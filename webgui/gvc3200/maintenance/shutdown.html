<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.prompt.js'></script>
<style>
.btndiv{margin:0;margin:150px 0 0 148px;text-align:center;}
.btndiv div{margin:0 56px 0 0 !important;width:122px;height:122px;border-radius:2px;border:1px solid #CFDCE6;color:#444444;font-size:14px;background:#F4F4F4;text-align:center;}
.btndiv button{font-size:18px;padding:0;width:54px;height:54px;min-width:0;margin-top:28px;}
.btndiv span{top: 15px;display: inline-block;width: 100%;float: left;position:relative;}
#rebootbtn{background:url("../img/shut_down_all.png") 0 0 transparent no-repeat;}
#sleepbtn{background:url("../img/shut_down_all.png") -216px 0 transparent no-repeat;}
#shutdownbtn{background:url("../img/shut_down_all.png") -108px 0 transparent no-repeat;}
#rebootbtn.rebootbuttonover{background:url("../img/shut_down_all.png") -54px 0 transparent no-repeat;}
#sleepbtn.rebootbuttonover{background:url("../img/shut_down_all.png") -270px 0 transparent no-repeat;}
#shutdownbtn.rebootbuttonover{background:url("../img/shut_down_all.png") -162px 0 transparent no-repeat;}
.divhover{background:#2C9BEA !important;color:#FFFFFF !important;cursor:pointer;}
</style>
<body id="framebody">
<div class="tooltip"></div>

<div id="mainbody" class="maindiv">
    <div class="navi"><span id="a_pagetitle">Shut Down</span></div>
    <div id="statusdiv"></div>
    <form action="" method="get" id="Formvalidate">
        <fieldset>
            <div class="btndiv">
                <div id="rebootdiv"><button id="rebootbtn" type="button"></button><span class="reboot">Reboot</span></div>
                <div id="sleepdiv"><button id="sleepbtn" type="button"></button><span class="sleep">Sleep</span></div>
                <div id="shutdowndiv"><button id="shutdownbtn" type="button"></button><span class="shutdown">Shut Down</span></div>
            </div>
        </fieldset>
    </form>
</div>

<script type="text/javascript">
    var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
    }
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");

</script>
<script type="text/javascript">
$(function(){
    translate_page();
    pageEventActions();
});

function translate_page(){
    $(".reboot").text(a_4251);
    $(".sleep").text(a_16375);
    $(".shutdown").text(a_17020);
}

function cb_shutdownres(data, type){
    var msgs = res_parse_rawtext(data);
    if (msgs.headers['response'].toLowerCase() == "pong") {
        $.cookie( "ShutdownType" ,  type , { path: '/', expires: 30 });
        window.parent.location='/reboot.html';
    } else {
        window.parent.location='/login.html';
    }
}
function cb_shutdown(type){
	var urihead = "action=ping";
	urihead += "&time=" + new Date().getTime();
	$.ajax ({
		type: 'get',
		url:'/manager',
		data:urihead,
		dataType:'text',
		success:function(data) {
			cb_shutdownres(data, type);
		},
		error:function(xmlHttpRequest, errorThrown) {
			cb_networkerror(xmlHttpRequest, errorThrown);
		}
	});
}

function reboot(type)
{
	var urihead = "action=reboot&reboottype=" + type;
	urihead += "&time=" + new Date().getTime();
	$.ajax ({
		type: 'get',
		url:'/manager',
		data:urihead,
		dataType:'text',
		success:function(data) {
		},
		error:function(xmlHttpRequest, errorThrown) {
		}
	});
}

function isUpgrade(){
    var isupgradenow = 0;
    var urihead = "action=isupgrade";
	urihead += "&time=" + new Date().getTime();
	$.ajax ({
		type: 'get',
		url:'/manager',
		data:urihead,
		dataType:'text',
        async:false,
		success:function(data) {
            var tObj = eval("(" + data + ")");
            isupgradenow = tObj.msg;
		},
		error:function(xmlHttpRequest, errorThrown) {
		}
	});

    return isupgradenow;
}

function pageEventActions(){
    $("#shutdowndiv").click(function(){
        if(isUpgrade() == "1"){
            $.prompt(a_19242);
            return false;
        }
        
        var iscalling;
        if($("#meettingdiv", window.parent.document).children("img").attr("src").indexOf("gif") != -1){
            iscalling = true;
        }else{
            iscalling = false;
        }
        
        if(iscalling){
            var $appenddiv = $("#framebody");
            var btnarray = new Array(a_20006, a_20007);
            alertPrompt($appenddiv, a_20003+":", btnarray);
            $("#alertboard").attr("operation", "shutdown");
        }
        else{
            var txt = '<div class="shortmsg">' + a_19171 + '</div>';
    		$.prompt(txt,{
    			buttons:{
    				OK:true,
    				Cancel:false
    			},
    			callback: function(v,m,f){
    				if(v){
    					cb_shutdown(1);			
    				}
    				else{}			
    			}
    		});
        }
    });
    
    $(".btndiv div").hover(function(){
        $(this).addClass("divhover");
        $(this).children("button").addClass("rebootbuttonover");
    },function(){
        $(this).removeClass("divhover");
        $(this).children("button").removeClass("rebootbuttonover");
    });
    
    $("#rebootdiv").click(function(){
        if(isUpgrade() == "1"){
            $.prompt(a_19242);
            return false;
        }
        
        var iscalling;
        if($("#meettingdiv", window.parent.document).children("img").attr("src").indexOf("gif") != -1){
            iscalling = true;
        }else{
            iscalling = false;
        }
        
        if(iscalling){
            var $appenddiv = $("#framebody");
            var btnarray = new Array(a_20008, a_20004);
            alertPrompt($appenddiv, a_20003+":", btnarray);
            $("#alertboard").attr("operation", "reboot");
        }
        else{
            var txt = '<div class="shortmsg">' + a_16469 + '</div>';
    		$.prompt(txt,{
    			buttons:{
    				OK:true,
    				Cancel:false
    			},
    			callback: function(v,m,f){
    				if(v){
    					cb_shutdown(0);
    				}
    				else{}			
    			}
    		});
        }
	});
	
	$("#sleepdiv").click(function(){
        if(isUpgrade() == "1"){
            $.prompt(a_19242);
            return false;
        }
        
        var iscalling;
        if($("#meettingdiv", window.parent.document).children("img").attr("src").indexOf("gif") != -1){
            iscalling = true;
        }else{
            iscalling = false;
        }
        
        if(iscalling){
            var $appenddiv = $("#framebody");
            var btnarray = new Array(a_20009, a_20005);
            alertPrompt($appenddiv, a_20003+":", btnarray);
            $("#alertboard").attr("operation", "sleep");
        }
        else{
            var txt = '<div class="shortmsg">' + a_16470 + '</div>';
    		$.prompt(txt,{
    			buttons:{
    				OK:true,
    				Cancel:false
    			},
    			callback: function(v,m,f){
    				if(v){
    					cb_shutdown(2);		
    				}
    				else{}			
    			}
    		});
        }
    });
    
    $("#btngroup button:eq(0)").live("click", function(){
        var operation = $("#alertboard").attr("operation");
        switch (operation) {
            case "reboot":    //reboot now
                cb_shutdown(4);
                break;
            case "shutdown":
                cb_shutdown(5);
                break;
            case "sleep":
                cb_shutdown(6);
                break;
        }
    });
    
    $("#btngroup button:eq(1)").live("click", function(){
        var operation = $("#alertboard").attr("operation");
        switch (operation) {
            case "reboot":    //reboot when idle
                reboot(0);
                break;
            case "shutdown":
                reboot(1);
                break;
            case "sleep":
                reboot(2);
                break;
        }
        
        $("#cancelbtn").click();
    });
}
</script>

</body>

</html>
