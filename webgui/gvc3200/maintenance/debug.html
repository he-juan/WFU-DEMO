<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<link href='../css/black_frame.css' type='text/css' rel='stylesheet' id="framecssfile">
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.stylish-select.min.js'></script>
<body id="framebody" class="maintenancebody">
<div id="mainbody" class="maindiv">
    <div class="navi"><span id="a_debug">Debug</span></div>
    <div id="statusdiv"></div>
	<form action="" method="get" class="Formvalidate">
		<fieldset>
            <div webtip="Capture Trace">
                <div class="noreboot"><span id="a_operation">Capture Trace</span> :</div>
                <button id="a_start" type="button">Start</button>
            </div>
            <div webtip="Trace List" style="width:710px;">
                <div class="noreboot"><span id="a_tracelist">Trace List</span> :</div>
                <select id="tracelist" name="tracelist"></select>
                <button id="a_delete" type="button" style="margin-left:5px;margin-top:5px;">Delete</button>
            </div>
            <div style="padding-bottom:10px;" webtip="View Trace">
                <div class="noreboot"><span id="a_view">View Trace</span> :</div>
                <button id="a_list" type="button">List</button>
            </div>
        </fieldset>
	</form>


</div>
<script type="text/javascript">
	var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
	}
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");

</script>
<script type="text/javascript">


$(function(){
    translate_debug();
    cb_get_action('capture&mode=mode&region=maintenance');
    cb_get_tracelist();
    //cb_get(req_items);
    pageEventActions();
});
function get_item_suc_callback() {
    
}
function cb_get_action_done(data, action) {
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    if (cb_is_fail(msgs)){
    }else {
        if(action == 'capture&mode=mode&region=maintenance')
            view_mode_write(msgs);
        //else if(action == 'capture&mode=on' || action == 'capture&mode=off')
        else if(action == 'capture&mode=off&region=maintenance') {
            view_message(a_7479, MSG_OK);
            cb_get_tracelist();
        }
    }
}
function view_mode_write(msgs)
{
    if (msgs.headers['mode'] == "on"){
        mode = 0;
        $("#a_start").text(a_10);
    }
    else{
        mode = 1;
        $("#a_start").text(a_9);
    }
}
function cb_get_tracelist()
{
    var urihead = "action=tracelist&region=maintenance";
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_get_tracelist_done(data);
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}
function cb_get_tracelist_done(data)
{
    if($(".newListSelected")){
        $(".newListSelected").remove();
        $('#tracelist').empty();
        $("#a_delete").attr("disabled","disabled");
    }
    var selvalue = "";
    if( data.substring(0, 1) == "{" )
    {
        var json = eval("(" + data + ")");
	    var tracelist = json.Tracelist;
	    for (var i = 0; tracelist[i] != undefined; i++) {
		    var $opt = $("<option value='" + tracelist[i] + "'>" + htmlEncode(tracelist[i]) + "</option>");
		    $('#tracelist').append($opt);
	    }
	    selvalue = tracelist[0];
	}
	$('#tracelist').sSelect();
	$('#tracelist').getSetSSValue(tracelist[0]);
    if(selvalue != undefined)
        $("#a_delete").removeAttr("disabled");
}
function cb_put_suc(data, mode)
{
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    if( cb_if_is_fail(msgs) )
        view_message(a_58, MSG_FAIL);
    else 
        view_message(a_57, MSG_OK);
    checkIsApplyNeed();
    /*if (mode == "cfupdated") {
         dbussend_cfupdated();
    }*/
}
function cb_delete_trace()
{
    if( $('#tracelist').val() == null ) return;
    var urihead = "action=deletetrace&region=maintenance&tracename=" + $('#tracelist').getSetSSValue();
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_put_suc(data);
            cb_get_tracelist();
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
} 
function translate_debug(){
    $("#a_debug").text(a_16031);
    $("#a_operation").text(a_16357);
    //$("#a_pcap").text(a_pcap);
    $("#a_view").text(a_16358);
    $("#a_tracelist").text(a_16359);
    $("#a_delete").text(a_21);
    $("#a_start").text(a_9);
    $("#a_list").text(a_2106);
}
function pageEventActions(){
    $("#a_start").click(function(){
        if (mode == 1) {
            mode = 0;
            $("#a_start").text(a_10);
            cb_get_action('capture&mode=on&region=maintenance');
        } else {
            mode = 1;
            $("#a_start").text(a_9);
            cb_get_action('capture&mode=off&region=maintenance');
        }
    });
    $("#a_delete").click(function(){
        cb_delete_trace();
    });
    $("#a_list").click(function(){
        parent.window.location = "/ppp";
    });
}

</script>

</body>

</html>
