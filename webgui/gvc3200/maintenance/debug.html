<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.stylish-select.min.js'></script>
<style>
.noreboot, .rebootitem{width: 250px;}
.one-click-debug{border: 1px solid #ccc; width: 527px; margin-left: 114px; padding: 10px 10px 3px 10px;}
.one-click-debug div{margin: 0 !important;}
.debuginfoleft{float: left; height: 100%; width: 150px; text-align: right; line-height: 30px;}
.debuginforight{float: right; height: 100%; width: 329px;}
/*#debuglist{margin: 0; width: 100%;}*/
.debuginforight .debugitem, .debuginforight .dotline, .debuginforight .select-all{margin-bottom: 10px !important;}
</style>
<body id="framebody" class="maintenancebody">
<div id="mainbody" class="maindiv">
    <div class="navi"><span id="a_debug">Debug</span></div>
	<form action="" method="get" id="Formvalidate">
        <div id="statusdiv"></div>
		<fieldset>
            <div webtip="One-click Debugging">
                <div class="noreboot"><span id="a_operation">One-click debugging</span> :</div>
                <button id="a_start" type="button">Start</button>
            </div>
            <div webtip="Debug Information List" id="debuglist" class="one-click-debug">
                <div class="debuginfoleft"><span id="a_debuglist">Debug Information List</span> :</div>
                <div class="debuginforight">
                    <div class="select-all">
                        <input id="selectall" type="checkbox" />
                        <span id="a_selectall">Select all</span>
                    </div>
                    <div class='dotline' style="width:85%;"></div>
                    <div class="debugitem">
                        <input id="syslogcheck" type="checkbox" />
                        <span id="a_syslog">Syslog</span>
                    </div>
                    <div class="debugitem">
                        <input id="logcatcheck" type="checkbox" />
                        <span id="a_logcat">Logcat</span>
                    </div>
                    <!--div class="debugitem">
                        <input id="dbuscheck" type="checkbox" />
                        <span id="a_dbus">D-Bus data</span>
                    </div>
                    <div class="debugitem">
                        <input id="bluetoothcheck" type="checkbox" />
                        <span id="a_bluetooth">Bluetooth info</span>
                    </div-->
                    <div class="debugitem">
                        <input id="capturecheck" type="checkbox" />
                        <span id="a_capture">Capture trace</span>
                    </div>
                </div>
            </div>
            <div webtip="Package List" style="width:710px;" id="tracelist_div">
                <div class="noreboot"><span id="a_tracelist">Trace List</span> :</div>
                <select id="tracelist" name="tracelist"></select>
                <button id="a_delete" type="button" style="margin-left:5px;">Delete</button>
            </div>
            <div style="padding-bottom:10px;" webtip="View Package">
                <div class="noreboot"><span id="a_view">View Trace</span> :</div>
                <button id="a_list" type="button">List</button>
            </div>
            <div class='dotline' style='margin-top:30px;margin-bottom:30px;'></div>
            <div webtip="Record">
                <div class="noreboot"><span id="a_record">Record</span> :</div>
                <button id="a_startrecord" type="button" state="0">Start</button>
            </div>
            <div webtip="Recording List" style="width:710px;">
                <div class="noreboot"><span id="a_reclist">Recording List</span> :</div>
                <select id="recordlist" name="recordlist"></select>
                <button id="a_deleterec" type="button" style="margin-left:5px;">Delete</button>
            </div>
            <div style="padding-bottom:10px;" webtip="View Recording">
                <div class="noreboot"><span id="a_viewrec">View Recording</span> :</div>
                <button id="a_listrec" type="button">List</button>
            </div>
            <div class='dotline' style='margin-top:30px;margin-bottom:30px;'></div>
            <div webtip="Enable Core Dump Generation">
                <div class="noreboot"><span id="a_enablecoredump">Enable Core Dump Generation</span> :</div>
                <input type='checkbox' id='enabcoredump'><span id='a_enabcoredumpyes'>Yes</span>
                <span class='rebootspan'></span>
            </div>
            <div webtip="Core Dump List" id='coredump_div'>
                <div class="noreboot"><span id="a_coredumplist">Core Dump List</span> :</div>
                <select id="coredumplist" name="coredumplist"></select>
                <button id="a_delete_coredump" type="button" style="margin-left:5px;">Delete</button>
            </div>
            <div style="padding-bottom:10px;" webtip="View Core Dump">
                <div class="noreboot"><span id="a_view_coredump">View Core Dump</span> :</div>
                <button id="a_list_coredump" type="button">List</button>
            </div>
            <div class='savediv' style="margin-left:304px !important;">
                <button id='a_save' class='savebtn' type='button'>Save</button>
                <button id='a_cancel' type='reset'>Cancel</button>
            </div>
        </fieldset>
	</form>
</div>
<script type="text/javascript">
	var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
	}
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");

</script>
<script type="text/javascript">

var req_items = new Array;
req_items.push(
    new ReqItem("enabcoredump", "29611", ""),
    new ReqItem("syslogcheck", "syslog", ""),
    new ReqItem("logcatcheck", "logcat", ""),
    new ReqItem("capturecheck", "capture", "")
);

$(function(){
    translate_debug();
    cb_get_action('capture&mode=mode&region=maintenance');
    cb_get_tracelist();
    cb_get_action('getrecordlist&region=maintenance&list=0');
    cb_get_action('coredumplist&region=maintenance');
    cb_get_action('get&var-0000=saveaudio');
    cb_get(req_items);
    pageEventActions();
});
function get_item_suc_callback() {
    var count = 0;
    $(".debugitem input").each(function(){
        if($(this).prop("checked")) count++;
    });
    if(count == 3 || count == 0){
        $(".debuginforight input").attr("checked", "checked");
    } else {
        if(!$("#capturecheck").prop("checked")){
            $("#a_start").text(a_19281);
        }
    }
}
function cb_get_action_done(data, action) {
    if( data.substring(0, 1) == "{" ){
        var tObj = eval("(" + data + ")");
        if (action.indexOf("list=0") != -1){
            if ($("#recordlist").next(".newListSelected")) {
                $("#recordlist").next(".newListSelected").remove();
                $('#recordlist').empty();
            }
            var selvalue = "";
            var reclist = tObj.Records;
            if(!reclist.length){
                $("#a_deleterec").prop("disabled", true);
            }else{
                for (var i = 0; reclist[i] != undefined; i++) {
                    var recOption = document.createElement('OPTION');
                    recOption.setAttribute('value', reclist[i]);
                    recOption.appendChild(document.createTextNode(reclist[i]));
    
                    $('#recordlist').append(recOption);
                }
                
                $("#a_deleterec").prop("disabled", false);
            }
            
            selvalue = reclist[0];
            $('#recordlist').sSelect({ddMaxHeight:'250px'});
            $('#recordlist').getSetSSValue(selvalue);
        } else if(action.indexOf("list=1") != -1){
            parent.window.location = "/recfiles";
        } else if (action.indexOf("coredumplist") != -1){
            if ($("#coredump_div .newListSelected")) {
                $("#coredump_div .newListSelected").remove();
                $('#coredumplist').empty();
            }

            var coredumplist = tObj.Coredumplist;
            if(coredumplist.length){
                for (var i = 0; coredumplist[i] != undefined; i++) {
                    var $opt = $("<option value='" + coredumplist[i] + "'>" + htmlEncode(coredumplist[i]) + "</option>");
                    $('#coredumplist').append($opt);
                }
                $("#a_delete_coredump").removeAttr("disabled");
            }else{
                $("#a_delete_coredump").attr("disabled", "disabled");
            }
            
            $('#coredumplist').sSelect({ddMaxHeight:'250px'});
        }
    }
    else{
        var msgs = res_parse_rawtext(data);
        cb_if_auth_fail(msgs);
        if (cb_is_fail(msgs)){
        }else {
            if(action.indexOf('mode=mode&region=maintenance') != -1)
                view_mode_write(msgs);
            //else if(action == 'capture&mode=on' || action == 'capture&mode=off')
            else if(action.indexOf('mode=off') != -1 || action.indexOf('mode=none') != -1) {
                cb_get_tracelist();
                window.parent.location.href = "../ppp/debugInfo.tar";
            } else if (action.indexOf('saveaudio') != -1){
                // init the status of start button:  0-ready to start 1-during recording
                var record_state = msgs.headers['saveaudio'];
                if (record_state == 1) {
                    $("#a_startrecord").attr("state", "1");
                    $("#a_startrecord").text(a_10);
                    $("#a_deleterec").prop("disabled", true);
                }
            } else if (action.indexOf("startrecording") != -1){
                if(msgs.headers['response'] == "Success"){
                    $("#a_startrecord").text(a_10).attr("state", "1");
                    $("#a_deleterec").prop("disabled", true);
                }
            } else if (action.indexOf("stoprecording") != -1){
                if(msgs.headers['response'] == "Success"){
                    $("#a_startrecord").text(a_9).attr("state", "0");
                    $("#a_deleterec").prop("disabled", false);
                    cb_get_action('getrecordlist&region=maintenance&list=0');
                }
            } else if (action.indexOf("deleterecordfile") != -1){
                cb_del_suc(data);
                cb_get_action('getrecordlist&region=maintenance&list=0');
            } else if (action.indexOf("deletecoredump") != -1){
                cb_del_suc(data);
                cb_get_action('coredumplist&region=maintenance');
            }
        }
    }
}
function view_mode_write(msgs)
{
    if (msgs.headers['mode'] == "on"){
        mode = 0;
        $("#a_start").text(a_10);
        $(".debuginforight input").attr("disabled", "disabled");
    }
    else{
        mode = 1;
        $("#a_start").text(a_9);
    }
}
function cb_get_tracelist()
{
    var urihead = "action=tracelist&region=maintenance";
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_get_tracelist_done(data);
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}
function cb_get_tracelist_done(data)
{
    if($("#tracelist_div .newListSelected")){
        $("#tracelist_div .newListSelected").remove();
        $('#tracelist').empty();
        $("#a_delete").attr("disabled","disabled");
    }
    var selvalue = "";
    if( data.substring(0, 1) == "{" )
    {
        var json = eval("(" + data + ")");
	    var tracelist = json.Tracelist;
	    for (var i = 0; tracelist[i] != undefined; i++) {
		    var $opt = $("<option value='" + tracelist[i] + "'>" + htmlEncode(tracelist[i]) + "</option>");
		    $('#tracelist').append($opt);
	    }
	    selvalue = tracelist[0];
	}
	$('#tracelist').sSelect({ddMaxHeight:'250px'});
	$('#tracelist').getSetSSValue(tracelist[0]);
    if(selvalue != undefined)
        $("#a_delete").removeAttr("disabled");
}
function cb_del_suc(data, mode)
{
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    if( cb_if_is_fail(msgs) )
        view_message(a_58, MSG_FAIL);
    else 
        view_message(a_57, MSG_OK);
    checkIsApplyNeed();
    /*if (mode == "cfupdated") {
         dbussend_cfupdated();
    }*/
}
function cb_delete_trace()
{
    if( $('#tracelist').val() == null ) return;
    var urihead = "action=deletetrace&region=maintenance&tracename=" + $('#tracelist').getSetSSValue();
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_del_suc(data);
            cb_get_tracelist();
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
} 
function translate_debug(){
    $("#a_debug").text(a_16031);
    $("#a_operation").text(a_19277);
    //$("#a_pcap").text(a_pcap);
    $("#a_view").text(a_16358);
    $("#a_tracelist").text(a_16359);
    $("#a_delete, #a_deleterec, #a_delete_coredump").text(a_21);
    $("#a_start, #a_startrecord").text(a_9);
    $("#a_list, #a_listrec, #a_list_coredump").text(a_2106);
    $("#a_record").text(a_410);
    $("#a_reclist").text(a_19260);
    $("#a_viewrec").text(a_19261);
    $("#a_enablecoredump").text(a_19262);
    $("#a_coredumplist").text(a_19263);
    $("#a_view_coredump").text(a_19264);
    $("#a_enabcoredumpyes").text(a_5);
    $("#a_debuglist").text(a_19280);
    $("#a_selectall").text(a_405);
    $("#a_syslog").text(a_4144);
    $("#a_logcat").text(a_16030);
    $("#a_dbus").text(a_19278);
    $("#a_bluetooth").text(a_19279);
    $("#a_capture").text(a_16357);
    $("#a_save").text(a_17);
    $("#a_cancel").text(a_3);
}
function pageEventActions(){
    $("#selectall").change(function(e){
        if(e.target.checked){
            $(".debugitem input").attr("checked", "checked");
            $("#a_start").prop("disabled", false);
            $("#a_start").text(a_9);
        }else{
            $(".debugitem input").removeAttr("checked");
            $("#a_start").prop("disabled", true);
            $("#a_start").text(a_19281);
        }
    });
    
    $(".debugitem input").change(function(e){
        if(e.target.checked){
            $(this).attr("checked", "checked");
            if($(".debugitem input[checked=checked]").length == 3){
                $("#selectall").prop("checked", true);
            }
            $("#a_start").prop("disabled", false);
            if($(this).attr("id") == "capturecheck"){
                $("#a_start").text(a_9);
            }
        }else{
            $(this).removeAttr("checked");
            $("#selectall").prop("checked", false);
            if($(".debugitem input[checked=checked]").length == 0){
                $("#a_start").prop("disabled", true);
            }
            if($(this).attr("id") == "capturecheck"){
                $("#a_start").text(a_19281);
            }
        }
    });
    
    $("#a_start").click(function(){
        var request;
        if($(this).text() == a_19281){
            request = "oneclickdebug&mode=none&region=maintenance&";
        }else{
            if (mode == 1) {
                mode = 0;
                $("#a_start").text(a_10);
                $(".debuginforight input").attr("disabled", "disabled");
                request = "oneclickdebug&mode=on&region=maintenance&";
            } else {
                mode = 1;
                $("#a_start").text(a_9);
                $(".debuginforight input").removeAttr("disabled");
                request = "oneclickdebug&mode=off&region=maintenance&";
            }
        }
        
        //var checkitems = ["syslog", "logcat", "dbus", "bluetooth", "capture"];
        var checkitems = ["syslog", "logcat", "capture"];
        for(var i = 0; i < checkitems.length; i++){
            if($("#" + checkitems[i] + "check").prop("checked")){
                request += checkitems[i] + "=1&";
            }else{
                request += checkitems[i] + "=0&";
            }
        }
        request = request.substring(0, request.length - 1);
        cb_get_action(request);
    });
    $("#a_delete").click(function(){
        cb_delete_trace();
    });
    $("#a_list").click(function(){
        parent.window.location = "/ppp";
    });
    
    $("#a_startrecord").click(function(){
        var state = $(this).attr("state");
        if(state == "0"){
            cb_get_action("startrecording&region=maintenance");
        }else{
            cb_get_action("stoprecording&region=maintenance");
        }
    });
    
    $("#a_listrec").click(function() {
        cb_get_action('getrecordlist&region=maintenance&list=1');
    });
    
    $("#a_deleterec").click(function() {
        var recordfile = $("div[webtip='Recording List']").children(".newListSelected").children(".selectedTxtDiv").children().text();
        cb_get_action("deleterecordfile&region=maintenance&recordname=" + recordfile);
    });
    
    $("#a_list_coredump").click(function() {
        parent.window.location = "/coredump";
    });
    
    $("#a_delete_coredump").click(function() {
        cb_get_action("deletecoredump&region=maintenance&coredumpname=" + $('#coredumplist').getSetSSValue());
    });
    
    $('#a_save').click(function() {
        cb_put(req_items, "", 0);
    });
}

</script>

</body>

</html>
