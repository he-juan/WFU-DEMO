<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<link href='../css/apps.css' type='text/css' rel='stylesheet' id="framecssfile">
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.prompt.js'></script>
<!--[if lt IE 10]>
<script type="text/javascript" src="../js/PIE.js"></script>
<![endif]-->
<style>
.itemname{width:120px;margin-left:0;}
.itemcontent{width:185px;}
#contentdiv div{width:306px;text-align:left;}
#stoppreviewbtn{width:120px;}
#rightbtn button{float:right;}
</style>
<body id="framebody" class="maintenancebody">
<div id="mainbody" class="maindiv appmaindiv">
    <div id="leftdiv" class="appleft">
        <div webtip="" id="itemsdiv">
            
        </div>
        <div class="appsbtn">
            <input type="checkbox" id="selectall" class="selectall" />
            <button id="delcontact"></button>
            <button id="addcontact">Add</button>
            <button id="stoppreviewbtn">Stop Preview</button>
        </div>  
    </div>
    <div id="rightdiv" class="appright">
        <div class="titlediv">
            <div class="titleboot"><span id="a_details">Details</span></div>
        </div>
        <div id="persondiv" class="detailcontent">
            <div class="detaildiv">
                <div class="desdiv"><span id="a_detailname">Caption Name</span></div>
                <div class="contentdiv"><span id="detailname"></span></div>
                <div class="editdiv"><input id="editname" name="editname" style="width:170px;"></input></div>
            </div>
            <div class="detaildiv" id="contentdiv">
                <div class="contentdiv"><textarea id="detailcontent" disabled="disabled" style="width:340px;resize: none;border:none;background:transparent;"></textarea></div>
                <div class="editdiv"><textarea id="editcontent" style="width:330px;max-height:500px;resize: none;"></textarea></div>
            </div>
        </div>
        <div class="appsbtn" id="rightbtn">
            <button id="editbtn" class="editbtn">Edit</button>
            <button id="sharebtn" class="sharebtn">Apply</button>
            <button id="previewbtn" class="previewbtn">Preview</button>
            <button id="cancelbtn" class="cancelbtn">Cancel</button>
            <button id="savebtn">Save</button>
        </div>  
    </div>

</div>
<script type="text/javascript">
	var cookie_lang = $.cookie( "MyLanguage");
    if ( !cookie_lang ){
        cookie_lang = 'en';
	}
    document.write("<script src='../lang/" + cookie_lang + ".js'><\/script>");
    //$("#delhis").button();
</script>
<script type="text/javascript" src='../js/public.js'></script>
<script type="text/javascript">
var mEditMode = 0;
var mType = 2;  //0:banner  1:middle  2:bottom
var mItemsdivObj;
var mSelectId;
var mOptionNum, mOptionNumSuc, mOptionNumDone;

$(function(){
    /***************init state****************/
    $("#delcontact").attr("disabled","disabled").addClass("deldisable");
    $("#rightbtn button").hide();
    /*************************/
    mItemsdivObj = document.getElementById('itemsdiv');
    
    var cookie_type = $.cookie( "CaptionType");
    if (cookie_type) {
        mType = parseInt(cookie_type);
    }
    translate_page();
    //get caption
    cb_get_action("sqlitesettings&type=caption&type="+mType);
    
    var height = parseInt($("#iframediv",parent.document.body).css('height'));
    $("#itemsdiv").css("height", height - 60); //30+18
    $("#persondiv").css("height", height - 94); //30+18+34
    $("#editcontent, #detailcontent").css("height", height - 184);
    pageEventActions();
});
function create_caption_div(id, disname, content){
    var itemdiv = document.createElement('DIV');
    itemdiv.className='itemdiv';
    itemdiv.setAttribute("name", disname);
    itemdiv.setAttribute("content", content);
    itemdiv.setAttribute("captionid", id);
    itemdiv.id = "caption_" + id;
    
    var checkdiv = document.createElement('DIV');
    checkdiv.className='itemcheck';
    var checkbox = document.createElement('INPUT');
    checkbox.type = 'checkbox';
    checkbox.className = "inputcbx";
    if( $("#selectall").attr("checked") )
        checkbox.checked = true;
    checkbox.setAttribute("captionid", id);
    checkdiv.appendChild(checkbox);
    itemdiv.appendChild(checkdiv);

    var namediv = document.createElement('DIV');
    namediv.className='itemname';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = htmlEncode(disname);
    spantext.setAttribute("title", disname);
    namediv.appendChild(spantext);
    itemdiv.appendChild(namediv);
    
    var contentdiv = document.createElement('DIV');
    contentdiv.className='itemcontent';
    var contenttext = document.createElement('SPAN');
    contenttext.innerHTML = htmlEncode(content);
    contenttext.setAttribute("title", content);
    contentdiv.appendChild(contenttext);
    itemdiv.appendChild(contentdiv);
    
    mItemsdivObj.appendChild(itemdiv);
}
function add_item_event(){
    $(".itemdiv").click(function(){
        mSelectId = $(this).attr("captionid");
        $(".contentdiv").show();
        $(".editdiv").hide();
        $("#persondiv").show().siblings(".detailcontent").hide();
        $(this).addClass("selectItem").siblings(".itemdiv").removeClass("selectItem");
        $("#detailname").text($(this).attr("name"));
        $("#detailcontent").val($(this).attr("content"));

        $("#savebtn, #cancelbtn").hide();
        $("#editbtn, #previewbtn, #sharebtn").show();
    });
}
function cb_get_action_done(data, action) {
    if( data.substring(0, 1) == "{" )
    {
        data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
        if( action.indexOf("sqlitesettings" ) != "-1" ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if( action.indexOf("type=caption") != "-1" ){   
                var id, disname, content, type;
                for (var i = 0; items[i] != undefined; i++)
                {
                    id = items[i].Id;
                    disname = items[i].Name;
                    content = items[i].Content;
                    type = items[i].Type;
                    
                    create_caption_div(id, disname, content);
                }
                
                add_item_event();
                if( i > 0 )
                    $(".itemdiv").eq(0).click();
                else
                    $("#a_detailname").text(a_16051);
            }            
        }else{
            mOptionNumDone ++;
            var staypage = 0;
            var tObj = eval("(" + data + ")");
            if( tObj.res == "success" ){
                mOptionNumSuc ++;
                var tmpid = parseInt(tObj.msg);
                if( action.indexOf("addcaption") != "-1" ){
                    staypage = 1;
                    create_caption_div(tmpid, $("#editname").val(), $("#editcontent").val());
                    add_item_event();
                    $("#caption_" + tmpid).click();
                }else if( action.indexOf("updatecaption") != "-1" ){
                    staypage = 1;
                    var newname = $("#editname").val();
                    var newcontent = $("#editcontent").val();
                    $(".itemdiv[captionid=" + tmpid + "]").attr("name", newname).attr("content", newcontent).click().children(".itemname").children("span").text(newname).attr("title", newname);
                    $(".itemdiv[captionid=" + tmpid + "]").children(".itemcontent").children("span").text(newcontent).attr("title", newcontent);
                }else if( action.indexOf("delcaption") != "-1" ){
                    staypage = 1;
                    if( $("#selectall").attr("checked") ){
                        $(".itemdiv").remove();
                        $(".contentdiv, #previewbtn, #sharebtn, #editbtn").hide();
                    }else{
                        var tmpid = parseInt(tObj.msg);  
                        $(".itemdiv[captionid=" + tmpid + "]").remove();
                        if( $("#caption_" + mSelectId).length == 0 ){
                            $(".itemdiv").eq(0).click();
                        }else{
                            $("#caption_" + mSelectId).click();
                        }
                    }
                }
            }
            if( mOptionNum == mOptionNumDone ){
                window.parent.unblock_func();
                if( mOptionNumSuc == 0 ){
                    $.prompt(a_opfail);
                }else if( mOptionNum == mOptionNumSuc ){
                    //$.prompt(a_opsuc);
                    if( $(".itemdiv").length == 0 ){
                        $("#selectall").attr("checked", false);
                        $("#editbtn, #previewbtn, #sharebtn").hide();
                        $("#delcontact").attr("disabled", "disabled").addClass("deldisable");
                        $("#detailname").text("");
                        $("#detailcontent").val("");
                        $("#a_detailname").text(a_16051);
                    }else if( staypage == 0 ){
                        $(".itemdiv").eq(0).click();
                    }
                }
            }
        }
    }else{
        var msgs = res_parse_rawtext(data);
        cb_if_auth_fail(msgs);
    }
}
function translate_page(){
    $("#a_details").text(a_584);
    $("#a_cancel").text(a_3);
    $("#addcontact").text(a_23);
    $("#stoppreviewbtn").text(a_16052);
    $("#editbtn").text(a_22);
    $("#previewbtn").text(a_68);
    $("#sharebtn").text(a_1027);
    $("#savebtn").text(a_17);
    $("#cancelbtn").text(a_3);
    $("#a_details").text(a_584);
    $("#a_detailname").text(a_16050);
}
function pageEventActions(){
    $("#cancelbtn").click(function(){
        $(".editdiv").hide();
        $(".contentdiv").show();
        $("#savebtn,#cancelbtn").hide();
        if( $(".itemdiv").length == 0 ){
            $("#a_detailname").text(a_16051);
        }else{
            $("#editbtn, #previewbtn, #sharebtn").show();
        }
    });
    
    $("#editbtn").click(function(){
        mEditMode = 2;
        $("#editname").val( $("#detailname").text() );
        $("#editcontent").val( $("#detailcontent").val() );
        $(".contentdiv").hide();
        $(".editdiv").show();
        $("#savebtn,#cancelbtn").show();
        $("#editbtn, #previewbtn, #sharebtn").hide();
    });

    $("#addcontact").click(function(){
        mEditMode = 1;
        $("#editname, #editcontent").val("");
        $("#a_detailname").text(a_16050);
        $(".contentdiv").hide();
        $(".editdiv").show();
        $("#savebtn,#cancelbtn").show();
        $("#editbtn, #previewbtn, #sharebtn").hide();
    });

    $("#delcontact").click(function(){
        if( $(".itemdiv").length == 0 ) return false;
        window.parent.block_download_func(a_59);
        mOptionNum = 0;
        mOptionNumSuc = 0;
        mOptionNumDone = 0;
        if( $("#selectall").prop("checked") == true ){
            mOptionNum = 1;
            if( mEditMode != 0 )
                $("#caption_" + mSelectId).click();
            cb_get_action("delcaption&region=webservice&id="); 
        }else{
            $(".itemcheck .inputcbx").each(function(index, item) {
                if ($(item).prop("checked") == true) {
                    mOptionNum ++;
                    cb_get_action("delcaption&region=webservice&id=" + $(this).attr("captionid"));   
                }
            });
        }
    });
    
    $(".itemcheck .inputcbx").live("click", function() {
        if ($(this).prop("checked") != true) {
            var isall = 1;
            $("#selectall").removeAttr("checked");//.button("refresh");
            $(".itemcheck .inputcbx").each(function(index, item) {
                if ($(item).prop("checked") == true) {
                    isall = 0;
                    return false;   
                }
            });

            if(isall == 0)
                $("#delcontact").removeAttr("disabled").removeClass("deldisable");
            else
                $("#delcontact").attr("disabled","disabled").addClass("deldisable");

        } else {
            var isall = 1;
            $(".itemcheck .inputcbx").each(function(index, item) {
                if ($(item).prop("checked") != true) {
                    isall = 0;
                    return false;   
                }
            });

            if (isall == 1)
                $("#selectall").attr("checked", "checked");//.button("refresh");

            $("#delcontact").removeAttr("disabled").removeClass("deldisable");
        }
    });

    $("#selectall").click(function(){
        if ($(this).prop("checked") == true) {
            $(".itemcheck .inputcbx").attr("checked", "checked");//.button("refresh");
            $("#delcontact").removeAttr("disabled").removeClass("deldisable");
        } else {
            $(".itemcheck .inputcbx").removeAttr("checked");//.button("refresh");
            $("#delcontact").attr("disabled","disabled").addClass("deldisable");
        }
    });

    $("#sharebtn").click(function(){
        mOptionNum = 0;
        mOptionNumSuc = 0;
        mOptionNumDone = 0;
        cb_get_action("sharecaption&region=webservice&type=" + mType + "&content=" + encodeURIComponent($("#detailcontent").val()));
    });

    $("#stoppreviewbtn").click(function(){
        mOptionNum = 0;
        mOptionNumSuc = 0;
        mOptionNumDone = 0;
        cb_get_action("stopcaption&region=webservice&type=" + mType);
    });
    $("#previewbtn").click(function(){
        mOptionNum = 0;
        mOptionNumSuc = 0;
        mOptionNumDone = 0;
        cb_get_action("previewcaption&region=webservice&type=" + mType + "&content=" + encodeURIComponent($("#detailcontent").val()));
    });
    
    $("#savebtn").click(function(){
        if( $("#editname").val() == "" ){
            $.prompt(a_7435);
            return false;
        }
        if( $("#editcontent").val() == "" ){
            $.prompt(a_16429);
            return false;
        }
        mOptionNum = 0;
        mOptionNumSuc = 0;
        mOptionNumDone = 0;
        var action = "";
        if( mEditMode == 1 ){
            action += "addcaption&region=webservice";
        }else{
            action += "updatecaption&region=webservice&id=";
            action += mSelectId;
        }
        action += "&type=";
        action += mType; 
        action += "&name=";
        action += encodeURIComponent($("#editname").val());
        action += "&content=";
        action += encodeURIComponent($("#editcontent").val());
            
        mOptionNum ++;
        cb_get_action(action);
    });
}

</script>

</body>

</html>
