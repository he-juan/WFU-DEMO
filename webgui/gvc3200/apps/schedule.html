<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<link href='../css/apps.css' type='text/css' rel='stylesheet' id="framecssfile">
<link href="../css/jquery-ui.css" type="text/css" rel="stylesheet" />
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.stylish-select.min.js'></script>
<script type="text/javascript" src='../js/jquery.prompt.js'></script>
<script type="text/javascript" src='../js/jquery-ui.min.js'></script>
<script type="text/javascript" src='../js/jquery-ui-timepicker-addon.js'></script>
<script type="text/javascript" src='../js/jscolor.js'></script>
<script type="text/javascript" src="../js/color_exchange.js"></script>
<style>
body{font-size:14px;}
#rightdiv{position:absolute;left:388px;margin-left:2px;}    /*to solve ie browser datepicker issue*/
.itemdiv{*width:388px;}
.itemdiv:hover{cursor:pointer;}
.itemname, .itemcontent, .host{width:140px;}
.detailcontent{width:372px;padding-left:12px;}
.host{width:160px;}
.desdiv{width:180px;padding-left:10px;}
.descriptiondiv, .contentdiv, .editdiv{width:140px;margin-left: 10px;}
.contentdiv{width:150px;}
select, input[type="text"]{width:145px;}
.editdiv input[type="text"]{margin-top:8px;}
.editdiv input[type="checkbox"]{margin-top:13px;}
#captionContainer select,#captionContainer input[type="checkbox"]{width:auto;}
#captionbtn button{border:0;margin-left: 180px;}
#editbtn{display:none;*float:none;}
#editmemberbtn{font-size:14px;*width:150px;}
.righttopdiv, .memberdiv{border-bottom:1px solid transparent;width:355px;}
.hasborder{border-bottom:1px solid #e1e1e1;}
.inputhint{color:gray;}

/* css for timepicker */
#ui-datepicker-div{right:10px;}
.ui-timepicker-div .ui-widget-header { margin-bottom: 8px; }
.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { float: left; clear:left; padding: 0 0 0 5px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 45%; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; padding: 0 5px 0 0; }
.ui-timepicker-rtl dl dt{ float: right; clear: right; }
.ui-timepicker-rtl dl dd { margin: 0 45% 10px 10px; }

.datediv{float: left;width: 350px;color:#444444;margin-left:10px;}
.datetitle{position: relative;left:-10px;height:18px;font-weight:bold;margin-bottom:2px;}
.datetitle span{margin-left:16px;}
.missed{color:#999999;}
.datechild{border-left:1px solid #A6A6A6;padding-left:10px;margin:0;float:left;width:100%;}
.itemcheck{padding-top:19px;}
.itemline{width:45%;float: left;height:54px;}
.itemline div{text-align: left;margin-left: 0px;color: #222;white-space: nowrap;overflow: hidden;height:27px;line-height:27px;}
.itemline > div {float: left;}
.itemdiv{height:auto;float:left;border-bottom:1px solid #D3D3D3;margin:0px;padding:0 0 0 10px;width:350px;}
.itemname{font-weight:bold;}
.itemline .itemstate{color:red;float:right;margin-right:10px;}
.itemline .duration{float:right;margin-right:10px;}
.itemstate img{margin-right:10px;}
.membername{margin-left:13px;}
.membernametop, .membernamebot{height:21px;line-height:21px;width:100%;}
.emaileditdiv{display:none;}

.firstline{height: 34px;line-height: 34px;margin-top: 0px;}
.itemname, .host, .contentdiv{text-overflow: ellipsis;white-space:nowrap;overflow:hidden;}
.itemname span, .itemstate span, .itemstate img{position:relative;bottom: -5px;*bottom: -3px;}
.itemstate img{bottom:-7px;}
#a_detailmember,#showmembernum{color:#1D6EA8;font-weight:bold;}
.dividline{width:380px;height:1px;font-size:1px;line-height:1px;background:#cecece;float:left;margin-left:-20px;}
/*contacts*/
#allcontactsdiv input{width:14px;}
#allcontactsdiv .membername, #allcontactsdiv .membernumber{height:42px;line-height:42px;margin-left:10px;}
#allcontactsdiv .membernumber{*margin-left:0px;}
#allcontactsdiv .contactsdiv {height:42px;width:340px;margin:0;}
#searchdiv{height: 50px;}
#searchdiv p{color:red;display:none;width:330px;margin-top: 0px;}
#search{position:relative;height:30px;width: 220px !important;}
.contactsdiv div{*float: left;*display:inline-block;}
.membernumber{width:115px;margin-left:25px;color:#666;}
div.memberemail{width:152px;margin-left:25px;color:#666;display:none;}
#detailacct{width: 90px;height: 32px;margin-left: 8px;}

#itemsdiv, #inviteditemsdiv{margin-top:13px;margin-left:8px;width:380px;float:none;}
#startbtn{width:auto;}

.appgroupicon{float:left;}
.arrowicon{float:right;margin-top:3px;}
.membericon{width:35px;}
#membersdiv .membericon{width:20px;}
#membersdiv .memberdiv{padding-left:10px;}
#membersdiv .membernumber{width:150px;text-align:left;}
.groupmemberlist{display:none;}
.groupcontactsdiv .membername, .groupcontactsdiv .membericon{cursor: pointer;}
#persondiv .contactsdiv .appcallouticon,#persondiv .contactsdiv .appmissedicon ,#persondiv .contactsdiv .appincomingicon,#persondiv .contactsdiv .appcontacticon{margin-left:2px;}
#persondiv{display:none;}
/* datepicker */
#ui-datepicker-div{font-family:Arial;width: 230px;}
.ui-datepicker-buttonpane .ui-datepicker-close{background:#5089BA;border:none;color:#FFFFFF;font-weight:normal;}
.ui-datepicker-buttonpane .ui-datepicker-close.ui-state-hover{background:#186DB7;border:none;color:#FFFFFF; }
.ui-datepicker-buttonpane .ui-datepicker-current{background:#777777;border:none;color:#FFFFFF;opacity:1;}
.ui-datepicker-buttonpane .ui-datepicker-current.ui-state-hover{background:#595959;border:none;color:#FFFFFF; }

#schedulecallbtn{margin-left: 2px;position: relative;right:20px;top:2px;width: 120px;height: 34px;background: #FFFFFF;padding-top:11px;text-align: right;float: right;display:none;}
#startbtn{height: 29px;width: 28px;min-width: 0px;z-index: 2;background: url(../img/apps/call_status_icons.png) -61px 0px no-repeat;border: none;margin: 0 0 0 15px;padding: 0;outline: 0;}
#startbtn.buttonover{background: url("../img/apps/call_status_icons.png") -91px 0px no-repeat;}
#delschedule{height: 29px;width: 28px;z-index: 2;background: url(../img/apps/call_status_icons.png) -121px 0px no-repeat;border: none;margin: 0;padding: 0;outline: 0;cursor: pointer;min-width:0px;display:none;}
#delschedule.buttonover{background: url(../img/apps/call_status_icons.png) -151px 0px no-repeat;}
.itemdivhover{background:#FFFFFF url("../img/apps/schedule_item_hover.png") no-repeat left;}
.selectItem{background:#FFFFFF url("../img/apps/schedule_item_selected.png") no-repeat left;}
.noscheudlediv{width:100%;height:100%;text-align:center;display:none;}

#delscheduleall{position: absolute;left: 40px;top: 0;}
#delscheduleall.buttonover{background: #186DB7;}
#invited{position: absolute;left: 185px;top: 0;}
#selectall{margin-top:6px;}

.newListSelected{background:url("../img/call/meeting_control_triangle.png") no-repeat scroll 132px center;width:149px;margin-top:8px !important;margin-bottom:12px;border:1px solid #a6a6a6;text-align:left;}
.selectedTxtDiv{width:149px !important;}
.selectedTxt{width:120px !important;}
.newListSelected div, ul.newList{width:149px;}
.newListDisabled{background-color:#f2f2f2;}

.shortselect .newListSelected{background:url("../img/call/meeting_control_triangle.png") no-repeat scroll 92px center;width:110px;margin-left:8px;}
.shortselect .selectedTxtDiv, .shortselect .selectedTxt{width:110px !important;}
.shortselect .newListSelected div, .shortselect ul.newList{width:110px;}
.cusrepeatdivs{display:none;}
</style>
<body id="framebody" class="maintenancebody">
<div id="mainbody" class="maindiv appmaindiv">
    <div id="leftdiv" class="appleft">
        <div class="noscheudlediv"><span></span></div>
        <div webtip="" id="itemsdiv">
            
        </div>
        <div webtip="" id="inviteditemsdiv" style="display:none;">
            
        </div>
        <div class="appsbtn">
            <input type="checkbox" id="selectall" class="selectall" />
            <button id="delscheduleall"></button>
            <button id="invited" style="display:none;">Invited</button>
            <button id="addcontact">Add</button>
        </div>  
    </div>
    <div id="schedulecallbtn">
        <button id="delschedule"></button>
        <button id="startbtn"></button>
    </div>
    <div id="rightdiv" class="appright">
        <div id="persondiv" class="detailcontent">
            <div id="righttopdiv">
                <div class="righttopdiv" id="googleacctdiv" style="margin-top:10px;display:none;">
                    <div class="desdiv"><span id="a_relatedacct">Related Account</span></div>
                    <div class="contentdiv"><span id="detailrelatedacct"></span></div>
                    <div class="editdiv">
                        <select id="relatedacct" name="relatedacct">
                            <option value="1">Local</option>
                        </select>
                    </div>
                </div>
                <div class="righttopdiv" id="subjectdiv" style="margin-top:10px;">
                    <div class="desdiv"><span id="a_detailname">Conference Name</span></div>
                    <div class="contentdiv" id="confnamedisdiv"><span id="detailname"></span></div>
                    <div class="editdiv" id="confnameeditdiv"><input id="selectconfname" name="selectconfname" maxlength="64" type="text" /></div>
                </div>
                <div class="righttopdiv cloudconf">
                    <div class="desdiv"><span id="a_conferencenumber">Conference Number</span></div>
                    <div class="contentdiv"><span id="conferencenumber"></span></div>
                </div>
                <div class="righttopdiv cloudconf">
                    <div class="desdiv"><span id="a_conferencepassword">Conference Password</span></div>
                    <div class="contentdiv"><span id="conferencepassword"></span></div>
                </div>
                <div class="righttopdiv">
                    <div class="desdiv"><span id="a_detailtime">Start Time</span></div>
                    <div class="contentdiv"><span id="detailtime"></span></div>
                    <div class="editdiv"><input id="edittime" name="edittime" type="text" /></div>
                </div>
                <div class="righttopdiv">
                    <div class="desdiv"><span id="a_detailduration">End Time</span></div>
                    <div class="contentdiv"><span id="detailduration"></span></div>
                    <div class="editdiv"><input id="editduration" name="editduration" type="text" /></div>
                </div>
                <div class="righttopdiv">
                    <div class="desdiv" style="width:150px;"><span id="a_detailreminder">Reminder Time</span></div>
                    <div class="descriptiondiv" id="advancediv" style="width:180px;"><input id="remindercheck" type="checkbox" /><span id="a_inadvance">10 mins in advance</span></div>
                </div>
                <!--div class="righttopdiv">
                    <div class="desdiv" id="autoanswerdiv" style="width:250px;"><span id="a_detailautoanswer">Auto Answer for Conference Members</span></div>
                    <div class="contentdiv" style="width:75px;margin-left:14px;"><span id="detailautoanswer"></span></div>
                    <div class="editdiv" style="width:60px;margin-left:10px;"><input id="autoanswer" type="checkbox" /></div>
                </div>
                <div class="righttopdiv pincodediv">
                    <div class="desdiv"><span id="a_confpincode">Conference PIN Code</span></div>
                    <div class="contentdiv"><span id="showpincode"></span></div>
                    <div class="editdiv"><input id="confpincode" name="confpincode" type="text" maxlength="10" /></div>
                </div>
                <div class="righttopdiv" id="presetdiv">
                    <div class="desdiv"><span id="a_confpreset">Conference Preset</span></div>
                    <div class="contentdiv"><span id="showpreset"></span></div>
                    <div class="editdiv">
                        <select id="confpreset" name="confpreset">
                            <option value="-1">None</option>
                            <option value="0">Preset1</option>
                            <option value="1">Preset2</option>
                            <option value="2">Preset3</option>
                            <option value="3">Preset4</option>
                            <option value="4">Preset5</option>
                            <option value="5">Preset6</option>
                            <option value="6">Preset7</option>
                            <option value="7">Preset8</option>
                            <option value="8">Preset9</option>
                            <option value="9">Preset10</option>
                            <option value="10">Preset11</option>
                            <option value="11">Preset12</option>
                            <option value="12">Preset13</option>
                            <option value="13">Preset14</option>
                            <option value="14">Preset15</option>
                            <option value="15">Preset16</option>
                            <option value="16">Preset17</option>
                            <option value="17">Preset18</option>
                            <option value="18">Preset19</option>
                            <option value="19">Preset20</option>
                            <option value="20">Preset21</option>
                            <option value="21">Preset22</option>
                            <option value="22">Preset23</option>
                            <option value="23">Preset24</option>
                        </select>
                    </div>
                </div-->
                <div class="righttopdiv_hidden" style="display:none;">
                    <div class="desdiv" style="width:295px;"><span id="a_detaildnd">Conference  DND</span></div>
                    <div class="contentdiv" style="width:50px;margin-left:-5px;"><span id="detaildnd"></span></div>
                    <div class="editdiv" style="width:54px;margin-left:-9px;"><input id="dndcheck" type="checkbox" /></div>
                </div>
                <div class="righttopdiv cloudconf">
                    <div class="desdiv" style="width:50px;"><span>URL</span></div>
                    <div class="contentdiv" style="width:280px;"><span id="conferenceurl"></span></div>
                </div>
                <div class="righttopdiv cloudconf" id="pstndivs" style="min-height:42px;height:auto;">
                    <div class="desdiv" style="width:120px;"><span id="a_pstn">PSTN Access</span></div>
                    <div class="contentdiv" style="width:210px;line-height:21px;white-space:normal;overflow:visible;"><span id="conferencepstn"></span></div>
                </div>
                <div class="righttopdiv" id="repeatdiv">
                    <div class="desdiv"><span id="a_repeat">Repeat</span></div>
                    <div class="contentdiv"><span id="detailrepeat"></span></div>
                    <div class="editdiv">
                        <select id="repeat" name="repeat">
                            <option value="0">One-time event</option>
                            <option value="1">Daily</option>
                            <option value="2">Every weekday (Mon-Fri)</option>
                            <option value="3">Weekly</option>
                            <option value="4">Monthly (by week)</option>
                            <option value="5">Monthly (by day)</option>
                            <option value="6">Yearly</option>
                            <option value="7">Custom</option>
                        </select>
                    </div>
                </div>
                <div class="righttopdiv" id="responsediv" style="display:none;">
                    <div class="desdiv"><span id="a_googlestatus">Repeat</span></div>
                    <div class="contentdiv"><span id="googlestatus"></span></div>
                </div>
                <div class="righttopdiv cusrepeatdivs" id="cusrepeatdiv">
                    <div class="desdiv"><span id="a_cusrepeat">Custom Repeat</span></div>
                    <div class="editdiv">
                        <select id="cusrepeat" name="cusrepeat">
                            <option value="0">Daily</option>
                            <option value="1">Weekly</option>
                            <option value="2">Monthly (by day)</option>
                            <option value="3">Monthly (by week)</option>
                            <option value="4">Yearly</option>
                        </select>
                    </div>
                </div>
                <div class="righttopdiv cusrepeatdivs">
                    <div class="desdiv"><span id="a_cusinterval">Every Fixed Days</span></div>
                    <div class="editdiv"><input id="cusinterval" name="cusinterval" type="text" maxlength="2" /></div>
                </div>
                <div class="righttopdiv cusrepeatdivs" id="cusweeklydiv" style="height: 84px;">
                    <div class="desdiv" style="width:80px"><span id="a_cusweeklyon">Repeat On</span></div>
                    <div class="editdiv" style="width:250px">
                        <input id="cusweeklysu" name="cusweekly" type="checkbox" daystr="SU" /><span id="a_sunday">Sunday</span>
                        <input id="cusweeklymo" name="cusweekly" type="checkbox" daystr="MO" /><span id="a_monday">Monday</span>
                        <input id="cusweeklytu" name="cusweekly" type="checkbox" daystr="TU" /><span id="a_tuesday">Tuesday</span><br/>
                        <input id="cusweeklywe" name="cusweekly" type="checkbox" daystr="WE" /><span id="a_wendesday">Wendesday</span>
                        <input id="cusweeklyth" name="cusweekly" type="checkbox" daystr="TH" /><span id="a_thursday">Thursday</span>
                        <input id="cusweeklyfr" name="cusweekly" type="checkbox" daystr="FR" /><span id="a_friday">Friday</span>
                        <input id="cusweeklysa" name="cusweekly" type="checkbox" daystr="SA" /><span id="a_saturday">Saturday</span>
                    </div>
                </div>
                <div class="righttopdiv cusrepeatdivs" id="cusmonthlydaydiv">
                    <div class="desdiv"><span id="a_cusmonthday">Repeat On</span></div>
                    <div class="editdiv">
                        <select id="cusmonthday" name="cusmonthday">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                        </select>
                    </div>
                </div>
                <div class="righttopdiv cusrepeatdivs shortselect" id="cusmonthlyweekdiv" style="display:none;">
                    <div class="desdiv" style="width:90px"><span id="a_cusmonthweek">Repeat On</span></div>
                    <div class="editdiv" style="width:240px">
                        <select id="cusmonthweekordinal" name="cusmonthweekordinal" style="width: 120px">
                            <option value="1">first</option>
                            <option value="2">second</option>
                            <option value="3">third</option>
                            <option value="4">fourth</option>
                            <option value="5">last</option>
                        </select>
                        <select id="cusmonthweekday" name="cusmonthweekday" style="margin-left:10px;width: 120px">
                            <option value="0">Sunday</option>
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wendesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                        </select>
                    </div>
                </div>
                <div class="righttopdiv cusrepeatdivs shortselect" id="cusyearlydiv">
                    <div class="desdiv" style="width:90px"><span id="a_cusyearlydate">Repeat On</span></div>
                    <div class="editdiv" style="width:240px">
                        <select id="cusyearlydatemonth" name="cusyearlydatemonth" style="width: 120px">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                        <select id="cusyearlydateday" name="cusyearlydateday" style="width: 120px">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                        </select>
                    </div>
                </div>
                <div class="righttopdiv cusrepeatdivs">
                    <div class="desdiv"><span id="a_cusstartdate">Start Date</span></div>
                    <div class="editdiv"><span id="cusstartdate"></span></div>
                </div>
                <div class="righttopdiv cusrepeatdivs">
                    <div class="desdiv"><span id="a_cusenddate">End Date</span></div>
                    <div class="editdiv"><input id="cusenddate" name="cusenddate" type="text" /></div>
                </div>
                <!--
                <div class="righttopdiv">
                    <div class="desdiv"><span id="a_detailcaption">Caption</span></div>
                    <div class="contentdiv"><span id="detailcaption"></span></div>
                    <div class="editdiv"><button id="editcaption">Edit caption</button></div>
                </div>
                -->
                <!--
                <div class="righttopdiv">
                    <div class="desdiv"><span id="a_detailcycle">Cycle</span></div>
                    <div class="contentdiv"><span id="detailcycle"></span></div>
                    <div class="editdiv"><input id="cyclecheck" type="checkbox" /></div>
                </div>
                <div class="righttopdiv">
                    <div class="desdiv"><span id="a_detailcolor">Color</span></div>
                    <div class="contentdiv"><span id="detailcaption"></span></div>
                    <div class="editdiv"><button id="colorcheck">Edit caption</button></div>
                </div>
                -->
                <!--<div class="dividline"></div>-->
                <div class="righttopdiv" style="border-bottom:none;line-height:normal;">
                    <div class="desdiv" style="width:200px;"><span id="a_detailmember">Conference Members</span><span id="showmembernum"></span></div>
                    <div class="editdiv" style="margin-left:0px;margin-top:6px;"><button id="editmemberbtn" name="editmemberbtn">Change Members</button></div>
                </div>
                <div class="righttopdiv" id="searchdiv">
                    <div class="desdiv" style="width:330px;">
                        <input id="search" type="text" class="searchinput" />
                        <select id="detailacct" class="acctselect">
                            <option value="0">Account 1</option>
                            <option value="1">Account 2</option>
                            <option value="8">H.323</option>
                        </select>
                        <p></p>
                    </div>
                </div>
            </div>   
            <div webtip="" id="membersdiv">
            
            </div>
            <div webtip="" id="allcontactsdiv">
                <div class="dividing"></div>
                <div class="dividingCreate"></div>
            </div>
        </div>
        <div class="appsbtn" id="rightbtn">
            <button id="savebtn">Save</button>
            <button id="cancelbtn" class="cancelbtn">Cancel</button>
            <button id="changemembersavebtn" style="display:none;">Save</button>
            <button id="changemembercancelbtn" class="cancelbtn" style="display:none;">Cancel</button>
            <button id="editbtn" class="editbtn">Edit</button>
            <button id="acceptbtn" class="editbtn" style="display:none;">Accept</button>
            <button id="rejectbtn" class="cancelbtn" style="display:none;">Reject</button>
        </div>  
    </div>
    <div id='captionContainer'>
        <button id="closecaption"></button>
        <div id='topCaption'><input type='text' class='capinput' position='top'/></div>
        <div id='leftCaption'><input type='text' class='capinput' position='left'/></div>
        <div id='bottomCaption'><input type='text' class='capinput' position='bottom'/></div>
        <div id='captionbtn'>
            <button id="capsend"></button>
            <button id="stopsending" style="display:none;">Stop Sending</button>
            <button id="capapply"></button>
            <button id="capstop" style="display:none;">Stop</button>
        </div>
    </div>
    <div id="startcheckdiv" class="dialogdivs" style="width:100%;height:100%;position:absolute;top:0;left:0;display:none;">
        <div class="dialogbg" style="width:300px;height:70px;position:absolute;left:195px;top:100px;*top:40px;padding:24px;background:#FFFFFF;font-size:16px;box-shadow:0px 0px 10px 2px #919191;">        
        <div>
            <div style="height:42px;"><input type="radio" name="deletecheck" id="cancelconf" onclick="cancelConference(1);"><span id="a_cancalconf">Cancel the conference after started</span></div>
            <div style="height:42px;"><input type="radio" name="deletecheck" id="keepconf" onclick="cancelConference(0);"><span id="a_keepconf">Keep the conference after started</span></div>
        </div>
        </div>
    </div>
    <div id="deletecheckdiv" class="dialogdivs" style="width:100%;height:100%;position:absolute;top:0;left:0;display:none;">
        <div class="dialogbg" style="width:300px;height:102px;position:absolute;left:195px;top:100px;*top:40px;padding:24px;background:#FFFFFF;font-size:16px;box-shadow:0px 0px 10px 2px #919191;">        
        <div>
            <div style="height:36px;"><span id="a_hasrepeat">For repeat schedules, delete</span></div>
            <div style="height:42px;"><input type="radio" name="deletecheck" id="delrep" onclick="deleteRepeat(1);"><span id="a_delrep">All events in the series</span></div>
            <div style="height:42px;"><input type="radio" name="deletecheck" id="delcur" onclick="deleteRepeat(0);"><span id="a_delcur">Only this instance</span></div>
        </div>
        </div>
    </div>
</div>
<script type="text/javascript">
	var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
	}
	if( cookie_lang != "zh" ){
	    $("#autoanswerdiv span").css("line-height", "21px");
	}
	if( cookie_lang == "es" ){
	    $("#advancediv span").css("line-height", "21px");
	}
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");
    //$("#delhis").button();
</script>
<script type="text/javascript" src='../js/apps.js'></script>
<script type="text/javascript">
var mEditMode = 0;
var mSelectId;
var mSelectConfId;
var mDftConfid = 0;
var mOptionNumDone = 0;
var mOptionNum = 0;
var mOptionNumSuc = 0;
var mItemsdivObj;
var mMaxmumber = 1;
var mMaxScheduleMember = 1;
var mIsreduce = false;
var mAllDelscheduleId = "";
var mDelscheduleId = "";
var mDelGooglescheduleId = "";
var mDelRepscheduleId = "";
var mDelRepGooglescheduleId = "";
var mTimeout = 60*1000;
var mTimeoutObj = new Object();
var mContactsItem;
var mCheckedmembernum = 0;
var mSelectedmemeber_num = 0;
var mDateObj = new Date();
var mUse24Hour = 1;
var mCurrentTime;
var mAcctName = new Array("SIP", "IPVideoTalk", "H.323");
var mMaxAccount = 3;
var mStarCode = "*01*02*16*17*18*19*67*82*83*84*30*31*50*51*70*71*72*73*74*90*91*92*93*47";
var mTempDurationTime = 60;
var mProStr = "IPVideoTalk";
var mRepeatRule = "";
var mCustomRepeatRule = "";
var mByDaysStr = new Array("SU", "MO", "TU", "WE", "TH", "FR", "SA");
var mCusSelWeekStr = "";
var mHasGoogle = false;
var mLastAction = "";
var contact_items = new Array;
var mPromodel = "GVC3200";
var mEmailreg = new RegExp("\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*");
var mAcctStatus = new Array();
var mDisdialplan = new Array();
var mIfdelete = 0;

$(function(){
    mPromodel = $("#promodel", window.parent.document).val();
    mMaxmumber = $("#maxlinenum", window.parent.document).val();
    mMaxScheduleMember = mMaxmumber;
    if( mPromodel == "GVC3202" ){
        mMaxmumber = 2;
        mMaxScheduleMember = 2;
    }
    mItemsdivObj = document.getElementById('itemsdiv');
    mInvitedItemsdivObj = document.getElementById('inviteditemsdiv');
    mAllContactdivObj = document.getElementById('allcontactsdiv');
    translate_page();
    /***************init state****************/
    $("#rightbtn button, #allcontactsdiv, #searchdiv").hide();
    
    $("#delscheduleall").attr("disabled","disabled").addClass("deldisable");
    /*************************/
    window.parent.block_download_func(a_6660);
    cb_get_action('status&region=status');
    cb_get_action('getgoogleaccts&region=apps');
    cb_get_action('get&var-0000=2382');
    get_schedule();
    
    var height = parseInt($("#iframediv",parent.document.body).css('height'));
    $("#itemsdiv, #inviteditemsdiv, #persondiv").css("height", height - 60); //30+18
    $(".noscheudlediv").css("line-height", height+"px");
    //initfnBlock();
    pageEventActions();
});

function add_item_event(){
    $(".itemdiv").unbind(); //to avoid too many click callback by one click
    $(".itemdiv").click(function(){
        if( mEditMode != 0 ) {
            $(".editdiv").hide();
            $("#remindercheck").attr("disabled", true).attr("checked",false);     
            $(".contentdiv").show();
            $("#showmembernum").show();
            $(".memberdiv, .memberemail").hide();
            $(".memberdiv[confid=" + mSelectConfId + "][isexist=1]").show();
            $("#membersdiv .memberdiv[confid=\""+mSelectConfId+"\"]").attr("isdelete",0);
            $("#savebtn,#cancelbtn").hide();
            $("#membersdiv .memberdiv[notsave=1]").remove();
            $("#allcontactsdiv .contactsdiv.creatsearchItem").remove();
            $("#membersdiv .memberdiv[confid=temp]").remove();
        }
        $(".righttopdiv, .memberdiv").addClass("hasborder");
        var isinvite = $(this).attr("inviteacct");
        mSelectConfId = $(this).attr("preconfid");
        mSelectId = $(this).attr("scheduleid");
        var disname = $(this).attr("name");
        var starttime = $(this).attr("starttime").split(" ");
        var display_time = starttime[0] + " " + calculateDuration(starttime[1],0);
        var endtime = convertEndTime( display_time,$(this).attr("duration") );
        var confnum = $(this).attr("schedulenum");
        var confpsw = $(this).attr("schedulepsw");
        var confurl = $(this).attr("scheduleurl");
        var confpstn = $(this).attr("schedulepstn");
        var pincode = $(this).attr("pincode");
        var repeat = $(this).attr("repeat");
        var preset = parseInt($(this).attr("preset"));
        $("#detailname").text(disname).attr("title",disname);
        $("#detailduration").text(endtime.substring(0,endtime.length-3));
        $("#detailtime").attr("title",display_time).text(display_time);
        $("#conferencenumber").text(confnum).attr("title",confnum);
        $("#conferencepassword").text(confpsw).attr("title",confpsw);
        $("#showpincode").text(pincode).attr("title",pincode);
        if( pincode == "" )
            $("#confpincode").val(a_15046).addClass("inputhint");
        else
            $("#confpincode").val(pincode).removeClass("inputhint");
        var presettext = a_15071;
        if( preset >= 0 )
            presettext = a_10024 + " " + (preset+1);
        $("#showpreset").text(presettext).attr("title",presettext);
        $("#confpreset").val(preset);
        $("#conferenceurl").text(confurl).attr("title",confurl);
        var confpstnstr = a_9400 + " " + confpstn + " " + a_15058;
        $("#conferencepstn").text(confpstnstr).attr("title",confpstnstr);
        var repeathtml = $("#repeat option").eq(repeat).text();
        $("#detailrepeat").text(repeathtml).attr("title",repeathtml);
        if( $(this).attr("reminder") == "1" ){
            $("#remindercheck").attr("checked", true);
        }else{
            $("#remindercheck").attr("checked", false);
        }
        if( $(this).attr("dnd") == "1" ){
            $("#detaildnd").text(a_38);
            $("#dndcheck").attr("checked", true);
        }else{
            $("#detaildnd").text(a_39);
            $("#dndcheck").attr("checked", false);
        }
        if( $(this).attr("autoanswer") == "1" ){
            $("#detailautoanswer").text(a_38);
            $("#autoanswer").attr("checked", true);
        }else{
            $("#detailautoanswer").text(a_39);
            $("#autoanswer").attr("checked", false);
        }
        $("#righttopdiv .righttopdiv, #editmemberbtn").show();
        $("#remindercheck").attr("disabled", true);     
        $(".memberdiv").hide().attr("isexist",0);
        $("#membersdiv .memberdiv[notsave=1]").remove();
        $(".memberdiv[confid=\"" + mSelectId + "\"]").show().attr("isexist",1);
        $("#membersdiv").show();
        $("#membersdiv .memberdiv[isdelete=1]").remove();
        $(".memberdiv .membercheck, #allcontactsdiv, .cloudconf").hide();
        $(".itemdiv").removeClass("selectItem");
        $("#searchdiv").hide();
        $(this).addClass("selectItem");
        //$(this).addClass("selectItem").siblings(".itemdiv").removeClass("selectItem");
        $(".appright #rightbtn button").hide();
        var confid = $(this).attr("confid");
        $("#membersdiv .memberdiv[confid=\""+confid+"\"]").attr("isdelete",0);
        var host = $(this).attr("host");
        if(host == mProStr){
            $(".cloudconf").show();
            $(".pincodediv").hide();
            $("#editbtn").hide();
            if( confpstn == "0" ){
                $("#pstndivs").hide();
            }
        } else {
            $("#editbtn").show();
            $(".pincodediv").show();
            if( host == "1" && mHasGoogle ){
                $("#membersdiv .membernumber").hide();
            }else{
                $("#membersdiv .membernumber").show();
            }
        }  
        /*if( (host == "1" && !mHasGoogle) || mHasGoogle){
            $("#membersdiv  .membernumber").show();
        }else{
            $("#membersdiv  .membernumber").hide();
        } */
        //$("#membersdiv .membernumber").show();
        var membernum = 0;
        $(".memberdiv[confid=\"" + mSelectId + "\"]").each(function(){
            membernum++;
        });
        $("#showmembernum").text(" ("+membernum+")").show();
        $(".noscheudlediv, .cusrepeatdivs").hide();
        if( isinvite != "" ){
            $("#editbtn").hide();
            $("#acceptbtn, #rejectbtn").show();
        }else{
            $("#itemsdiv").show();
            $("#acceptbtn, #rejectbtn").hide();
        } 
        $("#googleacctdiv").hide(); 
        if( mHasGoogle ){
            $("#subjectdiv").css("margin-top", "10px");
        }
        $("#persondiv,#rightbtn").show();
        
        var googlestatus = 0;
        $("#membersdiv .memberdiv[confid=" + mSelectId + "]").each(function(){
            if($(this).attr("googlestatus") != 0){
                googlestatus = $(this).attr("googlestatus");
                return false;
            }
        });
        
        if(googlestatus != 0 && googlestatus != undefined){
            var statustext;
            if(googlestatus == 1)
                statustext = a_10000;
            else
                statustext = a_10038;
            
            $("#responsediv .contentdiv span").text(statustext);
            $("#responsediv").show();
        }
        else{
            $("#responsediv").hide();
        }
    }); 

    $("#itemsdiv .itemdiv").hover(function(){
        $(this).addClass("itemdivhover");
        $("#schedulecallbtn").appendTo($(this)).show();
        $(this).find(".itemline").eq(1).hide();
    },function(){
        $(this).removeClass("itemdivhover");
        $("#schedulecallbtn").hide();
        $(this).find(".itemline").eq(1).show();
    });
}
function cb_get_action_done(data, action) {
    if( data.substring(0, 1) == "{" )
    {
        data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
        if(action == "getgoogleaccts&region=apps"){
            var tObj = eval("(" + data + ")");
            var accts = tObj.Data;
            $("#relatedacct option:gt(0)").remove();
            if(accts != undefined)
            {
                var disname, auth;
                mHasGoogle = false;
                for (var i = 0; accts[i] != undefined; i++)
                {
                    disname = accts[i].Account;
                    auth = accts[i].Auth;
                    if( auth == "1" ){
                        mHasGoogle = true;
                        var optionstr = "<option value='" + disname + "'>" + htmlEncode(disname) + "</option>";
                        $("#relatedacct").append(optionstr);
                    }
                }
            }
            if( !mHasGoogle ){
                $("#googleacctdiv").hide();
                $("#subjectdiv").css("margin-top", "10px");
            }
        }
        else if(action.indexOf("getcontactsbyorder") != -1 ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if(items != undefined)
            {
                parse_contacts(items); 
                get_contact_info();
            }
            else
                window.parent.unblock_func();
        }
        else if( action.indexOf("addconfmemeber") != -1)
        {
            var tObj = eval("(" + data + ")");
            var status = tObj.status;
            if(status == "1"){
                $.prompt(a_10104);
                return false;
            }
            /*if(tObj.res != "success")
            {
                if(tObj.msg == "line is busy")
                {
                    $.prompt(a_16683);
                    return false;
                }
                else if(tObj.msg == "add conf member failed")
                {
                    $.prompt(a_63);
                    return false;
                }
            }*/
        }else if(action.indexOf("setgoogleschestatus") != -1){
            window.parent.unblock_func();
            var tObj = eval("(" + data + ")");
            if(tObj.Response == "Success"){
                var operation = tObj.Operation;
                var scheid = tObj.Scheid;
                
                var response;
                if(operation == 1)
                    response = a_10000;
                else
                    response = a_10038;
                    
                $("#responsediv .contentdiv span").text(response);
                $("#responsediv").show();
                $("#membersdiv .memberdiv[confid=" + scheid + "]").attr("googlestatus", operation);
                
                $.prompt(a_64);
            }
            else{
                $.prompt(a_63);
            }
        }
        else if( action.indexOf("sqliteconf" ) != "-1" ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if( action.indexOf("type=schedule") != "-1" ){   
                var id, groupid, starttime, duration, reminder, retime, disname, host,confstate,dnd,milliseconds,autoanswer,schedulenum,schedulepsw,scheduleurl,pincode,repeat, repeatRule, inviteacct, preset;
                mCurrentTime = tObj.Curtime;
                mUse24Hour = parseInt(tObj.Use24Hour);
                if(mUse24Hour == 0)
                {
                    $('#edittime').datetimepicker({
                        showSecond: false,
                        timeFormat: 'hh:mm tt',
                        dateFormat: 'yy-mm-dd',
                        minDate: 0,
                        ampm: true,
                        onSelect: function(dateText, dp_inst){
                            var endtime = convertEndTime( $('#edittime').val(),mTempDurationTime );
                            $("#editduration").val( endtime.substring(0,endtime.length-3) );
                        },
                        onClose: function(dateText, dp_inst){
                            var endtime = convertEndTime( $('#edittime').val(),mTempDurationTime );
                            $("#editduration").val( endtime.substring(0,endtime.length-3) );
                        }
                    });
                    $('#editduration').datetimepicker({
                        showSecond: false,
                        timeFormat: 'hh:mm tt',
                        dateFormat: 'yy-mm-dd',
                        minDate: 0,
                        ampm: true,
                        onSelect: function(dateText, dp_inst){
                            mTempDurationTime = cal_durationTime( $('#edittime').val(),dateText );
                        },
                        onClose: function(dateText, dp_inst){
                            mTempDurationTime = cal_durationTime( $('#edittime').val(),dateText );
                        }
                    });
                }
                else
                {
                    $('#edittime').datetimepicker({
                        showSecond: false,
                        timeFormat: 'hh:mm',
                        dateFormat: 'yy-mm-dd',
                        minDate: 0,
                        ampm: false,
                        onSelect: function(dateText, dp_inst){
                            var endtime = convertEndTime( $('#edittime').val(),mTempDurationTime );
                            $("#editduration").val( endtime.substring(0,endtime.length-3) );
                            $("#cusstartdate").text( $('#edittime').val().substring(0,10));
                        },
                        onClose: function(dateText, dp_inst){
                            var endtime = convertEndTime( $('#edittime').val(),mTempDurationTime );
                            $("#editduration").val( endtime.substring(0,endtime.length-3) );
                            $("#cusstartdate").text( $('#edittime').val().substring(0,10));
                        }
                    });
                    $('#editduration').datetimepicker({
                        showSecond: false,
                        timeFormat: 'hh:mm',
                        dateFormat: 'yy-mm-dd',
                        minDate: 0,
                        ampm: false,
                        onSelect: function(dateText, dp_inst){
                            mTempDurationTime = cal_durationTime( $('#edittime').val(),dateText );
                        },
                        onClose: function(dateText, dp_inst){
                            mTempDurationTime = cal_durationTime( $('#edittime').val(),dateText );
                        }
                    });
                }
                $('#cusenddate').datepicker({
                    dateFormat: 'yy-mm-dd',
                    onSelect: function(dateText, dp_inst){
                        //$("#cusenddate").val( dateText.substring(0,10) );
                        checkCustomEnddate();
                    },
                    onClose: function(dateText, dp_inst){
                        //$("#cusenddate").val( dateText.substring(0,10) );
                        checkCustomEnddate();
                    }
                });
                $("#ui_tpicker_time_label_edittime").text(a_time);
                $("#ui_tpicker_hour_label_edittime").text(a_107);
                $("#ui_tpicker_minute_label_edittime").text(a_109);
                $("#ui_tpicker_second_label_edittime").text(a_113);
                for (var i = 0; items[i] != undefined; i++)
                {
                    id = items[i].Id;
                    //groupid = items[i].Groupid;
                    //starttime = items[i].Starttime;
                    duration = items[i].Duration;
                    reminder = items[i].Reminder;
                    retime = items[i].Retime;
                    disname = items[i].Displayname;
                    host = items[i].Host;
                    confstate = items[i].Confstate;
                    dnd = items[i].Confdnd;
                    milliseconds = items[i].Milliseconds;
                    autoanswer = items[i].Confautoanswer;
                    schedulenum = items[i].Schedulenum;
                    schedulepsw = items[i].Schedulepsw;
                    scheduleurl = items[i].ScheduleURL;
                    schedulepstn = items[i].SchedulePSTN;
                    pincode = items[i].Schedulepsw;
                    repeat = items[i].Recycle;
                    repeatRule = items[i].RepeatRule;
                    starttime = convertCurrentTime(milliseconds);
                    inviteacct = items[i].InviteAcct;
                    preset = items[i].Preset;
                    
                    create_schedule_div(id, "", disname, starttime, duration, reminder, retime ,host, confstate, dnd,milliseconds,autoanswer,schedulenum,schedulepsw,scheduleurl,pincode,schedulepstn, repeat, repeatRule, inviteacct, preset);
                }
                if(items[0] == undefined)
                {
                    $("#delscheduleall").attr("disabled","disabled").addClass("deldisable");
                }
                if( $("#inviteditemsdiv .itemdiv").length > 0 ){
                    $("#invited").show();
                }
                
                //get pre-conf, for the name display and member display
                get_groups();
            }
            else if( action.indexOf("type=preconf") != "-1" ){
                if($(".memberdiv") != undefined)
                    $(".memberdiv").remove();
                
                var confid, confname, disname, number, acctid, email, emailflag, recordfrom, googlestatus;
                var membersdiv = document.getElementById('membersdiv');
                for (var i = 0; items[i] != undefined; i++)
                {
                    confid = items[i].Id;
                    disname = items[i].Name;
                    number = items[i].Number;
                    disname = number;
                    confname = items[i].Confname;
                    acctid = items[i].Acctid;
                    email = items[i].Email;
                    recordfrom = items[i].RecordFrom;
                    googlestatus = items[i].GoogleStatus;

                    for(var n=0; mContactsItem[n] != undefined; n++)
                    {
                        if(number == mContactsItem[n].Number)
                        {
                            disname = mContactsItem[n].Name;
                            break;
                        }
                    }
                    
                    if( $(".itemdiv[preconfid=" + confid + "]").length != 0 ){
                        $(".itemdiv[preconfid=" + confid + "]").each(function(){
                            $(this).children(".itemname").children("span").text(confname).attr("title", confname);
                            $(this).attr("name", confname);
                        });
                    }
                    // if( $(".memberdiv[confid=" + confid + "]").length == 0 ){
                    //     $("#selectconfname").append("<option value='" + confid + "'>" + confname + "</option>");
                    //     if( mDftConfid == 0 )
                    //         mDftConfid = confid;
                    // }
                    if( $(".memberdiv[confid=" + confid + "]").length == 0 ){
                        $("#selectconfname").val(confname);
                        if( mDftConfid == 0 )
                            mDftConfid = confid;
                    }
                    var memberdiv = document.createElement('DIV');
	                memberdiv.className='memberdiv';
	                //memberdiv.setAttribute("name", confname);
	                memberdiv.setAttribute("confid", confid);
                    memberdiv.setAttribute("number", number);
                    memberdiv.setAttribute("isexist", 0);
                    memberdiv.setAttribute("isdelete", 0);
                    memberdiv.setAttribute("acctindex", acctid);
	                memberdiv.setAttribute("email", email);
                    memberdiv.setAttribute("recordfrom", recordfrom);
                    memberdiv.setAttribute("googlestatus", googlestatus);
	                if( email == "" )
	                    memberdiv.setAttribute("emailnum", "0");
	                else
	                    memberdiv.setAttribute("emailnum", "1");
	                
                    var iconmemberdiv = document.createElement('DIV');
                    iconmemberdiv.className='membericon';
                    var itemicon = document.createElement('DIV');
                    if(number.indexOf("group") != -1)
                        itemicon.className='appgroupicon';
                    else
                        itemicon.className='appcontacticon';
                    iconmemberdiv.appendChild(itemicon);
                    memberdiv.appendChild(iconmemberdiv);
                    
	                var namediv = document.createElement('DIV');
	                namediv.className='membername';
	                
	                emailflag = acctid;   
	                if( acctid == -1 ){
	                    var emailattr = "";
	                    $(".contactslog").each(function(){
	                        emailattr = $(this).attr("email");
	                        if( emailattr != "" ){
	                            emailattr = ":::" + emailattr + ":::";
	                            if( emailattr.indexOf(":::" + number + ":::") != -1 ){
	                                number = $(this).attr("number");
	                                memberdiv.setAttribute("number", number);
	                                disname = $(this).attr("name");
	                                memberdiv.setAttribute("acctindex", $(this).attr("acctindex"));
	                                emailflag = 0;
	                                return false;
	                            }
	                        }
	                    });
	                }
	                
	                var spantext = document.createElement('SPAN');
                    spantext.innerHTML = htmlEncode(disname);
                    spantext.setAttribute("title", disname);
	                    
                    var numberdiv = document.createElement('DIV');
                    numberdiv.className='membernumber';
                    var numbertext = document.createElement('SPAN');
                    if(number.indexOf("group") != -1)
                    {
                        number = number.split("_");
                        number = number[1];
                        numbertext.innerHTML = htmlEncode(number)+" "+(number > 1 ? a_16647 : a_16646);
                    }
                    else
                       numbertext.innerHTML = htmlEncode(number);
                    numbertext.setAttribute("title", number);

	                if( mHasGoogle ){
	                    if( emailflag == -1 ){
	                        namediv.appendChild(spantext);
	                        memberdiv.appendChild(namediv);
	                    }else{
	                        var nametopdiv = document.createElement('DIV');
	                        nametopdiv.className='membernametop';
	                        nametopdiv.appendChild(spantext);
	                        namediv.appendChild(nametopdiv);
	                        
	                        var namebotdiv = document.createElement('DIV');
	                        namebotdiv.className='membernamebot';
	                        namebotdiv.appendChild(numbertext);
	                        namediv.appendChild(namebotdiv);
	                        memberdiv.appendChild(namediv);
	                    }
	                    
	                    var emailtext = document.createElement('SPAN');
	                    emailtext.className='emailspan';
	                    emailtext.innerHTML = htmlEncode(email);
                        emailtext.setAttribute("title", email);
                        numberdiv.appendChild(emailtext);
	                    memberdiv.appendChild(numberdiv);
	                    
	                    var emaileditdiv = document.createElement('DIV');
                        emaileditdiv.className='memberemail';
                        var emailinput = document.createElement('INPUT');
                        emailinput.type = 'text';
                        emailinput.title = a_302;
                        emailinput.className = "emailinput";
                        emailinput.value = email;
                        emaileditdiv.appendChild(emailinput);
                        memberdiv.appendChild(emaileditdiv);
	                }else{
	                    namediv.appendChild(spantext);
	                    memberdiv.appendChild(namediv);
	                    
	                    numberdiv.appendChild(numbertext);
	                    memberdiv.appendChild(numberdiv);
	                }
 
	                membersdiv.appendChild(memberdiv);	                
                }

                add_item_event();
                if( $("#itemsdiv .itemdiv").length > 0 ) 
                    $(".itemdiv").eq(0).click();
                else{
                    $(".memberdiv").hide();
                    $(".noscheudlediv").show();
                    $("#persondiv,#rightbtn,#itemsdiv").hide();
                }
                // if( $("#selectconfname option").length == 0 ){
                //     $("#addcontact").attr("disabled", "disabled");
                // }
                get_normal_calllog(2, 0);
            }         
        }else if( action.indexOf("type=contacts") != "-1" ){  
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            var contactid, disname, number, acctid;
            mContactsItem = items;
            for (var i = 0; items[i] != undefined; i++)
            {
                contactid = items[i].RawId;
                disname = items[i].Name;
                number = items[i].Number;
                acctid = items[i].AcctIndex;
                if( number == "" ) continue;
                // $(".memberdiv[name=\"" + disname + "\"][number=\"" + number + "\"]").each(function(){
                //     $(this).attr("acctindex", acctid);
                // });
                create_member_div("", disname, number, acctid, contactid, 0);
            }
            clone_groupmember(); 
            if( mHasGoogle ){
                //get email
                get_contact_info();
            }else{
                get_preconf();  
            }                    
        }else if( action.indexOf("type=groups") != "-1" ){   
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            var id, disname, contactid;
            for (var i = 0; items[i] != undefined; i++)
            {
                id = items[i].Id;
                disname = items[i].Name;
                contactid = items[i].ContactId; //this is raw contact acturally
                                    
                create_member_div(id, disname, "", "", contactid, 1)
            }
            get_contact();

        }
        else if( action.indexOf("type=contactinfo") != "-1" ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            parse_contactinfo(items); 
            //window.parent.unblock_func(); 
            get_preconf();           
        } 
        else if( action.indexOf("type=calllog") != "-1" ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if(items != undefined)
                parse_calllog(items);  
            window.parent.unblock_func();  
            var schedulenum = $.cookie("addschedulenumber");
            var schedulename = $.cookie("addschedulename");
            var scheduleacct = $.cookie("addscheduleacct");
            var schedulercdfrom = $.cookie("addrecordfrom");

            if(schedulename != undefined && schedulename != "" && schedulenum != undefined && schedulenum != "" && scheduleacct != undefined && scheduleacct != "" && schedulercdfrom != undefined && schedulercdfrom != "")
            {
                add_calllog_to_schedule(schedulenum,schedulename,scheduleacct,schedulercdfrom);
            }
        }   
        else{
            mOptionNumDone ++;
            var staypage = 0;
            var tObj = eval("(" + data + ")");
            if( tObj.res == "success" ){
                mOptionNumSuc ++;
                var optionscheduleid = "";
                var optiontype = 0;
                if( action.indexOf("deleteschedule") != "-1" ){
                    staypage = 1;
                    optiontype = 2;
                    if( $("#selectall").attr("checked") ){
                        $("#schedulecallbtn").hide().appendTo($("#mainbody"));
                        $(".itemdiv, .datediv").remove();
                        $("#membersdiv .memberdiv").remove();
                        $(".contentdiv, .memberdiv, #editbtn,#showmembernum").hide();
                        $("#showmembernum").text("");
                        $(".noscheudlediv").show();
                        $("#persondiv,#rightbtn,#itemsdiv").hide();
                        $("#selectall").removeAttr("checked");
                        optionscheduleid = encodeURIComponent(mAllDelscheduleId);
                    }else{
                        var tmpids = tObj.msg;
                        var tmpid = tmpids.split(",");
                        for(var i = 0; i < tmpid.length; i++){
                            var old_time = $(".itemdiv[scheduleid=" + tmpid[i] + "]").parent().parent().attr("id");
                            $("#schedulecallbtn").hide().appendTo($("#mainbody"));
                            $(".itemdiv[scheduleid=" + tmpid[i] + "]").remove();
                            $("#membersdiv .memberdiv[confid=" + tmpid[i] + "]").remove();
                            if($("#itemsdiv #"+old_time).children(".datechild").children().length == 0)
                                $("#itemsdiv #"+old_time).remove();
                        }
  
                        if( $("#schedule_" + mSelectId).length == 0 ){
                            if( $("#itemsdiv .itemdiv").length > 0 ) 
                                $("#itemsdiv .itemdiv").eq(0).click();
                            else{
                                $("#cancelbtn").click();
                                $("#delscheduleall").attr("disabled","disabled").addClass("deldisable");
                                $("#showmembernum").text("").hide();
                                $("#detailautoanswer,#detaildnd").text("");
                                $(".noscheudlediv").show();
                                $("#persondiv,#rightbtn,#itemsdiv").hide();
                            }
                        }else{
                            $("#schedule_" + mSelectId).click();
                        }
                        optionscheduleid = tmpids;
                    }
                    $("#delscheduleall").attr("disabled","disabled").addClass("deldisable");
                }else if( action.indexOf("updateschedule") != "-1" ){
                    staypage = 1;
                    optiontype = 1;
                    optionscheduleid = parseInt(tObj.msg);
                    var tmpid = parseInt(tObj.msg); 
                    var dialplan = parseInt(tObj.dialplan);
                    var disnumber = tObj.disnumber;
                    var host = $("#relatedacct").val();
                    if( host != "1" )
                        optiontype = 11;
                    var name = $("#selectconfname").val();
                    var reminder = 0,dnd = 0,autoanswer = 0,repeat = 0, preset = -1;
                    var starttime = $("#edittime").val();
                    var datetime = starttime.replace(/-/g, "/");
                    var setdate = new Date(datetime);
                    var milliseconds = setdate.getTime();
                    var duration = cal_durationTime(starttime,$("#editduration").val());
                    var pincode = $("#confpincode").val();
                    if( pincode == a_15046 )
                        pincode = "";
                    starttime = change_time24hourformat(milliseconds);
                    /*if(dialplan == -1)
                    {
                        //$("#membersdiv .memberdiv[confid=\""+tmpid+"\"][isexist=1][isdelete=1]").attr("isdelete","0").show();
                        //$("#membersdiv .memberdiv[confid=\""+tmpid+"\"][notsave=1]").remove();
                        //$(".itemdiv[scheduleid=" + tmpid + "]").click();
                        $.prompt(a_16682);
                        return false;
                    }*/
                    if( $("#remindercheck").prop("checked") )
                        reminder = 1;
                    if( $("#dndcheck").prop("checked") )
                        dnd = 1;
                    if( $("#autoanswer").prop("checked") )
                        autoanswer = 1;
                    repeat = $("#repeat").val();
                    preset = $("#confpreset").val();

                    var old_time = $(".itemdiv[scheduleid=" + tmpid + "]").parent().parent().attr("id");
                    //var old_name = $(".itemdiv[scheduleid=" + tmpid + "]").attr("name");
                    /*if(dialplan == 0)
                    {
                        disnumber = disnumber.split(",");
                        var length = disnumber.length;
                        for(var i=0; i < length ; i++)
                        {
                            if(disnumber[i] != "")
                            {
                                $("#membersdiv .memberdiv[name=\""+old_name+"\"][number=\""+disnumber[i]+"\"]").remove();
                            }
                        }
                    }*/
                    $("#membersdiv .memberdiv[isexist=1][isdelete=1]").remove();
                    //$("#membersdiv .memberdiv[name=\""+old_name+"\"]").removeAttr("notsave");
                    //$("#membersdiv .memberdiv[name=\""+old_name+"\"]").attr("name",name);
                    $("#membersdiv .memberdiv[isdelete=0]").removeAttr("notsave");
                    $("#schedulecallbtn").hide().appendTo($("#mainbody"));
                    $(".itemdiv[scheduleid=" + tmpid + "]").remove();
                    create_schedule_div(tmpid, "", name, starttime, duration, reminder, "" ,host, "", dnd, milliseconds,autoanswer,"","","",pincode,"",repeat, mRepeatRule, "", preset);

                    if($("#itemsdiv #"+old_time).children(".datechild").children().length == 0)
                         $("#itemsdiv #"+old_time).remove();

                    $(".itemdiv[scheduleid=" + tmpid + "]").click();
                    /*if(dialplan == 0)
                    {
                        $.prompt(a_16681);
                    }*/
                }else if( action.indexOf("addschedule") != "-1" ){
                    staypage = 1;
                    optiontype = 0;
                    optionscheduleid = parseInt(tObj.msg);
                    var tmpid = parseInt(tObj.msg);
                    var dialplan = parseInt(tObj.dialplan);
                    /*if(dialplan == -1)
                    {
                        $.prompt(a_16682);
                        return false;
                    }*/
                    var disnumber = tObj.disnumber;
                    var reminder = 0,dnd = 0,autoanswer = 0;
                    var starttime = $("#edittime").val();
                    var durations = cal_durationTime(starttime,$("#editduration").val());
                    var datetime = starttime.replace(/-/g, "/");
                    var setdate = new Date(datetime);
                    var milliseconds = setdate.getTime();
                    var host = $("#relatedacct").val();
                    if( host != "1" )
                        optiontype = 11;
                    var confname = $("#selectconfname").val();
                    var pincode = $("#confpincode").val();
                    if( pincode == a_15046 )
                        pincode = "";
                    starttime = change_time24hourformat(milliseconds);
                    if( $("#remindercheck").prop("checked") ){
                        reminder = 1;
                    }  
                    if( $("#dndcheck").prop("checked") ){
                        dnd = 1;
                    }  
                    if( $("#autoanswer").prop("checked") )
                        autoanswer = 1;
                    repeat = $("#repeat").val();
                    preset = $("#confpreset").val();
                    
                    /*if(dialplan == 0)
                    {
                        disnumber = disnumber.split(",");
                        var length = disnumber.length;
                        for(var i=0; i < length ; i++)
                        {
                            if(disnumber[i] != "")
                            {
                                $("#membersdiv .memberdiv[isexist=1][isdelete=0][notsave=1][number=\""+disnumber[i]+"\"]").remove();
                            }
                        }
                    }*/
                    $("#membersdiv .memberdiv[isexist=1][isdelete=0][notsave=1]").each(function(){
                        $(this).removeAttr("notsave").attr("confid",tmpid).attr("name",confname);
                    });
                    create_schedule_div(tmpid,"", confname, starttime, durations, reminder, "", host, "", dnd, milliseconds, autoanswer,"","","",pincode,"",repeat, mRepeatRule, "", preset);
                    //$("#delscheduleall").attr("disabled", false).removeClass("deldisable");
                    //add_item_event();
                    $("#schedule_" + tmpid).click();
                    /*if(dialplan == 0)
                    {
                        $.prompt(a_16681);
                    }*/
                }
                var action = "notifyschedule&region=webservice&type="+optiontype+"&scheduleId="+optionscheduleid;
                cb_get_action(action);
            }else{
                if( action.indexOf("addschedule") != "-1" || action.indexOf("updateschedule") != "-1" ){
                    if( tObj.msg == "time eariler" ){
                        $.prompt(a_16438+a_19011);
                        return false;
                    }else if(tObj.msg == "name exist"){
                        $.prompt(a_16435);
                        return false;
                    }
                }
            }
            if( mOptionNum == mOptionNumDone ){
                window.parent.unblock_func();
                if( mOptionNumSuc == 0 ){
                    $.prompt(a_63);
                }else if( mOptionNum == mOptionNumSuc ){
                    //$.prompt(a_opsuc);
                    if( $(".itemdiv").length == 0 ){
                        $("#detailname, #detailduration, #detailtime").text("");
                        $("#delscheduleall").attr("disabled", true).addClass("deldisable");
                        $("#editbtn, .memberdiv").hide();
                    }else if( staypage == 0 ){
                        $(".itemdiv").eq(0).click();
                    }
                }
            }
        }
    }else{
        var msgs = res_parse_rawtext(data);
        if(action.indexOf("getcontactsbyorder") != -1){
            window.parent.unblock_func();
        }else if(action.indexOf("notifyschedule") != -1){
            if(mLastAction != "" && action.indexOf(mLastAction) != -1 ){
                $("#schedulecallbtn").hide().appendTo($("#mainbody"));
                $("#itemsdiv .datediv, .memberdiv").remove();
                setTimeout("get_schedule();", 1000);
            }else if(action.indexOf("&type=8") != -1){
                var tmpid = mDelGooglescheduleId.split(",");
                for(var i = 0; i < tmpid.length; i++){
                    var old_time = $(".itemdiv[scheduleid=" + tmpid[i] + "]").parent().parent().attr("id");
                    $(".itemdiv[scheduleid=" + tmpid[i] + "]").remove();
                    $("#membersdiv .memberdiv[confid=" + tmpid[i] + "]").remove();
                    if($("#itemsdiv #"+old_time).children(".datechild").children().length == 0)
                        $("#itemsdiv #"+old_time).remove();
                }
                $("#delscheduleall").attr("disabled","disabled").addClass("deldisable");
                if( $("#schedule_" + mSelectId).length == 0 ){
                    if( $("#itemsdiv .itemdiv").length > 0 ) 
                        $("#itemsdiv .itemdiv").eq(0).click();
                    else{
                        /*$("#cancelbtn").click();
                        $("#delscheduleall").attr("disabled","disabled").addClass("deldisable");
                        $("#showmembernum").text("").hide();
                        $("#detailautoanswer,#detaildnd").text("");*/
                        $(".noscheudlediv").show();
                        //$("#persondiv,#rightbtn,#itemsdiv").hide();
                    }
                }else{
                    $("#schedule_" + mSelectId).click();
                }
                window.parent.unblock_func();
            }else if(action.indexOf("&type=9") != -1 || action.indexOf("&type=10") != -1){
                var setstatus;
                if(action.indexOf("&type=9") != -1)
                    setstatus = 1;  //accept the google meeting
                else
                    setstatus = 2;  //reject the google meeting
                
                var scheid = action.split("scheduleId=")[1];
                
                var urihead = "setgoogleschestatus&region=webservice&scheid=" + scheid + "&status=" + setstatus;
                cb_get_action(urihead);
            }else{
                window.parent.unblock_func();
            }
        }
        else if(action == "status&region=status"){
            cb_get_status_done(msgs);
        } 
        else if(action == "get&var-0000=2382"){
            var disdialplan = msgs.headers['2382'];
            if(disdialplan == "" || disdialplan == undefined)
                disdialplan = 0;
            else
                disdialplan = parseInt(disdialplan).toString(2);
            
            for(var i = 3; i < 7; i++)
                mDisdialplan[i] = 0;
                
            var length = disdialplan.length;
            switch (length) {
                case 1:
                    mDisdialplan[6] = disdialplan;
                    break;
                case 2:
                    mDisdialplan[6] = disdialplan.substring(1, 2);
                    mDisdialplan[5] = disdialplan.substring(0, 1);
                    break;
                case 3:
                    mDisdialplan[6] = disdialplan.substring(2, 3);
                    mDisdialplan[5] = disdialplan.substring(1, 2);
                    mDisdialplan[3] = disdialplan.substring(0, 1);
                    break;
                case 4:
                    mDisdialplan[6] = disdialplan.substring(3, 4);
                    mDisdialplan[5] = disdialplan.substring(2, 3);
                    mDisdialplan[3] = disdialplan.substring(1, 2);
                    mDisdialplan[4] = disdialplan.substring(0, 1);
                    break;
                case 5:
                    mDisdialplan[6] = disdialplan.substring(4, 5);
                    mDisdialplan[5] = disdialplan.substring(3, 4);
                    mDisdialplan[3] = disdialplan.substring(2, 3);
                    mDisdialplan[4] = disdialplan.substring(1, 2);
                    break;
            }
        }
        cb_if_auth_fail(msgs);
    }
}

function cb_get_status_done(msgs) {
    if (msgs.headers['account_0_name'].length > 0) {
        mAcctName[0] = msgs.headers['account_0_name'];
    }
    if (msgs.headers['account_1_name'].length > 0) {
        mAcctName[1] = msgs.headers['account_1_name'];
    }
    /*if (msgs.headers['account_5_no'].length > 0) {
        mAcctName[2] = msgs.headers['account_5_name'];
    }*/
    
    for(var i = 0; i < mMaxAccount; i++){
        $("#detailacct option:eq(" + i + ")").text(mAcctName[i]);
    }
    
    for(var i = 0; i < 7; i++){
        var acctstatus = {};
        acctstatus.activate = msgs.headers['account_' + i + '_activate'];
        acctstatus.status = msgs.headers['account_' + i + '_status'];
        mAcctStatus.push(acctstatus);
    }
}

function parse_contacts(items){
    var id, rawid, disname;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        rawid = items[i].RawId;
        disname = items[i].Name;

        create_member_div("", disname, "", "", rawid,0);
    }
}

function set_email_info(number, acctid, email, emailnum){
    $(".memberdiv[number=\"" + number + "\"][acctindex=" + acctid + "]").attr("email", email).attr("emailnum", emailnum);
    $(".contactsdiv[number=\"" + number + "\"][acctindex=" + acctid + "]").attr("email", email).attr("emailnum", emailnum);
}

function parse_contactinfo(items){
    var id, rawid, info, acctid, datatype;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        rawid = items[i].RawId;
        info = items[i].Info;
        acctid = items[i].AcctIndex;
        datatype = items[i].DataType;
        
        update_contact_div(id, rawid, info, acctid, datatype);
    } 
    var curnumber, curacct, numbernum, emaillist, emailnum;
    for(i = 0; i < contact_items.length; i++){
        numbernum = contact_items[i].numbernum;
        curnumber = contact_items[i].numberlist;
        curacct = contact_items[i].acctidlist;
        emaillist = contact_items[i].emaillist;
        emailnum = contact_items[i].emailnum;
        if( numbernum > 1 ){
            var numbers = curnumber.split(":::");
            var accts = curacct.split(":::");
            for(var j = 0; j < numbernum; j++){
                set_email_info(numbers[j], accts[j], emaillist, emailnum);
            }
        }else if( numbernum == 1 ){
            set_email_info(curnumber, curacct, emaillist, emailnum);
        }
    }
}

function parse_calllog(items){
    var id, type, disname, contactname, number, duration, date, acctid, isconf;
    var itemnum = 0;
    var createItem = [];
    var needcreate = true;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        type = items[i].Type;
        disname = items[i].Name;
        number = items[i].Number;
        duration = parseInt(items[i].Duration);
        date = parseInt(items[i].Date);
        acctid = items[i].AcctIndex;
        isconf = items[i].IsConf;
        contactname = items[i].ContactName;
        if( contactname != "" )
            disname = contactname;
        
        needcreate = true;
        for(var n=0; createItem[n] != undefined; n++)
        {
            if(number == createItem[n])
            {
                needcreate = false;
                break;
            }
        }    

        if(needcreate)
        {
            var itemdiv = document.createElement('DIV');
            itemdiv.className='contactsdiv calllog';
            itemdiv.id = "calllog_" + itemnum;
            itemdiv.setAttribute("name", disname);
            itemdiv.setAttribute("disname", disname);
            itemdiv.setAttribute("logid", id);
            itemdiv.setAttribute("number", number);
            itemdiv.setAttribute("acctindex", acctid);
            itemdiv.setAttribute("isconf", "0");
            itemdiv.setAttribute("email", "");
            itemdiv.setAttribute("emailnum", "0");
            itemdiv.setAttribute("type", type);
            
            var checkdiv = document.createElement('DIV');
            checkdiv.className='membercheck';
            var checkbox = document.createElement('INPUT');
            checkbox.type = 'checkbox';
            checkbox.className = "inputcbx";
            checkbox.setAttribute("isconf", "0");
            checkdiv.appendChild(checkbox);
            itemdiv.appendChild(checkdiv);
            
            var icondiv = document.createElement('DIV');
            icondiv.className='membericon';
            var itemicon = document.createElement('DIV');
            if( type == "3" )
                itemicon.className='appmissedicon';
            else if( type == "1" )
                itemicon.className='appincomingicon';
            else  
                itemicon.className='appcallouticon';
            icondiv.appendChild(itemicon);
            itemdiv.appendChild(icondiv);
            
            var namediv = document.createElement('DIV');
            namediv.className='membername';
            var spantext = document.createElement('SPAN');
            spantext.innerHTML = htmlEncode(disname);
            namediv.appendChild(spantext);
            itemdiv.appendChild(namediv);                                   
            
            var datediv = document.createElement('DIV');
            datediv.className='membernumber';
            var datetext = document.createElement('SPAN');
            datetext.innerHTML = htmlEncode(number);
            datediv.appendChild(datetext);
            itemdiv.appendChild(datediv);
            
            itemnum ++; 
            mAllContactdivObj.appendChild(itemdiv);
            createItem.push(number);
        }
    }
}

function ContactItem(rawid, acctidlist, numberlist, numbernum, emaillist, emailnum) {
	this.rawid = rawid;
	this.acctidlist = acctidlist;
	this.numberlist = numberlist;
	this.numbernum = numbernum;
	this.emaillist = emaillist;
	this.emailnum = emailnum;
	if ( typeof ReqItem._initialized == 'undefined') {
	    ReqItem.prototype.showColor = function () {
		    alert( this.pvalue);
	    } ;
	    ReqItem._initialized = true ;
	}
}

function update_contact_div(dataid, rawid, info, acctid, datatype){
    //console.log("info = " + info + ",datatype = " + datatype);
    if( info == "" ) return;

    //$updatecontact = $("#contact_" + rawid);
    if( datatype == 1 ){
        //email
        /*var emailattr = $updatecontact.attr("email");
        var emailnum = parseInt($updatecontact.attr("emailnum"));
        if( emailattr != "" ){
            emailattr += ",";
            emailattr += info;
        }else{
            emailattr = info;
        }
        emailnum ++;
        $updatecontact.attr("email", emailattr).attr("emailnum", emailnum);*/
        var exist = 0;
        for(var i = 0; i < contact_items.length; i++){
            if( contact_items[i].rawid == rawid ){
                exist = 1;
                var emailattr = contact_items[i].emaillist;
                var emailnum = parseInt(contact_items[i].emailnum);
                if( emailattr != "" ){
                    emailattr += ":::";
                    emailattr += info;
                }else{
                    emailattr = info;
                }
                emailnum ++;
                contact_items[i].emaillist = emailattr;
                contact_items[i].emailnum = emailnum;
                break;
            }
        }
        if( exist == 0 ){
            contact_items.push(
                new ContactItem(rawid, "", "", 0, info, 1)
            )
        }
    }
    else if( datatype == 5 ){
        //number
        /*var contactid = $updatecontact.attr("contactid");
        if(contactid != dataid && contactid != "")
        {
            var $clone = $updatecontact.clone(true);
            var id = $updatecontact.attr("id") + "_" +dataid;
            $clone.attr("number", info).attr("id",id).attr("acctIndex", acctid).attr("contactid", dataid).children(".membernumber").children("span").text(info);
            $updatecontact.after($clone);
        }
        else
        {
            $updatecontact.attr("number", info).attr("acctIndex", acctid).attr("contactid", dataid).children(".membernumber").children("span").text(info);
        }*/
        var exist = 0;
        for(var i = 0; i < contact_items.length; i++){
            if( contact_items[i].rawid == rawid ){
                exist = 1;
                var numberattr = contact_items[i].numberlist;
                var acctidattr = contact_items[i].acctidlist;
                var numbernum = parseInt(contact_items[i].numbernum);
                if( numberattr != "" ){
                    numberattr += ":::";
                    numberattr += info;
                    acctidattr += ":::";
                    acctidattr += acctid;
                }else{
                    numberattr = info;
                    acctidattr = acctid;
                }
                numbernum ++;
                contact_items[i].numberlist = numberattr;
                contact_items[i].acctidlist = acctidattr;
                contact_items[i].numbernum = numbernum;
                break;
            }
        }
        if( exist == 0 ){
            contact_items.push(
                new ContactItem(rawid, acctid, info, 1, "", 0)
            )
        }
    }
}

function create_member_div(id, disname, number, acctindex, data, type){
    //type:0 means contact, type:1 means group
    if( type == 1 && $("#contactsgroup_" + id).length != 0 ){
        var contactsid = $("#contactsgroup_" + id).attr("contactsid");
        var contactsnum = parseInt($("#contactsgroup_" + id).attr("contactsnum"));
        contactsid += ",";
        contactsid += data;
        contactsnum ++;
        var groupnumber = "group_"+ contactsnum + "_" + id;
        $("#contactsgroup_" + id).attr("contactsid", contactsid).attr("contactsnum", contactsnum).attr("number",groupnumber);
        $("#contactsgroup_" + id).children(".membernumber").children("span").text(contactsnum + " " + (contactsnum > 1 ? a_16647 : a_16646));
        return;
    }
    if( id == "" && $("#contact_" + data).length != 0 && number == "") return;
    var memberdiv = document.createElement('DIV');
    memberdiv.className='contactsdiv contactslog';
    if( type == 1 ){
        memberdiv.setAttribute("preconfid", "");
        memberdiv.setAttribute("isgroup", "1");
        memberdiv.setAttribute("groupid", id);
    }else{
        memberdiv.setAttribute("preconfid", id);
        memberdiv.setAttribute("isgroup", "0");
    }
    
    //memberdiv.setAttribute("name", disname);
    memberdiv.setAttribute("number", number);
    memberdiv.setAttribute("acctIndex", acctindex);
    memberdiv.setAttribute("contactid","");
    memberdiv.setAttribute("email", "");
    memberdiv.setAttribute("emailnum", "0");
    if( id == "" ){
        //id empty means create contact list,and data is contact id
        var $exitcontact = $("#contact_" + data);
        if($exitcontact.length != 0 && number != $exitcontact.attr("number"))
        {
            memberdiv.id = "contact_" + data + "_" + number;
        }
        else
            memberdiv.id = "contact_" + data;
        memberdiv.setAttribute("confname", "");
    }else{
        if( type == 1 ){
            memberdiv.id = "contactsgroup_" + id;
            memberdiv.className='contactsdiv groupcontactsdiv';
            memberdiv.setAttribute("confname", "");
            memberdiv.setAttribute("contactsid", data);
            memberdiv.setAttribute("number", disname);
            memberdiv.setAttribute("email", "");
            memberdiv.setAttribute("emailnum", "0");
        }else{
            memberdiv.setAttribute("confname", data.replace(/\"/g,"'"));
        }
    }
    
    var checkdiv = document.createElement('DIV');
    checkdiv.className='membercheck';
    var checkbox = document.createElement('INPUT');
    checkbox.type = 'checkbox';
    checkbox.className = "inputcbx";
    if( id == "" ){
        checkbox.setAttribute("contactid", data);
        checkbox.setAttribute("preconfid", id);
    }
    else if( type == 1 ){
        checkbox.setAttribute("contactid", "-1");
        checkbox.setAttribute("preconfid", "");
    }
    else{
        checkbox.setAttribute("contactid", "");
        checkbox.setAttribute("preconfid", id);
    }    
    checkdiv.appendChild(checkbox);
    memberdiv.appendChild(checkdiv);

    var iconmemberdiv = document.createElement('DIV');
    iconmemberdiv.className='membericon';
    var itemicon = document.createElement('DIV');
    if( type == 1 ){
        itemicon.className='appgroupicon';
        var arrowicon = document.createElement('IMG');
        arrowicon.className='arrowicon';
        arrowicon.src='../img/apps/app_more_triangle_normal.png';
        iconmemberdiv.appendChild(itemicon);
        iconmemberdiv.appendChild(arrowicon);
    }else{
        itemicon.className='appcontacticon';
        iconmemberdiv.appendChild(itemicon);
    }
    memberdiv.appendChild(iconmemberdiv);
    
    var namediv = document.createElement('DIV');
    namediv.className='membername';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = htmlEncode(disname);
    spantext.setAttribute("title", disname);
    namediv.appendChild(spantext);
    memberdiv.appendChild(namediv);
    
    var numberdiv = document.createElement('DIV');
    numberdiv.className='membernumber';
    var numbertext = document.createElement('SPAN');
    if( type == 1 ){
        if( data == "0" ){
            numbertext.innerHTML = "0 " + a_16646;
            memberdiv.setAttribute("contactsnum", "0");
        }else{
            numbertext.innerHTML = "1 " + a_16646;
            memberdiv.setAttribute("contactsnum", "1");
        }
    }else{
        numbertext.innerHTML = htmlEncode(number);
        numbertext.setAttribute("title", number);
    }
    numberdiv.appendChild(numbertext);
    memberdiv.appendChild(numberdiv);
    
    mAllContactdivObj.appendChild(memberdiv);
}

function create_schedule_div(id, groupid, disname, starttime, duration, reminder, retime ,host, confstate, dnd, milliseconds, autoanswer, schedulenum, schedulepsw,scheduleurl,pincode,schedulepstn, repeat, repeatRule, inviteacct, preset){  
    var showdate = starttime.split(" ");
    //var currentTime = convertCurrentTime();
    var currentTime = mCurrentTime;
    currentTime = currentTime.split(" ");

    if( (inviteacct == "" && $("#itemsdiv div#"+showdate[0]).length <= 0) || (inviteacct != "" && $("#inviteditemsdiv div#"+showdate[0]).length <= 0) )
    {
        var datediv = document.createElement('DIV');
        datediv.className="datediv";
        datediv.id=showdate[0];
        var datetitle = document.createElement('DIV');
        datetitle.className="datetitle";
        var datespan = document.createElement("SPAN");
        datespan.className="datespan";
        datespan.innerHTML = htmlEncode(showdate[0]);
        var dateimg = document.createElement("IMG");
        dateimg.src = "../img/apps/schedule.png";
        datetitle.appendChild(dateimg);
        datetitle.appendChild(datespan);
        datediv.appendChild(datetitle);
    }
    else
    {
        var datediv = document.getElementById(showdate[0]);
    }
    if(pincode == undefined || pincode == null)
    {
        pincode = "";
    }

    var itemdiv = document.createElement('DIV');
    itemdiv.className='itemdiv';
    itemdiv.setAttribute("name", disname);
    itemdiv.setAttribute("starttime", starttime);
    itemdiv.setAttribute("duration", duration);
    itemdiv.setAttribute("reminder", reminder);
    itemdiv.setAttribute("retime", retime);
    itemdiv.setAttribute("scheduleid", id);
    itemdiv.setAttribute("preconfid", id);
    itemdiv.setAttribute("host", host);
    itemdiv.setAttribute("dnd", dnd);
    itemdiv.setAttribute("confstate", confstate);
    itemdiv.setAttribute("milliseconds", milliseconds);
    itemdiv.setAttribute("autoanswer", autoanswer);
    itemdiv.setAttribute("schedulenum", schedulenum);
    itemdiv.setAttribute("schedulepsw", schedulepsw);
    itemdiv.setAttribute("scheduleurl", scheduleurl);
    itemdiv.setAttribute("schedulepstn", schedulepstn);
    itemdiv.setAttribute("repeat", repeat);
    itemdiv.setAttribute("repeatrule", repeatRule);
    itemdiv.setAttribute("pincode", pincode);
    itemdiv.setAttribute("inviteacct", inviteacct);
    itemdiv.setAttribute("preset", preset);
    itemdiv.id = "schedule_" + id;
    
    if(inviteacct == "" ){
        var checkdiv = document.createElement('DIV');
        checkdiv.className='itemcheck';
        var checkbox = document.createElement('INPUT');
        checkbox.type = 'checkbox';
        checkbox.className = "inputcbx";
        if( $("#selectall").attr("checked") )
            checkbox.checked = true;
        checkdiv.appendChild(checkbox);
        itemdiv.appendChild(checkdiv);
    }
    var line1div = document.createElement('DIV');
    line1div.className='itemline';

    var namediv = document.createElement('DIV');
    namediv.className='itemname';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = htmlEncode(disname);
    spantext.setAttribute("title", disname);
    namediv.appendChild(spantext);
    line1div.appendChild(namediv);

    var contentdiv = document.createElement('DIV');
    contentdiv.className='host';
    var contenttext = document.createElement('SPAN');
    if(host == "1")
        contenttext.innerHTML = a_10055+":"+a_10057;
    else
        contenttext.innerHTML = a_10055+":"+htmlEncode(host);
    contentdiv.appendChild(contenttext);
    line1div.appendChild(contentdiv);
        
    var line2div = document.createElement('DIV');
    line2div.className='itemline';

    var icondiv = document.createElement('DIV');
    icondiv.className='itemstate';
    var spantext = document.createElement('SPAN');

    if(confstate == "1")
    {
        spantext.innerHTML = a_10155;
    }
    else if(confstate == "2")
    {
       spantext.innerHTML = a_10174;
    }
    else
    {
        var countTime = countdownTime(showdate,id);
        spantext.innerHTML = htmlEncode(countTime);
        var itemicon = document.createElement('IMG');
        itemicon.src='../img/apps/schedule_caltime.png';
        icondiv.appendChild(itemicon);
        if(mTimeoutObj[id])
        {
            clearInterval(mTimeoutObj[id]);
            delete mTimeoutObj[id];
        }
        var counttimeout = setInterval(function(){show_countDown(showdate,id);},mTimeout);
        mTimeoutObj[id] = counttimeout;
    }
    
    icondiv.appendChild(spantext);
    line2div.appendChild(icondiv);

    var durationdiv = document.createElement('DIV');
    durationdiv.className='duration';
    var durationtext = document.createElement('SPAN');
    var endtime = calculateDuration(showdate[1],duration)
    durationtext.innerHTML = a_10056+" "+calculateDuration(showdate[1],0)+" - "+endtime;
    durationdiv.appendChild(durationtext);
    line2div.appendChild(durationdiv);
    
    itemdiv.appendChild(line1div);
    itemdiv.appendChild(line2div);

    var datechild = document.createElement('DIV');
    datechild.className='datechild';

    datechild.appendChild(itemdiv);
    datediv.appendChild(datechild);

    //if($("#itemsdiv div#"+showdate[0]).length <= 0)
    if(inviteacct == "" && $("#itemsdiv div#"+showdate[0]).length <= 0)
        mItemsdivObj.appendChild(datediv);
    else if(inviteacct != "" && $("#inviteditemsdiv div#"+showdate[0]).length <= 0)
        mInvitedItemsdivObj.appendChild(datediv);
    add_item_event();
}

/*
add to schedule, the data is from calllog
*/
function add_calllog_to_schedule(numbers,names,accts,recordfrom)
{
    var numberarray = numbers.split(":::");
    var namearray = names.split(":::");
    var acctarray = accts.split(":::");
    var recordarray = recordfrom.split(":::");
    var n = 0;
    var memberstring = "",selectconfname = "";
    var confid = "temp";
    $("#addcontact").click();
    for(;n < numberarray.length; n++)
    {
        var membericon = "<div class='membericon'><div class='appcontacticon'></div></div>";
        //var memberdiv = "<div class='memberdiv' name=\""+selectconfname+"\" confid=\""+confid+"\" number=\""+numberarray[n]+"\" isdelete=0 isexist=1 notsave=1 acctindex=\""+acctarray[n]+"\" recordfrom=" + recordarray[n] + ">";
        var memberdiv = "<div class='memberdiv' confid=\""+confid+"\" number=\""+numberarray[n]+"\" isdelete=0 isexist=1 notsave=1 acctindex=\""+acctarray[n]+"\" recordfrom=" + recordarray[n] + ">";
        var membername = "<div class='membername'><span title=\""+namearray[n]+"\">"+htmlEncode(namearray[n])+"</span></div>";
        var membernum = "<div class='membernumber'><span title=\""+numberarray[n]+"\">"+htmlEncode(numberarray[n])+"</span></div>";
        var stringdiv = memberdiv + membericon + membername + membernum + "</div>";
        memberstring += stringdiv;
    }
    $("#membersdiv").append(memberstring);
    $("#membersdiv .memberdiv[isexist=1][isdelete=0]").show();
    $.cookie("addschedulenumber", "", {path: '/', expires:10});
    $.cookie("addschedulename", "", {path: '/', expires:10});
    $.cookie("addscheduleacct", "", {path: '/', expires:10});
    $.cookie("addrecordfrom", "", {path: '/', expires:10});
}

function translate_page(){
    $("#a_cancel,#changemembercancelbtn").text(a_3);
    $("#addcontact").text(a_23);
    $("#invited").text(a_10052);
    $("#editbtn").text(a_22);
    $("#savebtn,#changemembersavebtn").text(a_17);
    $("#cancelbtn").text(a_3);
    $("#acceptbtn").text(a_10000);
    $("#rejectbtn").text(a_10038);
    //$("#a_detaildnd").text(a_10053);
    $("#a_detaildnd").text(a_9321);
    $("#a_detailautoanswer").text(a_15023);
    $("#a_relatedacct").text(a_15053);
    $("#relatedacct option:eq(0)").text(a_10032);
    $("#a_detailname").text(a_15054);   //a_16047
    $("#a_conferencenumber").text(a_15055);//a_10153
    $("#a_conferencepassword").text(a_6759);
    $("#a_detailmember").text(a_2044);
    $("#a_detailduration").text(a_4034);
    $("#a_detailtime").text(a_10012);
    $("#a_detailreminder").text(a_10013);
    $("#a_inadvance").text(a_10014);
    $("#a_pstn").text(a_15057);
    $("#a_addname").text(a_7474);
    $("#editmemberbtn").text(a_16645);
    $(".noscheudlediv span").text(a_16696);
    $("#delscheduleall").text(a_19067);
    $("#a_confpincode").text(a_19133);
    $("#a_confpreset").text(a_15069);
    $("#confpreset option:eq(0)").text(a_15071);
    $("#confpreset option:eq(1)").text(a_10024+" 1");
    $("#confpreset option:eq(2)").text(a_10024+" 2");
    $("#confpreset option:eq(3)").text(a_10024+" 3");
    $("#confpreset option:eq(4)").text(a_10024+" 4");
    $("#confpreset option:eq(5)").text(a_10024+" 5");
    $("#confpreset option:eq(6)").text(a_10024+" 6");
    $("#confpreset option:eq(7)").text(a_10024+" 7");
    $("#confpreset option:eq(8)").text(a_10024+" 8");
    $("#confpreset option:eq(9)").text(a_10024+" 9");
    $("#confpreset option:eq(10)").text(a_10024+" 10");
    $("#confpreset option:eq(11)").text(a_10024+" 11");
    $("#confpreset option:eq(12)").text(a_10024+" 12");
    $("#confpreset option:eq(13)").text(a_10024+" 13");
    $("#confpreset option:eq(14)").text(a_10024+" 14");
    $("#confpreset option:eq(15)").text(a_10024+" 15");
    $("#confpreset option:eq(16)").text(a_10024+" 16");
    $("#confpreset option:eq(17)").text(a_10024+" 17");
    $("#confpreset option:eq(18)").text(a_10024+" 18");
    $("#confpreset option:eq(19)").text(a_10024+" 19");
    $("#confpreset option:eq(20)").text(a_10024+" 20");
    $("#confpreset option:eq(21)").text(a_10024+" 21");
    $("#confpreset option:eq(22)").text(a_10024+" 22");
    $("#confpreset option:eq(23)").text(a_10024+" 23");
    $("#confpreset option:eq(24)").text(a_10024+" 24");
    $("#a_repeat").text(a_15024);
    $("#a_googlestatus").text(a_10060);
    $("#a_cusrepeat").text(a_15025);
    $("#repeat option:eq(0)").text(a_10143);
    $("#repeat option:eq(1), #cusrepeat option:eq(0)").text(a_10144);
    $("#repeat option:eq(2)").text(a_10145);
    $("#repeat option:eq(3), #cusrepeat option:eq(1)").text(a_10146);
    $("#repeat option:eq(4), #cusrepeat option:eq(3)").text(a_10148);
    $("#repeat option:eq(5), #cusrepeat option:eq(2)").text(a_10149);
    $("#repeat option:eq(6), #cusrepeat option:eq(4)").text(a_10150);
    $("#repeat option:eq(7)").text(a_10151);
    $("#a_cusweeklyon, #a_cusmonthday, #a_cusmonthweek, #a_cusyearlydate").text(a_15032);
    $("#a_sunday, #cusmonthweekday option:eq(0)").text(a_123);
    $("#a_monday, #cusmonthweekday option:eq(1)").text(a_117);
    $("#a_tuesday, #cusmonthweekday option:eq(2)").text(a_118);
    $("#a_wendesday, #cusmonthweekday option:eq(3)").text(a_119);
    $("#a_thursday, #cusmonthweekday option:eq(4)").text(a_120);
    $("#a_friday, #cusmonthweekday option:eq(5)").text(a_121);
    $("#a_saturday, #cusmonthweekday option:eq(6)").text(a_122);
    $("#cusmonthweekordinal option:eq(0)").text(a_19162);
    $("#cusmonthweekordinal option:eq(1)").text(a_19163);
    $("#cusmonthweekordinal option:eq(2)").text(a_19164);
    $("#cusmonthweekordinal option:eq(3)").text(a_19165);
    $("#cusmonthweekordinal option:eq(4)").text(a_19166);
    $("#a_cusstartdate").text(a_15026);
    $("#a_cusenddate").text(a_15027);
    $("#a_cancalconf").text(a_15044);
    $("#a_keepconf").text(a_15045);
    $("#a_hasrepeat").text(a_19169);
    $("#a_delrep").text(a_15042);
    $("#a_delcur").text(a_15041);
}
function remove_left()
{
    $('#ui-datepicker-div').css("left", "auto");
}

function calculateDuration(starttime,duration)
{
    if(starttime == undefined)
        return false;
    duration = convertDuration(duration);
    duration = duration.split(":");
    starttime = starttime.split(":");

    var hour = parseInt(starttime[0])+parseInt(duration[0]);
    var min = parseInt(starttime[1])+parseInt(duration[1]);
    //var sec = starttime[2];
    var str12Hour = "";

    if(min >= 60)
    {
        min = min - 60;
        hour = hour + 1;
    }
    if(min < 10)
        min = "0" + min;
    if(hour >= 24)
        hour = hour - 24;
    if( mUse24Hour == 0 ){
        if( hour < 12 )
            str12Hour = " am";
        else
        {
            str12Hour = " pm";
            if(hour > 12) 
                hour = (hour-12);
        }
    }else{
        hour = hour;
        str12Hour = "";
    }
    if(hour < 10)
        hour = "0" + hour;

    var endtime = hour + ":" + min + str12Hour; // + ":" + sec
    return endtime;
}

function change_time24hourformat(date){
    mDateObj.setTime(date);
    var timestr = mDateObj.getFullYear()+"-";
    var month = mDateObj.getMonth()+1;
    if( month < 10 )
        timestr += "0";
    timestr += month;
    timestr += "-";
    var date = mDateObj.getDate();
    if( date < 10 )
        timestr += "0";
    timestr += date;
    timestr += " ";
    var hours = mDateObj.getHours();
    if( hours < 12 ){
        if( hours < 10 )
            timestr += "0";
        timestr += hours;
    }else{
        timestr += hours;
    }
    timestr += ":";
    var minutes = mDateObj.getMinutes();
    if( minutes < 10 )
        timestr += "0";
    timestr += minutes;
    timestr += ":";
    var seconds = mDateObj.getSeconds();
    if(seconds < 10)
        timestr += "0";
    timestr += seconds;
    
    
    return timestr;
}

function countdownTime(starttime,scheduleid)
{
    if(starttime.length <= 1)
        return false;
    var startdate = starttime[0].split("-");
    var starthour = starttime[1].split(":");
    var startT = new Date(startdate[0],startdate[1]-1,startdate[2],starthour[0],starthour[1],starthour[2]);
    //var currentT = new Date();
    var currenttime = mCurrentTime.split(" ");
    var currentdate = currenttime[0].split("-");
    var currenthour = currenttime[1].split(":");
    var currentT = new Date(currentdate[0],currentdate[1]-1,currentdate[2],currenthour[0],currenthour[1],currenthour[2]);
    var endtime = "";
    var caldate = startT.getTime() - currentT.getTime();

    if(currentT.getTime() > startT.getTime())
    {
        caldate = startT.getTime() - startT.getTime();
    }
    
    var days = Math.floor(caldate/(24*3600*1000));
    if(days > 99)
        return "99D+";
        
    //hour
    var leave1 = caldate%(24*3600*1000);
    var hour = Math.floor(leave1/(3600*1000));

    //min
    var leave2 = leave1%(3600*1000);
    var min = Math.floor(leave2/(60*1000));

    if(min < 10)
        min = "0" + min;
    if(hour < 10)
        hour = "0" + hour;

    if(days > 0)
        endtime = days + "D  " + hour + ":" + min;
    else
        endtime = hour + ":" + min;
    return endtime;
}

function show_countDown(showdate,id)
{
    var endtime = countdownTime(showdate,id);
    $("#schedule_" +id).find(".itemstate").children("span").text(endtime);
    if(endtime == "00:00")
    {
        clearInterval(mTimeoutObj[id]);
        delete mTimeoutObj[id];
    }
}

function clone_groupmember(){
    $(".groupcontactsdiv").each(function(){
        var $this = $(this);
        var groupid = $this.attr("groupid");
        var $groupmemberlist;
        var contactlist = $this.attr("contactsid");
        var checkallstate = $this.children(".membercheck").children().attr("checked");
        contactlist = contactlist.split(",");

        if($(".groupmemberlist[groupid=\""+groupid+"\"]").length > 0)
            $groupmemberlist = $(".groupmemberlist[groupid=\""+groupid+"\"]");
        else
        {
            $groupmemberlist = $("<div class='groupmemberlist' groupid='"+groupid+"'></div>");
            $this.after($groupmemberlist);
        }

        if(!$groupmemberlist.has("div").length)
        {
            var membernum = contactlist.length;
            for(var i=0; i<contactlist.length ; i++)
            {
                var contactid = "#contact_" + contactlist[i];
                var $clonecontact = $("#allcontactsdiv "+contactid).clone();
                if($clonecontact.length <= 0)
                {
                    //remove contacts which has no number
                    membernum--;
                }
                if($(".groupmemberlist[groupid=\""+groupid+"\"] .contactsdiv[cloneid=\""+contactid+"\"]").length <= 0 && $clonecontact.length > 0)
                {
                    $clonecontact.attr("cloneid",contactid).attr("notsearch","1").removeAttr("id");
                    $clonecontact.children(".membericon").children(".appcontacticon").css("background","transparent");
                    if(checkallstate == "checked")
                        $clonecontact.find(".inputcbx").attr("checked",checkallstate);
                    else
                        $clonecontact.find(".inputcbx").removeAttr("checked");
                    $groupmemberlist.append($clonecontact);
                }
            }  
            $this.attr("contactsnum",membernum);
            if(membernum > 1)
                $this.children(".membernumber").children("span").text(membernum+" "+a_16647);
            else
                $this.children(".membernumber").children("span").text(membernum+" "+a_16646);
            if(!$groupmemberlist.has("div").length)
            {
                //the group has no member,remove it
                $this.remove();
                $groupmemberlist.remove();
            }
        }
        $(".groupmemberlist").hide();
    });
}

function convertEndTime(startTime,durationTime)
{
    startTime = startTime.replace(/-/g, "/");
    var dateobj = new Date(startTime);
    var start_millisecond = dateobj.getTime();
    var dura_millisecond = parseInt(durationTime)*60*1000;
    var end_millisecond = start_millisecond + dura_millisecond;
    return convertCurrentTime(end_millisecond);
}

function cal_durationTime(startTime,endTime)
{
    startTime = startTime.replace(/-/g, "/");
    endTime = endTime.replace(/-/g, "/");
    var dateobj = new Date(startTime);
    var start_millisecond = dateobj.getTime();
    //end time
    dateobj = new Date(endTime);
    var end_millisecond = dateobj.getTime();
    var duration = (end_millisecond-start_millisecond)/(60*1000);
    return duration;
}

function showCheckDeleteDialog(){
    $("#startcheckdiv").show();
}

function cancelConference(ifdelete){
    $("#startcheckdiv").hide();
    if( ifdelete == 1 ){
        cb_get_action("sqliteconf&region=apps&type=updatestate&id="+mCalloutConfid);
    }
    callOutPreConf(mCalloutConfid, ifdelete);
}
function deleteRepeat(deleteall){
    window.parent.block_download_func(a_59);
    $("#deletecheckdiv").hide();
    if( deleteall == 1 ){
        if( mDelscheduleId != "" ){
            mDelscheduleId += ",";
            mAllDelscheduleId += ",";
        }
        mDelscheduleId += mDelRepscheduleId;
        mAllDelscheduleId += mDelRepscheduleId;
        if( mDelscheduleId != "" )
            cb_get_action("deleteschedule&region=webservice&id="+mDelscheduleId); 
        var delgoogle = mDelGooglescheduleId;
        if( mDelRepGooglescheduleId != "" ){
            if( delgoogle != "" )
                delgoogle += ",";
            delgoogle += mDelRepGooglescheduleId;
        }
        if( delgoogle != "" ){
            //mLastAction = "&type=8&";
            cb_get_action("notifyschedule&region=webservice&type=8&scheduleId="+delgoogle); 
        }
    }else{
        if( mDelscheduleId != "" ){
            cb_get_action_sync("deleteschedule&region=webservice&id="+mDelscheduleId); 
        }
        if( mDelGooglescheduleId != "" ){
            //mLastAction = "&type=8&";
            cb_get_action_sync("notifyschedule&region=webservice&type=8&scheduleId="+mDelGooglescheduleId); 
        }
        if( mDelRepscheduleId != "" )
            mLastAction = "&type=5&";
        else if( mDelRepGooglescheduleId != "" )
            mLastAction = "&type=12&";
      
        if( mDelRepGooglescheduleId != "" ){
            cb_get_action_sync("notifyschedule&region=webservice&type=12&scheduleId="+mDelRepGooglescheduleId);  
        }
        if( mDelRepscheduleId != "" ){
            cb_get_action_sync("notifyschedule&region=webservice&type=5&scheduleId="+mDelRepscheduleId); 
        }
        if( mDelscheduleId == "" ){
            window.parent.unblock_func(); 
        }  
    }
}
function checkDeleteDiv(selconfid){
    $("#schedulecallbtn").hide().appendTo($("#mainbody"));
    var starttime = $("#schedule_"+selconfid).attr("starttime");
    var olddate = starttime.split(" ")[0];
    $("#schedule_"+selconfid).remove();
    if($("#itemsdiv #"+olddate).children(".datechild").children().length == 0)
        $("#itemsdiv #"+olddate).remove();
    
    if($("#itemsdiv .itemdiv").length > 0){
        $("#itemsdiv .itemdiv:first").click();
    }else{
        $("#persondiv").hide();
        $("#rightbtn").hide();
    }
}

function callOutPreConf(selconfid, ifdelete){
    var confnumbers = "", confaccts = "";
    var pingcode = $("#schedule_" + selconfid).attr("pincode");
    var confname = $("#schedule_" + selconfid).attr("name");
    var repeat = $("#schedule_" + selconfid).attr("repeat");
    $("#membersdiv .memberdiv[isdelete=0][confid=\""+selconfid+"\"]").each(function(){
        var contactsid = $(this).attr("contactsid");
        var number = $(this).attr("number");
        var acct = $(this).attr("acctindex");
        if(acct == undefined || acct == "")
            acct = 0;
        if( acct == -1 ){
            return;
        }
        if( contactsid == undefined){
            if( confnumbers != "" ){
                confnumbers += ":::";
                confaccts += ":::";
            }
            confnumbers += number;
            confaccts += acct;
        }
        else
        {
            contactsid = contactsid.split(",");
            for(var i=0; i< contactsid.length ; i++)
            {
                var conid = "#contact_"+contactsid[i];
                var number = $("#allcontactsdiv "+conid).attr("number");
                var acct = $("#allcontactsdiv "+conid).attr("acctindex");
                if(acct == undefined || acct == "")
                    acct = 0;
                if(confnumbers.indexOf(number) == -1)
                {
                    if( confnumbers != "" ){
                        confnumbers += ":::";
                        confaccts += ":::";
                    }
                    confnumbers += number;
                    confaccts += acct;
                }
            }
        }
    });

    //cb_get_action("addconfmemeber&region=confctrl&numbers=" + encodeURIComponent(confnumbers) + "&accounts=" + encodeURIComponent(confaccts) + "&confname=" + encodeURIComponent($("#itemsdiv .itemdiv.selectItem").attr("name")));
    if( ifdelete == 1 )
        cb_get_action_sync("notifyschedule&region=webservice&type=7&scheduleId="+selconfid);
    else
        cb_get_action_sync("notifyschedule&region=webservice&type=6&scheduleId="+selconfid);
    //cb_start_addmemberconf(confnumbers, confaccts, "", encodeURIComponent($("#itemsdiv .itemdiv.selectItem").attr("name")));
    
    var isdialplan = "";
    $("#membersdiv .memberdiv[isexist=1]").each(function(){
        var recordfrom = $(this).attr("recordfrom");
        if(recordfrom != undefined){
            if(mDisdialplan[recordfrom] == 0)
                isdialplan += "1:::";
            else
                isdialplan += "0:::";
        }
        else{
            isdialplan += "1:::";
        }
    });
    
    isdialplan = isdialplan.substring(0, isdialplan.length - 3);
    
    cb_start_addmemberconf(confnumbers, confaccts, "", selconfid, isdialplan, confname, 1, 0, pingcode);
    
    mIfdelete = ifdelete;
    if( ifdelete >= 1 && repeat == "0"){
        mIfdelete = 0;
        checkDeleteDiv(selconfid);
    }
}

function handle_endcall(){
    if(mIfdelete == 1){
        $("#schedulecallbtn").hide().appendTo($("#mainbody"));
        $("#itemsdiv .datediv").remove();
        setTimeout("get_schedule()", 500);
    }
}

function update_custom_repeat_value(){
    var datetime = $("#edittime").val();
    $("#cusstartdate").text(datetime.substring(0,10));

    var custype = "0", interval = "1", endDate = "", day = "", ordinal = "0", dayweek = "0", selWeekStr = "", yearlymonth = 1, yearlyday = 1;
    //endDate = $("#cusstartdate").text();
    endDate = a_42;
    yeardate = datetime.substring(5,10);
    datetime = datetime.replace(/-/g, "/");
    var startdate = new Date(datetime);
    dayweek = startdate.getDay();
    day = startdate.getDate();
    yearlyday = day;
    yearlymonth = startdate.getMonth() + 1;
    ordinal = Math.ceil( day / 7 ); 
    selWeekStr = "," + mByDaysStr[dayweek] + ","; 
       
    if( mCustomRepeatRule != "" ){
        var rules = mCustomRepeatRule.split(";");
        var currule, key, value;
        for(var i = 0; i < rules.length; i++){
            currule = rules[i];
            key = currule.split("=")[0];
            value = currule.split("=")[1];
            if( key == "FREQ" ){
                if( value == "DAILY" ){
                    custype = 0;
                }else if( value == "WEEKLY" ){
                    custype = 1;
                }else if( value == "YEARLY" ){
                    custype = 4;
                }
            }else if( key == "INTERVAL" ){
                interval = value;
            }else if( key == "BYDAY" ){
                if( value.length == 3 ){
                    custype = 3;
                    ordinal = value.substring(0, 1);
                    dayweek = getDayWeekIndex(value.substring(1));
                }else if( value.length == 4 ){
                    custype = 3;
                    ordinal = "5";
                    dayweek = getDayWeekIndex(value.substring(2));                   
                }else{
                    selWeekStr = "," + value + ",";
                     
                } 
            }else if( key == "BYMONTHDAY" ){
                custype = 2;
                day = parseInt(value);
            }else if( key == "BYYEARDAY" ){
                yearlymonth = parseInt(value.substring(0, 2));
                yearlyday = parseInt(value.substring(2));
            }else if( key == "UNTIL" ){
                //endDate = value;
                value = value.replace(/T/g, "");
                value = value.replace(/Z/g, "");
                endDate = value.substring(0,4)+"/"+value.substring(4,6)+"/"+value.substring(6,8)+" "+value.substring(8,10)+":"+value.substring(10,12);
                var enddateobj = new Date(endDate);
                var time = enddateobj.getTime();
                var offset = enddateobj.getTimezoneOffset();
                enddateobj.setTime(time-offset*60000);
                var endmonth = (enddateobj.getMonth()+1);
                var endday = enddateobj.getDate();
                endDate = enddateobj.getFullYear() + "-";
                if( endmonth < 10 )
                    endDate += "0";
                endDate += endmonth;
                endDate += "-";
                if( endday < 10 )
                    endDate += "0";
                endDate += endday; 
            }
        }
    }
    $("#cusinterval").val( interval );
    $("#cusenddate").val( endDate );
    $("#cusmonthweekordinal").getSetSSValue( ordinal );
    $("#cusmonthweekday").getSetSSValue( dayweek );
    $("#cusmonthday").getSetSSValue(day);
    $("#cusyearlydatemonth").getSetSSValue( yearlymonth );
    $("#cusyearlydateday").getSetSSValue( yearlyday );
    //the cusrepeat value must be set after cusyearlydatemonth,or else cusyearlydateday can't be open
    $("#cusrepeat").getSetSSValue(custype);
    var curweek;
    $("input[name=cusweekly]").each(function(){
        curweek = "," + $(this).attr("daystr") + ",";
        if( selWeekStr.indexOf(curweek) != -1 ){
            $(this).attr("checked", true);
        }else{
            $(this).attr("checked", false);
        }
    });
}

function checkCustomEnddate(){
    var enddate = $("#cusenddate").val();
    if( enddate != a_42 ){
        enddate += " 23:59";
        enddate = enddate.replace(/-/g, "/");
        var endDate = new Date(enddate);
        var endtime = endDate.getTime();
        
        var starttime = $("#edittime").val();
        starttime = starttime.replace(/-/g, "/");
        var startDate = new Date(starttime);
        var starttime = startDate.getTime();  
        if( endtime <= starttime ){
            $("#cusenddate").val(a_42);
        }
    }
}

function getCustomRepeatRule(){
    var repeatrule = "";
    var custype = parseInt($("#cusrepeat").val());
    var freq = "", byday = "", byyearday = "";
    var bymonthday = -1, ordinal = -1, dayweek = 0;
    switch(custype){
        case 0:
            freq = "DAILY";
            break;
        case 1:
            freq = "WEEKLY";
            $("input[name=cusweekly]").each(function(){
                if( $(this).attr("checked") ){
                    if( byday != "" ){
                        byday += ",";
                    }
                    byday += $(this).attr("daystr");
                }
            });
            break;  
        case 2:
            freq = "MONTHLY";
            bymonthday = parseInt($("#cusmonthday").val());
            break;
        case 3:
            freq = "MONTHLY";
            ordinal = $("#cusmonthweekordinal").val();
            if( ordinal == '5' ){
                byday += "-1";
            }else{
                byday += ordinal;
            }
            dayweek = parseInt($("#cusmonthweekday").val());
            byday += mByDaysStr[dayweek];
            break;
        case 4:
            freq = "YEARLY";
            var repmonth = parseInt($("#cusyearlydatemonth").val());
            var repday = parseInt($("#cusyearlydateday").val());
            if( repmonth < 10 )
                byyearday += "0";
            byyearday += repmonth;
            if( repday < 10 )
                byyearday += "0";
            byyearday += repday;
            break;   
    }
    if( freq != "" ){
        repeatrule = "FREQ=" + freq;
    }
    var interval = parseInt($("#cusinterval").val());
    if( interval > 1 ){
        repeatrule += ";INTERVAL=" + interval;
    }
    if( byday != "" ){
        repeatrule += ";BYDAY=" + byday;
    }
    if( bymonthday != -1 ){
        if( bymonthday < 1 || bymonthday > 31 ){
            $.prompt("Date error!");
            return;
        }
        repeatrule += ";BYMONTHDAY=" + bymonthday;
    }
    if( byyearday != "" ){
        repeatrule += ";BYYEARDAY=" + byyearday;
    }
    var enddate = $("#cusenddate").val();
    if( enddate != a_42 ){
        enddate += " 23:59";
        enddate = enddate.replace(/-/g, "/");
        var myDate = new Date(enddate);
        var time = myDate.getTime();
        var offset = myDate.getTimezoneOffset();
        myDate.setTime(time+offset*60000);
        repeatrule += ";UNTIL=" + date2str(myDate,"yyyyMMddThhmmssZ");
    }
    return repeatrule;
}
function date2str(x,y) { 
    var z ={y:x.getFullYear(),M:x.getMonth()+1,d:x.getDate(),h:x.getHours(),m:x.getMinutes(),s:x.getSeconds()}; 
    return y.replace(/(y+|M+|d+|h+|m+|s+)/g,function(v) {return ((v.length>1?"0":"")+eval('z.'+v.slice(-1))).slice(-(v.length>2?v.length:2))}); 
} 
function getUTCTimestamp(){
    var myDate = new Date();
    var time = myDate.getTime();
    var offset = myDate.getTimezoneOffset();
    myDate.setTime(time+offset*60000);
    return date2str(myDate,"yyyyMMddThhmmssZ");
}
function getDayWeekIndex(day){
    if( day == "SU" ){
        return 0;
    }
    if( day == "MO" ){
        return 1;
    }
    if( day == "TU" ){
        return 2;
    }
    if( day == "WE" ){
        return 3;
    }
    if( day == "TH" ){
        return 4;
    }
    if( day == "FR" ){
        return 5;
    }
    if( day == "SA" ){
        return 6;
    }
    return 0;
}

function change_repeat_type(updatevalue){
    var type = $("#repeat").val();
    if( type == "7" ){
        $(".cusrepeatdivs").show();
        if( $("#cusrepeatdiv").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#cusrepeat, #cusmonthweekordinal, #cusmonthweekday").sSelect();
            $("#cusmonthday, #cusyearlydatemonth, #cusyearlydateday").sSelect({ddMaxHeight:'250px'});
        }
        if( updatevalue == 1 ){
            update_custom_repeat_value();
            change_custom_repeat_type();
        }else{
            change_custom_repeat_type();
        }
    }else{
        $(".cusrepeatdivs").hide();
    }
}

function change_custom_repeat_type(){
    var custype = parseInt($("#cusrepeat").val());
    switch(custype){
        case 0:
            $("#cusweeklydiv, #cusmonthlydaydiv, #cusmonthlyweekdiv, #cusyearlydiv").hide();
            $("#a_cusinterval").text(a_15028);
            break;
        case 1:
            $("#cusmonthlydaydiv, #cusmonthlyweekdiv, #cusyearlydiv").hide();
            $("#a_cusinterval").text(a_15029);
            $("#cusweeklydiv").show();
            break;
        case 2:
            $("#cusweeklydiv, #cusmonthlyweekdiv, #cusyearlydiv").hide();
            $("#a_cusinterval").text(a_15030);
            $("#cusmonthlydaydiv").show();
            break;
        case 3:
            $("#cusweeklydiv, #cusmonthlydaydiv, #cusyearlydiv").hide();
            $("#a_cusinterval").text(a_15030);
            $("#cusmonthlyweekdiv").show();
            break;
        case 4:
            $("#cusweeklydiv, #cusmonthlydaydiv, #cusmonthlyweekdiv").hide();
            $("#a_cusinterval").text(a_15031);
            $("#cusyearlydiv").show();
            break;
    }
}
function change_repeat_yearly_month(){
    var month = parseInt($("#cusyearlydatemonth").val());
    var dayCount = 0;
    switch (month) { 
         case 1: 
         case 3: 
         case 5: 
         case 7: 
         case 8: 
         case 10: 
         case 12: 
              dayCount = 31; 
              break; 
         case 4: 
         case 6: 
         case 9: 
         case 11: 
              dayCount = 30; 
              break; 
         case 2: 
              dayCount = 28; 
              /*if ((year % 4 == 0) && (year % 100 != 0) || (year % 400 == 0)) { 
                  dayCount = 29; 
              }*/ 
              break; 
         default: 
              break; 
    }
    var curmaxday = $("#cusyearlydateday option").length;
    if( curmaxday > dayCount ){
        $("#cusyearlydateday option:gt("+(dayCount-1)+")").remove();
    }else if( curmaxday < dayCount ){
        for (var i = curmaxday+1; i <= dayCount; i++) {
            var $opt = $("<option value='" + i + "'>" + i + "</option>");
			$('#cusyearlydateday').append($opt);
        } 
    }
    $('#cusyearlydateday').resetSS(); 
}
function pageEventActions(){

    $('#edittime').click(function(){
        setTimeout("remove_left();", 100);
    });
    $('#edittime').focus(function(){
        setTimeout("remove_left();", 100);
    });

    $('#edittime, #editduration, #cusenddate').keydown(function(event){
        return false;
    });
    $('#edittime, #editduration, #cusenddate').keyup(function(event){
        return false;
    });
    
    /***************serach hover function********************/
    $("#search").hover(function(){
            $(this).css("borderColor","#4ABE6B");
        },function(){
            $(this).css("borderColor","#d9d9d9");
    });
    /***************hover function end********************/
    
    // $("#selectconfname").change(function(){
    //     var confid = $(this).val();
    //     $(".memberdiv").hide();
    //     $(".memberdiv[confid=" + confid + "]").show();
    // });
    
    $("#repeat").change(function(){
        change_repeat_type(1);
    });
    
    $("#relatedacct").change(function(){
        if( $(this).val() == "1" ){
            $(".memberemail").hide();
        }else{
            $(".memberemail").show();
        }
    });
    
    $("#cusrepeat").change(function(){
        change_custom_repeat_type();
    });
    
    $("#confpincode").focus(function(){
        if( $(this).val() == a_15046 ){
            $(this).val("").removeClass("inputhint");
        }
    }).blur(function(){
        if( $(this).val() == "" ){
            $(this).val(a_15046).addClass("inputhint");
        }
    });
    
    $("#cusyearlydatemonth").change(function(){
        change_repeat_yearly_month();
    });
    
    $("#editbtn").click(function(){
        var confname = $("#itemsdiv .itemdiv.selectItem").attr("name");
        var duration = $("#itemsdiv .itemdiv.selectItem").attr("duration");
        var repeat = $("#itemsdiv .itemdiv.selectItem").attr("repeat");
        mRepeatRule = $("#itemsdiv .itemdiv.selectItem").attr("repeatrule");
        var schtime = $("#detailtime").text();
        var endtime = convertEndTime(schtime,duration);
        mTempDurationTime = parseInt(duration);
        $("#search").val("");
        mEditMode = 2;
        
        $(".righttopdiv, .memberdiv").removeClass("hasborder");
        $("#editduration").val( endtime.substring(0,endtime.length-3) );
        $("#edittime").val( schtime );
        $("#selectconfname").val(confname);
        $("#remindercheck").attr("disabled", false);          
        $(".contentdiv").hide();
        $(".editdiv, #confnamedisdiv").show();
        $("#confnamedisdiv").hide();
        $("#confnameeditdiv").show();
        $(".memberdiv").hide();
        $("#searchdiv,#showmembernum").hide();
        $(".memberdiv[confid=" + mSelectConfId + "]").show();
        $("#savebtn,#cancelbtn").show();
        $("#editbtn").hide();
        $("#selectconfname").focus();
        if( mHasGoogle ){
            $("#membersdiv .membernumber").hide();
            $("#googleacctdiv, .memberemail").show();
            if( $("#googleacctdiv").children(".editdiv").children(".newListSelected").length == 0 ){
                $("#relatedacct").sSelect();
            }
            var host = $("#itemsdiv .itemdiv.selectItem").attr("host");
            $("#relatedacct").getSetSSValue(host);
            if( host != "1" ){
                $("#relatedacct").next(".newListSelected").attr("disabled", "disabled").addClass("newListDisabled");
            }else{
                $(".memberemail").hide();
                $("#relatedacct").next(".newListSelected").removeAttr("disabled").removeClass("newListDisabled");
            }
            $("#subjectdiv").css("margin-top", "0");
        }
        if( $("#repeatdiv").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#repeat").sSelect();
        }
        if( $("#presetdiv").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#confpreset").sSelect({ddMaxHeight:'250px'});
        }
        if( repeat == "7" ){
            mCustomRepeatRule = mRepeatRule;
        }else{
            mCustomRepeatRule = "";
        }
        $("#repeat").getSetSSValue( repeat );
        //change_repeat_type();
    });

    $("#editmemberbtn").click(function(){
        $("#search").val("");
        $("#detailacct").val("0");
        $("#allcontactsdiv .contactsdiv").show();
        var selectconfname = $("#itemsdiv .itemdiv.selectItem").attr("name");
        var confid = $("#itemsdiv .itemdiv.selectItem").attr("scheduleid");
        $("#allcontactsdiv .contactsdiv").each(function(){
            $(this).children(".membercheck").children(".inputcbx").prop("checked",false);
            $(this).removeAttr("contactnosearch");
        })
        $("#searchdiv p").hide();
        $("#allcontactsdiv .contactsdiv.selectedItem").remove();
        mCheckedmembernum = 0;
        mSelectedmemeber_num = 0;
        mMaxScheduleMember = mMaxmumber;
        mIsreduce = false;
        if(mEditMode == 1)
            confid = "temp";
        $("#membersdiv .memberdiv[confid=\""+confid+"\"][isdelete=0]").each(function(){
            var itemnum = $(this).attr("number");
            var itemacct = $(this).attr("acctindex");
            var itemname = $(this).children(".membername").children(".membernametop").text();
            if( itemname == undefined || itemname == "" ){
                itemname = $(this).children(".membername").text();
            }
            var itememail = $(this).attr("email");
            var itememailnum = $(this).attr("emailnum");

            $("#allcontactsdiv .contactsdiv").each(function(){
                var $this = $(this);
                var contactnum = $this.attr("number");
                var contactname = $this.attr("name");
                var isclone = $this.attr("cloneid");
                var islog = $this.attr("logid");
                
                if(itemnum == contactnum && itemname == contactname && isclone == undefined && islog == undefined)
                {
                    $this.attr("contactnosearch",1).hide();
                }
            });
            var checkedDiv = document.createElement("DIV");
            checkedDiv.className = "contactsdiv selectedItem";
            checkedDiv.setAttribute("name",itemname);
            checkedDiv.setAttribute("acctindex",itemacct);
            checkedDiv.setAttribute("number",itemnum);
            checkedDiv.setAttribute("email",itememail);
            checkedDiv.setAttribute("emailnum",itememailnum);
            
            var inputcbxdiv = document.createElement("DIV");
            inputcbxdiv.className = "membercheck";
            var cbx = document.createElement("INPUT");
            cbx.className = "inputcbx";
            cbx.type = "checkbox";
            inputcbxdiv.appendChild(cbx);
            //in IE8,if 'setAttribute' it is before 'appendChild',the checkbox will not be checked
            cbx.setAttribute("checked","checked");
            checkedDiv.appendChild(inputcbxdiv);

            var icondiv = document.createElement("DIV");
            icondiv.className = "membericon";
            checkedDiv.appendChild(icondiv);

            var namediv = document.createElement("DIV");
            namediv.className = "membername";
            var spantext = document.createElement("SPAN");
            spantext.innerHTML = htmlEncode(itemname);
            spantext.setAttribute("title",itemname);
            namediv.appendChild(spantext);
            checkedDiv.appendChild(namediv);

            var numdiv = document.createElement("DIV");
            numdiv.className = "membernumber";
            var numtext = document.createElement("SPAN");
            numtext.innerHTML = htmlEncode(itemnum);
            numtext.setAttribute("title",itemnum);
            numdiv.appendChild(numtext);
            checkedDiv.appendChild(numdiv);

            $(".dividing").before(checkedDiv);
            mSelectedmemeber_num++;
            if(itemacct == "1")
            {
                //if member is ipvideotalk, max number should reduce 1
                if(!mIsreduce && mPromodel != "GVC3202")
                {
                    mIsreduce = true;
                    mMaxScheduleMember = mMaxScheduleMember - 1;
                }
            }
            // $("#allcontactsdiv .contactsdiv").each(function(){
            //     var contactnum = $(this).attr("number");
            //     if(itemnum == contactnum)
            //     {
            //         $(this).children(".membercheck").children(".inputcbx").attr("checked",true);
            //     }
            // });
        });
        $(this).hide();
        $(this).parent().parent().siblings(".righttopdiv").hide();
        $("#searchdiv,#changemembersavebtn,#changemembercancelbtn").show();
        $("#savebtn,#cancelbtn").hide();
        $("#searchdiv").show();
        $("#allcontactsdiv").show();
        $("#membersdiv .memberdiv").hide();
        var searchnum = $(".searchnewItem").attr("number");
        if(searchnum == "" || searchnum == undefined)
        {
            $(".searchnewItem").hide();
        }
    });

    $("#changemembersavebtn").click(function(){
        var selectconfname = $("#itemsdiv .itemdiv.selectItem").attr("name");
        var confid = $("#itemsdiv .itemdiv.selectItem").attr("preconfid");
        if(confid == undefined)
            confid = "temp";
        var tempnum = 0;
        $("#membersdiv .memberdiv[confid=\""+confid+"\"]").attr("isdelete",1);
        $("#allcontactsdiv .contactsdiv").each(function(){
            var contactnum = $(this).attr("number");
            var acctindex = $(this).attr("acctindex");
            var classname = $(this).attr("class");
            var recordfromid = $(this).attr("id");

            if($(this).children(".membercheck").children(".inputcbx").prop("checked") == true)
            {
                var $judgemember = $("#membersdiv .memberdiv[confid=\""+confid+"\"][number=\""+contactnum+"\"][acctindex=\""+acctindex+"\"]");
                if(selectconfname == undefined)
                    selectconfname = $("#selectconfname").val();
                
                var name = $(this).attr("name");
                var acctid = $(this).attr("acctindex");
                var membericon = "<div class='membericon'><div class='appcontacticon'></div></div>";
                
                var recordfrom;  //3--incoming calllog; 4--outgoing calllog; 5--contacts; 6--input search
                if(recordfromid == undefined){
                    if($(this).parent().attr("class") != undefined && $(this).parent().attr("class").indexOf("groupmemberlist") != -1)
                        recordfrom = 5;
                    else if($(this).attr("class").indexOf("creatsearchItem") != -1)
                        recordfrom = 6;
                    else if($(this).attr("class").indexOf("selectedItem") != -1){
                        var curnumber = $(this).attr("number");
                        recordfrom = $(".memberdiv[number=\"" + curnumber + "\"]").attr("recordfrom");
                    }
                        
                }
                else{
                    if(recordfromid.indexOf("contact") != -1)
                        recordfrom = 5;
                    else if(recordfromid.indexOf("contactsgroup") != -1)
                        recordfrom = 5;
                    else if(recordfromid.indexOf("calllog") != -1){
                        var type = $(this).attr("type");
                        if(type == 1 || type == 3)  //1--incoming; 2--outgoing; 3--missing
                            recordfrom = 3;
                        else
                            recordfrom = 4;        
                    }
                }
                
                if($(this).attr("class").indexOf("groupcontactsdiv") != -1)
                {
                    /*var contactsid = $(this).attr("contactsid");
                    var groupid = $(this).attr("groupid");
                    var tempmembernum = parseInt($(this).attr("contactsnum"));
                    var memberdiv = "";
                    var stringdiv = "";
                    contactsid = contactsid.split(",");
                    for(var i=0; i< tempmembernum ; i++)
                    {  
                        var contacttempid = "#contact_" + contactsid[i];
                        var tmpname = $(contacttempid).attr("name");
                        var tmpnum = $(contacttempid).attr("number");
                        var tmpacct = $(contacttempid).attr("acctindex");
                        var memberdiv = "<div class='memberdiv' name=\""+selectconfname+"\" confid=\""+confid+"\" number=\""+tmpnum+"\" isdelete=0 isexist=1 notsave=1 acctindex=\""+tmpacct+"\">";
                        var membername = "<div class='membername'><span title=\""+tmpname+"\">"+tmpname+"</span></div>";
                        var membernum = "<div class='membernumber'><span title=\""+tmpnum+"\">"+tmpnum+"</span></div>";
                        var $g_judgemember = $("#membersdiv .memberdiv[confid=\""+confid+"\"][number=\""+tmpnum+"\"][acctindex=\""+tmpacct+"\"]");

                        if($g_judgemember.length == 0)
                            stringdiv += memberdiv + membericon + membername + membernum + "</div>";

                        if($(contacttempid).find(".inputcbx").prop("checked") == false)
                            tempnum++;
                    }*/
                }
                else
                {
                    var emailattr = $(".contactsdiv[number=\"" + contactnum + "\"][acctindex=" + acctid + "]").eq(0).attr("email")
                    var emailnum = $(".contactsdiv[number=\"" + contactnum + "\"][acctindex=" + acctid + "]").eq(0).attr("emailnum");
                    //var memberdiv = "<div class='memberdiv' name=\""+selectconfname+"\" confid=\""+confid+"\" number=\""+contactnum+"\" email=\"" + emailattr + "\" emailnum=" + emailnum + " isdelete=0 isexist=1 notsave=1 acctindex=\""+acctid+"\" recordfrom=" + recordfrom + ">";
                    var memberdiv = "<div class='memberdiv' confid=\""+confid+"\" number=\""+contactnum+"\" email=\"" + emailattr + "\" emailnum=" + emailnum + " isdelete=0 isexist=1 notsave=1 acctindex=\""+acctid+"\" recordfrom=" + recordfrom + ">";    
                    if(classname.indexOf("creatsearchItem") != -1)
                    {
                        //memberdiv = "<div class='memberdiv' name=\""+selectconfname+"\" confid=\""+confid+"\" number=\""+contactnum+"\" searchitem=1 isdelete=0 isexist=1 notsave=1 acctindex=\""+acctid+"\" recordfrom=" + recordfrom + ">";
                        memberdiv = "<div class='memberdiv' confid=\""+confid+"\" number=\""+contactnum+"\" searchitem=1 isdelete=0 isexist=1 notsave=1 acctindex=\""+acctid+"\" recordfrom=" + recordfrom + ">";        
                        $(this).remove();
                    }
                    var membername, membernum, memberemail;
                    if( mHasGoogle ){
                        var email = emailattr.split(":::")[0];
                        membername = "<div class='membername'><div class='membernametop'><span title=\""+name+"\">"+htmlEncode(name)+"</span></div><div class='membernamebot'><span title=\""+contactnum+"\">"+htmlEncode(contactnum)+"</span></div></div>";
                        membernum = "<div class='membernumber' style='display:none;'><span class='emailspan' title=\""+email+"\">"+htmlEncode(email)+"</span></div>";
                        if( $("#relatedacct").val() != "1" ){   
                            memberemail = "<div class='memberemail' style='display:block;'><input class='emailinput' type='text' value=\""+email+"\" title=\""+a_302+"\"/></div>";
                        }else{
                            memberemail = "<div class='memberemail' style='display:none;'><input class='emailinput' type='text' value=\""+email+"\" title=\""+a_302+"\" /></div>";
                        }
                        
                    }else{
                        membername = "<div class='membername'><span title=\""+name+"\">"+htmlEncode(name)+"</span></div>";
                        membernum = "<div class='membernumber'><span title=\""+contactnum+"\">"+htmlEncode(contactnum)+"</span></div>";
                        memberemail = "";
                    }
                    
                    var stringdiv = memberdiv + membericon + membername + membernum + memberemail + "</div>";
                    tempnum++; 
                    if(acctid == "1")
                    {
                        //if member is ipvideotalk, max number should reduce 1
                        if(!mIsreduce && mPromodel != "GVC3202")
                        {
                            mIsreduce = true;
                            mMaxScheduleMember = mMaxScheduleMember - 1;
                        }
                    }
                }  

                if($judgemember.length == 0)
                    $("#membersdiv").append(stringdiv);
                else
                {
                    if($judgemember.attr("searchitem") == "1")
                    {
                        $judgemember.find(".membername").children("span").attr("title",name).text(name);
                        $judgemember.removeAttr("searchitem");
                    }
                    $judgemember.attr("isdelete",0);
                }
            }
        });
        
        if(tempnum == 0)
        {
            $(".detailcontent").scrollTop(0);
            $("#searchdiv p").text(a_16436)
            .show(800,function(){
            setTimeout(function(){$("#searchdiv p").hide(800);},2500);
            });
            $("#membersdiv .memberdiv[confid=\""+confid+"\"][isexist=1]").attr("isdelete",0);
            return false;
        }

        if(tempnum > mMaxScheduleMember)
        {
            $(".detailcontent").scrollTop(0);
            $("#searchdiv p").text(a_10097)
            .show(800,function(){
            setTimeout(function(){$("#searchdiv p").hide(800);},2500);
            });
            $("#membersdiv .memberdiv[notsave=1]").remove();
            return false;
        }

        $(this).hide();
        $("#righttopdiv .righttopdiv, #editmemberbtn").show();
        $("#responsediv").hide();
        if( !mHasGoogle ){
            $("#googleacctdiv").hide();
        }
        $("#allcontactsdiv, #searchdiv, #changemembercancelbtn, .cloudconf").hide();
        $("#savebtn,#cancelbtn").show();
        $("#membersdiv .memberdiv[isexist=1][isdelete=0]").show();
        change_repeat_type(0);
    });

    $("#changemembercancelbtn").click(function(){
        $(this).hide();
        $("#righttopdiv .righttopdiv, #editmemberbtn").show();
        $("#allcontactsdiv, #searchdiv, #changemembersavebtn, .cloudconf").hide();
        $("#responsediv").hide();
        if( !mHasGoogle ){
            $("#googleacctdiv").hide();
        }
        $("#savebtn,#cancelbtn").show();
        $("#membersdiv .memberdiv[isexist=1][isdelete=0]").show();
        change_repeat_type(0);
    });

    $("#addcontact").click(function(){
        mEditMode = 1;
        mTempDurationTime = 60;
        var nowtime = convertCurrentTime();
        var endtime = convertEndTime(nowtime,60);
        $("#changemembercancelbtn").click();
        //$("#cancelbtn").click();
        $(".editdiv").hide();
        $("#acceptbtn, #rejectbtn").hide();
        $(".righttopdiv, .memberdiv").removeClass("hasborder");
        $("#remindercheck").attr("disabled", true).attr("checked",false);     
        $(".contentdiv").show();
        $("#showmembernum").show();
        $(".memberdiv").hide();
        $(".memberdiv[confid=" + mSelectConfId + "][isexist=1]").show();
        $("#membersdiv .memberdiv[confid=\""+mSelectConfId+"\"]").attr("isdelete",0);
        $("#savebtn,#cancelbtn").hide();
        $("#membersdiv .memberdiv[notsave=1]").remove();
        $("#allcontactsdiv .contactsdiv.creatsearchItem").remove();
        $("#membersdiv .memberdiv[confid=temp]").remove();
        $("#detailname,#detailduration,#detailtime,#detaildnd").text("");
        $("#remindercheck").attr("checked", false);
        $(".contentdiv").hide();
        $(".editdiv").show();
        $("#editduration").val(endtime.substring(0,endtime.length-3));
        $("#edittime").val(nowtime.substring(0,nowtime.length-3));
        $("#remindercheck").attr("disabled", false).attr("checked", true);
        $("#dndcheck,#autoanswer").attr("checked", false);
        $("#confpincode").val(a_15046).addClass("inputhint");
        $("#selectconfname").val("");
        //$("#selectconfname").val(mDftConfid);
        $("#membersdiv .memberdiv").hide().attr("isexist",0);
        $("#itemsdiv .itemdiv.selectItem").removeClass("selectItem");
        $("#savebtn,#cancelbtn").show();
        $("#editbtn, .cloudconf").hide();
        $("#selectconfname").focus();
        $("#showmembernum").text("").hide();
        if( $(".itemdiv").length == 0 )
        {
            $(".noscheudlediv").show();
            $("#itemsdiv").hide();
        }
        else
        {
            $(".noscheudlediv").hide();
            $("#itemsdiv").show();
        }
        $("#persondiv,#rightbtn").show();
        $("#responsediv").hide();
        if( mHasGoogle ){
            $("#membersdiv .membernumber").hide();
            $("#googleacctdiv, .memberemail").show();
            if( $("#googleacctdiv").children(".editdiv").children(".newListSelected").length == 0 ){
                $("#relatedacct").sSelect();
            }else{
                $("#relatedacct").next(".newListSelected").removeAttr("disabled").removeClass("newListDisabled");
            }
            $("#relatedacct").getSetSSValue("1");
            $("#subjectdiv").css("margin-top", "0");
        }else{
            $("#googleacctdiv").hide();
        }
        if( $("#repeatdiv").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#repeat").sSelect();
        }
        if( $("#presetdiv").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#confpreset").sSelect({ddMaxHeight:'250px'});
        }
        mCustomRepeatRule = "";
        $("#repeat").getSetSSValue("0");
        $("#confpreset").getSetSSValue("-1");
        $(".cusrepeatdivs").hide();
    });

    $("#invited").click(function(){
        if( $("#invited").text() == a_10052 ){
            $("#inviteditemsdiv").show();
            $("#invited").css("left", "280px");
            $("#addcontact, #itemsdiv, #selectall, #delscheduleall").hide();
            $("#invited").text(a_29);
            $("#inviteditemsdiv .itemdiv").eq(0).click();
        }else{
            $("#inviteditemsdiv").hide();
            $("#invited").css("left", "185px");
            $("#addcontact, #itemsdiv, #selectall, #delscheduleall").show();
            $("#invited").text(a_10052);    
            if( $("#itemsdiv .itemdiv").length > 0 ){
                $("#itemsdiv .itemdiv").eq(0).click();
                $("#responsediv").hide();
            }
            else{
                $(".memberdiv").hide();
                $(".noscheudlediv").show();
                $("#persondiv,#rightbtn,#itemsdiv,#responsediv").hide();
            }          
        }
    });
    
    $("#acceptbtn").click(function(){
        window.parent.block_download_func(a_6661);
        cb_get_action("notifyschedule&region=webservice&type=9&scheduleId="+mSelectId);
    });
    
    $("#rejectbtn").click(function(){
        window.parent.block_download_func(a_6661);
        cb_get_action("notifyschedule&region=webservice&type=10&scheduleId="+mSelectId);
    });
    
    $("#delscheduleall").click(function(){
        if( $(".itemdiv").length == 0 ) return false;
        var txt = '<div class="shortmsg">' + a_9334 + '</div>';
        $.prompt(txt,{
            buttons:{
                Yes: true, No: false
            },
            callback: function(v,m,f){
                if(v) {  
                    window.parent.block_download_func(a_59);
                    mOptionNum = 0;
                    mOptionNumSuc = 0;
                    mOptionNumDone = 0;
                    
                    mOptionNum = 1;
                    mAllDelscheduleId = "";
                    mDelscheduleId = "";
                    mDelGooglescheduleId = "";
                    mDelRepscheduleId = "";
                    mDelRepGooglescheduleId = "";
                    /*
                    //can't delete invited schedule because not host
                    if( $("#inviteditemsdiv").is(":visible") ){
                        $("#inviteditemsdiv .itemdiv .inputcbx").each(function(index, item) {
                            if ($(item).prop("checked") == true) {
                                var scheduleid = $itemdiv.attr("scheduleid");
                                if(mDelscheduleId == "")
                                    mDelscheduleId += scheduleid;
                                else
                                {
                                    mDelscheduleId += ",";
                                    mDelscheduleId += scheduleid;
                                }
                            }
                        });
                        if( mDelscheduleId != "" ){
                            cb_get_action("notifyschedule&region=webservice&type=8&scheduleId="+mDelscheduleId);
                        }
                        return;
                    } */
                    $("#itemsdiv .itemdiv .inputcbx").each(function(index, item) {
                        if ($(item).prop("checked") == true) {
                            var $itemdiv = $(this).parent().parent(".itemdiv");
                            var scheduleid = $itemdiv.attr("scheduleid");
                            var host = $itemdiv.attr("host");
                            if( host == mProStr ){
                                mLastAction = "&type=3&scheduleId="+scheduleid;
                                var action = "notifyschedule&region=webservice&type=3&scheduleId="+scheduleid;
                                cb_get_action(action);
                            }
                            else
                            {
                                var repeat = $itemdiv.attr("repeat");
                                if( repeat == "0" ){
                                    var schedulestate = $(this).parent().parent().attr("confstate");
                                    if( host == "1" ){
                                        if(mDelscheduleId == "")
                                            mDelscheduleId += scheduleid;
                                        else
                                        {
                                            mDelscheduleId += ",";
                                            mDelscheduleId += scheduleid;
                                        }
                                    }else{
                                        if(mDelGooglescheduleId == "")
                                            mDelGooglescheduleId += scheduleid;
                                        else
                                        {
                                            mDelGooglescheduleId += ",";
                                            mDelGooglescheduleId += scheduleid;
                                        }
                                    }
                                }else{
                                    if( host == "1" ){
                                        if(mDelRepscheduleId == "")
                                            mDelRepscheduleId += scheduleid;
                                        else
                                        {
                                            mDelRepscheduleId += ",";
                                            mDelRepscheduleId += scheduleid;
                                        }
                                    }else{
                                        if(mDelRepGooglescheduleId == "")
                                            mDelRepGooglescheduleId += scheduleid;
                                        else
                                        {
                                            mDelRepGooglescheduleId += ",";
                                            mDelRepGooglescheduleId += scheduleid;
                                        }
                                    }
                                }
                            }

                            if(mAllDelscheduleId == "")
                                mAllDelscheduleId += scheduleid;
                            else
                            {
                                mAllDelscheduleId += ",";
                                mAllDelscheduleId += scheduleid;
                            }

                            clearInterval(mTimeoutObj[scheduleid]);
                            delete mTimeoutObj[scheduleid];
                        }
                    });
                    /*console.log("mDelRepscheduleId = " + mDelRepscheduleId);
                    console.log("mDelRepGooglescheduleId = " + mDelRepGooglescheduleId);
                    console.log("mDelscheduleId = " + mDelscheduleId);
                    console.log("mDelGooglescheduleId = " + mDelGooglescheduleId);*/
                    if( mDelRepscheduleId != "" || mDelRepGooglescheduleId != "" ){
                        window.parent.unblock_func();
                        $("#deletecheckdiv").show();
                    }else{
                        if(mDelscheduleId != "")
                            cb_get_action_sync("deleteschedule&region=webservice&id="+mDelscheduleId); 
                        if( mDelGooglescheduleId != "" ){
                            cb_get_action("notifyschedule&region=webservice&type=8&scheduleId="+mDelGooglescheduleId);
                        }
                    }
                }   
            }
        });       
    });

    $("#delschedule").click(function(e){
        if( $(".itemdiv").length == 0 ) return false;
        var $this = $(this);
        var txt = '<div class="shortmsg">' + a_9334 + '</div>';
        $.prompt(txt,{
            buttons:{
                Yes: true, No: false
            },
            callback: function(v,m,f){
                if(v) {  
                    window.parent.block_download_func(a_59);
                    mOptionNum = 0;
                    mOptionNumSuc = 0;
                    mOptionNumDone = 0;
                    
                    mOptionNum ++;
                    var scheduleid = $this.parent().parent().attr("scheduleid");
                    cb_get_action("deleteschedule&region=webservice&id=" + scheduleid); 
                    clearInterval(mTimeoutObj[scheduleid]);
                    delete mTimeoutObj[scheduleid];
                }
                else {}
            }
        }); 
        e.stopPropagation();      
    });

    $("#startbtn").click(function(e){
        var confstate = $("#disconfstate",window.parent.document).val();
        if(confstate == "1")
        {
            $.prompt(a_560);
            return false;
        }
        if(confstate == "0")
        {
            if($("#pause",window.parent.confFrame.document).attr("ishold") == "0")
            {
                $.prompt(a_10080);
                return false;
            }
            var busylinenum = parseInt($("#busylinenum",window.parent.document).val());
            if(busylinenum > 0)
            {
                $.prompt(a_16683);
                return false;
            }
        }
        
        var selconfid = $(this).parent().parent().attr("preconfid");
        if( $(this).parent().parent().attr("host") == mProStr ){
            $.prompt(a_15066,{
                buttons:{
                    Yes: true, No: false
                },
                callback:function(v,m,f){
                    if(v) {
                        var action = "notifyschedule&region=webservice&type=4&scheduleId="+selconfid;
                        cb_get_action(action);
                        checkDeleteDiv(selconfid);
                    }
                    else {}
                }
            })           
            return;
        }
        var schedulestate = $(this).parent().parent().attr("confstate");
        
        if(schedulestate == "1")
        {
            //update data2 in schedule database if this schedule is missed
            cb_get_action("sqliteconf&region=apps&type=updatestate&id="+selconfid);
            callOutPreConf(selconfid, 2);
        }else{
            mCalloutConfid = selconfid;
            $("#schedulecallbtn").hide();
            showCheckDeleteDialog();
        }
        
        e.stopPropagation();
    });
    
    $(".itemcheck .inputcbx").live("click", function() {
        if ($(this).prop("checked") != true) {
            var isall = 1;
            $("#selectall").removeAttr("checked");//.button("refresh");
            $(".itemcheck .inputcbx").each(function(index, item) {
                if ($(item).prop("checked") == true) {
                    isall = 0;
                    return false;   
                }
            });
            if(isall == 0)
                $("#delscheduleall").removeAttr("disabled").removeClass("deldisable");
            else
                $("#delscheduleall").attr("disabled","disabled").addClass("deldisable");
                
        } else {
            var isall = 1;
            $(".itemcheck .inputcbx").each(function(index, item) {
                if ($(item).prop("checked") != true) {
                    isall = 0;
                    return false;   
                }
            });

            if (isall == 1)
                $("#selectall").attr("checked", "checked");//.button("refresh");

            $("#delscheduleall").removeAttr("disabled").removeClass("deldisable");
        }
    });

    $("#selectall").click(function(){
        if ($(this).prop("checked") == true) {
            $(".itemcheck .inputcbx").attr("checked", "checked");//.button("refresh");
            if( $(".itemdiv").length > 0 )
                $("#delscheduleall").removeAttr("disabled").removeClass("deldisable");
        } else {
            $(".itemcheck .inputcbx").removeAttr("checked");//.button("refresh");
            $("#delscheduleall").attr("disabled","disabled").addClass("deldisable");
        }
    });
    
    $("#search").bind('input propertychange', function() {
        var searchkey = $("#search").val();
        var reg = new RegExp("^[0-9]*$");
        var $searchitem = $("#allcontactsdiv .contactsdiv.searchnewItem");
        if($searchitem.length <= 0 && searchkey != "")
        {
            var checkedDiv = document.createElement("DIV");
            checkedDiv.className = "contactsdiv searchnewItem creatsearchItem";
            checkedDiv.setAttribute("name","");
            checkedDiv.setAttribute("acctindex","0");
            checkedDiv.setAttribute("number","");
            checkedDiv.setAttribute("email", "");
            checkedDiv.setAttribute("emailnum", "0");
            
            var inputcbxdiv = document.createElement("DIV");
            inputcbxdiv.className = "membercheck";
            var cbx = document.createElement("INPUT");
            cbx.className = "inputcbx sreachitemcbx";
            cbx.type = "checkbox";
            inputcbxdiv.appendChild(cbx);
            checkedDiv.appendChild(inputcbxdiv);

            var icondiv = document.createElement("DIV");
            icondiv.className = "membericon";
            checkedDiv.appendChild(icondiv);

            var namediv = document.createElement("DIV");
            namediv.className = "membername";
            var spantext = document.createElement("SPAN");
            spantext.innerHTML = "";
            spantext.setAttribute("title","");
            namediv.appendChild(spantext);
            checkedDiv.appendChild(namediv);

            var numdiv = document.createElement("DIV");
            numdiv.className = "membernumber";
            var numtext = document.createElement("SPAN");
            numtext.innerHTML = "";
            numtext.setAttribute("title","");
            numdiv.appendChild(numtext);
            checkedDiv.appendChild(numdiv);

            $("#allcontactsdiv").append(checkedDiv);

            $(".sreachitemcbx").bind("click",function(e){
                var $parent = $(this).parent().parent();
                var acct = parseInt($("#detailacct").val());
                $("#allcontactsdiv .contactsdiv").show();
                $(".dividingCreate").before($parent);
                $parent.attr("acctindex",acct).removeClass("searchnewItem");
                $(this).removeClass("sreachitemcbx").unbind("click");
                mCheckedmembernum++;
                if(acct == 1)
                {
                    //if member is ipvideotalk, max number should reduce 1
                    if(!mIsreduce && mPromodel != "GVC3202")
                    {
                        mMaxScheduleMember = mMaxScheduleMember - 1;
                        mIsreduce = true;
                    }
                }
                if((mCheckedmembernum+mSelectedmemeber_num) > mMaxScheduleMember)
                {
                    mCheckedmembernum--;
                    $(".detailcontent").scrollTop(0);
                    $("#searchdiv p").text(a_10097).show(800,function(){
                        setTimeout(function(){$("#searchdiv p").hide(800);},2000);
                    });
                    $(this).parent().parent().remove();
                    return false;
                }
                else{
                    if($(this).prop("checked")){
                        if(mDisdialplan[6] == 0){
                            var result;
                            var urihead = "action=dialPlanCheck&region=confctrl&account=" + acct + "&number=" + searchkey; 
                            urihead += "&time=" + new Date().getTime();
                            $.ajax ({
                                type: 'get',
                                url:'/manager',
                                data:urihead,
                                dataType:'text',
                                async:false,
                                success:function(data) {
                                    var tObj = eval("(" + data + ")");
                                    if(tObj.res == "success"){
                                        result = tObj.msg;
                                    }
                                },
                                error:function(xmlHttpRequest, errorThrown) {
                                    cb_networkerror(xmlHttpRequest, errorThrown);
                                }
                            });
                            
                            if(result == "false"){
                                mCheckedmembernum--;
                                $.prompt(a_10104);
                                $("#search").val("");
                                
                                return false;
                            }
                        }
                    }
                }
                $("#search").val("");
                e.stopPropagation();
            });
        }

        var curacct = $("#detailacct").val();
        //if(curacct == 8 || reg.test(searchkey))
        //{
            $searchitem.attr("name",searchkey).attr("number",searchkey);
            $searchitem.find(".membername").children("span").attr("title",searchkey).text(searchkey);
            $searchitem.find(".membernumber").children("span").attr("title",searchkey).text(searchkey);
            $searchitem.show();
        //}

        $("#allcontactsdiv .contactsdiv").each(function(){
            var $this = $(this);
            if($this.attr("notsearch") != "1")
            {
                if( $this.attr("number").indexOf(searchkey) == -1 && $this.attr("name").indexOf(searchkey) == -1 || $this.attr("contactnosearch") == "1")
                {
                    $this.hide();
                }else{
                    $this.show();
                }
            }
            else
            {
                $this.parent().hide();
            }
        });
        if(searchkey == "")
        {
            $searchitem.hide();
        }
    });

    $("#cancelbtn").click(function(){
        $(".editdiv").hide();
        $("#remindercheck").attr("disabled", true).attr("checked",false);     
        $(".contentdiv").show();
        $("#showmembernum").show();
        $(".memberdiv").hide();
        $(".righttopdiv, .memberdiv").addClass("hasborder");
        //$(".memberdiv[confid=" + mSelectConfId + "]").show();
        $(".memberdiv[confid=" + mSelectConfId + "][isexist=1]").show();
        //var confid = $("#itemsdiv .itemdiv.selectItem").attr("scheduleid");
        $("#membersdiv .memberdiv[confid=\""+mSelectConfId+"\"]").attr("isdelete",0);
        $("#savebtn,#cancelbtn").hide();
        $("#membersdiv .memberdiv[notsave=1]").remove();
        $("#allcontactsdiv .contactsdiv.creatsearchItem").remove();
        $("#membersdiv .memberdiv[confid=temp]").remove();
        if( $("#itemsdiv .itemdiv").length == 0 ){
            $(".memberdiv").hide();
            $(".noscheudlediv").show();
            $("#persondiv,#rightbtn,#itemsdiv").hide();
        }else{
            if( $("#itemsdiv .itemdiv.selectItem").length > 0 )
                $("#editbtn").show();

            $(".itemdiv[scheduleid=\""+mSelectConfId+"\"]").click();
        }
        if( mHasGoogle ){
            $(".memberemail").hide();
            $("#membersdiv .membernumber").show();
        }
    });

    $("#editcaption").click(function(){
        $("#captionContainer").show();
    });

    $(".groupcontactsdiv").live("click",function(e){
        e.stopPropagation();
        var $this = $(e.currentTarget);
        var groupid = $this.attr("groupid");
        var $groupmemberlist = $(".groupmemberlist[groupid=\""+groupid+"\"]");;

        if(!$groupmemberlist.is(":visible"))
        {
            $this.find(".arrowicon").attr("src","../img/apps/app_more_triangle_pressed.png");
            $this.siblings(".groupcontactsdiv").find(".arrowicon").attr("src","../img/apps/app_more_triangle_normal.png");
            $(".groupmemberlist").hide();
            $groupmemberlist.show();
        }
        else
        {
            $groupmemberlist.hide();
            $this.find(".arrowicon").attr("src","../img/apps/app_more_triangle_normal.png");
        }
        
    });

    $(".contactsdiv .inputcbx").live("click",function(e){
        var groupnum = parseInt($(this).parent().parent().attr("contactsnum"));
        var number = $(this).parent().parent().attr("number");
        var parentclass = $(this).parent().parent().attr("class");

        if( number == "anonymous" ){
            //$.prompt(a_10083);
            $(".detailcontent").scrollTop(0);
            $("#searchdiv p").text(a_10083).show(800,function(){
                setTimeout(function(){$("#searchdiv p").hide(800);},2500);
            });
            return false;
        }
        var acctindex = parseInt($(this).parent().parent().attr("acctindex"));
        if( acctindex == 2 ){
            $(".detailcontent").scrollTop(0);
            $("#searchdiv p").text(a_16698).show(800,function(){
                setTimeout(function(){$("#searchdiv p").hide(800);},2500);
            });
            return false;
        }
        else if(acctindex == 1)
        {
            //if member is ipvideotalk, max number should reduce 1
            if(!mIsreduce && mPromodel != "GVC3202")
            {
                mMaxScheduleMember = mMaxScheduleMember - 1;
                mIsreduce = true;
            }
        }
        if( number.length >=3 && number.indexOf("*") == 0 && mStarCode.indexOf( number.substring(0,3) ) != -1 ){
            $(".detailcontent").scrollTop(0);
            $("#searchdiv p").text(a_10100).show(800,function(){
                setTimeout(function(){$("#searchdiv p").hide(800);},3500);
            });
            return false;
        }
        if(parentclass.indexOf("groupcontactsdiv") != -1)
        {
            var $this = $(e.target);
            var $groupcontactsdiv = $this.parent().parent();
            var groupid = $groupcontactsdiv.attr("groupid");
            var $groupmemberlist = $(".groupmemberlist[groupid=\""+groupid+"\"]");
            var groupmember_anonymous = false;
            if($groupmemberlist.length > 0)
            {
                if($this.prop("checked") == true)
                {
                    $groupmemberlist.find(".inputcbx").each(function(){
                        var number = parseInt($(this).parent().parent().attr("number"));
                        var grp_acctid = parseInt($(this).parent().parent().attr("acctindex"));
                        if( number == "anonymous" ){
                            groupmember_anonymous = true;
                            return false;
                        }
                        $(this).attr("checked","checked");
                        if(grp_acctid == 1)
                        {
                            //if member is ipvideotalk, max number should reduce 1
                            if(!mIsreduce && mPromodel != "GVC3202")
                            {
                                mMaxScheduleMember = mMaxScheduleMember - 1;
                                mIsreduce = true;
                            }
                        }
                    });
                    if(groupmember_anonymous)
                    {
                        $groupmemberlist.find(".inputcbx").removeAttr("checked");
                        $.prompt(a_10083);
                        return false;
                    }
                }
                else
                {
                    $groupmemberlist.find(".inputcbx").removeAttr("checked");
                }
            }
        }
        if($(this).prop("checked"))
        {
            if(!isNaN(groupnum))
                mCheckedmembernum += groupnum;
            else
                mCheckedmembernum++;
        }
        else
        {
            if(!isNaN(groupnum))
                mCheckedmembernum -= groupnum;
            else
                mCheckedmembernum--;
            if(mIsreduce)
            {
                /*
                if all ipv member is not checked, initialize mMaxScheduleMember and mIsreduce
                */
                var isall_unckeched = true;
                $(".contactsdiv").each(function(){
                    var acctipv = $(this).attr("acctindex");
                    if(acctipv == "1")
                    {
                        if($(this).find(".inputcbx").prop("checked"))
                        {
                            isall_unckeched = false;
                            return false;
                        }
                    }
                });
                if(isall_unckeched)
                {
                    mMaxScheduleMember = mMaxmumber;
                    mIsreduce = false;
                }
            }
        }
        if((mCheckedmembernum+mSelectedmemeber_num) > mMaxScheduleMember)
        {
            if(!isNaN(groupnum))
            {
                mCheckedmembernum -= groupnum;
                $groupmemberlist.find(".inputcbx").removeAttr("checked");
            }
            else
                mCheckedmembernum--;
            $(".detailcontent").scrollTop(0);
            $("#searchdiv p").text(a_10097).show(800,function(){
                setTimeout(function(){$("#searchdiv p").hide(800);},2000);
            });
            return false;
        }
        else{
            if($(this).prop("checked")){
                var recordid = $(this).parent().parent().attr("id");
                var recordfrom;
                if(recordid != undefined){
                    if(recordid.indexOf("contact") != -1)
                        recordfrom = 5;
                    else if(recordid.indexOf("calllog") != -1){
                        var type = $(this).attr("type");
                        if(type == 1 || type == 3)
                            recordfrom = 3;
                        else
                            recordfrom = 4;
                    }
                }
                else{
                    var $parentclass = $(this).parent().parent();
                    if($parentclass.parent().attr("class") != undefined && $parentclass.parent().attr("class").indexOf("groupmemberlist") != -1)
                        recordfrom = 5;
                    else if($parentclass.attr("class").indexOf("creatsearchItem") != -1)
                        recordfrom = 6;
                    else if($parentclass.attr("class").indexOf("selectedItem") != -1){
                        var curnumber = $parentclass.attr("number");
                        recordfrom = $(".memberdiv[number=\"" + curnumber + "\"]").attr("recordfrom");
                        if(recordfrom != undefined)
                            recordfrom = parseInt(recordfrom);
                    }
                }
                
                if(mDisdialplan[recordfrom] == 0){
                    var result;
                    var urihead = "action=dialPlanCheck&region=confctrl&account=" + acctindex + "&number=" + number; 
                    urihead += "&time=" + new Date().getTime();
                    $.ajax ({
                        type: 'get',
                        url:'/manager',
                        data:urihead,
                        dataType:'text',
                        async:false,
                        success:function(data) {
                            var tObj = eval("(" + data + ")");
                            if(tObj.res == "success"){
                                result = tObj.msg;
                            }
                        },
                        error:function(xmlHttpRequest, errorThrown) {
                            cb_networkerror(xmlHttpRequest, errorThrown);
                        }
                    });
                    
                    if(result == "false"){
                        if(!isNaN(groupnum))
                        {
                            mCheckedmembernum -= groupnum;
                            $groupmemberlist.find(".inputcbx").removeAttr("checked");
                        }
                        else
                            mCheckedmembernum--;
                        
                        $.prompt(a_10104);
                        return false;
                    }
                }
            }
        }
        
        e.stopPropagation();
    });

    $(".groupmemberlist .inputcbx").live("click",function(e){
        var isall = 1;
        var $this = $(e.target);
        var groupid = $this.parent().parent().parent().attr("groupid");
        var contactid = $this.parent().parent().attr("contactid");
        var $groupmemberlist = $(".groupmemberlist[groupid=\""+groupid+"\"]");

        $groupmemberlist.find(".inputcbx").each(function(){
            if($(this).prop("checked") != true)
            {
                isall = 0;
                return false;
            }
        });
        if(isall == 1)
            $groupmemberlist.prev(".groupcontactsdiv").find(".inputcbx").attr("checked","checked");
        else
            $groupmemberlist.prev(".groupcontactsdiv").find(".inputcbx").removeAttr("checked");

        e.stopPropagation();
    });

    $("#savebtn").click(function(){
        var durationreg = new RegExp("^[0-9]*$");
        var datetime = $("#edittime").val();
        var durations = cal_durationTime(datetime,$("#editduration").val());
        datetime = datetime.replace(/-/g, "/");
        var setdate = new Date(datetime);
        var stander_milliseconds = 60*1000;
        var millflag = 0;
        var pincode = $("#confpincode").val();
        if( pincode == a_15046 )
            pincode = "";
        var repeat = parseInt($("#repeat").val());
        // if(!durationreg.test(durations))
        // {
        //     $.prompt(a_16654);
        //     return false;
        // }
        /*if(!durationreg.test(pincode))
        {
            $.prompt(a_16709);
            return false;
        }*/
        if( durations <= 0 ){
            $.prompt(a_16708);
            return false;
        }
        if($.trim(datetime) == "")
        {
            $.prompt(a_16670);
            return false;
        }
        $("#itemsdiv .itemdiv").each(function(){
            var milliseconds = $(this).attr("milliseconds");
            var itemclass = $(this).attr("class");
            var currentmill = setdate.getTime();
            if(itemclass.indexOf("selectItem") == -1)
            {
                var differ = currentmill - milliseconds;
                differ = Math.abs(differ);
                if(differ < stander_milliseconds)
                {
                    millflag = 1;
                    $.prompt(a_16437);
                    return false;
                }
            }
        });
        if(millflag == 1)
            return false;
        var confname = $.trim($("#selectconfname").val());
        if( confname == "" ){
            $.prompt(a_16638);//conf name
            return false;
        }
        switch(repeat){
            case 0:
                mRepeatRule = "";
                break;
            case 1:
                mRepeatRule = "FREQ=DAILY";
                break;
            case 2:
                mRepeatRule = "FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR";
                break;
            case 3:
                mRepeatRule = "FREQ=WEEKLY;BYDAY=" + mByDaysStr[setdate.getDay()];
                break;
            case 4:
                var day = parseInt(setdate.getDate());
                var dayweek = parseInt(setdate.getDay());
                var ordinal = Math.ceil( day / 7 ); 
                if( ordinal >= 5 )
                    ordinal = -1;
                mRepeatRule = "FREQ=MONTHLY;BYDAY=" + ordinal + mByDaysStr[dayweek];
                break;
            case 5:
                mRepeatRule = "FREQ=MONTHLY";
                break;
            case 6:
                mRepeatRule = "FREQ=YEARLY";
                break;
            case 7:
                mRepeatRule = getCustomRepeatRule();
                break;
        }

        /*var nameexist = 0;
        $("#itemsdiv .itemdiv").each(function(){
            if(mEditMode == 1)
            {
                if(confname == $(this).attr("name"))
                {
                    nameexist = 1;
                    return false;
                }
            }
            else if(mEditMode == 2)
            {
                if(confname == $(this).attr("name") && $(this).attr("scheduleid") != mSelectId)
                {
                    nameexist = 1;
                    return false;
                }
            }     
        });
        if( nameexist == 1 ){
            $.prompt(a_16435);
            return false;
        }*/
        mOptionNum = 0;
        mOptionNumSuc = 0;
        mOptionNumDone = 0;
        var action = "";
        if( mEditMode == 1 ){
            action += "addschedule&region=webservice&id=";
            //action += $("#selectconfname").val();
        }else{
            action += "updateschedule&region=webservice&id=";
            action += mSelectId;
        }
        var host = $("#relatedacct").val();
        action += "&host=";
        action += encodeURIComponent(host);
        action += "&confname=";
        action += encodeURIComponent(confname);
        action += "&duration=";
        action += parseInt(durations); 
        action += "&start_time=";
        action += encodeURIComponent($("#edittime").val()); //do not use datetime here,as it changed - to /
        action += "&milliseconds=";
        action += encodeURIComponent(setdate.getTime());
        action += "&pincode=";
        action += encodeURIComponent(pincode);
        action += "&repeat=";
        action += repeat;
        action += "&repeatRule=";
        action += encodeURIComponent(mRepeatRule);
        action += "&preset=";
        action += encodeURIComponent($("#confpreset").val());
        if( $("#remindercheck").prop("checked") )
            action += "&reminder=1";
        else
            action += "&reminder=0"; 
        if( $("#dndcheck").prop("checked") )
            action += "&schedulednd=1";
        else
            action += "&schedulednd=0";
        if( $("#autoanswer").prop("checked") )
            action += "&autoanswer=1";
        else
            action += "&autoanswer=0";
        var updatemembernum="",updatemembername="", updatememberacct="", updatememberemail="", updaterecordfrom = "";
        $("#membersdiv .memberdiv[isexist=1][isdelete=1]").hide();
        var validemail = true;
        $("#membersdiv .memberdiv[isexist=1][isdelete=0]").each(function(){
            var tempname = $(this).children(".membername").children().attr("title");
            if( tempname == undefined )
                tempname = $(this).children(".membername").children(".membernametop").children().attr("title");
            var tempnum = $(this).attr("number");
            var tempacct = $(this).attr("acctindex");
            var tempemail = "";
            var temprecord = $(this).attr("recordfrom");
            
            if( host != "1" ){
                tempemail = $(this).children(".memberemail").children("input").val();
                if( tempacct == "-1" && tempemail == "" ){
                    $(this).remove();
                    return;
                }else{ 
                    $(this).attr("email", tempemail).attr("emailnum", "1");
                    $(this).children(".membernumber").children(".emailspan").text(tempemail);
                }
                if( tempemail != "" ){
                    if( !mEmailreg.test(tempemail) ){
                        validemail = false;
                        $.prompt(a_10187.replace('%s', tempemail));
                        return false;
                    }
                }
            }
            if(tempnum != "" && tempname != "" && tempacct != "")
            {
                updatemembername += tempname+":::";
                updatemembernum += tempnum+":::";
                updatememberacct += tempacct+":::";
                updatememberemail += tempemail+":::";
                updaterecordfrom += temprecord+":::";
            }
            //$(this).removeAttr("notsave");
        });
        if( !validemail )
            return false;
        if( mHasGoogle ){
            $(".memberemail").hide();
            $("#membersdiv .membernumber").show();
        }
        
        if(updatemembernum == "" && updatemembername == "" && updatememberacct == "")
        {
            $.prompt(a_16436);
            return false;
        }

        if(updatemembernum != "" && updatemembername != "" && updatememberacct != "")
        {
            updatemembernum = updatemembernum.substring(0,updatemembernum.length-3);
            updatememberacct = updatememberacct.substring(0,updatememberacct.length-3);
            updatemembername = updatemembername.substring(0,updatemembername.length-3);
            updatememberemail = updatememberemail.substring(0,updatememberemail.length-3);
            updaterecordfrom = updaterecordfrom.substring(0,updaterecordfrom.length-3);
            action += "&membernames="+encodeURIComponent(updatemembername);
            action += "&membernumbers="+encodeURIComponent(updatemembernum);
            action += "&memberaccts="+encodeURIComponent(updatememberacct);
            action += "&memberemails="+encodeURIComponent(updatememberemail);
            action += "&recordsfrom="+encodeURIComponent(updaterecordfrom);
        }
        mOptionNum ++;
        cb_get_action( action );
    });
}

/*********************Caption**********************************************/
function calleftheight(fnblockpos){
    var topheight = $("#topCaption").height();
    var bottomheight = $("#bottomCaption").height();
    var wholeheight = $("#captionContainer").height();
    var btnheight = $("#captionbtn").height();
    if(fnblockpos == "")
    {
        //init
        topheight = bottomheight = 30;
        btnheight = 30;
    }
    var leftheight = wholeheight - topheight - bottomheight - btnheight - 6;
    $("#leftCaption").css("height",leftheight+"px");

    if(fnblockpos == "top")
        changeBlockpostion(topheight,fnblockpos);
    if(fnblockpos == "bottom")
        changeBlockpostion(bottomheight,fnblockpos);
}
function initfnBlock(){
    calleftheight("");
    var fnblockContainer = $("<div id='fnblockContainer'></div>").appendTo($("#captionContainer"));
    var font = "<select id='fontfamily'>";
    font += "<option value='sans'>sans</option>";
    font += "<option value='serif'>serif</option>";
    font += "<option value='monospace'>monospace</option>";
    font += "</select>";
    var fontsize = "<select id='capfontsize'>";
    fontsize += "<option value='24px'>"+a_16246+"</option>";//smallest
    fontsize += "<option value='28px'>"+a_16247+"</option>";//smaller
    fontsize += "<option value='32px'>"+a_16248+"</option>";//small
    fontsize += "<option value='36px'>"+a_16236+"</option>";//medium
    fontsize += "<option value='40px'>"+a_16249+"</option>";//large
    fontsize += "<option value='46px'>"+a_16250+"</option>";//larger
    fontsize += "<option value='50px'>"+a_16251+"</option>";//largest
    fontsize += "</select>";
    var blod = "<button id='capBold'>B</button>";
    var fontcolor = "<div id='ftcolordiv'><span>A</span><input class='color' autocomplete='off' id='capfontcolor'/></div>";
    var bgcolor = "<div id='bgcolordiv'><input class='color' autocomplete='off' id='capbgcolor'/></div>";
    var leftalign = "<button id='capleftalign' align='left'></button>";
    var centeralign = "<button id='capcenteralign' align='center'></button>";
    var rightalign = "<button id='caprightalign' align='right'></button>";
    var lineheight = "<select id='caplineheight'>";
    lineheight += "<option value='sans'>"+a_16246+"</option>";//smallest
    lineheight += "<option value='sans'>"+a_16247+"</option>";//smaller
    lineheight += "<option value='sans'>"+a_16248+"</option>";//small
    lineheight += "<option value='sans'>"+a_16236+"</option>";//medium
    lineheight += "<option value='sans'>"+a_16249+"</option>";//large
    lineheight += "<option value='sans'>"+a_16250+"</option>";//larger
    lineheight += "<option value='sans'>"+a_16251+"</option>";//largest
    lineheight += "</select>";
    var speedcbx = "<input type='checkbox' id='capspeedcbx'/>";
    var speed = "<select id='capspeed'>";
    speed += "<option value='sans'>"+a_16244+"</option>";//slowest
    speed += "<option value='sans'>"+a_16243+"</option>";//slower
    speed += "<option value='sans'>"+a_16242+"</option>";//slow
    speed += "<option value='sans'>"+a_16236+"</option>";//medium
    speed += "<option value='sans'>"+a_16241+"</option>";//fast
    speed += "<option value='sans'>"+a_16240+"</option>";//faster
    speed += "<option value='sans'>"+a_16239+"</option>";//fastest
    speed += "</select>";

    fnblockContainer.append($(font));
    fnblockContainer.append($(fontsize));
    fnblockContainer.append($(blod));
    fnblockContainer.append($(fontcolor));
    fnblockContainer.append($(bgcolor));
    fnblockContainer.append($(leftalign));
    fnblockContainer.append($(centeralign));
    fnblockContainer.append($(rightalign));
    fnblockContainer.append($(lineheight));
    fnblockContainer.append($(speedcbx));
    fnblockContainer.append($(speed));

    mjsfontColor = new jscolor.color(document.getElementById('capfontcolor'), {}, "font", 0,jscolorCallback);
    mjsbgColor = new jscolor.color(document.getElementById('capbgcolor'), {}, "bg", 1,jscolorCallback);
    $("#capsend").text(a_4);
    $("#capapply").text(a_16003);
    setfnBlock_Event();
}

function changeBlockpostion(height,fnblockpos){
    var wholeheight = $("#captionContainer").height();
    var thistop = $("#fnblockContainer").position().top;
    var selfheight = $("#fnblockContainer").height();
    var btnheight = $("#captionbtn").height();
    var changetop;

    if(fnblockpos == "top")
    {
        changetop = height + 'px';  
        $("#fnblockContainer").css("top",changetop);    
    }
    else if(fnblockpos == "bottom")
    {
        changetop =  wholeheight - height - btnheight - selfheight + 'px';
        $("#fnblockContainer").css("top",changetop);
    }   
}

function setfnBlock_Event(){
    //set position
    $("#captionContainer .capinput").click(function(){
        var inputHeight = $(this).parent().height();
        var inputWidth = $(this).parent().width();
        var inputtop = $(this).parent().position().top;
        var inputleft = $(this).parent().position().left;
        var fnblockpos = $(this).attr("position");
        var fnblockWidth = 0;
        var fnblocktop = 0;
        var fnblockleft = 0;
        //init fnblock
        var fsize = $(this).css("font-size");
        var ffamily = $(this).css("font-family");
        var fbold = $(this).css("font-weight");
        var fcolor = $(this).css("color");
        var bgcolor = $(this).parent().css("background-color");
        var lheight = $(this).css("line-height");

        //set position
        $("#fnblockContainer").css("top",fnblocktop).css("left",fnblockleft);
        fnblockWidth = $("#fnblockContainer").width();
        if(fnblockpos == "top")
        {
            fnblocktop = inputtop + inputHeight + 'px';
            fnblockleft = inputleft + inputWidth - fnblockWidth + 'px';
            $("#capspeedcbx,#capspeed,#caplineheight").hide();
            $("#capleftalign,#capcenteralign,#caprightalign").show();
        }
        else if(fnblockpos == "left")
        {
            fnblocktop = inputtop + inputHeight/2 + 'px';
            fnblockleft = inputleft + inputWidth + 'px';
            $("#capspeedcbx,#capspeed,#caplineheight,#capleftalign,#capcenteralign,#caprightalign").show();
            $("#capspeedcbx").prop("checked",true);
            $("#capspeed").removeAttr("disabled");
        }
        else if(fnblockpos == "bottom")
        {
            fnblocktop = inputtop - inputHeight + 'px';
            fnblockleft = inputleft + inputWidth - fnblockWidth + 'px';
            $("#caplineheight,#capleftalign,#capcenteralign,#caprightalign").hide();
            $("#capspeedcbx,#capspeed").show();
            $("#capspeedcbx").prop("checked",false);
            $("#capspeed").attr("disabled","disabled");
        }

        $("#fnblockContainer").css("top",fnblocktop).css("left",fnblockleft).attr("position",fnblockpos).show();

        //init fnblock
        if(ffamily)
        {
            $("#fontfamily").val(ffamily);
        }
        else
        {
            $("#fontfamily").val("sans");
        }
        if(fsize)
        {
            $("#fontfamily").val();
        }
        else
        {
            $("#fontfamily").val();
        }
        if(fbold && fbold != "normal")
        {
            $("#capBold").addClass("active");
        }
        else
        {
            $("#capBold").removeClass("active");
        }
        if(fcolor)
        {
            mjsfontColor.fromString("#"+fcolor.colorHex());
        }
        else
        {
            mjsfontColor.fromString("#ffffff");
        }
        if(bgcolor)
        {
            var that = bgcolor;
            var opacity = 1;
            if(/^(rgba|RGBA)/.test(that)){
                var aColor = that.replace(/(?:\(|\)|rgba|RGBA)*/g,"").split(",");
                bgcolor = "rgb("+aColor[0]+","+aColor[1]+","+aColor[2]+")";
                opacity = aColor[3];
                //console.log("#"+bgcolor.colorHex());
            }
            mjsbgColor.fromString("#"+bgcolor.colorHex(),"",opacity);
        }
        else
        {
            mjsbgColor.fromString("#ffffff");
        }
        if(lheight)
        {
            $("#caplineheight").val();
        }
        else
        {
            $("#caplineheight").val();
        }
    });

    $("#fontfamily").change(function(){
        var value = $(this).val();
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";

        $(changeInput).css("font-family",value);
        var fnblockpos = $(this).parent().attr("position");
        calleftheight(fnblockpos);
    });
    
    $("#capBold").click(function(){
        var classattr = $(this).attr("class");
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";
        if(classattr == undefined)
            classattr = "";
        if( classattr.indexOf("active") != -1 )
        {
            $(changeInput).css("font-weight","normal");
            $(this).removeClass("active");
        }
        else
        {
            $(changeInput).css("font-weight","bold");
            $(this).addClass("active");
        }
        var fnblockpos = $(this).parent().attr("position");
        calleftheight(fnblockpos);
    });

    $("#capleftalign, #capcenteralign, #caprightalign").click(function(){
        var classattr = $(this).attr("class");
        var align = $(this).attr("align");
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";
        if(classattr == undefined)
            classattr = "";
        if( classattr.indexOf("active") != -1 )
        {
            //$(changeInput).css("text-align","");
            $(this).removeClass("active");
        }
        else
        {
            $(changeInput).css("text-align",align);
            $(this).addClass("active");
        }
    });

    $("#capfontsize").change(function(){
        var value = $(this).val();
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";

        $(changeInput).css("font-size",value);
        var fnblockpos = $(this).parent().attr("position");
        calleftheight(fnblockpos);
    });

    $("#caplineheight").change(function(){
        var value = $(this).val();
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";

        $(changeInput).css("line-height",value);
        var fnblockpos = $(this).parent().attr("position");
        calleftheight(fnblockpos);
    });

    $("#captionContainer .capinput").blur(function(){
        //$("#fnblockContainer").hide();
    });

    $("#closecaption").click(function(){
        $("#captionContainer").hide();
    });
    $("#capsend").click(function(){
        $(this).hide();
        $("#stopsending").show();
    });
    $("#capapply").click(function(){
        $(this).hide();
        $("#capstop").show();
    });
    $("#stopsending").click(function(){
        $(this).hide();
        $("#capsend").show();
    });
    $("#capstop").click(function(){
        $(this).hide();
        $("#capapply").show();
    });
    $("#ftcolordiv, #bgcolordiv").click(function(){
        $(this).children("input").click();
    });
}

function jscolorCallback(target,value,opacity)
{
    if(target && target == "font")
    {
        var fontcolor = "#"+$("#capfontcolor").val();
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";
        $(changeInput).css("color",fontcolor);
    }
    else
        if(target && target == "bg")
        {
            var bgcolor = "#"+$("#capbgcolor").val();
            var position = $("#fnblockContainer").attr("position");
            var changeInput = "#"+position+"Caption";
            $(changeInput).css("background-color","rgba("+bgcolor.colorRgb()+","+opacity+")");
        }
}
/*******************************************************************/

</script>

</body>

</html>
