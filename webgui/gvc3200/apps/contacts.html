<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<link href='../css/apps.css' type='text/css' rel='stylesheet' id="framecssfile">
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.stylish-select.min.js'></script>
<script type="text/javascript" src='../js/ajaxupload.3.5.js'></script>
<script type="text/javascript" src='../js/jquery.prompt.js'></script>
<style>
#search{font-size:14px;}
#rightdiv{*position:absolute;}
#itemsdiv{margin-top:16px;}
#import, #export, #download{background:transparent;border:none;border-radius:0px;}
#export{border-top:1px dashed #323334;border-bottom:1px dashed #323334;}
#morebtndiv{display:none;position:absolute;bottom:50px;left:182px;width:100px;height:90px;background:#5A5C5E;color:#FFFFFF;text-align: center;border-radius: 4px;}
#morebtndiv div{height:30px;}
#morebtndiv button{width:100px;text-align:center;padding-left:6px;}
#morebtndiv button.buttonover{cursor:pointer;color:#FD7E0E;}
#morebtndiv .moretriangle{background:url("../img/apps/more_triangel.png") 50% 0 no-repeat;width:14px;height:6px;position:absolute;top:90px;left:43px;}
.morecontent{overflow-x:hidden;overflow-y:auto;padding-left:16px;*width:100%;display:none;}
.morecontent .desdiv{width:180px;}
.morecontent .contentdiv{width:150px;}

.detailcontent .newListSelected{background:url(../img/apps/contacts_select_normal.png);width:230px;margin-top:0 !important;margin-bottom:12px;}
.detailcontent .newListSelected div{width:230px;}
.detailcontent .selectedTxtDiv{width:230px !important;}
.detailcontent .selectedTxt{width:200px !important;}
.detailcontent ul.newList{width:230px;}
.itemname{width:200px;*width:200px;}
#addgroups{overflow:hidden;}
.desdiv{width:70px;}
.descriptiondiv, .editdiv{width:260px;}
.editdiv{margin-top:8px;}
.descriptiondiv span, #addgroups span{display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.descriptiondiv span{width:263px; height:47px; line-height: 47px;}
#addgroups span{width:215px;height:30px;line-height:45px;*line-height:30px;margin-left:15px;}
.acctselect{width:230px;height:26px;float:left;margin-right:10px;}
.editdiv input[type="text"]{width:225px;margin-top:0px;float: left;color:#666;}
input[type="text"].numinput{margin-top:2px;}
.descriptiondiv span.desnumtypespan{width:127px;display:none;}
.descriptiondiv span.desemailtypespan{display:none;}
.descriptiondiv span.desnumspan{margin-left:2px;}
.delicon{width:20px;height:20px;padding:0;border:0;top:4px;float:right;*float:none;*top:0px;min-width:0px;background:transparent url(../img/apps/call_status_icons.png) -20px -157px no-repeat;position:relative;}
.detailemaildiv .delicon{top:2px;}
.addnumicon,.addemailicon{width:20px;height:20px;padding:0;border:0;top:11px;float:right;*float:none;*top:2px;min-width:0px;background:transparent url(../img/apps/call_status_icons.png) 0 -157px no-repeat;position:relative;}
#divcallbtn{margin-left:50px;*margin-left:30px;}
/**/
#selectcalldiv{width:400px;height:auto;position:absolute;top:40%;margin-top:-50px;left:50%;margin-left:-200px;z-index:1000;background:#F6F7F7;color:#FFF;font-size:16px;box-shadow:0px 0px 10px 2px #919191;}
.selecttitle{width:auto;height:35px;line-height:35px;background:#1D6EA8;padding-left:15px;}
.selecttitle span{float: left;}
#selectlist{color:#222;}
#selectlist .newListSelected{float:none;margin:20px 0 20px 77px;}
.selectbtn{text-align:center;height:50px;position:relative;*z-index:-1;}
.selectbtn button{margin:8px 0 0 15px;}
#selectcalldiv #closecalldiv{width:24px;height:24px;min-width:0px;border:0;background:url("../img/call/close_incomingcall.png") center center transparent no-repeat;border-radius:0px;float:right;margin:5px 5px 0 0;}
#selectcalldiv #closecalldiv.buttonover{background-color:#E32632;}
#selectcall{width:100px;height:30px;background:#4ABE6B;position:relative;}
#selectcall.buttonover{background-color:#32A553;}
#selectcancel{width:100px;height:30px;position:relative;margin-left:48px;}
.dialdiv{margin-left:12px;*margin-left:10px;}

.dialogbg{width:650px;height:150px;position:absolute;left:105px;top:100px;*top:40px;background:#FFFFFF;color:#FFF;font-size:16px;box-shadow:0px 0px 10px 2px #919191;}
.dialogbg .titlediv{width:auto;height:35px;line-height:35px;background:transparent;padding-left:15px;color:#1D6EA8;font-weight:normal;text-align:center;margin-top:10px;font-size:16px;}
.dialogbg button{width:82px;*line-height:30px;}
.dialogokbtn{margin-right: 30px;}
#addnewnumspan, #addnewemailspan{margin-right:5px;}
#a_detailgroups{display:inline-block;}
#newgroupbtn{margin-top: 5px;}

.detaildiv{width:100%;height:auto;padding-left:10px;}
.dialogdivs{width:100%;height:100%;position:absolute;top:0;left:0;display:none;}
.dialogbg .detaildiv{height:42px;width:570px;padding-left:50px;}
.dialogbg .desdiv{width:280px;font-weight:normal;}
.dialogbg .contentdiv{width:250px;font-weight:normal;text-align:right;margin-top:5px;}
.newListSelected div, .newList{text-align:left;color:#666;}
.dialogbg input[type="text"]{width:250px;}
</style>
<!--[if IE 9]>
<style>
.dialdiv input{height:32px;line-height:32px;}
</style>
<![endif]-->
<body id="framebody" class="maintenancebody">
<div id="mainbody" class="maindiv appmaindiv">
    <div id="leftdiv" class="appleft">
        <div class="dialdiv">
            <input id="search" name="search" class="radiusinput" style="width:352px;" />
            <!--<button id="dialnow" type="button"></button>-->
        </div>
        <!--<div>
            <input id="search" name="search" />
        </div>-->
        <div webtip="" id="itemsdiv">
            <div id="divcallbtn"><input type="button" id="itemcallbtn" /></div>
        </div>
        <div class="appsbtn">
            <input type="checkbox" id="selectall" class="selectall" />
            <button id="delcontact"></button>
            <button id="morebtn">More</button>
            <button id="addcontact">Add</button>
        </div>
        <div id="morebtndiv">
            <div><button id="import">Import</button></div>
            <div><button id="export">Export</button></div>
            <div><button id="download">Download</button></div>
            <div class="moretriangle"></div>
        </div>  
    </div>
    <div id="rightdiv" class="appright">
        <div class="titlediv" style="display: none;">
            <div class="titleboot"><span id="a_details"> Details</span></div>
        </div>
        <!--<h2 style="color:#325C9F;margin:0 0 20px;line-height:26px;" id="a_details">Details</h2>-->
        <div id="persondiv" class="detailcontent" style="display:none;">
            <div id="personinfodiv" style="width:342px;height:100%;">
            <div class="detaildiv">
                <div class="desdiv"><span id="a_detailname">Name</span></div>
                <div class="descriptiondiv"><span id="detailname"></span></div>
                <div class="editdiv"><input id="addname" type="text" style="margin-right:21px;"></div>
            </div>
            <div class="detaildiv detailnumdiv" id="detailnum0div">
                <div class="desdiv"><span id="a_detailnum">Phone</span></div>
                <div class="descriptiondiv">
                    <span id="detailnumtype0" typevalue="1" class="desnumtypespan"></span>
                    <span id="detailacct0" typevalue="0" class="desnumtypespan"></span>
                    <span id="detailnum0" class="desnumspan"></span>
                </div>
                <div class="editdiv">
                    <select id="addsipnumtype0" class="acctselect">
                        <option value="1">Home</option>
                        <option value="2">Mobile</option>
                        <option value="3">Work</option>
                        <option value="4">Work Fax</option>
                        <option value="5">Home Fax</option>
                        <option value="6">Pager</option>
                        <option value="7">Other</option>
                        <option value="8">Callback</option>
                        <option value="9">Car</option>
                        <option value="10">Company Main</option>
                        <option value="11">ISDN</option>
                        <option value="12">Main</option>
                        <option value="13">Other Fax</option>
                        <option value="14">Radio</option>
                        <option value="15">Telex</option>
                        <option value="16">TTY TDD</option>
                        <option value="17">Work Mobile</option>
                        <option value="18">Work Pager</option>
                        <option value="19">Assistant</option>
                        <option value="20">MMS</option>
                    </select>
                    <select id="addsipacct0" class="acctselect">
                        <option value="0">SIP</option>
                        <option value="1">IPVideoTalk</option>
                        <option value="8">H.323</option>
                        <!--<option value="2">Account 3</option>
                        <option value="3">Account 4</option>
                        <option value="4">Account 5</option>
                        <option value="5">Account 6</option>-->
                    </select>
                    <input id="addsipnum0" type="text" style="margin-right:21px;" class="numinput">
                </div>
            </div>    
            <div class="detaildiv editdiv" id="addnewdiv" style="width:330px;">
                <div class="editdiv" style="float:right;margin-right:0px;margin-top:-11px;*margin-top:-6px;cursor:pointer;"><span id="addnewnumspan">Add New Item</span><button class="addnumicon"></button></div>
            </div>
            <div class="detaildiv detailemaildiv" id="detailemail0div">
                <div class="desdiv"><span id="a_detailemail">Email</span></div>
                <div class="descriptiondiv">
                    <span id="detailemailtype0" typevalue="1" class="desemailtypespan"></span>
                    <span id="detailemail0" class="emailinput"></span>
                </div>
                <div class="editdiv">
                    <select id="addemailtype0" class="acctselect">
                        <option value="1">Home</option>
                        <option value="2">Work</option>
                        <option value="3">Other</option>
                        <option value="4">Mobile</option>
                    </select>
                    <input id="addemail0" class="emailinput" type="text">
                </div>
            </div>
            <div class="detaildiv editdiv" id="addnewemaildiv" style="width:330px;">
                <div class="editdiv" style="float:right;margin-right:0px;margin-top:-11px;*margin-top:-6px;cursor:pointer;"><span id="addnewemailspan">Add New Item</span><button class="addemailicon"></button></div>
            </div>
            <div class="detaildiv" id="detailgroupdiv" style="height:auto;line-height:0;">
                <div class="desdiv"><span id="a_detailgroups">Groups</span></div>
                <div class="descriptiondiv"><span id="detailgroups"></span></div>
                <div class="editdiv" id="addgroups" name="addgroups" style="text-align:left;"></div>
                <div class="editdiv" style="text-align:left;float: right;margin-right: 13px;"><button id="newgroupbtn" name="newgroupbtn">New Group</button></div>
            </div>
            </div>
        </div>
        <div class="appsbtn" id="rightbtn">
            <button id="editbtn" class="editbtn">Edit</button>
            <button id="savebtn">Save</button>
            <button id="cancelbtn" class="cancelbtn">Cancel</button>
        </div>  
    </div>
    
    <div id="downloaddiv" class="dialogdivs">
        <div id="downloaddivbg" class="dialogbg" style="height:520px;top:50%;margin-top:-260px;">
            <div class="titlediv"><span id="a_download">Download</span></div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_clearoldlist">Clear The Old List</span></div>
                <div class="contentdiv"><input type="checkbox" id="clearold" /><span id="a_clearoldyes">Yes</span></div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_downdup">Replace Duplicate Items</span></div>
                <div class="contentdiv"><input type="checkbox" id="downdup" /><span id="a_downdupyes">Yes</span></div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_downmode">Download mode</span></div>
                <div class="contentdiv">
                    <select id="downmode" name="downmode">
                        <option value="2">HTTP</option>
                        <option value="3">HTTPS</option>
                        <option value="1">TFTP</option>
                        <option value="0">OFF</option>
                    </select>
                </div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_downfileencode">File encoding</span></div>
                <div class="contentdiv">
                    <select id="downencodetype" name="downencodetype">
                        <option value="UTF-8">UTF-8</option>
                        <option value="GBK">GBK</option>
                        <option value="UTF-16">UTF-16</option>
                        <option value="UTF-32">UTF-32</option>
                        <option value="Big5">Big5</option>
                        <option value="Big5-HKSCS">Big5-HKSCS</option>
                        <option value="Shift-JIS">Shift-JIS</option>
                        <!--<option value="ISO 2022-JP">ISO 2022-JP</option>
                        <option value="KOI8-R">KOI8-R</option>-->
                        <option value="ISO8859-1">ISO8859-1</option>
                        <option value="ISO8859-15">ISO8859-15</option>
                        <option value="Windows-1251">Windows-1251</option>
                        <option value="EUC-KR">EUC-KR</option>
                    </select>
                </div>
            </div> 
            <div class="detaildiv">
                <div class="desdiv"><span id="a_downinterval">Download Interval</span></div>
                <div class="contentdiv">
                    <select id="phbkdowninterval" name="phbkdowninterval">
                        <option value="0" selected="selected">None</option>
                        <option value="120">2 Hour</option>
                        <option value="240">4 Hour</option>
                        <option value="360">6 Hour</option>
                        <option value="480">8 Hour</option>
                        <option value="720">12 Hour</option>
                    </select>
                </div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_downserver">Download server</span></div>
                <div class="contentdiv"><input type="text" id="downserver" name="downserver" /></div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_httpsusername">HTTP/HTTPS User Name</span></div>
                <div class="contentdiv"><input name="httpsusername" type="text" id="httpsusername" /></div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_httpspass">HTTP/HTTPS Password</span></div>
                <div class="contentdiv"><input name="httpspass" type="password" id="httpspass" /></div>
            </div>
            <div class="detaildiv" style="line-height:0;">
                <div class="desdiv"><span>&nbsp;</span></div>
                <div class="contentdiv"><button id="downnow">Download</button></div>
            </div>
            <div class="detaildiv" style="margin-top:20px;text-align:center;margin-right:10px;padding-left:24px;line-height:0;">
                <button id="downloaddialogok" class="dialogokbtn">Save</button>
                <button id="downloaddialogcancel" class="cancelbtn">Cancel</button>
            </div>  
        </div>  
    </div>
    <div id="importdiv" class="dialogdivs">
        <div id="importdivbg" class="dialogbg" style="height:353px;">
            <div class="titlediv"><span id="a_import">Import</span></div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_portclearoldlist">Clear The Old List</span></div>
                <div class="contentdiv"><input type="checkbox" id="portclearold" /><span id="a_portclearoldyes">Yes</span></div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_portdowndup">Replace Duplicate Items</span></div>
                <div class="contentdiv"><input type="checkbox" id="portdowndup" /><span id="a_portdowndupyes">Yes</span></div>
            </div> 
            <div class="detaildiv">
                <div class="desdiv"><span id="a_fileencode">File encoding</span></div>
                <div class="contentdiv">
                    <select id="encodetype" name="encodetype">
                        <option value="UTF-8">UTF-8</option>
                        <option value="GBK">GBK</option>
                        <option value="UTF-16">UTF-16</option>
                        <option value="UTF-32">UTF-32</option>
                        <option value="Big5">Big5</option>
                        <option value="Big5-HKSCS">Big5-HKSCS</option>
                        <option value="Shift-JIS">Shift-JIS</option>
                        <!--<option value="ISO 2022-JP">ISO 2022-JP</option>
                        <option value="KOI8-R">KOI8-R</option>-->
                        <option value="ISO8859-1">ISO8859-1</option>
                        <option value="ISO8859-15">ISO8859-15</option>
                        <option value="Windows-1251">Windows-1251</option>
                        <option value="EUC-KR">EUC-KR</option>
                    </select>
                </div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_imfiletype">File type</span></div>
                <div class="contentdiv">
                    <select id="porttype" name="porttype">
                        <option value="0" selected="selected">XML</option>
                        <option value="1">VCard</option>
                        <option value="2">CSV</option>
                        <!--<option value="2">CSV(For GXV3175)</option>
                        <option value="3">CSV(For Outlook)</option>
                        <option value="4">CSV(For Outlook Express)</option>
                        <option value="5">CSV(For Simplified Chinese Outlook)</option>
                        <option value="6">CSV(For Simplified Outlook Express)</option>
                        <option value="7">CSV(For Google GMail)</option>-->
                    </select>
                </div>
            </div>
            <div class="detaildiv" style="line-height:0;">
                <div class="desdiv"><span>&nbsp;</span></div>
                <div class="contentdiv"><button id="a_browse" type="button">Browse</button></div>
            </div>
            <div class="detaildiv" style="margin-top:20px;text-align:center;margin-right:10px;padding-left:24px;line-height:0;">
                <button id="importdialogok" class="dialogokbtn">Save</button>
                <button id="importdialogcancel" class="cancelbtn">Cancel</button>
            </div>  
        </div>
    </div>
    <div id="exportdiv" class="dialogdivs">
        <div id="exportdivbg" class="dialogbg" style="height:260px;">
            <div class="titlediv"><span id="a_export">Export</span></div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_exfileencode">File encoding</span></div>
                <div class="contentdiv">
                    <select id="exencodetype" name="exencodetype">
                        <option value="UTF-8">UTF-8</option>
                        <option value="GBK">GBK</option>
                        <option value="UTF-16">UTF-16</option>
                        <option value="UTF-32">UTF-32</option>
                        <option value="Big5">Big5</option>
                        <option value="Big5-HKSCS">Big5-HKSCS</option>
                        <option value="Shift-JIS">Shift-JIS</option>
                        <!--<option value="ISO 2022-JP">ISO 2022-JP</option>
                        <option value="KOI8-R">KOI8-R</option>-->
                        <option value="ISO8859-1">ISO8859-1</option>
                        <option value="ISO8859-15">ISO8859-15</option>
                        <option value="Windows-1251">Windows-1251</option>
                        <option value="EUC-KR">EUC-KR</option>
                    </select>
                </div>
            </div>
            <div class="detaildiv">
                <div class="desdiv"><span id="a_exfiletype">File type</span></div>
                <div class="contentdiv">
                    <select id="exporttype" name="exporttype">
                        <option value="0" selected="selected">XML</option>
                        <option value="1">VCard</option>
                        <option value="2">CSV</option>
                        <!--<option value="2">CSV(For GXV3175)</option>
                        <option value="3">CSV(For Outlook)</option>
                        <option value="4">CSV(For Outlook Express)</option>
                        <option value="5">CSV(For Simplified Chinese Outlook)</option>
                        <option value="6">CSV(For Simplified Outlook Express)</option>
                        <option value="7">CSV(For Google GMail)</option>-->
                    </select>
                </div>
            </div>
            <div class="detaildiv" style="line-height:0;">
                <div class="desdiv"><span>&nbsp;</span></div>
                <div class="contentdiv"><button id="savefavnow">Export</button></div>
            </div>
            <div class="detaildiv" style="margin-top:20px;text-align:center;margin-right:10px;padding-left:24px;line-height:0;">
                <button id="exportdialogok" class="dialogokbtn">Save</button>
                <button id="exportdialogcancel" class="cancelbtn">Cancel</button>
            </div> 
        </div>
    </div>
    
    <div id="newgroupdiv" class="dialogdivs">
        <div id="newgrouppopdiv" class="dialogbg" style="width:480px;height:170px;left:140px;">
            <div class="titlediv"><span id="a_newgroup">New Group</span></div>
            <div>
                <div style="margin-top:12px;"><input id="newgroupname" name="newgroupname" type="text" style="width:330px;margin-left:70px;" /></div>
                <div style="margin-top:20px;text-align:center;margin-right:10px;">
                    <button id="addnewgroup" class="dialogokbtn">OK</button>
                    <button id="cancelnewgroup" class="cancelbtn">Cancel</button>
                </div>   
            </div>
        </div>
    </div>
    <div id="selectcalldialog" style="width:100%;height:100%;position:absolute;top:0;left:0;display:none;">
    <div id="selectcalldiv">
        <div class="selecttitle"><span>Please select a number to call</span><button id="closecalldiv"></button></div>
        <div id="selectlist">

        </div>
        <div class="selectbtn">
            <button id="selectcall">Call</button><button id="selectcancel" class="cancelbtn">Cancel</button>
        </div>
    </div>
    </div>
</div>
<script type="text/javascript">
	var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
	}
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");
    //$("#delhis").button();
</script>
<script type="text/javascript" src='../js/apps.js'></script>
<script type="text/javascript">
var mEditMode = 0;
var selectid = "";
var selectrawid = "";
var mOptionNum = 0;
var mOptionNumSuc = 0;
var mOptionNumDone = 0;
var mItemsdivObj;
var mInsertBeforeNumObj, mInsertBeforeEmailObj, mDetailParentDivObj;
var portnum = 0;
var mAcctName = new Array("SIP", "IPVideoTalk", "H.323");
//var mNumberTypes = new Array("Home", "Mobile", "Work", "Work Fax", "Home Fax", "Pager", "Other", "Callback", "Car", "Company Main", "ISDN", "Main", "Other Fax", "Radio", "Telex", "TTY TDD", "Work Mobile", "Work Pager", "Assistant", "MMS");
var mNumberTypes = new Array(a_19087, a_19086, a_19088, a_19089, a_19090, a_19091, a_19092, a_19093, a_19094, a_19095, "ISDN", a_19096, a_19097, a_19098, a_19099, "TTY TDD", a_19100, a_19101, a_19102, a_19103);
//var mEmailTypes = new Array("Home", "Work", "Other", "Mobile");
var mEmailTypes = new Array(a_19129, a_19130, a_19092, a_19086);
var mEditNumberNum, mEditEmailNum;
var mContactNum = 0;
var mMaxContactNum = 2000;
var mSearchText = "";
var mSearchKey = "";
var mRunning = 0;
var mSearchTimer = 0;
var mMaxAccount = 3;
var mMaxMember = 1;
var mPromodel = "GVC3200";
var mOEMId = '0';
var mAcctStatus = new Array();
var mDisdialplan = 1;

var req_items = new Array;
req_items.push(
    new ReqItem("clearold", "1435", ""),
    new ReqItem("downdup", "1436", ""),
    new ReqItem("downmode", "330", ""),
    new ReqItem("downserver", "331", ""),
    new ReqItem("downencodetype", "1681", ""),
    new ReqItem("phbkdowninterval", "332", ""),
    new ReqItem("httpsusername", "6713", ""),
    new ReqItem("httpspass", "6714", "")
);
 
$(function(){
    mPromodel = $("#promodel", window.parent.document).val();
    mMaxMember = $("#maxlinenum", window.parent.document).val();
    if( mPromodel == "GVC3202" ){
        mMaxMember = 2;
    }
    mOEMId = $("#existcolore", window.parent.document).val();
    mItemsdivObj = document.getElementById('itemsdiv');
    mInsertBeforeNumObj = document.getElementById('addnewdiv');
    mInsertBeforeEmailObj = document.getElementById('addnewemaildiv');
    mDetailParentDivObj = document.getElementById('personinfodiv');
    
    /***************init state****************/
    $("#addpersondiv, .dialogdivs").hide();
    $("#delcontact").attr("disabled","disabled").addClass("deldisable");
    $("#rightbtn button").hide();
    /*************************/
    translate_page();
    cb_get_action('getcontactcount&region=webservice');
    window.parent.block_download_func(a_6660);
    get_contact();
    cb_get_action('get&var-0000=1688&var-0001=2382');
    cb_get_action('status&region=status');
    var height = parseInt($("#iframediv",parent.document.body).css('height'));
    $("#itemsdiv").css("height", height - 120); //14+32+30+18+20
    $("#persondiv").css("height", height - 60); //14+32+30+18
    
    cb_get(req_items);
    cb_get_download_params("getphbkparam");
    init_uploadphbook();
    $("input[type='file']").attr("title", "");
    pageEventActions();
});
function create_nocontact_div(){
    if( $("#nocalldiv").length > 0 ){
        $("#nocalldiv").show();
    }else{
        var nocalldiv = document.createElement('DIV');
        nocalldiv.className='nocalldiv';
        nocalldiv.id='nocalldiv';
        var itemsheight = $("#itemsdiv").css("height");
        nocalldiv.style.lineHeight = itemsheight;
        var nocalltext = document.createElement('SPAN');
        nocalltext.innerHTML = htmlEncode(a_15016);
        nocalldiv.appendChild(nocalltext);
        mItemsdivObj.appendChild(nocalldiv);
    }
    $("#a_details").text("");
    $("#editbtn, #personinfodiv .desdiv, .descriptiondiv").hide();
    window.parent.unblock_func();
}
function reget_contact(){
    $("#divcallbtn").appendTo($("#itemsdiv"));
    $(".itemdiv").remove();
    $("#addgroups").children().remove();
    window.parent.block_download_func(a_6660);
    cb_get_action('getcontactcount&region=webservice');
    get_contact();
}
function view_private_write(msgs)
{
    var portmode = msgs.headers["port-type"];
	$("#porttype").val(portmode);//getSetSSValue(portmode);
   
    var encode = msgs.headers["port-encode"];
    if( encode != "" && encode != undefined )
    {
        $("#encodetype").val(encode);
    }
    
    var exportmode = msgs.headers["export-type"];
	$("#exporttype").val(exportmode);//getSetSSValue(exportmode);
   
    var exencode = msgs.headers["export-encode"];
    if( exencode != "" && encode != undefined )
    {
        $("#exencodetype").val(exencode);
    }
    $(".dialogdivs").show();
    $("#downmode, #phbkdowninterval, #exporttype, #porttype").sSelect();
    $("#downencodetype, #exencodetype, #encodetype").sSelect({ddMaxHeight:'250px'});
    $(".dialogdivs").hide();
}
function create_contact_div(id, disname, number, numbertype, acctid, rawid, pinyin, pinyinfirst){
    if( $("#rawcontact_" + rawid).length == 0){
        var itemdiv = document.createElement('DIV');
        itemdiv.className='itemdiv';
        itemdiv.setAttribute("name", disname);
        itemdiv.setAttribute("number", number);
        if( number != "" ){
            itemdiv.setAttribute("numbernum", "1");
            itemdiv.setAttribute("numbertype", numbertype);
        }else{
            itemdiv.setAttribute("numbernum", "0");
            itemdiv.setAttribute("numbertype", "");
        }
        itemdiv.setAttribute("emailnum", "0");
        itemdiv.setAttribute("account", acctid);
        itemdiv.setAttribute("contactid", id);
        itemdiv.setAttribute("rawcontactid", rawid);
        itemdiv.setAttribute("email", "");
        itemdiv.setAttribute("emailtype", "");
        itemdiv.setAttribute("emailid", "");
        itemdiv.setAttribute("groupname", "");
        itemdiv.setAttribute("groupid", "");
        itemdiv.setAttribute("pinyin", pinyin);
        itemdiv.setAttribute("pinyinfirst", pinyinfirst);
        itemdiv.id = "rawcontact_" + rawid;
        
        var checkdiv = document.createElement('DIV');
        checkdiv.className='itemcheck';
        var checkbox = document.createElement('INPUT');
        checkbox.type = 'checkbox';
        checkbox.className = "inputcbx";
        if( $("#selectall").attr("checked") )
            checkbox.checked = true;
        checkdiv.appendChild(checkbox);
        itemdiv.appendChild(checkdiv);
        
        /*var icondiv = document.createElement('DIV');
        icondiv.className='itemstar';
        var itemicon = document.createElement('IMG');
        if( starred == "1" )
            itemicon.src='../img/apps/app_collection_pressed.png';
        else
            itemicon.src='../img/apps/app_collection_normal.png';
        icondiv.appendChild(itemicon);
        itemdiv.appendChild(icondiv);*/

        var picondiv = document.createElement('DIV');
        picondiv.className='itempicon';
        var pitemicon = document.createElement('DIV');
        pitemicon.className = "appcontacticon";
        picondiv.appendChild(pitemicon);
        itemdiv.appendChild(picondiv);
        
        var namediv = document.createElement('DIV');
        namediv.className='itemname';
        var spantext = document.createElement('SPAN');
        spantext.innerHTML = htmlEncode(disname);
        spantext.setAttribute("title", disname);
        namediv.appendChild(spantext);
        itemdiv.appendChild(namediv);
    
        mItemsdivObj.appendChild(itemdiv);
    }else{
        if( number != "" ){
            var curnumber = $("#rawcontact_" + rawid).attr("number");
            var curnumbertype = $("#rawcontact_" + rawid).attr("numbertype");
            var curacct = $("#rawcontact_" + rawid).attr("account");
            var curnumbernum = parseInt($("#rawcontact_" + rawid).attr("numbernum"));
            if( curnumber != "" ){
                curnumber += ":::";
                curacct += ",";
                curnumbertype += ",";
                curnumbernum ++;
            }
            curnumber += number;
            curacct += acctid;
            curnumbertype += numbertype;
            $("#rawcontact_" + rawid).attr("number", curnumber).attr("numbertype", curnumbertype).attr("numbernum", curnumbernum).attr("account", curacct);
        }
    }
}
function update_contact_div(dataid, rawid, info, infotype, acctid, datatype){
    if( info == "" ) return;
    if( datatype == 1 ){
        //email
        var emailattr = $("#rawcontact_"+rawid).attr("email");
        var emailtype = $("#rawcontact_"+rawid).attr("emailtype");
        var emailnum = parseInt($("#rawcontact_"+rawid).attr("emailnum"));
        if( emailattr != "" ){
            emailattr += ":::";
            emailattr += info;
            emailtype += ",";
            emailtype += infotype;
        }else{
            emailattr = info;
            emailtype = infotype;
        }
        emailnum ++;
        $("#rawcontact_"+rawid).attr("email", emailattr).attr("emailtype", emailtype).attr("emailnum", emailnum);
    }
    else if( datatype == 5 ){
        //number
        var curnumber = $("#rawcontact_" + rawid).attr("number");
        var curnumbertype = $("#rawcontact_" + rawid).attr("numbertype");
        var curacct = $("#rawcontact_" + rawid).attr("account");
        var curnumbernum = parseInt($("#rawcontact_" + rawid).attr("numbernum"));
        if( curnumber != "" ){
            curnumber += ":::";
            curacct += ","; 
            curnumbertype += ",";
        }
        curnumber += info;
        curacct += acctid;
        curnumbertype += infotype;
        curnumbernum ++;
        $("#rawcontact_" + rawid).attr("number", curnumber).attr("numbertype", curnumbertype).attr("numbernum", curnumbernum).attr("account", curacct);
    }
}

function parse_contacts(items){
    var id, rawid, disname, pinyin, pinyinfirst;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        rawid = items[i].RawId;
        disname = items[i].Name;
        pinyin = items[i].Pinyin;
        pinyinfirst = items[i].PinyinFirst;
        
        create_contact_div(id, disname, "", "", "", rawid, pinyin, pinyinfirst);
    }
    get_groups();
}

function parse_contactinfo(items){
    var id, rawid, info, acctid, infotype, datatype;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        rawid = items[i].RawId;
        info = items[i].Info;
        acctid = items[i].AcctIndex;
        infotype = items[i].InfoType;
        datatype = items[i].DataType;
        
        update_contact_div(id, rawid, info, infotype, acctid, datatype);
    } 
    add_item_event();
    
    if( mEditMode == 1 ){
        $("#rawcontact_"+selectrawid).click();
    }else{
        if( $(".itemdiv").length > 0 ){
            $(".itemdiv").eq(0).click();
        }
    }
}

function parse_groups(items){
    var itemsdiv = document.getElementById('itemsdiv');
    var id, disname, contactid;
    var groupsdiv = document.getElementById('addgroups');
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        disname = items[i].Name;
        contactid = items[i].ContactId;//this is raw contact id
        
        if( $("#addgroup_" + id).length == 0 )
        {
            var checkbox = document.createElement('INPUT');
            checkbox.type = 'checkbox';
            checkbox.className = "inputcbx";
            checkbox.id = "addgroup_" + id;
            checkbox.setAttribute("groupid", id);
            checkbox.setAttribute("groupname", disname);
            var spantext = document.createElement('SPAN');
            spantext.innerHTML = htmlEncode(disname);
            spantext.setAttribute("title", disname);
            groupsdiv.appendChild(checkbox);
            groupsdiv.appendChild(spantext);
            var brbox = document.createElement('BR');
            groupsdiv.appendChild(brbox);
        }
        
        if( $("#rawcontact_" + contactid).length != 0 )
        {
            var oldname = $("#rawcontact_" + contactid).attr("groupname");
            if( oldname == "" ){
                $("#rawcontact_" + contactid).attr("groupname", disname).attr("groupid", id);
            }else{
                oldname += ",";
                oldname += disname;
                var oldid = $("#rawcontact_" + contactid).attr("groupid");
                oldid += ",";
                oldid += id;
                $("#rawcontact_" + contactid).attr("groupname", oldname).attr("groupid", oldid);
            }
        }  
    }
    //get_email();
    get_contact_info(); 
}
function create_detail_number_div(newid)
{
    if( $("#detailnum" + newid + "div").length != 0 ) return;
    var detaildiv = document.createElement('DIV');
    detaildiv.className='detaildiv detailnumdiv';
    detaildiv.id = "detailnum" + newid + "div";
    var desdiv = document.createElement('DIV');
    desdiv.className='desdiv';
    var destext = document.createElement('SPAN');
    destext.innerHTML = htmlEncode(a_317);
    desdiv.appendChild(destext);
    detaildiv.appendChild(desdiv);
    
    var desnumdiv = document.createElement('DIV');
    desnumdiv.className='descriptiondiv';
    var desnumselect = document.createElement('SPAN');
    desnumselect.id = "detailnumtype" + newid;
    desnumselect.setAttribute("typevalue", "1");
    desnumselect.className='desnumtypespan';
    desnumselect.innerHTML = "";
    /*desnumselect.disabled = "disabled";
    for(var j = 0; j < 20; j++ ){
        var optiontext = "";
        var toption=document.createElement("OPTION");
        desnumselect.appendChild(toption);
        toption.value=(j+1);
        toption.text=mNumberTypes[j];
    }*/
    desnumdiv.appendChild(desnumselect);
    var desacctselect = document.createElement('SPAN');
    desacctselect.id = "detailacct" + newid;
    desacctselect.setAttribute("typevalue", "0");
    desacctselect.className='desnumtypespan';
    desacctselect.innerHTML = "";
    /*desacctselect.className='acctselect';
    desacctselect.disabled = "disabled";
    for(j = 0; j < mMaxAccount; j++ ){
        var optiontext = "";
        var toption=document.createElement("OPTION");
        desacctselect.appendChild(toption);
        toption.value=j;
        toption.text=mAcctName[j];
    }*/
    desnumdiv.appendChild(desacctselect);                             
    var desnumtext = document.createElement('SPAN');
    desnumtext.id = "detailnum" + newid;
    desnumtext.innerHTML = "";
    desnumtext.className = "desnumspan";
    desnumdiv.appendChild(desnumtext);
    detaildiv.appendChild(desnumdiv);
    
    var editdiv = document.createElement('DIV');
    editdiv.className='editdiv';
    var editnumselect = document.createElement('SELECT');
    editnumselect.id = "addsipnumtype" + newid;
    editnumselect.className='acctselect';
    for(j = 0; j < 20; j++ ){
        var optiontext = "";
        var toption=document.createElement("OPTION");
        editnumselect.appendChild(toption);
        toption.value=(j+1);
        toption.text=mNumberTypes[j];
    }
    editdiv.appendChild(editnumselect); 
    var editacctselect = document.createElement('SELECT');
    editacctselect.id = "addsipacct" + newid;
    editacctselect.className='acctselect';
    for(j = 0; j < mMaxAccount; j++ ){
        var optiontext = "";
        var toption=document.createElement("OPTION");
        editacctselect.appendChild(toption);
        if( mAcctName[j] == 'H.323' )
            toption.value='8';
        else
            toption.value=j;
        toption.text=mAcctName[j];
    }
    editdiv.appendChild(editacctselect); 
    var editinput = document.createElement('INPUT');
    editinput.id = "addsipnum" + newid;
    editinput.className = "numinput"; 
    editinput.setAttribute("type", "text");
    editdiv.appendChild(editinput);
    
    var delicon = document.createElement('BUTTON');
    delicon.id = "delnumber" + newid;
    delicon.className='delicon';
    delicon.setAttribute("numberid", newid);
    $(delicon).bind("click", function(){ deleteNumber($(this).attr("numberid")); });
    //delicon.onClick = deleteNumber;
	//delicon.addEventListener("click",deleteNumber,false); 
    editdiv.appendChild(delicon);
    detaildiv.appendChild(editdiv);
    
    mDetailParentDivObj.insertBefore(detaildiv, mInsertBeforeNumObj);
}
function deleteNumber(idattr){
    var id = parseInt(idattr);//$(this).attr("numberid")
    $("#detailnum" + id + "div").remove();
    if( id < mEditNumberNum -1 ){
        var newid;
        for( var i = id+1; i < mEditNumberNum; i++ ){
            newid = i-1;
            $("#detailnum" + i).attr("id", "detailnum" + newid);
            $("#detailnumtype" + i).attr("id", "detailnumtype" + newid);
            $("#detailacct" + i).attr("id", "detailacct" + newid);
            $("#addsipacct" + i).attr("id", "addsipacct" + newid);
            $("#addsipnum" + i).attr("id", "addsipnum" + newid);
            $("#addsipnumtype" + i).attr("id", "addsipnumtype" + newid);
            $("#delnumber" + i).attr("id", "delnumber" + newid).attr("numberid", newid);
            $("#detailnum" + i + "div").attr("id", "detailnum" + newid + "div");
        }
    }
    mEditNumberNum --;
}
function create_detail_email_div(newid)
{
    if( $("#detailemail" + newid + "div").length != 0 ) return;
    var detaildiv = document.createElement('DIV');
    detaildiv.className='detaildiv detailemaildiv';
    detaildiv.id = "detailemail" + newid + "div";
    var desdiv = document.createElement('DIV');
    desdiv.className='desdiv';
    var destext = document.createElement('SPAN');
    destext.innerHTML = htmlEncode(a_302);
    desdiv.appendChild(destext);
    detaildiv.appendChild(desdiv);
    
    var desnumdiv = document.createElement('DIV');
    desnumdiv.className='descriptiondiv';   
    var desemailtypeselect = document.createElement('SPAN');
    desemailtypeselect.id = "detailemailtype" + newid;
    desemailtypeselect.className='desemailtypespan';
    desemailtypeselect.innerHTML = "";
    /*desemailtypeselect.className='acctselect';
    desemailtypeselect.disabled = "disabled";
    for(var j = 0; j < 4; j++ ){
        var optiontext = "";
        var toption=document.createElement("OPTION");
        desemailtypeselect.appendChild(toption);
        toption.value=(j+1);
        toption.text=mEmailTypes[j];
    }*/
    desnumdiv.appendChild(desemailtypeselect);                               
    var desnumtext = document.createElement('SPAN');
    desnumtext.className='emailinput';   
    desnumtext.id = "detailemail" + newid;
    desnumtext.innerHTML = "";
    desnumdiv.appendChild(desnumtext);
    detaildiv.appendChild(desnumdiv);
    
    var editdiv = document.createElement('DIV');
    editdiv.className='editdiv';
    var emailtypeselect = document.createElement('SELECT');
    emailtypeselect.id = "addemailtype" + newid;
    emailtypeselect.className='acctselect';
    for(j = 0; j < 4; j++ ){
        var optiontext = "";
        var toption=document.createElement("OPTION");
        emailtypeselect.appendChild(toption);
        toption.value=(j+1);
        toption.text=mEmailTypes[j];
    }
    editdiv.appendChild(emailtypeselect); 
    var editinput = document.createElement('INPUT');
    editinput.className='emailinput';   
    editinput.id = "addemail" + newid;
    editinput.setAttribute("type", "text");
    editdiv.appendChild(editinput);
    
    var delicon = document.createElement('BUTTON');
    delicon.id = "delemail" + newid;
    delicon.className='delicon';
    delicon.setAttribute("emailid", newid);
    $(delicon).bind("click", function(){ deleteEmail($(this).attr("emailid")); });
    //delicon.onClick = deleteEmail;
	//delicon.addEventListener("click",deleteEmail,false); 
    editdiv.appendChild(delicon);
    detaildiv.appendChild(editdiv);
    
    mDetailParentDivObj.insertBefore(detaildiv, mInsertBeforeEmailObj);
}
function deleteEmail(idattr){
    var id = parseInt(idattr);//$(this).attr("emailid")
    $("#detailemail" + id + "div").remove();
    if( id < mEditEmailNum -1 ){
        var newid;
        for( var i = id+1; i < mEditEmailNum; i++ ){
            newid = i-1;
            $("#detailemail" + i).attr("id", "detailemail" + newid);
            $("#addemail" + i).attr("id", "addemail" + newid);
            $("#addemailtype" + i).attr("id", "addemailtype" + newid);
            $("#delemail" + i).attr("id", "delemail" + newid).attr("emailid", newid);
            $("#detailemail" + i + "div").attr("id", "detailemail" + newid + "div");
        }
    }
    mEditEmailNum --;
}
function add_item_event(){
    $(".itemdiv").unbind(); //to avoid too many click callback by one click 
    
    $(".itemdiv").hover(function(){
        $(this).addClass("hoverItem");
        if( $(this).attr("number") != "" ){
            $("#divcallbtn").appendTo($(this)).show();
        }
    },function(){
        //if( selectid != $(this).attr("contactid") )
            $(this).removeClass("hoverItem");
        $("#divcallbtn").hide();
    }); 

    //$(".descriptiondiv .acctselect").prop("disabled", true);
    $(".descriptiondiv .newListSelected").prop("disabled", true);
    
    $(".itemdiv").click(function(){
        if( mEditMode != 0 ){
            $("#cancelbtn").click();
        }
        $("#morebtndiv").hide();
        $("#personinfodiv").show();
        $("#a_details").text(a_584);
        selectid = $(this).attr("contactid");
        selectrawid = $(this).attr("rawcontactid");
        $("#persondiv").show().siblings(".detailcontent").hide();
        $(this).addClass("selectItem").siblings(".itemdiv").removeClass("selectItem");
        $("#detailname").text($(this).attr("name")).attr("title", $(this).attr("name"));
        var number = $(this).attr("number");
        var acctattr = $(this).attr("account");
        var typeattr = $(this).attr("numbertype");
        mEditNumberNum = parseInt($(this).attr("numbernum"));
        $(".detailnumdiv").hide();
        if( mEditNumberNum == 0 ){
            //$("#detailnumtype0").hide();
            $("#detailnumtype0, #detailacct0, #detailnum0").attr("title", "").text("");
        }else{
            var numbers = number.split(":::");
            var accts = acctattr.split(",");
            var numtypes = typeattr.split(",");
            for( var i = 0; i < mEditNumberNum; i++ ){
                if( $("#detailnum" + i + "div").length == 0 ){
                    create_detail_number_div(i);
                }
                if( numbers[i] != undefined ){
                    if( accts[i] == '8' ){
                        if( mOEMId == '54' ){
                            $("#detailnum" + i).attr("title", numbers[i]).text( "(" + mNumberTypes[numtypes[i]-1]+" , " + mAcctName[1] + ") " + numbers[i]);
                        }else{
                            $("#detailnum" + i).attr("title", numbers[i]).text( "(" + mNumberTypes[numtypes[i]-1]+" , " + mAcctName[2] + ") " + numbers[i]);
                        }
                    }else
                        $("#detailnum" + i).attr("title", numbers[i]).text( "(" + mNumberTypes[numtypes[i]-1]+" , " + mAcctName[accts[i]] + ") " + numbers[i]);
                    $("#detailacct" + i).attr("typevalue", accts[i]); //.text( "(" + a_301+" : " + mAcctName[i] + ")");
                    $("#detailnumtype" + i).attr("typevalue", numtypes[i]);//.text( "(" + a_2059 + " : " + mNumberTypes[i] + ")");
                    //$("#detailnumtype" + i).val(numtypes[i]).next(".newListSelected").show();
                    $("#detailnum" + i + "div").show();
                }else{
                    if( i > 0 )
                        $("#detailnum" + i + "div").hide();
                }
            }
        }
        /*if(numbers[0] == ""){
            $("#detailacct0").hide();
        }else{
            $("#detailacct0").show();
        }*/
        $(".detailemaildiv").hide();
        mEditEmailNum = parseInt($(this).attr("emailnum"));
        if( mEditEmailNum == 0 ){
            //$("#detailemailtype0").hide();
            $("#detailemail0, #detailemailtype0").attr("title", "").text("");
        }else{
            var emailattr = $(this).attr("email");
            var emailtype = $(this).attr("emailtype");
            var emails = emailattr.split(":::");
            var emailtypes = emailtype.split(",");
            for( var i = 0; i < mEditEmailNum; i++ ){
                if( $("#detailemail" + i + "div").length == 0 ){
                    create_detail_email_div(i);
                }
                if( emails[i] != undefined ){
                    $("#detailemail" + i).attr("title",emails[i]).text("(" + mEmailTypes[emailtypes[i]-1] + ") " + emails[i]);
                    $("#detailemailtype" + i).attr( "typevalue", emailtypes[i] ).text( "(" + a_2059 + " : " + mEmailTypes[i] + ")" );
                    //$("#detailemail" + i).text(emails[i]);
                    $("#detailemail" + i + "div").show();
                }else{
                    if( i > 0 )
                        $("#detailemail" + i + "div").hide();
                }
            }
        }
        $("#persondiv .detaildiv").addClass("hasborder");
        var gpname = $(this).attr("groupname");
        $("#detailgroups").attr("title", gpname).text(gpname);
        if( gpname != "" ){
            $("#detailgroupdiv").show();
        }else
            $("#detailgroupdiv").hide();
            
        $("#appright button, .morecontent").hide();
        $("#editbtn").show();
    }); 
    
    /*$(".itemstar").click(function(){
        var setstarred = 0;
        if( $(this).children("img").attr("src") == "../img/apps/app_collection_normal.png" )
        {
            setstarred = 1;
        }
    });*/
}
function parse_email(items){
    var id, email, emailattr, emailidattr, emialnum;           
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        email = items[i].Email;
        
        emailattr = $("#rawcontact_"+id).attr("email");
        emailnum = parseInt($("#rawcontact_"+id).attr("emailnum"));
        if( emailattr != "" ){
            emailattr += ":::";
            emailattr += email;
            emailnum ++;
        }else{
            emailattr = email;
        }
        $("#rawcontact_"+id).attr("email", emailattr).attr("emailnum", emailnum);
    }
    
    add_item_event();
    if( mEditMode == 1 ){
        $("#rawcontact_"+selectrawid).click();
    }else{
        if( $(".itemdiv").length > 0 ){
            $(".itemdiv").eq(0).click();
        }
    }
}

function cb_get_action_done(data, action) {
    if( data.substring(0, 1) == "{" )
    {
        data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
        if( action.indexOf("sqlitecontacts" ) != "-1" ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if( action.indexOf("type=contacts") != "-1" ){   
                 parse_contacts(items);         
            }
            else if( action.indexOf("type=contactinfo") != "-1" ){
                parse_contactinfo(items);    
                if( $(".itemdiv").length != 0 ){
                    $("#search").val(mSearchText);
                }
                window.parent.unblock_func();           
            }
            else if( action.indexOf("type=contactpinyin") != "-1" ){  
                var rawid, pinyin, pinyinfirst; 
                for (var i = 0; items[i] != undefined; i++)
                {
                    rawid = items[i].RawId;
                    pinyin = items[i].Pinyin;
                    pinyinfirst = items[i].PinyinFirst;
                    
                    $("#rawcontact_"+rawid).attr("pinyin", pinyin).attr("pinyinfirst", pinyinfirst);
                    if( mSearchKey != "" ){
                        if( (pinyin.toLowerCase()).indexOf(mSearchKey) != -1 || (pinyinfirst.toLowerCase()).indexOf(mSearchKey) != -1 ){
                            $("#rawcontact_" + rawid).show();
                        }
                    }
                }       
            }else if( action.indexOf("type=groups") != "-1" ){
                parse_groups(items);               
            }
            else if( action.indexOf("type=email") != "-1" ){
                parse_email(items);
            }
        }else if(action.indexOf("getcontactsbyorder") != -1 ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if( items != undefined )
                parse_contacts(items); 
            else
                window.parent.unblock_func();
        }else if(action.indexOf("removecontact") != -1 ){
            var tObj = eval("(" + data + ")");
            if( tObj.res == "success" ){
                mOptionNumSuc ++;
                $("#divcallbtn").appendTo($("#itemsdiv"));
                var deleteidstr = (action.split("="))[2];
                if( deleteidstr == "" ){
                    mContactNum = 0;
                    $("#itemsdiv .itemdiv").remove();
                    create_nocontact_div();
                    //$("#selectall").removeAttr("checked");
                    //$("#delcontact").attr("disabled","disabled").addClass("deldisable");
                }else{
                    var deleteids = deleteidstr.split(",");
                    for( var i = 0; i < deleteids.length; i++){
                        mContactNum --;
                        $(".itemdiv[contactid=" + deleteids[i] + "]").remove();
                    }
                }
                mSearchText = a_65 + " " + mContactNum + " " + a_4832;
                if( mSearchKey == "" ){
                    $("#search").val(mSearchText);
                }
            }
            mOptionNumDone ++;
            if( mOptionNum == mOptionNumDone ){
                window.parent.unblock_func();
                if( mOptionNumSuc == 0 ){
                    $.prompt(a_58);
                }else if( mOptionNum == mOptionNumSuc ){
                    $.prompt(a_57);
                    if( $(".itemdiv[contactid=" + selectid + "]").length == 0 ){
                        if( $(".itemdiv:visible").length == 0 ){
                            $("#personinfodiv, #editbtn").hide();
                        }else{
                            $(".itemdiv:visible").eq(0).click();
                        }
                    }
                    $("#selectall").removeAttr("checked");
                    $("#delcontact").attr("disabled","disabled").addClass("deldisable");
                }else{
                    $.prompt(a_16428);
                }
            }
        }else if(action.indexOf("setcontact") != -1 ){
            var tObj = eval("(" + data + ")");              
            if( tObj.res == "success" ){//success
                $("#nocalldiv").hide();
                var newname = $("#addname").val();
                var newnumbertype = $("#addsipnumtype0").val();
                var newnumber = $("#addsipnum0").val();
                var newnumbernum = 0;
                if( newnumber != "" )
                    newnumbernum = 1;
                var tmpnumber = "";
                var newaccount = $("#addsipacct0").val();
                var newnumbertype = $("#addsipnumtype0").val();
                for(var i = 1; i < mEditNumberNum; i++){
                    tmpnumber = $("#addsipnum" + i).val();
                    if( tmpnumber != "" ){
                        newnumber += ":::";
                        newaccount += ",";
                        newaccount += $("#addsipacct" + i).val();
                        newnumbertype += ",";
                        newnumbertype += $("#addsipnumtype" + i).val();
                        newnumbernum ++;
                        newnumber += tmpnumber;
                        $("#addsipnum" + i).text(tmpnumber);
                    }
                }
                var newemail = $("#addemail0").val();
                var newemailnum = 0;
                if( newemail != "" )
                    newemailnum = 1;
                //$("#detailemail0").text(newemail);
                var tmpemail = "";
                var newemailtype = $("#addemailtype0").val();
                for(var i = 1; i < mEditEmailNum; i++){
                    tmpemail = $("#addemail" + i).val();
                    if( tmpemail != "" ){
                        newemailtype += ",";
                        newemailtype += $("#addemailtype" + i).val();
                        newemail += ":::";
                        newemailnum ++;
                        newemail += tmpemail;
                        $("#detailemail" + i).attr("title",tmpemail).text(tmpemail);
                    }
                }  
                var newgname = "";
                var newgid = "";
                $("#addgroups .inputcbx").each(function(index, item) {
                    if ($(item).prop("checked") == true) {
                        if( newgname != "" )
                            newgname += ","
                        newgname += $(item).attr("groupname");
                        if( newgid != "" )
                            newgid += ","
                        newgid += $(item).attr("groupid");  
                    }
                });
                if( mEditMode == 1 ){
                    //add
                    var newrawid = parseInt(tObj.rawcontactid);
                    if( newrawid >= 0 ){
                        selectrawid = newrawid;
                        reget_contact(); 
                    }
                    /*mContactNum ++;
                    var newid = parseInt(tObj.contactid);
                    if( newrawid >= 0 ){
                        create_contact_div(newid, newname, newnumber, 0, newrawid, "", "");
                        add_item_event();
                        get_contact_pinyin_by_rawid(newrawid);
                        $("#rawcontact_" + newrawid).attr("numbernum", newnumbernum).attr("account", newaccount).attr("email", newemail).attr("emailnum", newemailnum).attr("groupname", newgname).attr("groupid", newgid).click(); 
                        if( $("#search").val() != "" ){
                            var searchkey = ($("#search").val()).toLowerCase();
                            if( (newnumber.toLowerCase()).indexOf(searchkey) == -1 && (newname.toLowerCase()).indexOf(searchkey) == -1 ){
                                $("#rawcontact_" + newrawid).hide();
                            }
                        }
                    }*/
                }else{
                    $("#rawcontact_" + selectrawid).children(".itemname").text(newname);
                    $("#rawcontact_" + selectrawid).attr("name", newname).attr("number", newnumber).attr("numbernum", newnumbernum).attr("numbertype", newnumbertype).attr("account", newaccount).attr("email", newemail).attr("emailnum", newemailnum).attr("emailtype", newemailtype).attr("groupname", newgname).attr("groupid", newgid).click();
                }    
            }else{
                if( mEditMode == 1 ){
                    $.prompt(a_7363);
                }else{
                    $.prompt(a_3317);
                }
            }
            window.parent.unblock_func();
        }else if(action.indexOf("setgroup") != -1 ){
            var tObj = eval("(" + data + ")");
            if( tObj.res == "success" ){
                var newid = parseInt(tObj.msg);
                var disname = $("#newgroupname").val();
                var groupsdiv = document.getElementById('addgroups');
                var checkbox = document.createElement('INPUT');
                checkbox.type = 'checkbox';
                checkbox.className = "inputcbx";
                checkbox.id = "addgroup_" + newid;
                checkbox.setAttribute("groupid", newid);
                checkbox.setAttribute("groupname", disname);
                var spantext = document.createElement('SPAN');
                spantext.innerHTML = htmlEncode(disname);
                spantext.setAttribute("title", disname);
                groupsdiv.appendChild(checkbox);
                groupsdiv.appendChild(spantext);
                var brbox = document.createElement('BR');
                groupsdiv.appendChild(brbox);
            }else{
                $.prompt(a_7363);
            }
        }else if(action.indexOf("getcontactcount") != -1 ){
            var tObj = eval("(" + data + ")");
            if( tObj.res == "success" ){
                mContactNum = parseInt(tObj.msg);
                mSearchText = a_65 + " " + mContactNum + " " + a_4832;
                if( mContactNum == 0 )
                    create_nocontact_div();
                else{
                    if( $("#nocalldiv").length > 0 )
                        $("#nocalldiv").hide();
                    $("#persondiv, #editbtn, #personinfodiv .desdiv, .descriptiondiv").show();
                }
                //$("#search").val(mSearchText);
            }
        }
    }else{
        if(action.indexOf("setcontact") != -1 || action.indexOf("getcontactsbyorder") != -1){
            window.parent.unblock_func();
        }
        if( data == "" ) return;
        var msgs = res_parse_rawtext(data);
        cb_if_auth_fail(msgs);
        if (cb_is_fail(msgs)){}   
        else {
            if(action == "status&region=status"){
                cb_get_status_done(msgs);
            }else if(action == "get&var-0000=1688&var-0001=2382"){
                mMaxContactNum = parseInt(msgs.headers['1688']);
                
                var disdialplan = msgs.headers['2382'];
                
                if(disdialplan == "" || disdialplan == undefined)
                    disdialplan = 0;
                else
                    disdialplan = parseInt(disdialplan).toString(2);
                    
                var length = disdialplan.length;
                switch (length) {
                    case 2:
                        if(disdialplan.substring(0, 1) == 1)
                            mDisdialplan = 0;
                        break;
                    case 3:
                        if(disdialplan.substring(1, 2) == 1)
                            mDisdialplan = 0;
                        break;
                    case 4:
                        if(disdialplan.substring(2, 3) == 1)
                            mDisdialplan = 0;
                        break;
                    case 5:
                        if(disdialplan.substring(3, 4) == 1)
                            mDisdialplan = 0;
                        break;
                }
            }
        }
    }
}
function cb_get_status_done(msgs) {
    if (msgs.headers['account_0_name'].length > 0) {
        mAcctName[0] = msgs.headers['account_0_name'];
    }
    if (msgs.headers['account_1_name'].length > 0) {
        mAcctName[1] = msgs.headers['account_1_name'];
    }
    if( mOEMId == '54' ){
        mAcctName = new Array("SIP", "H.323");
        $("#addsipacct0 option:eq(1)").remove();
        mMaxAccount = 2;
    }
    /*if (msgs.headers['account_2_no'].length > 1) {
        mAcctName[2] = msgs.headers['account_2_name'];
    }
    if (msgs.headers['account_3_no'].length > 1) {
        mAcctName[3] = msgs.headers['account_3_name'];
    }
    if (msgs.headers['account_4_no'].length > 1) {
        mAcctName[4] = msgs.headers['account_4_name'];
    }
    if (msgs.headers['account_5_no'].length > 1) {
        mAcctName[2] = msgs.headers['account_5_name'];
    }*/
    for(var i = 0; i < mMaxAccount; i++){
        $("#detailacct0 option:eq(" + i + ")").text(mAcctName[i]);
        $("#addsipacct0 option:eq(" + i + ")").text(mAcctName[i]);
    }
    
    for(var i = 0; i < 7; i++){
        var acctstatus = {};
        acctstatus.activate = msgs.headers['account_' + i + '_activate'];
        acctstatus.status = msgs.headers['account_' + i + '_status'];
        mAcctStatus.push(acctstatus);
    }
}
function get_item_suc_callback(){
    cb_downmode_change();
}
function translate_page(){
    $("#a_pagetitle").text(a_310);
    $("#a_details").text(a_584);
    $("#a_cancel").text(a_3);
    $("#morebtn").text(a_19070);
    $("#addcontact").text(a_23);
    $("#a_export, #export, #savefavnow").text(a_34);
    $("#a_import, #import").text(a_45);
    $("#delcontact").text(a_19067);
    $("#download").text(a_28);
    $("#editbtn").text(a_22);
    $("#savebtn").text(a_17);
    $("#cancelbtn").text(a_3);
    $("#a_detailname").text(a_7474);
    $("#a_detailnum").text(a_317);
    $("#a_detailemail").text(a_302);
    $("#a_detailgroups").text(a_4749);
    $("#a_addname").text(a_7474);
    $("#a_addemail").text(a_302);
    $("#addnewnumspan, #addnewemailspan").text(a_14004);
    $("#newgroupbtn, #a_newgroup").text(a_4838);
    $("#importdialogok, #exportdialogok, #downloaddialogok, #addnewgroup").text(a_17);
    $("#downloaddialogcancel, #importdialogcancel, #exportdialogcancel, #cancelnewgroup").text(a_3);
    $("#a_imfiletype, #a_exfiletype").text(a_4756);
    $("#a_downdup, #a_portdowndup").text(a_4754);
    $("#a_clearoldlist, #a_portclearoldlist").text(a_16485);
    $("#a_downmode").text(a_4765);
    $("#downmode option:eq(3)").text(a_8);
    $("#a_downserver").text(a_4766);
    $("#a_download, #downnow").text(a_28);
    $("#a_downinterval").text(a_16488);
    
    for(var i = 0; i < mNumberTypes.length; i++){
        $("#addsipnumtype0 option").eq(i).text(mNumberTypes[i]);
    }
    for(i = 0; i < mEmailTypes.length; i++){
        $("#addemailtype0 option").eq(i).text(mEmailTypes[i]);
    }
    $("#phbkdowninterval option:eq(0)").text(a_20);
    $("#phbkdowninterval option:eq(1)").text("2 "+a_108);
    $("#phbkdowninterval option:eq(2)").text("4 "+a_108);
    $("#phbkdowninterval option:eq(3)").text("6 "+a_108);
    $("#phbkdowninterval option:eq(4)").text("8 "+a_108);
    $("#phbkdowninterval option:eq(5)").text("12 "+a_108);
    $("#a_httpsusername").text(a_4111);
    $("#a_httpspass").text(a_4112);
    $("#a_fileencode, #a_exfileencode, #a_downfileencode").text(a_4755);
    $("#a_clearoldyes, #a_downdupyes, #a_portclearoldyes, #a_portdowndupyes").text(a_5);
    $("#a_browse").text(a_16486);
    $("#selectcancel").text(a_3);
    $("#selectcall").text(a_504);
    $(".selecttitle span").text(a_16656);
}
function init_uploadphbook()
{
    var button = $('#a_browse'), interval;
    var uploadkeytimer = 0;
    new Ajax_upload(button,{
        name: 'file',
		action : '../upload?type=phonebook',
        onSubmit : function(file, ext){
            cb_ping();
            //if (ext && new RegExp('^(' + allowed.join('|') + ')$').test(ext)){
            var portmode;
            var formaterror = 0;
            if ( (ext && /^(xml)$/.test(ext)) ){
                if( $("#porttype").val() != 0 )
                    formaterror = 1;
            }else if ( (ext && /^(vcf)$/.test(ext))){
                if( $("#porttype").val() != 1 )
                    formaterror = 1;
            }else if ( (ext && /^(csv)$/.test(ext))){
                if( $("#porttype").val() != 2 )
                    formaterror = 1;
            }else
            {
                $.prompt(a_16475);
                return false;
            }
            if( formaterror == 1 ){
                $.prompt(a_4758);
                return false;
            }
            window.parent.block_download_func(a_16430);
            /*if ( portmode == 1 && ! (ext && /^(vcf)$/.test(ext))){
                    $.prompt(ext_vcard);
                    return false;
            }
            if ( portmode >= 2 && ! (ext && /^(csv)$/.test(ext))){
                    $.prompt(ext_csv);
                    return false;
            }*/
            // change button text, when user selects file           
            button.text(a_16431);
            button.addClass('widebtn');
            
            // If you want to allow uploading only 1 file at time,
            // you can disable upload button
            this.disable();
            
            // Animating upload button
            // Uploding -> Uploading. -> Uploading...
            interval = window.setInterval(function(){
                var text = button.text();
                uploadkeytimer++;
                if (text.length < (a_16431.length + 3)){
                    button.text(text + '.');
                } else {
                    button.text(a_16431);
                }
                if (uploadkeytimer > 900)
                {
                     window.clearInterval(interval);
                     uploadkeytimer = 0;
                     $.prompt(a_16432);
                     button.text(a_7404);
                     button.removeClass('widebtn');
                }
            }, 200);
        },
        onComplete: function(file, response){
            button.text(a_8104);
            //button.removeClass('widebtn');
            window.clearInterval(interval);
            $("input[type='file']").attr("title", "");
            uploadkeytimer = 0;
            cb_put_portphbk(1, 0);
            
            // enable upload button
            this.enable();
        }
    });
}
/********cb_put_portphbk
    flag-1 means upload, which need send dbus,  flag-0 means save.  modify 20140916 flag-0 means save export, flag-1 means import, flag-2 means save import
    opmode-0 means import, opmode-1 means export, opmode-2 means save
*********/
function cb_put_portphbk(flag, opmode)      
{
    var data;
    if( flag == 0 )
        data = "&opmode=" + opmode + "&portType=" + $("#exporttype").val() + "&portEncode=" + $("#exencodetype").val();
    else{
        var cleared = 0;
        var replaced = 0;
        if( $("#portclearold").prop("checked") ) cleared = 1;
        if( $("#portdowndup").prop("checked") ) replaced = 1;
        data = "&opmode=" + opmode + "&portType=" + $("#porttype").val() + "&portEncode=" + $("#encodetype").val() + "&portReplace=" + replaced + "&portClear=" + cleared;
    }
    cb_put_port_param('putportphbk', flag, data);
}
function cb_get_portresponse(mode)
{
    var urihead = "action=portphbkresponse";
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_get_portresponse_done(data,mode);
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}
function cb_get_xmlresponse()
{
    cb_get_portresponse(0);
}
function cb_get_csvresponse()
{
    cb_get_portresponse(2);
}
function cb_get_vcardresponse()
{
    cb_get_portresponse(1);
}
function cb_get_portresponse_done(data,mode)
{
	var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    cb_if_is_fail(msgs);

    var response = msgs.headers["portphbkresponse"];
    if( response == 1 )
    {
        if(portnum < 80){
            if( mode == 0 )
			    setTimeout("cb_get_xmlresponse()",5000);
			else if( mode == 1 )
			    setTimeout("cb_get_vcardresponse()",5000);
			else
			    setTimeout("cb_get_csvresponse()",5000);
			if( portnum == 0 )
			    window.parent.block_export_func();
			portnum ++;
		}else
		{
		    window.parent.unblock_func();
		    $.prompt(a_6171);
		    portnum = 0; 
		}
    }else{
        if( portnum >= 1 )
            window.parent.unblock_func();
        portnum = 0; 
        if(response == 0)
        {
            if( mode == 0 )
                parent.window.location.href = "/phonebook/phonebook.xml?time=" + new Date().getTime();
            else if( mode == 1 )
                parent.window.location.href = "/phonebook/phonebook.vcf?time=" + new Date().getTime();
            else
                parent.window.location.href = "/phonebook/phonebook.csv?time=" + new Date().getTime();
        }else
        {
            switch( response )
            {
                case '2':
                    $.prompt(a_16420);
                    break;
                case '8':
                    $.prompt(a_16423);
                    break;
                case '9':
                    $.prompt(a_16433);
                    break;
                case '4':
                case '10':
                    $.prompt(a_6171);
                    break;
                default:
                    break;
            }
        } 
    }
}
function cb_get_fav_url()
{
    var portmode = $("#exporttype").val();
    cb_get_portresponse(portmode);
}
function cb_alert_import_response(t)
{
    switch(t) {
		case '1':
			if(downnum < 80){
				setTimeout("cb_get_upload_response()",5000);
				downnum ++;
				break;
			}else{
				$("#a_browse").text(a_7404).removeClass('widebtn');
			}
			break;
	    case '0':
	        reget_contact();
	        $.prompt(a_4780);
	        break;
        case '2':
	        $.prompt(a_16420);
	        break;
        case '3':
	        $.prompt(a_4772);
	        break;
        /*case '3':
	        if( $("#exporttype").val() == 2 )
                $.prompt(a_downparsefail+a_selcode);
            else
	            $.prompt(a_downparsefail);
	        break;*/
        case '4':
	        $.prompt(a_16474);
	        break;
        case '9':
	        $.prompt(a_16433);
	        break;
        case '10':
            $.prompt(a_16434);
	        break;
	    default:
	        break;
	}  
	if( t != 1 )
	{
	    downnum = 0;
	    $("#a_browse").text(a_16486).removeClass('widebtn');
	    if( t != 0 )
	        window.parent.unblock_func();
    }
}
function cb_get_response(flag)
{
    var urihead = "action=phbkresponse";
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_get_response_done(data,flag);
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}
function cb_get_response_done(data,flag)
{
	var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    cb_if_is_fail(msgs);

    var response = msgs.headers["phbkresponse"];
    if(flag == 2)
    {
        cb_alert_import_response(response);
    }else{
        cb_alert_response(response,flag); 
    }
}
function cb_put_downphbk(flag)
{
    var tempinterval = $("#phbkdowninterval").val();
    if(tempinterval == "") { tempinterval = 0; } 
    
    var data = "&downInterval=" + tempinterval + "&downEncode=" + $("#downencodetype").val(); //"&downType=" + $("#downloadtype").val()
    
    cb_put_download_param('putdownphbk', flag, data);
}
function cb_get_state_of_running_done(data){
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    cb_if_is_fail(msgs);
    mRunning = msgs.headers["running"];
}
function get_state_of_running(){
    var urihead = "action=get&var-0000=running";
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        async:false,
        dataType:'text',
        success:function(data) {
            cb_get_state_of_running_done(data);
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}
function on_search_key(){
    var searchkey = $("#search").val();
    if( searchkey == mSearchText ) return false;
    searchkey = searchkey.toLowerCase();
    mSearchKey = searchkey;
    if( searchkey == "" ){
        $(".itemdiv").show();
    }else{
        //$("#delcontact").attr("disabled","disabled").addClass("deldisable");
        $(".itemdiv").each(function(){
            if( ($(this).attr("number").toLowerCase()).indexOf(searchkey) == -1 && ($(this).attr("name").toLowerCase()).indexOf(searchkey) == -1 && ($(this).attr("pinyin").toLowerCase()).indexOf(searchkey) == -1 && ($(this).attr("pinyinfirst").toLowerCase()).indexOf(searchkey) == -1 )
            {
                $(this).hide();
            }else{
                $(this).show();
            }
        });
    }
    var isall = 1;
    if( $(".itemcheck .inputcbx:visible").length == 0 ){
        isall = 0;
        $("#delcontact").attr("disabled","disabled").addClass("deldisable");
    }else{
        $(".itemcheck .inputcbx:visible").each(function(index, item) {
            if ($(item).prop("checked") != true) {
                isall = 0;
                return false;   
            }
        });
    }
    if( isall == 0 )
        $("#selectall").removeAttr("checked");
    else
        $("#selectall").attr("checked", "checked");
    var haschecked = 0;
    $(".itemcheck .inputcbx:visible").each(function(index, item) {
        if ($(item).prop("checked")) {
            haschecked = 1;
            return false;   
        }
    });
    if( haschecked == 1 )
        $("#delcontact").removeAttr("disabled").removeClass("deldisable");
    else
        $("#delcontact").attr("disabled","disabled").addClass("deldisable");
    if( $("#rawcontact_"+selectrawid).length > 0 ){
        if( $("#rawcontact_"+selectrawid).is(":hidden") ){
            //hide the detail info
            $("#personinfodiv, #editbtn").hide();
        }else{
            $("#personinfodiv, #editbtn").show();
            //$("#rawcontact_"+selectrawid).click();
        }
    }else if( searchkey == "" ){
        $(".itemdiv").eq(0).click();
    }
}
function pageEventActions(){
    /***************serach hover function********************/
    $("#dialnow,#search").hover(function(){
            $(this).css("borderColor","#4ABE6B").siblings().css("borderColor","#4ABE6B");
        },function(){
            $(this).css("borderColor","#d9d9d9").siblings().css("borderColor","#d9d9d9");
    });
    /***************hover function end********************/
    
    $("#itemcallbtn").mouseover(function(){
        $(this).addClass('buttonover');
    }).mouseout(function(){
        $(this).removeClass('buttonover');
    }); 
    
    $("#downmode").change(function(){
        cb_downmode_change();
    });
        
    $("#downnow").click(function(){
        var downloadURL = $.trim($("#downserver").val());
        if(downloadURL == "")
        {
            $.prompt(a_4873);
            return false;
        }
        cb_put(req_items, "", 0);
        cb_put_downphbk(1); 
    });
    
    $("#savefavnow").click(function(){
        var porttype = $("#exporttype").val();
        var saveaction = 'savephbk&mode=' + porttype;
        cb_put_portphbk(0, 1);
        var data = '&porttype=' + porttype;
        cb_save_fav('savephbk');
    });
    
    $("#dialnow").click(function(){
        var dialnum = $.trim($("#search").val());
        if( dialnum == mSearchText )
            return false;
        if( dialnum == "" ) return false;
        cb_start_single_call(dialnum, "0", 0, mDisdialplan);
    });
    
    $("#itemcallbtn").click(function(){
        var numbernum = $(this).parent().parent(".itemdiv").attr("numbernum");
        var dialnum = $(this).parent().parent(".itemdiv").attr("number");
        var dialacct = $(this).parent().parent(".itemdiv").attr("account");

        if(numbernum > "1")
        {
            var dialnumarray = dialnum.split(":::");
            var dialacctarray = dialacct.split(",");
            numbernum = parseInt(numbernum);
            $("#selectlist").empty();
            var dialsel = "<select id='dialnumselect' dialacct="+dialacct+">";
            for(var i = 0;i < numbernum; i++)
            {
                var numopt = "<option value='"+dialnumarray[i]+ "' dialacct=" + dialacctarray[i] + ">"+htmlEncode(dialnumarray[i])+"</option>";
                dialsel += numopt;
            }
            dialsel += "</select>";
            $("#selectlist").append(dialsel);
            $("#dialnumselect option:eq(0)").attr("selected","selected");
            $("#selectcalldialog").show();
            $("#dialnumselect").sSelect({ddMaxHeight:'250px'});
            //$("#selectcalldialog").show();
            return false;
        }
        
        if( dialnum != "" ){
            mMaxlineNum = mMaxMember - parseInt($("#busylinenum",window.parent.document).val());
            if( $("#hasipvt", window.parent.document).val() == "1" && mPromodel == "GVC3202" && mMaxlineNum < 2 ){
                mMaxlineNum ++;
            }
            if( mMaxlineNum > 0 ) 
                cb_start_single_call(dialnum, dialacct, 0, mDisdialplan);
            else{
                $.prompt(a_10097);
            }
        }else{
            $.prompt(a_16665);
        }
    });
    
    $("#selectcall").click(function(){
        var dialnum = $("#dialnumselect").val();
        var dialacct = $("#dialnumselect option:selected").attr("dialacct");
        if( dialnum != "" ){
            mMaxlineNum = mMaxMember - parseInt($("#busylinenum",window.parent.document).val());
            if( $("#hasipvt", window.parent.document).val() == "1" && mPromodel == "GVC3202" && mMaxlineNum < 2 ){
                mMaxlineNum ++;
            }
            if( mMaxlineNum > 0 ) 
                cb_start_single_call(dialnum, dialacct, 0, mDisdialplan);
            else{
                $.prompt(a_10097);
            }
        }
        $("#selectcalldialog").hide();
    });

    $("#editbtn").click(function(){
        mEditMode = 2;
        $("#a_details").text(a_4839);
        $(".descriptiondiv").hide();
        $(".detaildiv").removeClass("hasborder");
        $(".editdiv, #detailgroupdiv").show();
        $("#savebtn,#cancelbtn").show();
        $("#editbtn, .detailnumdiv").hide();
        $("#addname").val( $("#detailname").attr("title") );
        mEditNumberNum = parseInt( $("#rawcontact_" + selectrawid).attr("numbernum") );
        $("#detailnum0div, #detailemail0div").show();
        if( mEditNumberNum == 0 ){
            $("#addsipnum0").val("");
            if( $("#detailnum0div").children(".editdiv").children(".newListSelected").length == 0 ){
                $("#addsipnumtype0").sSelect({ddMaxHeight:'200px'});
                $("#addsipacct0").sSelect();
            }
        }else{
            for( var i = 0; i < mEditNumberNum; i++ ){
                $("#addsipnum" + i).val( $("#detailnum" + i).attr("title") );
                $("#detailnum" + i + "div").show();
                if( $("#detailnum" + i + "div").children(".editdiv").children(".newListSelected").length == 0 ){
                    $("#addsipacct"+i).sSelect();
                    $("#addsipnumtype"+i).sSelect({ddMaxHeight:'200px'});
                }
                $("#addsipnumtype" + i).getSetSSValue( $("#detailnumtype" + i).attr("typevalue") );
                $("#addsipacct" + i).getSetSSValue( $("#detailacct" + i).attr("typevalue") );
            }
        }
        mEditEmailNum = parseInt( $("#rawcontact_" + selectrawid).attr("emailnum") );
        if( mEditEmailNum == 0 ){
            $("#addemail0").val("");
            if( $("#detailemail0div").children(".editdiv").children(".newListSelected").length == 0 ){
                $("#addemailtype0").sSelect();
            }
        }else{
            for( var i = 0; i < mEditEmailNum; i++ ){
                $("#addemail" + i).val( $("#detailemail" + i).attr("title") );
                $("#detailemail" + i + "div").show();
                if( $("#detailemail" + i + "div").children(".editdiv").children(".newListSelected").length == 0 ){
                    $("#addemailtype"+i).sSelect();
                }
                $("#addemailtype" + i).getSetSSValue( $("#detailemailtype" + i).attr("typevalue") );
            }
        }
        var gname = $("#detailgroups").attr("title");
        if( gname != "" )
            gname = "," + gname + ",";
        $("#addgroups .inputcbx").each(function(index, item) {
            if ( gname.indexOf( ","+$(item).attr("groupname")+"," ) != -1) {
                $(item).attr("checked", true);            
            }else{
                $(item).attr("checked", false);  
            }
        });
        $("#addname").focus();
    });

    $("#addcontact").click(function(){
        mEditMode = 1;
        mEditNumberNum = 1;
        mEditEmailNum = 1;
        $("#a_details").text(a_15003);
        $(".detaildiv").show();
        $("#rawcontact_" + selectrawid).removeClass("selectItem")
        $(".descriptiondiv, .detailnumdiv, .detailemaildiv").hide();
        $(".detaildiv").removeClass("hasborder");
        $("#personinfodiv, .desdiv, .editdiv, #detailnum0div").show();
        $("#savebtn,#cancelbtn, #persondiv").show();
        $("#editbtn, .morecontent").hide();
        $("#addname, #addsipnum0, #addemail0").val("");
        $("#detailnum0div, #detailemail0div, #detailgroupdiv").show();
        if( $("#detailnum0div").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#addsipacct0").sSelect();
            $("#addsipnumtype0").sSelect({ddMaxHeight:'200px'});
        }
        if( $("#detailemail0div").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#addemailtype0").sSelect();
        }
        $("#addsipacct0").getSetSSValue("0");
        $("#addsipnumtype0, #addemailtype0").getSetSSValue("1");
        $("#addgroups .inputcbx").each(function(index, item) {
            $(item).attr("checked", false);
        });
        $("#addname").focus();
    });

    $("#addnewnumspan,.addnumicon").click(function(){
        //since id is start from 0,so do not plus first
        if(mEditEmailNum == 0)
        {
            mEditEmailNum++; 
        }
        create_detail_number_div(mEditNumberNum);
        $("#addsipnum"+mEditNumberNum).val("");
        $("#detailnum" + mEditNumberNum + "div").show();
        $(".descriptiondiv").hide();
        $(".editdiv").show();
        if( $("#detailnum" + mEditNumberNum + "div").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#addsipacct"+mEditNumberNum).sSelect();
            $("#addsipnumtype"+mEditNumberNum).sSelect({ddMaxHeight:'200px'});
        }
        mEditNumberNum ++; 
    });
    
    $("#addnewemailspan,.addemailicon").click(function(){
        //since id is start from 0,so do not plus first
        if(mEditEmailNum == 0)
        {
            mEditEmailNum++;
        }
        create_detail_email_div(mEditEmailNum);
        $("#addemail"+mEditEmailNum).val("");
        $("#detailemail" + mEditEmailNum + "div").show();
        $(".descriptiondiv").hide();
        $(".editdiv").show();
        if( $("#detailemail" + mEditEmailNum + "div").children(".editdiv").children(".newListSelected").length == 0 ){
            $("#addemailtype"+mEditEmailNum).sSelect();
        }
        mEditEmailNum ++; 
    });
    
    $("#delcontact").click(function(){
        if( $(".itemdiv").length == 0 ) return false;
        var txt = '<div class="shortmsg">' + a_9334 + '</div>';
        $.prompt(txt,{
            buttons:{
                Yes: true, No: false
            },
            callback: function(v,m,f){
                if(v) {  
                    get_state_of_running();
                    if( mRunning == 1 ){
                        $.prompt(a_10046);
                        return false;
                    }
                    window.parent.block_download_func(a_59);
                    mOptionNum = 0;
                    mOptionNumSuc = 0;
                    mOptionNumDone = 0;
                    if( $("#selectall").prop("checked") == true && mSearchKey == "" ){
                        mOptionNum = 1;
                        if( mEditMode != 0 )
                            $("#rawcontact_" + selectrawid).click();
                        cb_get_action("removecontact&region=webservice&contactid="); 
                    }else{
                        var contactids = "";
                        var i = 0;
                        mOptionNum = 1;
                        $(".itemcheck .inputcbx:visible").each(function(index, item) {
                            if ($(item).prop("checked") == true) {
                                if( i != 0 )
                                    contactids += ",";
                                contactids += $(this).parent(".itemcheck").parent(".itemdiv").attr("contactid");
                                i ++;
                            }
                        });
                        if( contactids != "" )
                            cb_get_action("removecontact&region=webservice&contactid=" + contactids);
                        else{
                            window.parent.unblock_func(); 
                        }  
                    }
                }
                else {}
            }
        });  
    });
    
    $("#cancelbtn").click(function(){
        mEditMode = 0;
        $(".editdiv, .morecontent").hide();
        $(".descriptiondiv").show();
        $("#rawcontact_" + selectrawid).addClass("selectItem").click();
        $("#savebtn,#cancelbtn").hide();
        $("#a_details").text(a_584);
        if( $(".itemdiv").length == 0 ){
            $(".descriptiondiv, #editbtn").hide();
        }else
            $("#editbtn").show();
        if( mContactNum == 0 ){
            $("#persondiv .desdiv, .detaildiv").hide();
            $("#a_details").text("");
        }else{
            if( $("#rawcontact_"+selectrawid).is(":hidden") ){
                $("#personinfodiv, #editbtn").hide();
            }    
        }
    });
    
    $("#newgroupbtn").click(function(){
        $("#newgroupname").val("");
        $("#addnewgroup").attr("disabled", "disabled");
        $("#newgroupdiv").show();
    });
    
    $("#addnewgroup").click(function(){
        var newname = $.trim($("#newgroupname").val());
        if( newname != "" ){
            if( $("#addgroups input[groupname=\"" +newname + "\"]").length > 0 ){
                $.prompt(a_4834);
            }else{
                cb_get_action("setgroup&region=webservice&groupInfo=:::" + encodeURIComponent(newname) + "&format=json"); 
            }
        }
        $("#newgroupdiv").hide();
    });
    
    $("#downloaddialogok").click(function(){
        cb_put(req_items, "", 0); 
        $("#downloaddiv").hide();
    });
    
    $("#importdialogok").click(function(){
        cb_put_portphbk(2, 2); 
        $("#importdiv").hide();
    });
    
    $("#exportdialogok").click(function(){
        cb_put_portphbk(0, 2);
        $("#exportdiv").hide();
    });
        
    $("#downloaddialogcancel").click(function(){
        $("#downloaddiv").hide();
    });
    
    $("#importdialogcancel").click(function(){
        $("#importdiv").hide();
    });
    
    $("#exportdialogcancel").click(function(){
        $("#exportdiv").hide();
    });
    
    $("#cancelnewgroup").click(function(){
        $("#newgroupdiv").hide();
    });
    
    $("#morebtn").click(function(){
        if( $("#morebtndiv").css("display") == "none" ){
            $("#morebtndiv").css("display", "block");
        }else{
            $("#morebtndiv").css("display", "none");
        }
    });

    $("#morebtndiv").mouseleave(function(){
        $(this).hide();
    });
    
    $("#download,#import,#export").click(function(){
        /*if( mEditMode != 0 ){
            $("#savebtn,#cancelbtn,#editbtn").hide();
        }*/
        //$("#a_details").text( $(this).text() );
        //$(".detailcontent").hide();
        var showid = $(this).attr("id")+"div";
        $("#"+showid).show().siblings(".morecontent").hide();
        if( showid == "downloaddiv" ){
            mEditMode = 3;
        }else if( showid == "importdiv" ){
            mEditMode = 4;
        }else if( showid == "exportdiv" ){
            mEditMode = 5;
        }
        //$("#editbtn, #morebtndiv").hide();
        //$("#savebtn,#cancelbtn").show();
    });

    $(".itemcheck .inputcbx").live("click", function() {
        if ($(this).prop("checked") != true) {
            var isall = 1;
            $("#selectall").removeAttr("checked");//.button("refresh");
            //if( mSearchKey == "" ){
                $(".itemcheck .inputcbx:visible").each(function(index, item) {
                    if ($(item).prop("checked") == true) {
                        isall = 0;
                        return false;   
                    }
                });

                if(isall == 0)
                    $("#delcontact").removeAttr("disabled").removeClass("deldisable");
                else
                    $("#delcontact").attr("disabled","disabled").addClass("deldisable");
            /*}else{
                $("#delcontact").attr("disabled","disabled").addClass("deldisable");
            }*/
        } else {
            var isall = 1;
            $(".itemcheck .inputcbx:visible").each(function(index, item) {
                if ($(item).prop("checked") != true) {
                    isall = 0;
                    return false;   
                }
            });

            if (isall == 1)
                $("#selectall").attr("checked", "checked");//.button("refresh");
            $("#delcontact").removeAttr("disabled").removeClass("deldisable");
            /*if( mSearchKey == "" )
                $("#delcontact").removeAttr("disabled").removeClass("deldisable");
            else
                $("#delcontact").attr("disabled","disabled").addClass("deldisable");*/
        }
    });

    $("#selectall").click(function(){
        if ($(this).prop("checked") == true) {
            $(".itemcheck .inputcbx:visible").attr("checked", "checked");//.button("refresh");
            if( $(".itemdiv").length > 0 )
                $("#delcontact").removeAttr("disabled").removeClass("deldisable");
        } else {
            $(".itemcheck .inputcbx:visible").removeAttr("checked");//.button("refresh");
            $("#delcontact").attr("disabled","disabled").addClass("deldisable");
        }
    });
    
    $("#newgroupname").bind('input propertychange', function() {
        var text = $.trim($(this).val());
        if( text == "" ){
            $("#addnewgroup").attr("disabled","disabled");
        }else{
            $("#addnewgroup").removeAttr("disabled")
        }
    });
    
    $("#search").focus(function(){
        if( $(this).val() == mSearchText ){
            $(this).val("");
            mSearchKey = "";
        }
    }).blur(function(){
        if( $(this).val() == "" ){
            $(this).val(mSearchText);
            mSearchKey = "";
        }
    });
    
    $("#search").bind('input propertychange', function() {
        if(mSearchTimer > 0) 
            clearTimeout(mSearchTimer);
        mSearchTimer = setTimeout("on_search_key();", 350);
    });

    $("#closecalldiv,#selectcancel").click(function(){
        $("#selectcalldialog").hide();
    });
    
    $("#savebtn").click(function(){
        /*if( mEditMode > 2 ){
            if( mEditMode == 3 ){   //download
                //cb_put_downphbk(0);
                cb_put(req_items, "", 0); 
            }else if( mEditMode == 4 ){ //import
                cb_put_portphbk(2, 2); 
            }else if( mEditMode == 5 ){ //export
                cb_put_portphbk(0, 2);
            }
            $(".morecontent, #savebtn, #cancelbtn").hide();
            if( $(".itemdiv").length > 0 ){
                $(".detailcontent").show();
            }
            $("#a_details").text(a_584);
            return;
        }*/
        if( mEditMode == 1 ){
            if( mContactNum >= mMaxContactNum ){
                $.prompt(a_7471);
                return false;
            }
        }
        get_state_of_running();
        if( mRunning == 1 ){
            $.prompt(a_10046);
            return false;
        }
        var addname = $.trim($("#addname").val());
        if( addname == "" ){
            $.prompt(a_7435);
            return false;
        }
        /*if( $("#addsipnum0").val() == "" ){
            $.prompt(a_numberempty);
            return false;
        }*/
        window.parent.block_download_func(a_8104);
        var gpid = new Array();
        $("#addgroups .inputcbx").each(function(index, item) {
            if( $(item).prop("checked") ){
                gpid.push($(item).attr("groupid"));
                /*if( gpid != "" )
                    gpid += ",";
                gpid += $(item).attr("groupid");*/
            }
        });
        var infostr = '{"rawcontact":{';
        if( mEditMode == 2 ){
            //edit
            infostr += '"contactid":"';
            infostr += selectid;
            infostr += '"';
        }
        
        infostr += '},"structuredname":{"displayname":"';
        infostr += addname.replace(/\\/g, "\\\\").replace(/\"/g, "\\\"");
        infostr += '"},"groupmembership":[';
        
        var groupstr = "";
        for( var i = 0; i < gpid.length; i++){
            if( i > 0 )
                groupstr += ',';
            groupstr += '{"groupid":"';
            groupstr += gpid[i];
            groupstr += '"}';
        }
        infostr += groupstr;
        infostr += '],"phone":[';
        var numberstr = "";
        var curnumbernum = mEditNumberNum;
        if( mEditNumberNum == 0 && $.trim( $("#addsipnum0").val() ) != "" ){
            curnumbernum = 1;
        }
        for( i = 0; i < curnumbernum; i++){
            if( $.trim( $("#addsipnum" + i).val() ) == "" ) continue;
            if( numberstr != "" )
                numberstr += ',';
            numberstr += '{"type":"';
            numberstr += $("#addsipnumtype" + i).val();
            numberstr += '","account":"';
            numberstr += $("#addsipacct" + i).val();
            numberstr += '","number":"';
            numberstr += $("#addsipnum" + i).val().replace(/\\/g, "\\\\").replace(/\"/g, "\\\"");
            numberstr += '"}';
        }
        infostr += numberstr;
        infostr += '],"email":[';
        var emailstr = "";
        var curemialnum = mEditEmailNum;
        if( mEditEmailNum == 0 && $.trim( $("#addemail0").val() ) != "" ){
            curemialnum = 1;
        }
        for( i = 0; i < curemialnum; i++){
            if( $.trim( $("#addemail" + i).val() ) == "" ) continue;
            if( emailstr != "" )
                emailstr += ',';
            emailstr += '{"type":"';
            emailstr += $("#addemailtype" + i).val();
            emailstr += '","address":"';
            emailstr += $("#addemail" + i).val().replace(/\\/g, "\\\\").replace(/\"/g, "\\\"");
            emailstr += '"}';
        }
        infostr += emailstr;
        infostr += ']}';
        
        cb_get_action("setcontact&region=webservice&contactInfo=" + encodeURIComponent(infostr) + "&format=json"); 
        /*$(".editdiv").hide();
        $(".descriptiondiv").show();
        $("#savebtn,#cancelbtn").hide();
        $("#editbtn").show();*/  
    });
}

</script>

</body>

</html>
