<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Line</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href='../css/jquery-ui-tab.css' type='text/css' rel='stylesheet'>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src="../js/jquery-ui.tab.min.js"></script>
<script type="text/javascript" src='../js/jquery.stylish-select.min.js'></script>
<script type="text/javascript" src='../js/jquery.prompt.js'></script>
<script type="text/javascript" src='../js/jscolor.js'></script>
<script type="text/javascript" src='../js/apps.js'></script>
<script type="text/javascript" src="../js/color_exchange.js"></script>
<script type="text/javascript" src="../js/jquery-ui.min.js"></script>
<script type="text/javascript" src="../js/jquery.easing.1.3.js"></script>
<script type="text/javascript">
function GetRequest() {
    var url = location.search; //获取url中"?"符后的字串
    var theRequest = new Object();
    if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for(var i = 0; i < strs.length; i ++) {
            theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
        }
    }
    return theRequest;
}
</script>
<style>
body{background-color:#fff;width:100%;overflow:hidden;margin:0;padding:0;}
div{margin:0;padding:0;}
.disablediv{width:100%;height:80px;position:absolute;bottom:0px;left:0px;z-index:999;}
#bottombtn{width:100%;height:80px;position:absolute;bottom:0px;left:0px;z-index:10;background:#EDF0F2;}
/*#bottombtn div{float:left;width:70px;height:100%;text-align:center;position:relative;z-index:10;*margin-left:expression(this.previousSibling==null?"50px":"0px");}
#bottombtn div:first-child{margin-left:50px;}*/
.confbtmbtn{width:48px;height:49px;margin-left:35px;border:0;outline:0;min-width:0px;margin-top: 0px;vertical-align:middle;}
.confbtmbtn:hover{cursor:pointer;}
.confbtmbtn:disabled{-moz-opacity:0.4;opacity:.40;filter:alpha(opacity=40);}
.confbasebtn{margin:auto;width:590px;height:55px;margin-top:15px;}
.confctrlbtn{background-color: #219BF2;border-radius:50px;width:0px;height:55px;position: absolute;top: 11px;left: 50%;margin-left: -300px;display:none;}
.confctrlbtn .confbtmbtn{margin-top:3px;}

#confcontrol{background:url("../img/call/conf_control.png") 0px 0px no-repeat;margin-left:0px;}
#confcontrol.confctrlopen{background:url("../img/call/conf_control.png") 0px -349px no-repeat;width:54px;height:55px;}
#pause{background:url("../img/call/conf_control.png") 0px -147px no-repeat;margin-left: 50px;}
#record{background:url("../img/call/conf_control.png") -48px 0px no-repeat;}
#addmember{background:url("../img/call/conf_control.png") -96px 0px no-repeat;}
#dnd{background:url("../img/call/conf_control.png") -144px 0px no-repeat;}
#confdnd{background:url("../img/call/conf_control.png") -336px 0px no-repeat;}
#pincode{background:url("../img/call/conf_control.png") -336px 0px no-repeat;}
#details{background:url("../img/call/conf_control.png") -240px 0px no-repeat;}
#handsup{background:url("../img/call/conf_control.png") -386px 0px no-repeat; display: none;}
#close{background:url("../img/call/conf_control.png") -288px 0px no-repeat;}
#DTMF{background:url("../img/call/conf_control.png") -192px -0px no-repeat;}
#caption{background:url("../img/call/conf_control.png") -416px 0px no-repeat;}
#audiomix{background:url("../img/call/meeting_control_audio_mix_unpressed.png") no-repeat;}
#present{background:url("../img/call/conf_control.png") -96px -147px no-repeat;}
#switchvideosource{background:url("../img/call/conf_control.png") -144px -147px no-repeat;display:none;}
/*#closecamera{background:url("../img/call/conf_control.png") -512px -32px no-repeat;}
#localmute{background:url("../img/call/conf_control.png") -704px 0px no-repeat;}*/
#addnewcall{background:url("../img/call/conf_control.png") -608px -32px no-repeat;}
#layout{background:url("../img/call/conf_control.png") -48px -147px no-repeat;}
#closeconfctrl{width:26px;height:26px;min-width:0px;position: absolute;right: 15px;top: 14px;background:url("../img/call/conf_control.png") -234px -323px no-repeat;}
#muteall{background:url("../img/call/conf_control.png") -336px -147px no-repeat;}
#blockall{background:url("../img/call/conf_control.png") -240px -147px no-repeat;}
#suspendall{background:url("../img/call/conf_control.png") -288px -147px no-repeat;}

#confcontrol.btndisabled{background:url("../img/call/conf_control.png") 0px -49px no-repeat;}
#record.btndisabled{background:url("../img/call/conf_control.png") -48px -49px no-repeat;}
#addmember.btndisabled{background:url("../img/call/conf_control.png") -96px -49px no-repeat;}
#dnd.btndisabled{background:url("../img/call/conf_control.png") -144px -49px no-repeat;}
#confdnd.btndisabled{background:url("../img/call/conf_control.png") -336px -49px no-repeat;}
#pincode.btndisabled{background:url("../img/call/conf_control.png") -336px -49px no-repeat;}
#details.btndisabled{background:url("../img/call/conf_control.png") -240px -49px no-repeat;}
#close.btndisabled{background:url("../img/call/conf_control.png") -288px -49px no-repeat;}
#DTMF.btndisabled{background:url("../img/call/conf_control.png") -192px -49px no-repeat;}
#caption.btndisabled{background:url("../img/call/conf_control.png") -384px 0 no-repeat;}
#audiomix.btndisabled{background:url("../img/call/meeting_control_audiomix_disable.png") no-repeat;}
/*#closecamera.btndisabled{background:url("../img/call/conf_control.png") -480px -32px no-repeat;}
#localmute.btndisabled{background:url("../img/call/conf_control.png") -672px 0px no-repeat;}*/
#addnewcall.btndisabled{background:url("../img/call/conf_control.png") -576px -32px no-repeat;}

#pause.buttonover,#pause.active{background:url("../img/call/conf_control.png") 0px -196px no-repeat;}
#record.buttonover{background:url("../img/call/conf_control.png") -48px -98px no-repeat;}
#record.active{background:url("../img/call/conf_control.png") -336px -98px no-repeat;}
#addmember.buttonover, #addmember.active{background:url("../img/call/conf_control.png") -96px -98px no-repeat;}
#dnd.buttonover{background:url("../img/call/conf_control.png") -144px -98px no-repeat;}
#dnd.active{background:url("../img/call/conf_control.png") -384px -98px no-repeat;}
#confdnd.buttonover{background:url("../img/call/conf_control.png") -432px -98px no-repeat;}
#confdnd.active{background:url("../img/call/conf_control.png") -480px -98px no-repeat;}
#pincode.buttonover{background:url("../img/call/conf_control.png") -432px -98px no-repeat;}
#pincode.active{background:url("../img/call/conf_control.png") -480px -98px no-repeat;}
#details.buttonover, #details.active{background:url("../img/call/conf_control.png") -240px -98px no-repeat;}
#handsup.buttonover, #handsup.active{background:url("../img/call/conf_control.png") -578px -98px no-repeat;}
#close.buttonover{background:url("../img/call/conf_control.png") -288px -98px no-repeat;}
#DTMF.buttonover, #DTMF.active{background:url("../img/call/conf_control.png") -192px -98px no-repeat;}
#caption.buttonover, #caption.active{background:url("../img/call/conf_control.png") -448px 0 no-repeat;}
#audiomix.buttonover, #audiomix.active{background:url("../img/call/meeting_control_audio_mix_pressed.png") no-repeat;}
#present.buttonover,#present.active{background:url("../img/call/conf_control.png") -96px -196px no-repeat;}
#switchvideosource.buttonover, #switchvideosource.active{background:url("../img/call/conf_control.png") -144px -196px no-repeat;}
/*#closecamera.buttonover, #closecamera.active{background:url("../img/call/conf_control.png") -544px -32px no-repeat;}
#localmute.buttonover, #localmute.active{background:url("../img/call/conf_control.png") -736px 0px no-repeat;}*/
#addnewcall.buttonover, #addnewcall.active{background:url("../img/call/conf_control.png") -640px -32px no-repeat;}
#layout.buttonover, #layout.active{background:url("../img/call/conf_control.png") -48px -196px no-repeat;}
#closeconfctrl.buttonover{background:url("../img/call/conf_control.png") -234px -323px no-repeat;}
#muteall.buttonover,#muteall.active{background:url("../img/call/conf_control.png") -336px -196px no-repeat;}
#blockall.buttonover,#blockall.active{background:url("../img/call/conf_control.png") -240px -196px no-repeat;}
#suspendall.buttonover,#suspendall.active{background:url("../img/call/conf_control.png") -288px -196px no-repeat;}

#tips, #operatetip{width:auto;height:28px;color:#ffffff;font-size:12px;margin: 0;position:absolute;z-index:15;}
#tips span.tipcontent{padding:0 5px;height:24px;line-height:24px;border-radius:4px;background:#555555;display:block;}
#tips span.tipsimg{padding:0 5px;height:4px;background:url("../img/call/meeting_control_triangle.png") 50% 0px no-repeat;display:block;}
.noticetip{position:absolute;top:50%;left:50%;font-size:22px;color:#c8c8c8;margin-top:-100px;margin-left:-100px;background:transparent;width:200px;height:195px;}
.noticeicon{width:66px;height:87px;margin-left:67px;background:url("../img/call/no_meeting.png") no-repeat;}
#noticetipmsg{margin-top:20px;text-align:center;}
#operatetip{position: absolute;left:50%;z-index:1001;top:0;margin-left:-110px;font-size:16px;height:32px;}
#operatetip span.opcontent{padding:0 15px;height:30px;line-height:30px;border-radius:4px;background:#555555;display:block;}
/*tabs*/
#tabs{background:transparent;border:0;padding:0;}
.ui-tabs .ui-tabs-panel{padding:.2em 1.4em;}
.ui-tabs .ui-tabs-nav{padding:0;border:0;background:transparent;margin-bottom: 10px;}
.ui-tabs .ui-tabs-nav li{background:#1D6EA8;border:0;border-top-right-radius: 0px;border-top-left-radius: 0px;height:46px;line-height:46px;margin:0;outline:none;text-align:left;overflow:hidden;width:100%;padding: 0 0 0 33px;font-size:20px;}
.ui-tabs .ui-tabs-nav .ui-tabs-anchor{padding:0;width:100%;height:100%;outline:0;overflow:hidden;white-space:nowrap;text-overflow: ellipsis;}
.ui-state-hover{border:0;}
.ui-tabs .ui-tabs-nav li.ui-tabs-active{outline:none;margin:0;padding:0;background:#1D6EA8;overflow:hidden;width:100%;padding: 0 0 0 33px;text-align:left;}
.ui-tabs .ui-tabs-nav li.ui-state-hover{cursor:default;}
.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor{cursor: text;}
.ui-state-default a, .ui-state-default a:link, .ui-state-default a:visited{color:#FFF;font-size:16px;font-weight:normal;}
.ui-state-active a, .ui-state-active a:link, .ui-state-active a:visited{color:#FFF;font-size:20px;}
.ui-widget{font-family: Arial;}
/**conf list**/
.confdiv{width: 950px;height: 50px;line-height: 50px;background: transparent;color: #222;font-size:16px;border-bottom:1px solid #E1E1E1;}
.confdiv div{display: block;float: left;margin-left:15px;}
.confdiv div.conficon{width:14px;height:100%;margin:0 0 0 10px;}
.conficon img{margin:12px 0 0 0;}
.confname, .confnum, .conftype{width:150px;height:100%;overflow:hidden;text-overflow: ellipsis;white-space: nowrap;}
.conftype{width:170px;}
.confbtn{width:auto;height:100%;}
.confdiv div.confbtn{float:right;margin-right:30px;margin-left:0px;}
.confbtn button{float:left;width:26px;height:26px;border:0;outline:0;padding:0;margin:15px 0 0 25px;min-width:0px;}
.mute, #localmute{background:url("../img/call/conf_control.png") -208px -245px no-repeat;}
.unmute, #localmute.unmute{background:url("../img/call/conf_control.png") 0px -245px no-repeat;}
.confvideo{background:url("../img/call/conf_control.png") -180px -245px no-repeat;}
.confaudio{background:url("../img/call/conf_control.png") -154px -245px  no-repeat;}
.linehold{background:url("../img/call/conf_control.png") -252px -64px  no-repeat;}
.linetransfer{background:url("../img/call/conf_control.png") -315px -64px  no-repeat;}
.calling{display:none;}
.confdel{background:url("../img/call/conf_control.png") -104px -245px no-repeat;}
.confblock{background:url("../img/call/conf_control.png") -234px -245px no-repeat;}
.confsuspend{background:url("../img/call/conf_control.png") -52px -245px no-repeat;}
.isvideoed{background:url("../img/call/conf_control.png") -364px -245px no-repeat;}
.startFECC{background:url("../img/call/conf_control.png") -78px -245px no-repeat;}
.redialcall{background:url("../img/call/conf_control.png") -128px -245px no-repeat;display:none;}
.buttonover{cursor:pointer;}
.mute.normal,#localmute.normal{background:url("../img/call/conf_control.png") -208px -297px no-repeat;}
.unmute.normal,#localmute.unmute.normal{background:url("../img/call/conf_control.png") 0px -297px no-repeat;}
.confvideo.normal{background:url("../img/call/conf_control.png") -180px -297px no-repeat;}
.confaudio.normal{background:url("../img/call/conf_control.png") -154px -297px no-repeat;}
.confdel.normal{background:url("../img/call/conf_control.png") -104px -297px no-repeat;}
.linehold.normal{background:url("../img/call/conf_control.png") -273px -64px  no-repeat;}
.linetransfer.normal{background:url("../img/call/conf_control.png") -336px -64px  no-repeat;}
.redialcall.normal{background:url("../img/call/conf_control.png") -128px -297px  no-repeat;}
.confblock.normal{background:url("../img/call/conf_control.png") -234px -297px no-repeat;}
.confsuspend.normal{background:url("../img/call/conf_control.png") -52px -297px no-repeat;}
.startFECC.normal{background:url("../img/call/conf_control.png") -78px -297px no-repeat;}

.mute.buttonover{background:url("../img/call/conf_control.png") -208px -297px no-repeat;}
.unmute.buttonover{background:url("../img/call/conf_control.png") 0px -297px no-repeat;}
.confvideo.buttonover{background:url("../img/call/conf_control.png") -180px -297px  no-repeat;}
.confaudio.buttonover{background:url("../img/call/conf_control.png") -154px -297px no-repeat;}
.confdel.buttonover{background:url("../img/call/conf_control.png") -104px -297px no-repeat;}
.linehold.buttonover{background:url("../img/call/conf_control.png") -294px -64px  no-repeat;}
.linetransfer.buttonover{background:url("../img/call/conf_control.png") -357px -64px  no-repeat;}
.redialcall.buttonover{background:url("../img/call/conf_control.png") -128px -297px  no-repeat;}
.mute.active, .mute.active.buttonover, #localmute.buttonover, #localmute.active{background:url("../img/call/conf_control.png") -208px -297px no-repeat;}
.unmute.active, .unmute.active.buttonover, #localmute.unmute.buttonover, #localmute.unmute.active{background:url("../img/call/conf_control.png") 0px -297px no-repeat;}
.confvideo.active, .confvideo.active.buttonover{background:url("../img/call/conf_control.png") -180px -297px no-repeat;}
.confaudio.active, .confaudio.active.buttonover{background:url("../img/call/conf_control.png") -154px -297px  no-repeat;}
.confdel.active, .confdel.active.buttonover{background:url("../img/call/conf_control.png") -231px -64px no-repeat;}
.linehold.active, .linehold.active.buttonover{background:url("../img/call/conf_control.png") -294px -64px  no-repeat;}
.linetransfer.active, .linetransfer.active.buttonover{background:url("../img/call/conf_control.png") -357px -64px  no-repeat;}
.redialcall.active, .redialcall.active.buttonover{background:url("../img/call/conf_control.png") -128px -297px  no-repeat;}
.confblock.buttonover{background:url("../img/call/conf_control.png") -234px -297px no-repeat;}
.confsuspend.buttonover{background:url("../img/call/conf_control.png") -52px -297px no-repeat;}
.startFECC.active, .startFECC.buttonover{background:url("../img/call/conf_control.png") -78px -297px no-repeat;}
.confsuspend.active, .confsuspend.active.buttonover{background:url("../img/call/conf_control.png") -260px -297px no-repeat;}
.confblock.active, .confblock.active.buttonover{background:url("../img/call/conf_control.png") -26px -297px no-repeat;}
.isvideoed.btndisabled{background:url("../img/call/conf_control.png") -390px -245px no-repeat;}
.isvideoed.buttonover{background:url("../img/call/conf_control.png") -416px -245px no-repeat;}
.unisvideoed{background:url("../img/call/conf_control.png") -364px -271px no-repeat;}
.unisvideoed.buttonover{background:url("../img/call/conf_control.png") -416px -271px no-repeat;}
.startFECC.btndisabled{background:url("../img/call/conf_control.png") -78px -271px no-repeat;}
.confsuspend.btndisabled{background:url("../img/call/conf_control.png") -52px -271px no-repeat;}
.confblock.btndisabled{background:url("../img/call/conf_control.png") -234px -271px no-repeat;}
.confblock.active.btndisabled{background:url("../img/call/conf_control.png") -26px -271px no-repeat;}
.confdel.btndisabled{background:url("../img/call/conf_control.png") -104px -271px no-repeat;}
.mute.btndisabled, #localmute.btndisabled{background:url("../img/call/conf_control.png") -208px -271px no-repeat;}
.unmute.btndisabled, #localmute.unmute.btndisabled{background:url("../img/call/conf_control.png") 0px -271px no-repeat;}
.confaudio.btndisabled{background:url("../img/call/conf_control.png") -154px -271px no-repeat;}
.confvideo.btndisabled{background:url("../img/call/conf_control.png") -180px -271px no-repeat;}

.conflisthover,.conflistactive{background:#DFDFDF;}
.failedtip{color: red;}
#line-local{font-weight:bold;}
/*contacts*/
#addmemberdiv,#detailsdiv{display: none;position:absolute;z-index:1001;left:50%;top:50%;background:#FFFFFF;width:690px;height:auto;margin-left:-345px;border-radius:4px;}
#detailsdiv{overflow-y: auto;width:880px;margin-left:-440px;}
.poptitlediv{font-size:18px;color:#1D6EA8;background:transparent;width:100%;height:40px;line-height:40px;text-align:center;margin-top:10px;}
#search,.bjinput{width:628px;height:32px;line-height:32px;background:#F9FAFA;color:#777777;font-size:14px;border:0;padding:0 5px;border:1px solid #A4A3A3;border-radius: 4px;margin-left:30px;margin-top:15px;}
#contactsdiv{overflow-y:auto;overflow-x:hidden;margin:0 15px;}
.itemdiv{width:100%;height:42px;margin-top:5px;line-height:42px;background:transparent;border:none;font-size:14px;}
.itemdiv > div{display:block;float:left;margin-left:10px;}
.itemdiv div{*display:block;*float:left;}
#selectlist .itemname,#selectlist .itemtime{width:150px;overflow:hidden;text-overflow: ellipsis;white-space: nowrap;}
#selectlist input{margin-top:15px;}
#selectlist .itemdiv{width:450px;margin-left:25px;}
#contactsdiv .itempicon,#contactsdiv .itemname,#contactsdiv .itemnum{margin-left:10px;overflow:hidden;white-space:nowrap;text-overflow: ellipsis;}
#addmemberdiv p{color:red;margin:0;height:20px;margin-left:30px;}
#contactsdiv .inputcbx{width:15px;height:15px;margin-top: 14px;}
#contactsdiv .inputcbx:hover{cursor: pointer;}
.addmemberbtn{width:100%;position:absolute;bottom:25px;text-align: center;}
#addsave,#cancel{width:100px;height:28px;}
#addsave{margin-right:25px;}

#detailDiv{background: #f8f9fa;display: none;width:680px;height:300px;border:1px solid #000;position:absolute;top:50%;left:50%;overflow-y: auto;margin-left:-340px;}
#detailDiv > div {float:left;}
#sendDetail, #recDetail {width:50%;height:50px;text-align:center;}
#videoDetail, #audioDetail{height:125px;width:80px;}
.videocon, .audiocon{width:285px;height:125px;}
#presentDetail{height:125px;width:80px;display:none;}
.presentcon{width:285px;height:125px;display:none;}

.confdiv div.appcontacticon{width:20px;height:18px;background:url("../img/apps/call_status_icons.png") 0px  -107px no-repeat;margin: 15px 0 0 0;}
.itemdiv div.appcontacticon{margin: 12px 0 0 0;}
.confdiv div.searchitemicon{width:20px;height:18px;margin: 15px 0 0 0;}
.appgroupicon{width:26px;height:16px;background:url("../img/apps/call_status_icons.png") -11px  -93px no-repeat;}
.unholdline{font-weight:bold;}
.unholdicon{width:24px;height:24px;background:url("../img/call/talking.gif") no-repeat;margin: 5px 0 0 0 !important;}
.holdicon{width:17px;height:18px;background:url("../img/call/conf_control.png") 0px -85px  no-repeat;margin: 9px 0 0 3px !important;}
.confdiv div.failedicon{width:16px;height:16px;background:url("../img/apps/call_status_icons.png") 0px -50px no-repeat;margin: 15px 0 0 0;}
.itemname{white-space:nowrap;overflow: hidden;width:300px;text-overflow: ellipsis;text-align:left;}
#contactsdiv .itemnum{width:200px;text-align:right;margin-left:65px;}
.titleline{margin:0 15px;width:850px;height:1px;line-height:1px;background-color:#1D6EA8;}
.contactcalllog .itempicon div{margin-left:0;margin-top:12px;}
.contactcalllog .itemname div{margin-left:0;overflow:hidden;text-overflow: ellipsis;white-space: nowrap;width:100%;}
.contactcalllog .logitemduration{margin-left:30px;width: 130px;}
#acctselect, #callmodeselect{height:32px;margin-left:10px;}
#acctselect{margin-left:30px;}
#search.bjinput, .bjinput{display:none;width:301px;margin-left:10px;}
#search.bjinput{margin-left:30px;}
.modeselect{width:90px;height:25px;margin-left: 10px;float: left;margin-top: 15px;}
#acctdiv{width:150px;margin-left:30px;}
.modeselect .newListSelected{color: #222;width:89px;height:25px;padding: 0;background: url("../img/call/meeting_control_triangle.png") 0 0 no-repeat #EAEAEA;margin: 0px;outline: 0;border: 1px solid #A6A6A6;background-position: 70px center;font-size: 14px;text-align: center;border-radius: 4px;}
.modeselect .selectedTxt{width:75px !important;margin-left: -5px;}
.modeselect .selectedTxtDiv{width:75px !important;}
.modeselect ul.newList{width:90px;height: 78px;border: 1px solid #d9d9d9;color: #999;padding: 0;border-bottom: 0;top:28px !important;}
.modeselect ul.newList li{padding: 0 0 0 13px;height: 25px;line-height: 25px;float: none;margin: 0;text-align: left;border: 0;border-bottom: 1px solid #d9d9d9;white-space:nowrap;}
.modeselect ul.newList li a{padding: 0;float: none;margin: 0;text-align: left;}
.modeselect ul.newList li:hover{background-color:#E9EBED;}
.modeselect ul.newList li a.newListHover{background:transparent !important;cursor:pointer;}
#acctdiv .newListSelected{width:150px;background-position: 130px center;}
#acctdiv .selectedTxt{width:130px !important;}
#acctdiv ul.newList{width:150px;}
#acctdiv .selectedTxtDiv{width:150px !important;}
#callmodediv ul.newList{height: 52px !important;}
#callvideodiv ul.newList{height: 52px !important;}
#callmodediv ul.newList.disipcall{height: 26px !important;}
/*DTMF*/
#dtmfDiv{background:#FFFFFF;width:302px;height:410px;position: absolute;left:50%;top:50%;display:none;margin-left: -150px;margin-top: -205px;z-index: 1001;border-radius:4px;}
#dtmfinput{font-size:36px;color:#222222;height:40px;clear:both;margin:65px 0 8px 0;padding: 0;}
#dtmfdial{width:100%;height: auto;font-size:28px;color:#666666;background:#FFFFFF;margin:0px;position: absolute;bottom: 0px;}
.dtmfkeypad{float:left;width:100px;height:65px;background:#FFFFFF;cursor:pointer;text-align:center;border-top:1px solid #E1E1E1;line-height: 65px;}
.dtmfkeypad:hover{background:#219BF2;color:#FFFFFF;}
#dtmfinput p{overflow:hidden;padding: 0 0 0 5px;margin:0px;width:265px;height: 30px;line-height: 30px;float: left;}
#dtmfinput input{width:185px;background:transparent;border:0px;height:40px;line-height:40px;font-size:26px;color:#222222;padding-left:10px;margin:0px;}
#dtmfcursor{width:4px;border-right:1px solid #CAC9C9;height:auto;top: 6px;position: relative;left: 1px;display:none;}
.midkeypad{border:1px solid #E1E1E1;border-bottom:0px;}
.dtmfspchar{font-size: 46px;top: 8px;display: inline-block;position: relative;}

/*video_invite*/
#selectvideodiv,#dndselect,#presentselect,#pincodediv,#transferlinediv,#continuerecording{width:480px;height:auto;min-height:200px;position:absolute;top:50%;margin-top:-125px;left:50%;margin-left:-240px;z-index:1001;display:none;background:#FFFFFF;color:#FFF;font-size:16px;box-shadow:0px 0px 6px 1px #919191;border-radius:4px;}
#dndlist{margin-top:20px;}
.selecttitle{width:auto;height:35px;line-height:35px;background:#1D6EA8;padding-left:15px;}
.selecttitle span{float: left;}
#selectlist,#transferselectlist,#goonrecording{color:#222;text-align: center;margin: 0px;}
#selectlist .newListSelected,#dndselect .newListSelected,#transferselectlist .newListSelected{float:none;margin: 20px 0 10px 120px;text-align:left;}
.selectbtn{text-align:center;height:40px;position:relative;*z-index:-1;margin: 40px 0 10px 0;}
#layoutdiv .selectbtn{margin-bottom:5%;}
.selectbtn button{margin:8px 0 0 15px;width:100px;}
.closecontain{width:36px;height:36px;position:absolute;right:0px;text-align:center;background:transparent;}
.closecalldiv,#closeFECC,#detailsback,#closedtmf{width:26px;height:26px;min-width:0px;border:0;background:url("../img/call/conf_control.png") -52px -323px transparent no-repeat;border-radius:0px;position: relative;top: 5px;}
.closecontain.buttonover{background-color:#E32632;}
.closecalldiv.buttonover,#closeFECC.buttonover,#detailsback.buttonover,#closedtmf.buttonover{background:url("../img/call/conf_control.png") 0px -323px no-repeat transparent;}
#accpvideo{width:100px;height:30px;background:#4ABE6B;position:relative;}
#rejectvideo{width:100px;height:30px;position:relative;background:#D8333D;margin-left:48px;}
.listtips{width:100%;text-align:center;color:red;display:none;}
.presentitem{width: 100%; height: 40px; margin-top: 30px;}
.presentlabel{width: 44%; float: left; color: #000; text-align: right; height: 30px; line-height: 30px;}
.presentlist{width: 56%; float: left;}
.presentitem .newListSelected{margin-left: 10px; width: 182px !important; background: url(../img/settings_dropdown_control_unpressed_1.png) no-repeat}
.presentitem .selectedTxtDiv{width: 182px !important;}
.presentitem .newList{width: 178px;}
.presentitem .selectedTxt{width: 150px !important;}
#presentselect .selectbtn{margin: 30px 0 20px 0;}

/*transfer*/
#transferdiv{display: none;position:fixed;z-index:20;left:0;top:0px;background:#FFFFFF;width:100%;height:100%;}
#transferdiv .titlediv{font-size:18px;color:#1D6EA8;padding-left:30px;background:transparent;height:40px;line-height:40px;}
#transferdiv .titlediv span{vertical-align: top;}
#transfersearch{width:350px;height:36px;line-height:36px;color:#777777;font-size:14px;border:0;padding:0 5px;margin:0;}
#transfernotice{margin:20px 0 10px 0;}
.transferbtn *{float:left;}
#transferlist .conftype{width: 200px;}
#transferline, #transferoption{margin:0 0 0 30px;float:left;}
#transferlist{margin:15px 0 0 30px;float:left;}
#transferline{font-weight:bold;margin-top: 15px;margin-bottom: 5px;}
.transferbtn, .transferdetail{width:100%;}
#transferlist{overflow-x:hidden;overflow-y:auto;}
#transferlist .itemdiv{width:850px;}
#transferlist .itemname,#transferlist .logitemduration{width:200px;}
#transferlist .itemnumber{width:200px;}
.transferinput{width:440px;height:36px;border:2px solid #BDBCBC;margin-left:10px;}
.transferinput .newListSelected{width:80px;height:36px;line-height:36px;background:url("../img/call/transfer_triangle.png") #EBECEC no-repeat;background-position: 65px;padding:0;font-size:14px;text-align:center}
.transferinput .newListSelHover{border:none;}
.transferinput .newListSelected div{width:70px !important;padding: 0;;height:36px;}
.transferinput ul.newList{width:78px;border: 1px solid #BDBCBC;border-bottom:none;background: #FFFFFF;padding:0;}
.transferinput ul.newList li{width:100%;}
.transferinput ul.newList li a{width:68px;height:36px;color:#222;border-bottom: 1px solid #BDBCBC;padding:0 10px 0 0;}
.transferinput ul.newList li a.newListHover{background: #EBECEC !important;}
#transferback{width:25px;height:25px;min-width: 0;background:url("../img/call/back_unpressed.png") no-repeat;outline:none;margin:5px 10px 0 0;float:left;}
#transferback.buttonover{background:url("../img/call/back_pressed.png") no-repeat;}
#transferok{width:62px;height:40px;background:url("../img/call/transfer_button.png") #4ABE6B no-repeat;background-position: 50% 50%;margin-left:10px;}
#transferok.buttonover{background:url("../img/call/transfer_button.png") #39AD5A no-repeat;background-position: 50% 50%;}
.hoverItem{background-color:#EBECEC;cursor:pointer;}
#transfernum{display:none;}
#transferlist .itemdiv > div{display:block;float:left;margin-left:40px;}
#transferlist .itemicon,#transferlist .itempicon{margin-left:10px !important;}
#transferlist .itemname{margin-left:20px !important;}
/*calllog*/
.appincomingicon{width:18px;height:18px;background:url("../img/apps/call_status_icons.png") -18px  -54px no-repeat;margin: 8px 0 0 0;}
.appcallouticon{width:18px;height:18px;background:url("../img/apps/call_status_icons.png") -36px  -54px no-repeat;margin: 8px 0 0 0;}
.appmissedicon{width:18px;height:18px;background:url("../img/apps/call_status_icons.png") 0px  -54px no-repeat;margin: 8px 0 0 0;}

/*dnd*/
#dndcancel,#transferpopcancel{margin-left:30px;}

#transfermaskdiv{background-color:#000;width:100%;height:100%;position:fixed;top:0;left:0;z-index:1000;display: none;-moz-opacity:0.5;opacity:.50;filter:alpha(opacity=50);}
#loadingDiv{z-index: 1001;position: absolute;padding: 15px;margin: 0px;width: 250px;top: 40%;left: 35%;background-color:#FFFFFF;display:none;text-align: center;margin-left:-80px;}

/*details*/
#detailscontent{width:790px;height:375px;background-color:transparent;margin-left:45px;margin-top:20px;border:1px solid #CECECE;margin-bottom:20px;}
#lineinfo{float:left;width:140px;height:100%;background:#DFDFDF;font-size:16px;color:#444444;border-right:1px solid #CECECE;}
#linedetails{float:left;width:649px;height:100%;background:transparent;font-size:14px;color:#666666;}
#detailsarrow{display:none;}
.linelist{width:100%;height:40px;line-height:40px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;text-align:left;margin-top:5px;color:#222222;}
.linelist span{margin-left:22px;width:80px;display:inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;float: left;}
.linelist img{float:right;position:relative;right:15px;top:14px;}
.linelist:hover{color:#1D6EA8;cursor:pointer;}
.linelist.active{color:#1D6EA8;font-weight:bold;}
#detailstitle{width:100%;height:50px;font-weight:bold;}
#detailstitle div{float:left;text-align: center;}
#detailsend{width:260px;padding-left:110px;text-align:left;height:50px;line-height:50px;}
#detailreceive{width:260px;text-align:left;height:50px;line-height:50px;}
#detailscontent .titlediv,#detailscontent .sendinfo,#detailscontent .receinfo{float:left;text-align:left;font-size:12px;}
#detailscontent .titlediv{width:100px;font-weight: normal;text-align:center;padding:0;margin-right:10px;margin-top: 0px;}
.videodetail,.presentdetail{width:100%;height:200px;border-top:1px solid #E1E1E1;}
#detailscontent .videodetail .titlediv,#detailscontent .presentdetail .titlediv{height:200px;line-height:200px;}
#detailscontent .videodetail .titlediv span,#detailscontent .presentdetail .titlediv span,#detailscontent .audiodetail .titlediv span{background: #C8C8C8;text-align: center;color: #FFFFFF;padding: 5px;font-size:14px;}
.audiodetail{width:100%;height:120px;border-top:1px solid #E1E1E1;}
#detailscontent .audiodetail .titlediv{height:120px;line-height:120px;}
#detailscontent .sendinfo,#detailscontent .receinfo{width:260px;}
#detailscontent .spantitle,#detailscontent .spansign,#detailscontent .spancontent{display:inline-block;height:30px;line-height:30px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
#detailscontent .spantitle{width:120px;}
#detailscontent .spansign{width:10px;}
#detailscontent .spancontent{width:120px;font-weight:bold;color:#444444;}
.sendinfo div, .receinfo div{margin-top: 5px;}
#callingtips{width:auto;color:#ffffff;margin: 0;position: absolute;left:50%;z-index:1001;margin-left:-240px;font-size:16px;height:32px;display:none;bottom:0;margin-bottom:15px;}
#callingtips span.callingcontent{padding:0 15px;height:30px;line-height:30px;border-radius:4px;background:#555555;display:block;max-width: 315px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}

/*FECC*/
#ctrlFECCDiv{background-color:#FFFFFF; position: absolute; max-height: 500px; top: 0; left:0; right:0; bottom:0; text-align: center; margin: auto; display: none;z-index:1000;border-radius:4px;}
.fecctips, .fecctip{width:200px;text-align:center;margin:auto;}
.fecctips p, .fecctip p{margin:0px;height:30px;line-height:30px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
#direction{width:163px;height:163px;background:transparent;position:relative;top: 70px;left:50%;margin-left:-80px;}
#direction button{width:40px;height:40px;position:absolute;min-width:0px;}
#direction.normal{background:url("../img/control_all.png") -652px -28px  no-repeat;}
#direction.uphover{background:url("../img/control_all.png") -0px -28px  no-repeat;}
#direction.upactive{background:url("../img/control_all.png") -0px -191px  no-repeat;}
#direction.downhover{background:url("../img/control_all.png") -326px -28px  no-repeat;}
#direction.downactive{background:url("../img/control_all.png") -326px -191px  no-repeat;}
#direction.righthover{background:url("../img/control_all.png") -163px -28px  no-repeat;}
#direction.rightactive{background:url("../img/control_all.png") -163px -191px  no-repeat;}
#direction.lefthover{background:url("../img/control_all.png") -489px -28px  no-repeat;}
#direction.leftactive{background:url("../img/control_all.png") -489px -191px  no-repeat;}
.optionbtn{width:121px;margin-top: 130px;height:40px;border-radius:4px;border:1px solid #999999;background-color:#FAF9F9;position:relative;left:50%;margin-left:-60px;}
.optionbtn button{background:transparent;width:60px;height:40px;color:#666666;font-weight:bold;font-size:24px;min-width:0px;padding:0px;float:left;}
.optionbtn button.buttonover{color:#219BF2;}
.zoombtn{width:60px;height:40px;text-align: center;display:inline-block;float:left;}
.zoombtn button{position: relative;top: 6px;left:16px;}
#up{background:url("../img/control_all.png") -80px -354px  no-repeat;top:7px;left:62px;}
#up.buttonover{background:url("../img/control_all.png") -120px -354px  no-repeat;}
#down{background:url("../img/control_all.png") -160px -354px  no-repeat;top:114px;left:62px;}
#down.buttonover{background:url("../img/control_all.png") -200px -354px  no-repeat;}
#left{background:url("../img/control_all.png") -0px -354px  no-repeat;left:7px;top:62px;}
#left.buttonover{background:url("../img/control_all.png") -40px -354px  no-repeat;}
#right{background:url("../img/control_all.png") -240px -354px  no-repeat;left:117px;top:62px;}
#right.buttonover{background:url("../img/control_all.png") -280px -354px  no-repeat;}
#zoomwide{background:url("../img/control_all.png") 0px 0px  no-repeat;width:28px;height:28px;min-width:0px;}
#zoomtele{background:url("../img/control_all.png") -56px 0px  no-repeat;width:28px;height:28px;min-width:0px;}
#zoomwide.buttonover{background:url("../img/control_all.png") -28px 0px  no-repeat;}
#zoomtele.buttonover{background:url("../img/control_all.png") -84px 0px  no-repeat;}

.imgdiv{width:101px;height:58px;margin:0 !important;padding:0;*margin-top:0px !important;border:1px solid #BEC6CC;position: relative;border-width:0 1px 1px 0;display:block;float:left;}
.imgdiv span{width:20px;height:20px;line-height:20px;font-size:14px;font-weight:bold;text-align:center;margin-left:8px;}
.imgdiv span.noIMG{width:30px;height:30px;line-height:30px;border-radius: 50px;border:1px solid #666666;color:#666666;background:transparent;position:relative;left:50%;top:50%;margin-top:-15px;float: left;margin-left:-15px;background-color:#FFFFFF;}
.imgdiv span.noIMG.spanselect{border:1px solid #219BF2;color:#219BF2;}
.imgdiv span.noIMG.hover{border:1px solid #219BF2;color:#219BF2;}

.divingline{width:1px;height:40px;background:url("../img/ptz_divingline.png") no-repeat;display:inline-block;margin:0;background-position: center;float:left;}
/*layout*/
#layoutdiv{background-color:#FFFFFF;width:990px;height:100%; position: absolute;top: 0;display: none;z-index:1000;border-radius:4px;overflow-y: auto;}
.layoutcontainer{width:100%;}
.onewaylayout{height:550px;width:800px;margin-top:50px;background:transparent;}
.layoutlist{width:716px;height: 420px;border:0px;list-style-type: none;padding:0px;margin:auto;font-size:16px;background-color:#000000;border-radius:4px;}
.layoutlist.oneline{height:100%;background:transparent;}
.layoutlist.autosize{width:100%;height:100%;}
.layoutlist li {float: left;margin-left:5px;margin-top:5px;color:#FFFFFF;text-align:center;}
.layoutlist li.onelayoutlist{margin-right:20px;}
.onelayoutlist:hover{cursor: pointer;}
.mainpip, .custommainpip{width:465px;height:196px;border-radius:4px;border: 1px solid #4799D3;background-color:#3A81B4;}
.minorpip, .onelayoutitem, .cunstomminorpip{width:230px;height:96px;border-radius:4px;border: 1px solid #656464;background-color:#4A4A4A;}
.onelayoutitem{height:150px;opacity:0.9;background-color:#000000;width: 210px;}
.onelayoutitem.active,.onelayoutitem:hover{opacity:1;box-shadow:0px 0px 10px 2px #219BF2;}
.onelayoutitem div{border-radius:4px;background-color:#4A4A4A;display:inline-block;float: left;margin-left: 5px;}
.layoutlist p{overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin:0px;position: relative;top: 50%;margin-top: -11px;}
.layoutlist p.shownumber, .customlayoutlist p.shownumber{font-size:12px;color:#C8C8C8;margin-top:0px;}
.mainlayout{width:115px;height:95px;margin-top:27px;}
.minorlayout{width:80px;height:45px;margin-top:52px;}
.maxlayout{margin:5px;width:200px;height:140px;}
.overlaplayout{width: 97px;height: 70px;margin-top:40px;}
.morelineoverlap{width:230px;height:130px;border-radius:4px;border: 1px solid #656464;background-color:#4A4A4A;text-align:center;}
.onelayoutradio{left: 50%;margin-left:-7px;}
.fstbfcplayout{margin-top:27px;}
.secbfcplayout{margin-top:5px;}
.draghover{border:2px solid #75A7CB;background-color:#000000;}
.layoutmode{margin: auto;margin-top: 50px;margin-left: 40px;position: relative;}
.modelist{list-style-type: none;padding:0px;margin:0px;width:auto;height:36px;border:1px solid #D8D6D6;border-radius:4px;display: inline-block;}
.withpresent{display:none;}
#laymodetips{position: relative;top: -12px;margin: 0px;margin-left:10px;font-size: 16px;display: inline-block;}
.modelist li{float: left;text-align:center;vertical-align:middle;width:45px;height:100%;background-color:#E7E7E7; cursor: pointer; border-right: 1px solid #cccccc;}
/*.modelist li.divisionline{width:1px;background-color: #D8D6D6;}*/
.modelist li.buttonover, .modelist li.active, .presentlayout.buttonover{background-color:#219BF2;color:#FFFFFF;}
li.maxlayout{width:703px;height:406px;background-color:#4A4A4A;border-radius:4px;border: 1px solid #656464;}
.sysrcmd{background:url("../img/call/conf_control.png") -260px -323px no-repeat;}
.sysrcmd.buttonover, .sysrcmd.active{background:url("../img/call/conf_control.png") -286px -323px no-repeat;}
.overlap{background:url("../img/call/conf_control.png") -78px -323px no-repeat;}
.overlap.buttonover, .overlap.active{background:url("../img/call/conf_control.png") -104px -323px no-repeat;}
#layoutLinelist #layoutLineMode .overlap.buttonover {background-color: #C7C7C7;}
#layoutLinelist #layoutLineMode .overlap.active {background:url("../img/call/conf_control.png") -470px -323px no-repeat;}
.childmother{background:url("../img/call/conf_control.png") -130px -323px no-repeat;}
.childmother.buttonover, .childmother.active{background:url("../img/call/conf_control.png") -156px -323px no-repeat;}
#layoutLinelist #layoutLineMode .childmother.buttonover {background-color: #C7C7C7;}
#layoutLinelist #layoutLineMode .childmother.active {background:url("../img/call/conf_control.png") -440px -323px no-repeat;}
.pop{background:url("../img/call/conf_control.png") -526px -323px no-repeat;}
.pop.buttonover, .pop.active{background:url("../img/call/conf_control.png") -553px -323px no-repeat;}
#hdmiout1,#hdmiout2,#hdmiout3{width:350px;height:240px;background-color:#000000;border-radius:4px;float:left;}
#hdmiout1{margin-left:256px;margin-bottom:10px;}
#hdmiout2{margin-right:10px;}
#hdmiout1.twoscreen{margin-left:50px;margin-right:15px;}
#hdmiout2.twoscreen{margin-right:0px;}
#hdmiout2.threescreen{margin-left:75px;}
.morehdmicontain{background:transparent;}
.mainhdmipip,.droptips{width:332px;margin:auto;height:220px;border-radius:4px;border: 1px solid #4799D3;background-color:#3A81B4;float: left;margin-top: 9px;margin-left: 9px;text-align:center;}
.droptips{display:none;background-color:transparent;color:#FFFFFF;}
.minhdmipip{width:108px;height:71px;border-radius:4px;border: 1px solid #656464;background-color:#4A4A4A;margin-top: 5px;margin-left: 5px;float:left;text-align:center;}
.fullscreenbtn{background:url("../img/call/conf_control.png") -182px -323px no-repeat;width:26px;height:26px;position: absolute;right: 0;}
.fullscreenbtn:hover{cursor: pointer;}
.mainhdmipip p,.minhdmipip p,.droptips p, .customhdmi p{overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin:0px;position: relative;top: 50%;margin-top: -11px;color: #FFFFFF;}
.droptips p{font-size: 18px;}
#hdmiout2 .morelineoverlap{width:108px;height:68px;border-radius:4px;border: 1px solid #656464;background-color:#4A4A4A;margin-top: 9px;float:left;text-align:center;margin-bottom:0px;}
#hdmiout2 .minorpip{width:108px;height:47px;border-radius:4px;border: 1px solid #656464;background-color:#4A4A4A;margin-top: 9px;float:left;text-align:center;margin-bottom:0px;}
#hdmiout2 .mainpip{width:222px;height:105px;border-radius:4px;margin-top: 9px;float:left;text-align:center;margin-bottom:0px;}
#hdmiout2 .mainpip.draghover{height:103px;width:220px;}
#layoutHDMIinfo{display:none;width: 80px;height:100%;float:left;padding-top: 80px;}
#layoutLinelist{float:left;height:100%;width:708px;border-radius:4px;background-color:#E8F5FE;padding:10px;color: #FFFFFF;border: 1px solid #B2D4EC;}
.customlayoutlist{width: 100%;height: 90%;margin: 0px;padding: 0px;list-style: none;background: #000;border-radius: 4px;}
.customhdmi{width:220px;margin-left:10px;border-radius:4px;background-color:#4A4A4A;height:150px;margin-top:10px;}
.customoverlap{width:227px;height:135px;border-radius:4px;border: 1px solid #656464;background-color:#4A4A4A;text-align:center;margin-top:5px;margin-left:5px;float: left;}
.customlayoutlist input{float:right;}
.layoutHDMIlist{font-size:18px;color:#444444;height: 30px;line-height: 30px;position: relative;margin-top: 10px;}
.layoutHDMIlist:hover{cursor: pointer;}
.layoutHDMIlist.active{color:#219BF2;font-weight: bold;}
.hdmilistimg{background:url("../img/call/conf_control.png") -424px -323px no-repeat;height:26px;width:10px;position: relative;right: -1px;float: right;}
.customlayoutlist .showname{margin-top: 45px;overflow:hidden;text-overflow: ellipsis;white-space: nowrap;}
.custommode{background:url("../img/call/conf_control.png") -312px -323px no-repeat;}
.custommode.buttonover, .custommode.active{background:url("../img/call/conf_control.png") -338px -323px no-repeat;}
.presentlayout{width:26px;height:26px;background:url("../img/call/conf_control.png") -364px -323px no-repeat;margin-top:5px;margin-left:9px;}
.presentlayout.buttonover, .presentlayout.active{background:url("../img/call/conf_control.png") -390px -323px no-repeat;}
.customlayoutlist .custommainpip, .customlayoutlist .cunstomminorpip{float: left;margin-left:5px;margin-top:5px;}
.customlayoutlist .custommainpip{width:460px;height:234px;text-align: center;}
.customlayoutlist .custommainpip .showname{position: relative;top: 50%;margin-top: -20px;}
.customlayoutlist .custommainpip .shownumber{position: relative;top: 50%;margin-top: -15px;}
.customlayoutlist .cunstomminorpip{width:227px;height:114px;text-align: center;}

.ipvconfdivs{display:block;height:30px;}
.ipvconfdes, .ipvconfcontent{display:inline-block;margin-left:25px;}
.ipvconfdes{width:150px;}

.inputhint{color:gray;}
.presetbtn{background:transparent;color:#666666;width:129px;height:35px;}
.presetbtn:hover{color:#EB7921;}
#layoutLineMode {text-align: center;}
#layoutLinelist .overlapcustom, #layoutLinelist .pipcustom {display: inline-block; width: 45px; height:36px; margin-bottom: 10px; border: 1px solid #D8D6D6; background-color: #656464;}
#layoutLinelist .overlapcustom.buttonover, #layoutLinelist .overlapcustom.active, #layoutLinelist .pipcustom.buttonover, #layoutLinelist .pipcustom.active { background-color: #C7C7C7;}
#layoutLinelist .overlapcustom {border-right:0; -moz-border-bottom-left-radius: 4px; -webkit-border-bottom-left-radius: 4px; -ms-border-bottom-left-radius: 4px border-bottom-left-radius: 4px;}
#layoutLinelist .pipcustom {-moz-border-bottom-right-radius: 4px; -ms-border-bottom-right-radius: 4px; -webkit-border-bottom-right-radius: 4px; border-bottom-right-radius: 4px;}
.hdmi1custommode, .hdmi2custommode, .hdmi3custommode{margin-top:6px;}
.hdmi1custommode .hdmi1maxisizemode, .hdmi2custommode .hdmi2maxisizemode, .hdmi3custommode .hdmi3maxisizemode {display :inline-block; width: 26px; height: 26px; background: url("../img/call/conf_control.png") -400px -297px no-repeat;}
.hdmi1custommode .hdmi1smallsizemode, .hdmi2custommode .hdmi2smallsizemode, .hdmi3custommode .hdmi3smallsizemode {display :inline-block; width: 26px; height: 26px; background: url("../img/call/conf_control.png") -424px -297px no-repeat;}
.hdmi1custommode .hdmi1nosizemode, .hdmi2custommode .hdmi2nosizemode, .hdmi3custommode .hdmi3nosizemode {display :inline-block; width: 26px; height: 26px; background: url("../img/call/conf_control.png") -449px -297px no-repeat;}
.hdmi1custommode .hdmi1maxisizemode.active, .hdmi1custommode .hdmi1maxisizemode:hover, .hdmi2custommode .hdmi2maxisizemode.active, .hdmi2custommode .hdmi2maxisizemode:hover, .hdmi3custommode .hdmi3maxisizemode.active,.hdmi2custommode .hdmi2maxisizemode:hover { background: url("../img/call/conf_control.png") -314px -297px no-repeat;cursor:pointer;}
.hdmi1custommode .hdmi1smallsizemode.active, .hdmi1custommode .hdmi1smallsizemode:hover, .hdmi2custommode .hdmi2smallsizemode.active, .hdmi2custommode .hdmi2smallsizemode:hover, .hdmi3custommode .hdmi3smallsizemode.active, .hdmi3custommode .hdmi3smallsizemode:hover { background: url("../img/call/conf_control.png") -338px -297px no-repeat;cursor:pointer;}
.hdmi1custommode .hdmi1nosizemode.active, .hdmi1custommode .hdmi1nosizemode:hover, .hdmi2custommode .hdmi2nosizemode.active, .hdmi2custommode .hdmi2nosizemode:hover, .hdmi3custommode .hdmi3nosizemode.active, .hdmi3custommode .hdmi3nosizemode:hover { background: url("../img/call/conf_control.png") -366px -297px no-repeat;cursor:pointer;}
.hdmi1custommode .hdmi1maxisizemode.hidemaxisizemode, .hdmi2custommode .hdmi2maxisizemode.hidemaxisizemode, .hdmi3custommode .hdmi3maxisizemode.hidemaxisizemode {display: none;}
#layoutImgTip #layoutmaxiImg {display :inline-block; width: 26px; height: 26px;background: url("../img/call/conf_control.png") -476px -297px no-repeat;}
#layoutImgTip #layoutsmallImg {display :inline-block; width: 26px; height: 26px;background: url("../img/call/conf_control.png") -499px -297px no-repeat;}
#layoutImgTip #layoutnoImg {display :inline-block; width: 26px; height: 26px;background: url("../img/call/conf_control.png") -522px -297px no-repeat;}
#layoutImgTip {display:none;width: 30px;float: left;padding-top: 80px;}
#layoutmaxispan, #layoutsmallspan, #layoutnospan {display:inline-block;width:40px;margin-left:35px;height:26px;line-height:26px;font-size: 10px;font-color:#7a8088;}
.layoutleft{float:left; width:30%;height: 100%;}
.layoutnumberlist{margin:57px 0 0 40px; width: 250px; float: left;}
.layoutnumber{height: 30px; width: 210px; border: 1px solid #dddddd; border-radius: 3px; background: #dddddd; line-height: 30px; font-size: 16px; padding: 0 15px 0 15px; margin-bottom: 10px;}
.layoutlocalicon{background: url("../img/call/conf_control.png") -546px -297px no-repeat; display: inline-block; width: 26px; height: 26px; float: left; margin:1px 0 0 3px;}
.layoutpresenticon{background: url("../img/call/conf_control.png") -572px -297px no-repeat; display: inline-block; width: 26px; height: 26px; float: left; margin:1px 0 0 5px;}
.screendiv{display :inline-block; width: 26px; height: 26px; float:right; margin-top: 1px; cursor: pointer;}
.fullscreen{background: url("../img/call/conf_control.png") -400px -297px no-repeat;}
.fullscreen.active{background: url('../img/call/conf_control.png') -316px -297px no-repeat;}
.normalscreen{background: url("../img/call/conf_control.png") -426px -297px no-repeat;}
.normalscreen.active{background: url('../img/call/conf_control.png') -342px -297px no-repeat;}
.hidescreen{background: url("../img/call/conf_control.png") -452px -297px no-repeat;}
.hidescreen.active{background: url('../img/call/conf_control.png') -368px -297px no-repeat;}
.linename{max-width: 99px; min-width: 45px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; float: left;}
.hdmidiv{float:left;font-size: 20px; margin-left: 165px; cursor: pointer; max-height: 50px;}
.hdmi_arrow{background: url("../img/call/hdmi_arrow.png") no-repeat; width: 17px; height: 11px; margin-left: 28px; position: absolute; bottom: -3px; z-index: 1;}
.modediv{width: 26px; height: 26px; margin: 5px 0 0 9px;}
.layoutbkgdiv{background: #6b6b6b; border-radius: 4px; box-shadow: 0 0 3px 3px #cccccc; position: relative;}
.layoutlinediv{border-radius: 5px; background: #cccccc; float: left;}
.layoutlinename{font-weight: bold; font-size: 16px; margin-top: 29%;}
.layoutlinenumber{font-size: 15px;}
.layoutlinename, .layoutlinenumber{width: 80%; color: black; text-align: center; padding: 0 10%; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;}
.largelinediv{border-radius: 5px; background: #cccccc; float: left;}
.smalllinediv{border-radius: 5px; background: #cccccc; float: right;}
#sysrcmdmode{display: none; position: absolute; z-index: 100; border: 1px solid #ccc; border-top: none; margin-top: -1px; padding: 0; width: 45px; border-radius: 5px;}
#sysrcmdmode li{background: #e7e7e7; list-style-type:none; width: 45px; height: 36px; border-top: 1px dashed #ccc; cursor: pointer;}
#sysrcmdmode li div{width: 55%; height: 100%; margin: 5px 0 0 9px;}
.sysmodeoverlap{background:url("../img/call/conf_control.png") -78px -323px no-repeat;}
.sysmodepip{background:url("../img/call/conf_control.png") -130px -323px no-repeat;}
.sysmodepop{background:url("../img/call/conf_control.png") -526px -323px no-repeat;}
.cusmodecls{width: 100%; height: 40px; background: black; opacity: 0.5; float: left; border-radius: 5px; overflow: hidden; position: absolute; bottom:0px;}
.cusmodecls ul{width: 150px; height: 30px; margin-left: 39.5%; margin-top: 8px; padding: 0;}
.cusmodecls li{width: 26px; float: left; list-style-type: none; height: 26px; cursor: pointer; margin-left: 15px;}
.cusoverlap{background: url("../img/call/conf_control.png") -78px -323px no-repeat;}
.cusoverlap.active{background: url("../img/call/conf_control.png") -470px -323px no-repeat;}
.cuschildmother{background: url("../img/call/conf_control.png") -130px -323px no-repeat;}
.cuschildmother.active{background: url("../img/call/conf_control.png") -440px -323px no-repeat;}
.cuspop{background: url("../img/call/conf_control.png") -526px -323px no-repeat;}
.cuspop.active{background: url("../img/call/conf_control.png") -498px -323px no-repeat;}
#layouttitle{width: 100%; height: 36px; font-size: 16px; font-weight: bold; line-height: 36px; color: white; background: #1d6ea8; border-radius: 1px;}
#layouttitletext{width: 90%; float: left; padding-left: 20px;}
#promptdiv{position: absolute;background: #fff;width: 450px;height: 200px;z-index: 1005; top:0; left:0; right:0; bottom:0; margin:auto; border-radius: 8px; border: 1px solid #cccccc;}
.promptinfo{width: 100%; height: 50%; line-height: 100px; color: #1d6ea8; font-size: 18px; text-align:center;}
.promptinfo span{float:left;}
.prompthost{display: inline-block;max-width: 40%;overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-left: 5%;}
.promptbutton{float: left; margin-left: 85px; margin-top: 30px; width:100px;}
.promptbutton:hover{background: #d1d1d1;}
#recordSelect{width: 300px; height: 120px; position: absolute; top:-150px; left:0; right:0; bottom:0; margin: auto; display:none;}
#recordtitle{width: 100%; height: 40px; background: #1d6ea8; color:#fff; font-size: 18px; line-height: 40px; border: 1px solid #1d6ea8; border-top-left-radius: 5px; border-top-right-radius: 5px;}
#recordtitle span{margin-left: 12px;}
#recordtitle img{height: 12px; width: 12px; cursor: pointer; padding: 5px; margin: 10px; float: right;}
.recordline{width: 100%; height: 39px; border: 1px solid #c1c1c1; border-top:none; background: #fff;}
#ipvtrcd{border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;}
.rcdicon{float: left; margin: 13px 0 0 15px;}
#localrcd .rcdicon{width: 18px; height: 14px; background: url("../img/call/conf_control.png") -564px -171px no-repeat;}
#ipvtrcd .rcdicon{width: 18px; height: 12px; background: url("../img/call/conf_control.png") -565px -213px no-repeat; margin-top:14px;}
.rcdlinename{float:left; font-size: 15px; margin-left: 10px; line-height: 39px;}
.rcdstart{height: 24px; width: 24px; cursor: pointer;position: absolute; right: 6px; background: url("../img/call/conf_control.png") -528px -165px no-repeat; margin: 8px;}
.rcdstop{height: 24px; width: 24px; cursor: pointer;position: absolute; right: 6px; background: url("../img/call/conf_control.png") -528px -205px no-repeat; margin: 8px;}
</style> 
</head>
<body>
    <input name="disableconf" type="checkbox" id="disableconf" style="display:none;">
    <div id="wholepage"> 
        <div id="tabs">
            <ul></ul>
        </div>  
    </div>
    <div id="loadingDiv" class="blockMsg blockPage">
        <img src="../img/busy.gif" wdith="40px" height="40px">
        <div class="downfont"></div>
    </div> 
    <div id="transfermaskdiv"></div>
    <div id="addmemberdiv">
        <div class="closecontain"><button class="closecalldiv"></button></div>
        <div class="poptitlediv">Add Members</div>
        <div class="modeselect" id="acctdiv">
            <select id="acctselect">
                <option value="0">Account 1</option>
                <option value="1">Account 2</option>
                <option value="2">Account 3</option>
                <option value="8">H.323</option>
            </select>
        </div>
        <div class="modeselect" id="callmodediv">
            <select id="callmodeselect">
                <option value="0">Call</option>
                <!--<option value="1">Paging</option>-->
                <option value="2">IP Call</option>
            </select>
        </div>
        <div class="modeselect" id="callvideodiv">
            <select id="callvideoselect">
                <option value="1">Video</option>
                <option value="0">Audio</option>
            </select>
        </div>
        <input id="search" name="search" />
        <input id="bjpassword" class="bjinput" />
        <p></p>
        <div id="contactsdiv"></div>
        <div class="addmemberbtn">
            <button id="addsave" class="savebtn">Add</button>
            <button id="cancel" class="cancelbtn">Cancel</button>
        </div>
    </div>
    <div id="transferdiv">
        <div class="titlediv"><button id="transferback"></button><span>Transfer</span></div>
        <div class="titleline"></div>
        <div id="transferline"></div>
        <div id="transferoption">
            <div class="transferbtn">
                <div class="transferinput">
                    <select id="transfermode">
                        <option value="0">Blind</option>
                        <option value="1">Attended</option>
                    </select>
                    <input id="transfersearch" name="search" />
                </div>
                <button id="transferok"></button>
            </div>
            <div class="transferdetail"></div>
            <div class="transferdetail"></div>
        </div>
        <div id="transferlist"></div>
    </div>
    <div id="detailsdiv">
        <div class="closecontain"><button id="detailsback"></button></div>
        <div class="poptitlediv"><span>Details</span></div>
        <div id="detailscontent">
            <div id="lineinfo">
                <img id="detailsarrow" src="../img/call/details_arrow.png" width="9px" height="12px"/>
            </div>
            <div id="linedetails">
                <div id="ipvconfdetails" style="display:none;margin-top: 10px;border-bottom:1px solid #e1e1e1;">
                    <div class="ipvconfdivs">
                        <span id="a_ipvconftitle" class="ipvconfdes">Subject</span>: <span id="ipvconftitle" class="ipvconfcontent" style="max-width:440px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;"></span>
                    </div>
                    <div class="ipvconfdivs">
                        <span id="a_ipvconfnumber" class="ipvconfdes">Meeting ID</span>:<span id="ipvconfnumber" class="ipvconfcontent"></span>
                    </div>
                    <div class="ipvconfdivs">
                        <span id="a_ipvconfhost" class="ipvconfdes">Host</span>:<span id="ipvconfhost" class="ipvconfcontent">IPVideoTalk</span>
                    </div>
                    <div class="ipvconfdivs">
                        <span id="a_ipvconfpass" class="ipvconfdes">Password</span>:<span id="ipvconfpass" class="ipvconfcontent"></span>
                    </div>
                    <div class="ipvconfdivs">
                        <span id="a_ipvconfurl" class="ipvconfdes">URL</span>:<span id="ipvconfurl" class="ipvconfcontent"></span>
                    </div>
                    <div class="ipvconfdivs">
                        <span id="a_ipvconfhostcode" class="ipvconfdes">Host code</span>:<span id="ipvconfhostcode" class="ipvconfcontent"></span>
                    </div>
                    <div class="ipvconfdivs" id="regiondivs">
                        <span id="a_ipvconfregion" class="ipvconfdes">Server area</span>:<span id="ipvconfregion" class="ipvconfcontent"></span>
                    </div>
                    <div class="ipvconfdivs" id="pstndivs" style="margin-bottom:10px;">
                        <span id="a_ipvconfpstn" class="ipvconfdes" style="display: block; float: left;">Join by phone</span>
                        <span style="display: block; float: left;">:</span>
                        <span id="ipvconfpstn" class="ipvconfcontent" style="max-width: 440px;"></span>
                    </div>
                </div>
                <div id="detailstitle">
                    <div id="detailsend"><div><span id="a_detailsend">Send</span>&nbsp;:&nbsp;</div><div><span id="detailsendnum">0</span>Kbps</div></div>
                    <div id="detailreceive"><div><span id="a_detailreceive">Receive</span>&nbsp;:&nbsp;</div><div><span id="detailreceivenum">0</span>Kbps</div></div>
                </div>
                <div class="onedetails" style="display: none;">
                    <div class="videodetail">
                        <div class="titlediv"><span>Video</span></div>
                        <div class="sendinfo">
                            <div class="lostdiv">
                                <span class="spantitle">Packet Loss Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="bitratediv">
                                <span class="spantitle">Video Bit Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="fpsdiv">
                                <span class="spantitle">Frames Per Second</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="codecdiv">
                                <span class="spantitle">Preferred Video Codec</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="resolutiondiv">
                                <span class="spantitle">Resolution</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                        </div>
                        <div class="receinfo">
                            <div class="lostdiv">
                                <span class="spantitle">Packet Loss Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="bitratediv">
                                <span class="spantitle">Video Bit Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="fpsdiv">
                                <span class="spantitle">Frames Per Second</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="codecdiv">
                                <span class="spantitle">Preferred Video Codec</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="resolutiondiv">
                                <span class="spantitle">Resolution</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                        </div>
                    </div>
                    <div class="audiodetail">
                        <div class="titlediv"><span>Audio</span></div>
                        <div class="sendinfo">
                            <div class="lostdiv">
                                <span class="spantitle">Packet Loss Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="bitratediv">
                                <span class="spantitle">Audio Bit Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="codecdiv">
                                <span class="spantitle">Audio Codec</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                        </div>
                        <div class="receinfo">
                            <div class="lostdiv">
                                <span class="spantitle">Packet Loss Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="bitratediv">
                                <span class="spantitle">Audio Bit Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="codecdiv">
                                <span class="spantitle">Audio Codec</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                        </div>
                    </div>
                    <div class="presentdetail" style="display: none;">
                        <div class="titlediv"><span>Presentation</span></div>
                        <div class="sendinfo">
                            <div class="lostdiv">
                                <span class="spantitle">Packet Loss Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="bitratediv">
                                <span class="spantitle">Video Bit Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="fpsdiv">
                                <span class="spantitle">Frames Per Second</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="codecdiv">
                                <span class="spantitle">Preferred Video Codec</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="resolutiondiv">
                                <span class="spantitle">Resolution</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                        </div>
                        <div class="receinfo">
                            <div class="lostdiv">
                                <span class="spantitle">Packet Loss Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="bitratediv">
                                <span class="spantitle">Video Bit Rate</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="fpsdiv">
                                <span class="spantitle">Frames Per Second</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="codecdiv">
                                <span class="spantitle">Preferred Video Codec</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                            <div class="resolutiondiv">
                                <span class="spantitle">Resolution</span>
                                <span class="spansign">:</span>
                                <span class="spancontent"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="noticetip"><div class="noticeicon"></div><div id="noticetipmsg"></div></div>
    <div class="disablediv">
    </div>
    <div id="detailDiv"></div>
    <p id="operatetip"><span class="opcontent"></span></p>
    <div id="callingtips"><span class="callingcontent"></span></div>
    <p id="tips"><span class="tipcontent">Add members list</span><span class="tipsimg"></span></p>
    <div id="bottombtn">
        <div class="confbasebtn">
            <button id="confcontrol" name="Conf Control" class="confbtmbtn"></button>
            <button id="record" name="Record" isrecord="1" class="confbtmbtn"></button>
            <button id="addmember" name="Add Members" class="confbtmbtn"></button>
            <button id="dnd" name="DND" dndstate="0" isdnd="1" class="confbtmbtn"></button>
            <button id="confdnd" name="Lock" dndstate="0" isdnd="2" class="confbtmbtn"></button>
            <!--button id="pincode" name="Pin Code" class="confbtmbtn"></button-->
            <button id="DTMF" name="DTMF" class="confbtmbtn"></button>
            <button id="details" name="Details" isshow="0" class="confbtmbtn"></button>
            <button id="handsup" name="Handsup" class="confbtmbtn"></button>
            <button id="close" name="Close" class="confbtmbtn"></button>
        </div>
        <div class="confctrlbtn">
            <button id="pause" name="Hold" ishold="1" class="confbtmbtn"></button>
            <!--button id="muteall" name="Mute All" ismuteall="0" class="confbtmbtn"></button>
            <button id="blockall" name="Block All" isblockall="0" class="confbtmbtn"></button>
            <button id="suspendall" name="Suspend All" issuspendall="0" class="confbtmbtn"></button-->
            <button id="layout" name="Layout" class="confbtmbtn"></button>
            <button id="present" name="Presentation" ison="0" class="confbtmbtn"></button>
            <button id="switchvideosource" name="Switch To Sub Stream" ison="0" class="confbtmbtn"></button>
            <button id="closeconfctrl"></button>
        </div>
        <!--
        <div>
            <button id="pause" name="Hold" ishold="1"></button>
        </div>
        <div>
            <button id="localmute" name="Mute" ismute="1"></button>
        </div>
        <div>
            <button id="closecamera" isclose="1" name="Close the camera"></button>
        </div>
        <div>
            <button id="record" name="Record" isrecord="1"></button>
        </div>
        <div>
            <button id="addmember" name="Add Members"></button>
        </div>
        <div>
            <button id="addnewcall" name="Add Call"></button>
        </div>
        <div>
            <button id="dnd" name="DND" isdnd="0"></button>
            <button id="confdnd" name="DND" isdnd="2"></button>
        </div>
        <div>
            <button id="present" name="Presentation" ison="0"></button>
        </div>
        <div>
            <button id="DTMF" name="DTMF"></button>
        </div>
        <div style="display:none;">
            <button id="caption" name="Caption"></button>
        </div>
        <div>
            <button id="switchvideosource" name="Switch To Sub Stream" ison="0"></button>
        </div>
        <div>
            <button id="details" name="Details" isshow="0"></button>
        </div>
        <div>
            <button id="close" name="Close"></button>
        </div>
    -->
    </div>
    <div id="dtmfDiv">
        <div class="closecontain"><button id="closedtmf"></button></div>
        <div id="dtmfinput">
            <!--<input type="text" />-->
            <p align="right"></p>
            <span id="dtmfcursor"></span>
        </div>
        <div id="dtmfdial">
            <div class="dtmfkeypad"><span>1</span></div>
            <div class="dtmfkeypad midkeypad"><span>2</span></div>
            <div class="dtmfkeypad"><span>3</span></div>
            <div class="dtmfkeypad"><span>4</span></div>
            <div class="dtmfkeypad midkeypad"><span>5</span></div>
            <div class="dtmfkeypad"><span>6</span></div>
            <div class="dtmfkeypad"><span>7</span></div>
            <div class="dtmfkeypad midkeypad"><span>8</span></div>
            <div class="dtmfkeypad"><span>9</span></div>
            <div class="dtmfkeypad"><span class="dtmfspchar">*</span></div>
            <div class="dtmfkeypad midkeypad"><span>0</span></div>
            <div class="dtmfkeypad"><span>#</span></div>
        </div>
    </div>
    <div id="selectvideodiv" class="dragpopdiv">
        <div class="closecontain"><button class="closecalldiv" style="display:none;"></button></div>
        <div class="poptitlediv"><span>Inviting you for a video call</span></div>
        <div id="selectlist">

        </div>
        <div class="selectbtn">
            <button id="accpvideo">Accpet</button>
            <button id="rejectvideo">Reject</button>
        </div>
    </div>
    <div id="transferlinediv" class="dragpopdiv">
        <div class="poptitlediv"><span>Prompt</span></div>
        <div id="transferselectlist">

        </div>
        <div class="selectbtn">
            <button id="transfernext">Trasnsfer</button>
            <button id="transferpopcancel" class="cancelbtn">Cancel</button>
            <button id="attendcancel" class="cancelbtn">Cancel</button>
            <button id="transferdetach" class="cancelbtn">Split</button>
        </div>
    </div>
    <div id="presentselect" class="dragpopdiv">
        <div class="closecontain"><button class="closecalldiv"></button></div>
        <div class="poptitlediv"><span id="a_presentselect">Presentation Type</span></div>
        <div id="presentflow" class="presentitem">
            <div id="preflow" class="presentlabel">Presentation flow settings: </div>
            <div class="presentlist">
                <select id="presentmode">
                    <option value="1">Auto</option>
                    <!--option value="3">PC</option-->
                    <option value="0">Close</option>
                </select>
            </div>
        </div>
        <div class="selectbtn">
            <button id="presentsave">Save</button>
            <button id="presentcancel" class="cancelbtn">Cancel</button>
        </div>
    </div>
    <div id="dndselect" class="dragpopdiv">
        <div class="closecontain"><button class="closecalldiv"></button></div>
        <div class="poptitlediv"><span>DND</span></div>
        <div id="dndlist">
            <select id="dndmode">
                <option value="0">Off</option>
                <option value="1">On</option>
                <option value="2">Block Calls Not From Schedule</option>
            </select>
        </div>
        <div class="selectbtn">
            <button id="dndsave">Save</button>
            <button id="dndcancel" class="cancelbtn">Cancel</button>
        </div>
    </div>
    <div id="pincodediv" class="dragpopdiv">
        <div class="closecontain"><button class="closecalldiv"></button></div>
        <div class="poptitlediv"><span id="a_pincode">PIN Code</span></div>
        <div style="margin:0 25px 0 20px;height:50px;">
            <input id="newpincode" name="newpincode" type="text" maxlength="10" style="height: 30px; width: 100%;" />
            <span id="a_pincodetip" style="font-size:12px;color:red;display:none;">PIN Code must be an integer!</span>
        </div>
        <div class="selectbtn">
            <button id="pincodesave">Save</button>
            <button id="pincodecancel" class="cancelbtn">Cancel</button>
        </div>
    </div>
    <div id="continuerecording" class="dragpopdiv">
        <div class="poptitlediv"><span>Prompt</span></div>
        <div id="goonrecording">
            <p></p>
        </div>
        <div class="selectbtn">
            <button id="recordingOK">OK</button>
            <button id="recordingcancel" class="cancelbtn">Cancel</button>
        </div>
    </div>
    <div id="ctrlFECCDiv">
        <div class="closecontain"><button id="closeFECC"></button></div>
        <div class="poptitlediv" id="a_ptz">
            <div class="fecctips"><p id="fecclang">Camera Control</p></div>
            <div class="fecctip"><p id="fecctip" style="font-size:12px;color:red;display:none;"></p></div>
        </div>
        
        <div style="position:absolute; top:65px; left:45px;">
            <div id="feccleft" style="width:307px;display:block;float:left;">
                <div style="height:20px;margin:13px 0 7px 0;"><span id="a_presettitle">Preset</span></div>
                <div id="presetdiv" style="display:block;float:left;border:1px solid #BEC6CC;background:#F4F4F4;border-width:0 0 0 1px;">
                    <div id="presetbtndiv" style="display:none;display:block;position:absolute;left:0;top:40px;z-index:2;width:129px;height:81px;font-size:14px;background:url(../img/call/fecc_background.png) no-repeat;padding:5px 0;" presetid="0">
                        <button id="gotopreset" class="presetbtn" style="border-bottom:1px dashed #DADADA;">Go</button><button id="savepreset" class="presetbtn">Save</button>
                    </div>
                </div>
            </div>
            <div id="ctrldiv" style="display:block;float:right;width:300px;margin-left:20px;">
                <div id="direction" class="normal">
                    <button type="button" id="up" class="ptzctrl" keycode="19" arrowtype="up"></button>
                    <button type="button" id="right" class="ptzctrl" keycode="22" arrowtype="right"></button>
                    <button type="button" id="down" class="ptzctrl" keycode="20" arrowtype="down"></button>
                    <button type="button" id="left" class="ptzctrl" keycode="21" arrowtype="left"></button>
                </div>
                <div class="optionbtn" id="feccoptbtn">                    
                    <!--button type="button" id="MFup" class="ptzfocusctrl" keycode="228" arrowtype="focusfar">MF+</button>
                    <div class="divingline"></div>
                    <button type="button" id="MFdown" class="ptzfocusctrl" keycode="229" arrowtype="focusnear">MF-</button>
                    <div class="divingline"></div-->
                    <div class="zoombtn"><button type="button" id="zoomwide" class="ptzctrl" keycode="168" arrowtype="zoomtele"></button></div>
                    <div class="divingline"></div>
                    <div class="zoombtn"><button type="button" id="zoomtele" class="ptzctrl" keycode="169" arrowtype="zoomwide"></button></div>
                </div>
            </div>
        </div>
    </div>
    <div id="recordSelect">
        <div id="recordtitle">
            <span>Recording Control</span>
            <img src="../img/call/close_dtmf.png" />
        </div>
        <div id="localrcd" class="recordline">
            <div class="rcdicon"></div>
            <div class="rcdlinename">Local Recording</div>
            <div id="localswitch" class="rcdstart"></div>
        </div>
        <div id="ipvtrcd" class="recordline">
            <div class="rcdicon"></div>
            <div class="rcdlinename">Cloud Recording</div>
            <div id="ipvtswitch" class="rcdstart"></div>
        </div>
    </div>
    <div id="layoutdiv">
        <div id="layouttitle"><div id="layouttitletext">Layout</div><div class="closecontain"><button class="closecalldiv"></button></div></div>
        <!--div class="poptitlediv"><div class="layouttips"><p>Try to drop the windows</p></div></div-->
        <div class="layoutmode">
            <ul class="modelist">
                <li mode="sysrcmd"><div class="sysrcmd modediv"></div></li>
                <li mode="overlap"><div class="overlap modediv"></div></li>
                <li mode="childmother"><div class="childmother modediv"></div></li>
                <li mode="pop"><div class="pop modediv"></div></li>
                <!--li class="divisionline"></li>
                <li mode="content" class="withpresent"><div class="presentlayout"></div></li-->
                <li mode="custom" class="custom" style="border:none;"><div class="custommode modediv"></div></li>
            </ul>
        <!--p id="laymodetips"></p-->
        </div>
        <div class="layoutcontainer">
            <!--div class="layoutnumberlist">
            </div>
            <div id="hdmi1div" class="hdmidiv"><div>HDMI 1</div><div class="hdmi_arrow"></div></div>
            <div id="hdmi2div" class="hdmidiv"><div>HDMI 2</div><div class="hdmi_arrow"></div></div>
            <div class="layouttype"></div-->
        </div>
        <div class="selectbtn">
            <button id="layoutSave" class="savebtn">Save</button>
            <button id="layoutCancel" class="cancelbtn">Cancel</button>
        </div>
    </div>
    <input id="web_calldetail" type="text" value='0' style="display:none;"></input>
</body>
<script type="text/javascript">
    var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
    }
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");

</script>
<script type="text/javascript">
var mTabnum = 0;
var mConfmemeber_num = 0;
var mConfmemeber_maxnum = 1;
var mAddmember_maxnum = mConfmemeber_maxnum;
var mIsreduce = false;
var mConfid = "conf";
var mOnewayid = "onewaycall";
var mContactdivObj;
var mConfnumlist="";
var mConfacctlist = "";
var mContactsObj = new Object();//store contacts member
var mRequest = new Object();
var mDisableconf;
var mjsfontColor;
var mjsbgColor;
var mTimeout = 14*60*1000;//14 minutes
var mselacct = -1;
var mInvitemun = 0;
var mCalllogItems = "";
var mContactitems = "";
var mDateObj = new Date();
var mTransferlistdiv = $("#transferlist");
var mPingtimeout = 0;
var mInttimeout;
var mIntpingout;
var mBFCPObj = {};
var $mBusyline = $("#busylinenum",window.parent.document);
var mBusylinenum = 0;
var mUse24Hour = 1;
var mIncalldtmf = "0";
var mDTMFstr = "";
var mReplacement = unescape('%u25CF');// hide DTMF string
var mClicktimes = 0;  
var mPreClickTime ;  
var mCurrentClickTime;
var mAttendtransferMode = 0;
var mIPtest = /^([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/;
var mCalloutObj = {};
var mVideoOn_obj = {};
var mContinueRecording = 0;
var mLineState = {};
var mCF_number = "";//callfeature number
var mFECCState = {};//all line fecc is supported or not
var mAccountNames = [];
var mAccountActive = new Array("1", "1", "1", "0");
var mSIPAccountID = "SIP";
var mTipTimeout;
var mCheckedmembernum = 0;
var misBFCPSupport = false;//means:some line can support BFCP
var mIPVConfNumber = "";
var mIsIPVConf = false;
var mIPVPrefix = "90";
var mSendWholeBit = 0;
var mRecvWholeBit = 0;
var mSuspending = false;
var MAXPRESETNUM = 15;
var mSaveingPreset = false;
var mOEMID = '0';
var mProduct = "GVC3200";
var autoanswerFlag = false;
var autoanswer= {};
var mCurhdmi = 1;
var mHdmi2state = 0;
var mHdmiModeContent = new Array();
var mIsSysrcmd = 0; /*judge layout mode is system recommand mode or not*/
var mIsSysrcmdBefore = 0;
var mConfrole;  //0-normal 1-guest 2-host 3-panelists
var promptTxt = "";
var mInterval;
var is4kon = false;
var isallowipvtrcd = false;
var videocodec = 0;  // 0-video codec is not H.265  1-video codec is H.265

var req_items = new Array;
req_items.push(
    new ReqItem("web_calldetail", ":web_calldetail", "")
);
mAccountNames[0] = mSIPAccountID;
mAccountNames[3] = "H.323";
mRequest = GetRequest();

$(window).load(function() {
    //var pingtimeout = 7*60*1000;//7 minutes
    
    
    function cb_getconnectstate()
    {
        var action = "action=getconnectstate&time="+ new Date().getTime();
        $.ajax ({
            type: 'get',
            url:'/manager',
            data:action,
            dataType:'text',
            success:function(data) {
                var msgs = res_parse_rawtext(data);
                cb_if_auth_fail(msgs);
                clearInterval(mInttimeout);
                if(msgs.headers['timeout'] != undefined)
                {  
                    mPingtimeout = msgs.headers['timeout'] * 1000;    
                    if(mPingtimeout == 0)
                    {
                        window.parent.location.href = '/login.html';
                        throw "exit";
                    }
                }
                else
                {
                    mPingtimeout = 7*60*1000;
                }        
                mInttimeout = setInterval(function(){cb_getconnectstate();},mPingtimeout);
            },
            error:function(xmlHttpRequest, errorThrown) {
                cb_networkerror(xmlHttpRequest, errorThrown);
            }
        });
    }
    cb_getconnectstate();
});

$(function(){
    mProduct = $("#promodel", window.parent.document).val();
    mConfmemeber_maxnum = $("#maxlinenum", window.parent.document).val();
    mAddmember_maxnum = mConfmemeber_maxnum;
    if( mProduct == "GVC3202" ){
        mConfmemeber_maxnum = 2;
        mAddmember_maxnum = 2;
    }
    mOEMID = $('#existcolore', window.parent.document).val();
    if( mOEMID == '54' ){
        $("#addmember").hide();
        $("#pause").hide();
        $(".confbasebtn").css("width", "490px");
        $(".confctrlbtn").css("margin-left", "-245px");
    }else{
        $("#addmember").show();
        $(".confbasebtn").css("width", "590px");
        $(".confctrlbtn").css("margin-left", "-300px");
    }
    translate_page();
    mDisableconf = $("#disconfstate", window.parent.document).val();
    mContactdivObj = document.getElementById('contactsdiv');
    var calltype = mRequest["calltype"];
    var containHeight = window.parent.document.body.clientHeight-135;
    var addmemberheight = containHeight-340;
    var transferlistHeight = containHeight-310;
    $("#addmemberdiv").css("height",containHeight-110).css("margin-top",-(containHeight-120)/2);
    $("#detailsdiv").css("height",containHeight-100).css("margin-top",-(containHeight-120)/2);
    $("#contactsdiv").css("height",addmemberheight);
    $("#transferlist").css("height",transferlistHeight);
    $("#detailDiv").css("height",addmemberheight).css("margin-top",-(addmemberheight+30)/2 +"px");
    $("#contactsdiv").empty();
    $("#operatetip").css("margin-top",window.parent.document.body.clientHeight-280);
    $(".noticetip,.disablediv,#confdnd").hide();
    $("#tips,#operatetip").hide();
    $("#tabs").tabs({
        collapsible: true
    });
    $("#callmodeselect, #callvideoselect").show();
    $("#callvideoselect").sSelect({ddMaxHeight: '54px'});
    var disipcall = $("#disipcall",window.parent.document).val();
    if(disipcall == "1")
    {
        $("#callmodeselect option:eq(1)").remove();
        $("#callmodeselect").sSelect({ddMaxHeight: '54px'});
    }else{
        $("#callmodeselect").sSelect();
    }
    
    $("#callmodeselect").getSetSSValue("0");
    if(disipcall == "1")
        $("#callmodediv .newListSelected ul.newList").addClass("disipcall");
    if(window.parent.mAutovideo == "0")
        $("#callvideoselect").getSetSSValue("0");
    else
        $("#callvideoselect").getSetSSValue("1");
    $("#transferdiv,#dndselect").show();
    $("#transfermode,#dndmode").sSelect();
    $("#transferdiv,#dndselect,#callmodeselect,#callvideoselect").hide();

    if(calltype == 0)
    {
        $(".noticetip,.disablediv").show();
        $("#bottombtn button").attr("disabled","disabled").addClass("btndisabled");
    }
    //init busyline
    mBusylinenum = 0;
    setBusylinenum(); 
    //initfnBlock();
    var linenum = 0
    for(;linenum < mConfmemeber_maxnum;linenum++)
    {
        mLineState[linenum] = 0;
    }
    pageEventActions();
    cb_get_action('status&region=status');
    get_contact();
    cb_get_action("get&var-0000=:gui_calldetail");
    //get_normal_calllog(2, 0);
    window.parent.get_initws();
});

function create_preset_div(line){
    $("#presetdiv").children(".imgdiv").remove();
    if(line != -1){
        var presetDivObj = document.getElementById('presetdiv');
        for(var i = 0; i < MAXPRESETNUM; i++){
            var imgdiv = document.createElement('DIV');
            imgdiv.id = "presetdiv" + i;
            imgdiv.className='imgdiv';
            imgdiv.setAttribute("preset",i);
            var idspan = document.createElement('SPAN');
            idspan.id = "presetnum" + i;
            idspan.className = "noIMG";
            idspan.innerHTML = (i + 1);
            imgdiv.appendChild(idspan);
            presetDivObj.appendChild(imgdiv);
            
            if(i < 3){
                $("#presetdiv" + i).css("border-top", "1px solid #BEC6CC");
            }
        }
        
        $("#ctrlFECCDiv").css({"width":"690px", "height":"450px"});
        $("#feccleft").css("width", "312px");
        $(".imgdiv").hover(function(){
            var selpos = $(this).attr("preset");
            var top = parseInt(selpos / 3) * 59 + 29;
            var left = selpos % 3 * 103 - 14;
            $("#presetbtndiv").css("top", top).css("left", left).attr("presetid", selpos).fadeIn(500);
        });
    }
    else{
        var presetDivObj = document.getElementById('presetdiv');
        for(var i = 0; i < 24; i++){
            var imgdiv = document.createElement('DIV');
            imgdiv.id = "presetdiv" + i;
            imgdiv.className='imgdiv';
            imgdiv.setAttribute("preset",i);
            var idspan = document.createElement('SPAN');
            idspan.id = "presetnum" + i;
            idspan.className = "noIMG";
            idspan.innerHTML = (i + 1);
            imgdiv.appendChild(idspan);
            presetDivObj.appendChild(imgdiv);
            
            if(i < 4){
                $("#presetdiv" + i).css("border-top", "1px solid #BEC6CC");
            }
        }
        $("#ctrlFECCDiv").css({"width":"780px", "height":"500px"});
        $("#feccleft").css("width", "414px");
        $(".imgdiv").hover(function(){
            var selpos = $(this).attr("preset");
            var top = parseInt(selpos / 4) * 59 + 29;
            var left = selpos % 4 * 103 - 14;
            $("#presetbtndiv").css("top", top).css("left", left).attr("presetid", selpos).fadeIn(500);
        });
    }
    
    $("#presetdiv").hover(function(){
    },function(){
        $("#presetbtndiv").fadeOut(500);
    });
}
/*
This function is used for handleing call dbus, about ringing, calling, connected, end and so on.
*/
function handle_callmessage(data,obj_incominginfo)
{
    var state = parseInt(data.state);
    //console.log('handle_callmessage, state = ' + state + ',line = ' + data.line);
    switch(state)
    {
        case 0://end calling    
            var line = data.line;
            if(obj_incominginfo[line] != undefined)
                window.parent.del_obj_incominginfo(line);
            mLineState[line] = 0;
            mCalllogItems = "";//for getting new calllog
            if(videocodec)
                videocodec = 0;

            if($("#incomingcall",window.parent.document).is(":visible") || mTabnum > 0)
            {
                //if iframe#incomingcall is show, there has one or more calling be accepted
                var endflag = endcalling(data);
                var numtabs = mTabnum;
                if(endflag == 1)
                {
                    window.parent.showincominglist(false,data);
                    if($("#incominglist div",window.parent.document).length <= 0)
                    {
                        window.parent.isshowincominglist(false);
                        if($("#incomingcall",window.parent.document).is(":visible"))
                            $("#rightsidebtn #meettingdiv img",window.parent.document).attr("src","img/call/meeting_control_setback_button_unpressed.png").attr("alt","setback");
                        else
                            $("#rightsidebtn #meettingdiv img",window.parent.document).attr("src","img/call/meeting_control_open_button_unpressed.png").attr("alt","open"); 
                    }
                    mBusylinenum--;
                    setBusylinenum(); 
                    if(mBusylinenum >=mConfmemeber_maxnum && mDisableconf == "0")
                        $("#addmember").removeAttr("disabled");
                }
                var showvideosource = false;
                if(mDisableconf == "0")
                {
                    var blocknum = 0;
                    var suspendnum = 0, videonum = 0,mutenum = 0,notholdline_num = 0;
                    var ishasvideo = false;
                    var allbfcpsupport = true;
                    var videoline_notbfcp = false;
                    var bfcp = $("#present").attr("bfcp");
                    var isbfcpon = $("#present").attr("ison");
                    $("#conf div.remoteline").each(function(){
                        var isvideo = $(this).attr("isvideo");
                        var bfcpstate = $(this).attr("bfcpstate");
                        if (bfcpstate != "1" && bfcpstate != "3" && bfcpstate != "4" && bfcpstate != "5" && allbfcpsupport) {
                            allbfcpsupport = false;
                        }
                        if(isvideo == "1" && bfcpstate == "0" && !videoline_notbfcp)
                        {
                            videoline_notbfcp = true;
                        }
                        if(isvideo == "1")
                        {
                            ishasvideo = true;
                            if( $(this).attr("account") != "8" ){
                                videonum++;
                                if($(this).find(".confsuspend").attr("issuspend") == "1" && $(this).attr("remotehold") != "1")
                                    suspendnum++;
                            }
                        }
                        if($(this).attr("remotehold") != "1")
                        {
                            notholdline_num++;
                        }
                        if(isvideo == "1" && bfcp != "2")
                        {
                            showvideosource = true;
                        }
                        if($(this).find(".confblock").attr("isblock") == "1" && $(this).attr("remotehold") != "1")
                            blocknum++;
                        if($(this).find(".mute").attr("ismute") == "0" && $(this).attr("remotehold") != "1")
                            mutenum++;
                    });
                    if(isbfcpon == "1")
                    {
                        if(allbfcpsupport)
                            showvideosource = false;
                        else if(videoline_notbfcp){
                            showvideosource = true;
                        }
                    }
                    /*if(ishasvideo)
                    {
                        $("#suspendall").show();
                    }
                    else
                    {
                        $("#suspendall").hide();
                    }*/
                    $("#blockall").attr("name",a_10132).attr("isblockall","0").removeClass("active");
                    $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
                    $("#muteall").attr("ismuteall","0").attr("name",a_10130).removeClass("active");
                    if(blocknum == notholdline_num && blocknum != 0)
                    {
                        $("#blockall").attr("name",a_10133).attr("isblockall","1").addClass("active");
                    }
                    if(mutenum == notholdline_num && mutenum != 0)
                    {
                        $("#muteall").attr("ismuteall","1").attr("name",a_10131).addClass("active");
                    }
                    if(suspendnum == videonum && suspendnum != 0)
                    {
                        $("#suspendall").attr("name",a_10135).attr("issuspendall","1").addClass("active");
                    }
                }
                if(numtabs == 0)
                {
                    if(!$(".noticetip").is(":visible"))
                    {
                        window.parent.isopenincall(false);
                    }
                    if($("#detailsdiv").is(":visible"))
                    {
                        $("#detailsback").click();
                    }
                    $("#closeconfctrl").click();
                    $(".noticetip,.disablediv").show();
                    $("#present").show();
                    showvideosource = true;
                    $("#present").attr("ison",0).removeClass("active").removeAttr("bfcp").removeAttr("bfcpline").removeAttr("bytype").attr("name",a_10002+" "+a_10004);
                    $("#tips,#addmemberdiv,#dtmfDiv,#detailsdiv,#dndselect,#presentselect,#layoutdiv").hide();
                    $("#dtmfinput p").html("");
                    $("#bottombtn button").attr("disabled","disabled").addClass("btndisabled").removeClass("buttonover").removeClass("active");
                    $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
                    $("#blockall").attr("name",a_10132).attr("isblockall","0").removeClass("active");
                    $("#muteall").attr("ismuteall","0").attr("name",a_10130).removeClass("active");
                    $("#pause").attr("ishold",1);
                    $("#tabs").tabs("destroy");
                    $("#tabs").tabs({
                        collapsible: true
                    });
                    if(window.parent.mAutovideo == "0")
                        $("#callvideoselect").getSetSSValue("0");
                    else
                        $("#callvideoselect").getSetSSValue("1");
                    $("#acctselect,#callmodeselect").getSetSSValue("0");
                    mAttendtransferMode = 0;
                    mContinueRecording = 0;
                    mAddmember_maxnum = mConfmemeber_maxnum;
                    mIsreduce = false;
                    mIsIPVConf = false;
                    if( mProduct == "GVC3202" ){
                        mConfmemeber_maxnum = 2;
                        mAddmember_maxnum = 2;
                        $("#hasipvt", window.parent.document).val("0");
                        $("#disableipvt",window.parent.document).val("0");
                        $("#maxlinenum",window.parent.document).val('2');
                    }
                    mVideoOn_obj = {};
                    mFECCState = {};
                    $("#selectvideodiv,#transferlinediv,#continuerecording").hide();
                    ctrl_show_maskdiv(false);
                    clearInterval(mIntpingout);
                    setTimeout(function(){
                        if(!$("#incomingcall",window.parent.document).is(":visible"))
                        {
                            $("#rightsidebtn #meettingdiv img",window.parent.document).attr("src","img/call/meeting_control_open_button_unpressed.png").attr("alt","open");
                        }
                    },800);
                    mBusylinenum = 0;
                    setBusylinenum();
                }
            }
            else
            {
                //if iframe#incomingcall is hidden, there has no calling be accepted
                window.parent.showincominglist(false,data);
                if($("#incominglist div",window.parent.document).length <= 0)
                {
                    window.parent.isshowincominglist(false);
                    $("#rightsidebtn #meettingdiv img",window.parent.document).attr("src","img/call/meeting_control_open_button_unpressed.png").attr("alt","open");
                }
                mBusylinenum--;
                setBusylinenum(); 
            }     
            $("#jqibox").remove();
            $("#transferdiv[line=\""+line+"\"]").hide();
            change_numlist();   
            if($("#incominglist div",window.parent.document).length <= 0 && mTabnum != 0)
                $("#bottombtn button").removeAttr("disabled").removeClass("btndisabled"); 

            $("#closeFECC").click();
            if(mAttendtransferMode != 0)
            {
                var waitingline = $("#callingtips").attr("line");
                if(data.line == waitingline)
                    $("#callingtips").hide();
            }
            
            if(data.acct == 1){
               handle_promptdiv();
               if($("#recordSelect").is(":visible"))
                   $("#recordSelect").hide();
               $("#recordSelect .rcdstop").addClass("rcdstart").removeClass(".rcdstop");
           }
            
            break;
        case 1:
            break;
        case 2:
            window.parent.showincominglist(true,data);
            mLineState[data.line] = 1;
            if(mAttendtransferMode != 0)
            {
                var tipstr = a_658 + "  " + data.name;
                $("#callingtips .callingcontent").text(tipstr);
                var marginleft = -($("#callingtips").width())/2 - 70 + "px";
                $("#callingtips").attr("line",data.line).css("margin-left",marginleft).show();
            }
            window.parent.isshowincominglist(true);
            mBusylinenum++;
            setBusylinenum();
            if(mBusylinenum >=mConfmemeber_maxnum && mDisableconf == "0")
                $("#addmember").attr("disabled","disabled");

            $("#bottombtn button").attr("disabled","disabled").addClass("btndisabled");
            $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
            $("#blockall").attr("name",a_10132).attr("isblockall","0").removeClass("active");
            break;
        case 3: //calling out
            var dataline = data.line;
            var isexist = 0;
            mLineState[dataline] = 1;

            // for(var i in obj_incominginfo)
            // {
            //     if(i == dataline)
            //     {
            //         isexist = 1;
            //         return;
            //     }
            // }
            if(isexist == 0)
            {
                obj_incominginfo[dataline] = data;

                /*if(mContactitems != undefined)
                {
                    for(var i=0;mContactitems[i] != undefined;i++)
                    {
                        //get the name of incoming call 
                        var number = mContactitems[i].Number;
                        number = number.replace(/\s/g,"");
                        if(number == data.num)
                            data.name = mContactitems[i].Name;
                    }
                }
                if(data.oldstate == "8")
                {
                    if(mCalloutObj != undefined)
                    {
                        data.name = mCalloutObj.name;
                        data.num = mCalloutObj.num;
                    }
                }*/
                mCF_number = data.num;
                if(data.name == "")
                    data.name = data.num;

                //if($("#incomingcall")[0].contentWindow.judge_addmemeber(data.num,data.acct))
                if(mDisableconf == "0" && data.oldstate != "8")
                    addtoconf(data);
                
                setTimeout(function(){
                    if($("#rightsidebtn #meettingdiv img",window.parent.document).attr("alt") != "setback")
                    {
                        window.parent.isopenincall(true);
                    }
                },800);
                
                $("#blockall").attr("name",a_10132).attr("isblockall","0").removeClass("active");
                $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
                $("#muteall").attr("ismuteall","0").attr("name",a_10130).removeClass("active");
            }
            break;
        case 4:
            clearInterval(mIntpingout);
            mIntpingout = setInterval(function(){cb_ping();},mTimeout);
            var objnumber = 0;
            var i;
            var line = data.line;
            var msg = data.msg;
            
            if(parseInt(msg) >= 16 && parseInt(msg) < 64)
                videocodec = 0;
            else if(parseInt(msg) >= 64 && parseInt(msg) < 253)
                videocodec = 1;
                
            if(autoanswerFlag && data.name == "" && data.num == ""){
                if(autoanswer.name == "")
                    data.name = autoanswer.num;
                else
                    data.name = autoanswer.name;
                data.num = autoanswer.num;
            }
            
            mLineState[line] = 1;
            if($("#conf div[line=\""+line+"\"]").length <= 0){
                addtoconf(data);
                //window.parent.addtoconf_callback(line,4,data);
                if($("#rightsidebtn #meettingdiv img",window.parent.document).attr("alt") != "setback")
                {
                    window.parent.isopenincall(true);
                }
            }else if( mProduct == "GVC3202" && data.acct == '1' && data.realstate == '8' ){
                var ipvConf = "";
                if( data.num != undefined && data.num != "" )
                    ipvConf = data.num.substring(0,2);
                else
                    ipvConf = $("#conf div[line=\""+line+"\"]").attr("number");
                if(ipvConf == mIPVPrefix){
                    mConfmemeber_maxnum = 2;
                    mAddmember_maxnum = 2;
                    $("#hasipvt", window.parent.document).val("0");   
                    $("#maxlinenum",window.parent.document).val('2');
                }
            }
            if($("#selectlist div[line=\""+line+"\"]").length > 0)
            {
                $("#selectlist div[line=\""+line+"\"]").remove();
                var isfirst = 0;
                $("#selectlist .inputcbx").each(function(){
                    if(isfirst == 0)
                    {
                        $(this).attr("checked","checked");
                        isfirst = 1;
                    }
                    else
                        $(this).removeAttr("checked");
                });
            }

            if(mAttendtransferMode == 0 && data.oldstate != 5)
            {
                //$("#transfermaskdiv").fadeOut();
                $("#loadingDiv").hide();
                //$("#rightsidebtn #meettingdiv img",window.parent.document).css("z-index","999");
                $("#incomingcalldiv",window.parent.document).css("z-index","1002");
                $("#callingtips").hide();
            }
            if(mAttendtransferMode == 1 && data.oldstate != 5)
            {
                $("#transferlinediv .selectbtn button").hide();
                $("#transfernotice").text(a_635);
                $("#transfernext, #transferdetach,#transferlinediv").show();
            }

            for( i in obj_incominginfo)
                objnumber++;
            if(objnumber > 0)
            {
                var webaccept = 0;
                $("#incominglist div.itemdiv",window.parent.document).each(function(){
                    if($(this).attr("line") == line)
                    {
                        webaccept = 1;
                        if(mDisableconf == "0")
                        {
                            window.parent.obj_incominginfo[line].msg = msg;
                            window.parent.addtoconf_callback(line,4);
                        }
                        else
                        {
                            window.parent.obj_incominginfo[line].msg = msg;
                            window.parent.accept_callback(objnumber, line,4);
                        }
                    }
                });
                if(webaccept == 0)
                {
                    if(mDisableconf == "1")
                    {
                        acceptorcallout(data,1);
                    }
                    change_callconnectstate(data);
                    window.parent.del_obj_incominginfo(line);
                }
            }
            else{
                //var line = data.line;console.log("call");
                change_callconnectstate(data);
            }
            if(data.oldstate != 5)
                setconfpause_callback(data);
            var incomglength = $("#incomingcalldiv #incominglist div",window.parent.document).length;
            if(objnumber == 0 || incomglength <= 0)
            {    
                $("#bottombtn button").removeAttr("disabled").removeClass("btndisabled");
                window.parent.isshowincominglist(false);
            }
            if(mConfmemeber_num >=mConfmemeber_maxnum)
            {
                if(!hasIPVNumber())
                    $("#addmember").attr("disabled", "disabled");
                $("#addnewcall").attr("disabled","disabled");
            }
            /*if(mDisableconf == "0")
            {
                //do not need to re-check if show #switchvideosource as already check in change_callconnectstate --by ahluo 20150910 bug 49986
                var showvideosource = false;
                $("#conf div.remoteline").each(function(){
                    var isvideo = $(this).attr("isvideo");
                    var bfcp = $("#present").attr("bfcp");
                    if(isvideo == "1" && bfcp != "2")
                    {
                        if(!misBFCPSupport){
                            showvideosource = true;
                        }
                        return false;
                    }
                });
                if( showvideosource )
                    $("#switchvideosource").show();
                else
                    $("#switchvideosource").hide();
            }*/
            break;
        case 5:
            if(mDisableconf == "1")
            {
                data.state = 4;
                data.oldstate = 5;
                handle_callmessage(data,obj_incominginfo);
                data.state = 5;
                setconfpause_callback(data);
                var incomglength = $("#incomingcalldiv #incominglist div",window.parent.document).length;
                if(incomglength <= 0)
                {    
                    window.parent.isshowincominglist(false);
                }
            }
            else
                setconfpause_callback(data);
            break;
        case 6:
            //transfer
            var res = data.msg;
            if(res == "2")
            {
                //transfer failed
                ctrl_show_maskdiv(false);
                $("#loadingDiv").hide();
                $("#incomingcalldiv",window.parent.document).css("z-index","1002");
                $("#callingtips").hide();
                mAttendtransferMode = 0;
                $("#operatetip span.opcontent").text(a_550);
                $("#operatetip").fadeIn();
                setTimeout(function(){$("#operatetip").fadeOut();},2000);
                if($("#transfernext").attr("mode") == "blind_3")
                {
                    //split
                    $("#transferlinediv").hide();
                    $("#transferback").click();
                }
            }
            break;
        case 7:
            data.state = 0;
            handle_callmessage(data,obj_incominginfo);
            break;
        case 8:
            // data.state = 3;
            // data.oldstate = 8;
            // handle_callmessage(data,obj_incominginfo);
            if(mCalloutObj != undefined)
            {
                data.name = mCalloutObj.name;
                data.num = mCalloutObj.num;
            }
            data.state = 4;
            data.realstate = 8;
            handle_callmessage(data,obj_incominginfo);
            data.state = 8;
            handle_callfailed(data);
            mLineState[data.line] = 0;
            
            if(data.acct == "1"){
                if($("#recordSelect").is(":visible"))
                    $("#recordSelect").hide();
               
                $("#recordSelect .rcdstop").addClass("rcdstart").removeClass(".rcdstop");
               
                if($("#record").hasClass("active"))
                    $("#record").removeClass("active");
            }
            break;
        default:
            break;
    }
    
    showhandsup();
}

/*
This function is used for handleing infomation about lines when refreshing web UI.
*/
function init_conference(data)
{
    var state = parseInt(data.state);
    if( data.acct == '1' && data.name != '' ){
        data.num = data.name;
    }

    switch(state)
    {
        case 2:
            $("#incomingcalldiv",window.parent.document).hide().css("height","auto");
            window.parent.showincominglist(true,data);
            mLineState[data.line] = 1;
            if(mAttendtransferMode != 0)
            {
                var tipstr = a_658 + "  " + data.name;
                $("#callingtips .callingcontent").text(tipstr);
                var marginleft = -($("#callingtips").width())/2 - 70 + "px";
                $("#callingtips").attr("line",data.line).css("margin-left",marginleft).show();
            }
            window.parent.isshowincominglist(true);
            mBusylinenum++;
            setBusylinenum();
            if(mBusylinenum >=mConfmemeber_maxnum && mDisableconf == "0")
                $("#addmember").attr("disabled","disabled");

            $("#bottombtn button").attr("disabled","disabled").addClass("btndisabled");
            break;
        case 3: //calling out
            var dataline = data.line;
            mLineState[line] = 1;
            /*if(mContactitems != undefined)
            {
                for(var i=0;mContactitems[i] != undefined;i++)
                {
                    //get the name of incoming call 
                    var number = mContactitems[i].Number;
                    number = number.replace(/\s/g,"");
                    if(number == data.num)
                        data.name = mContactitems[i].Name;
                }
            }*/
            if(data.name == "")
                data.name = data.num;

            //if($("#incomingcall")[0].contentWindow.judge_addmemeber(data.num,data.acct))
            if(mDisableconf == "0")
                addtoconf(data);
            else
                acceptorcallout(data,1);
            if($("#rightsidebtn #meettingdiv img",window.parent.document).attr("alt") != "setback")
            {
                window.parent.isopenincall(true);
            }
            break;
        case 4:
            clearInterval(mIntpingout);
            mIntpingout = setInterval(function(){cb_ping();},mTimeout);
            var line = data.line;
            var ismute = data.ismute;
            var feccstate = data.feccstate;
            var feccline = data.feccline;
            var remotehold = data.isremotehold;
            mLineState[line] = 1;

            var msg = parseInt(data.videomsg);
            if(msg >= 16 && msg < 64)
                videocodec = 0;
            else if(msg >= 64 && msg < 253)
                videocodec = 1;

            if($("#selectlist div[line=\""+line+"\"]").length > 0)
            {
                $("#selectlist div[line=\""+line+"\"]").remove();
                var isfirst = 0;
                $("#selectlist .inputcbx").each(function(){
                    if(isfirst == 0)
                    {
                        $(this).attr("checked","checked");
                        isfirst = 1;
                    }
                    else
                        $(this).removeAttr("checked");
                });
            }
            if($("#selectvideodiv").is(":visible") && mInvitemun == 0)
                $("#selectvideodiv").hide();

            /*if(mContactitems != undefined)
            {
                for(var i=0;mContactitems[i] != undefined;i++)
                {
                    //get the name of init call 
                    var number = mContactitems[i].Number;
                    number = number.replace(/\s/g,"");
                    if(number == data.num)
                        data.name = mContactitems[i].Name;
                }
            }*/
            var num = data.num;
            var callname = data.name;
            if(callname == "")
                callname = num;
            
            //coming a call
            mDisableconf = $("#disconfstate", window.parent.document).val();
            if(mDisableconf == "0")
                window.parent.addtoconf_callback(line,4,data);
            else
                window.parent.accept_callback(0, line,4,data);
            change_callconnectstate(data);
            if(data.ismute == "1")
                $("#localmute").attr("ismute",0).attr("title",a_659).addClass("unmute active");
            if($("#incominglist div",window.parent.document).length <= 0)
            {
                $("#bottombtn button").removeAttr("disabled").removeClass("btndisabled");
            }
            if(mConfmemeber_num >=mConfmemeber_maxnum)
            {
                if(!hasIPVNumber())
                    $("#addmember").attr("disabled", "disabled");
                $("#addnewcall").attr("disabled","disabled");
            }
            if(data.oldstate != 5)
                handle_holdstate(data);
            if(feccstate == "1")
            {
                var isvideo = $("#line-"+line).attr("isvideo");
                $("#line-"+line).find(".startFECC").attr("issupport","1");
                if(isvideo == "1")
                    $("#line-"+line).find(".startFECC").removeAttr("disabled").removeClass("btndisabled");
            }
            if(feccline != "-2" && feccline != undefined)
            {
                ctrlFECC(feccline,1);
            }
            if(remotehold == "1")
            {
                $("#line-"+line).find(".mute").attr("disabled","disabled").addClass("btndisabled");
                $("#line-"+line).find(".confblock").attr("disabled","disabled").addClass("btndisabled");
                $("#line-"+line).find(".confaudio").attr("disabled","disabled").addClass("btndisabled");
                $("#line-"+line).find(".confvideo").attr("disabled","disabled").addClass("btndisabled");
            }
            $("#line-"+line).attr("remotehold",remotehold);
            //enable block and suspend
            $("#blockall").attr("name",a_10132).attr("isblockall","0").removeClass("active");
            $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
            if(data.isblock == "1")
                $("#line-"+line).find(".confblock").attr("isblock","1").attr("title",a_16702).addClass("active");
            if(data.issuspend == "1")
                $("#line-"+line).find(".confsuspend").attr("issuspend","1").attr("title",a_10077).addClass("active");
            var blocknum = 0;
            var suspendnum = 0 ,videonum = 0,notholdline_num = 0;
            var ishasvideo = false;
            $(".remoteline").each(function(){
                if($(this).attr("remotehold") != "1")
                {
                    notholdline_num++;
                }
                if($(this).find(".confblock").attr("isblock") == "1" && $(this).attr("remotehold") != "1")
                    blocknum++;
                if($(this).attr("isvideo") == "1")
                {
                    ishasvideo = true;
                    if( $(this).attr("account") != "8" ){
                        videonum++;
                        if($(this).find(".confsuspend").attr("issuspend") == "1" && $(this).attr("remotehold") != "1")
                            suspendnum++;
                    }
                }
            });
            if(blocknum == notholdline_num && blocknum != 0)
            {
                $("#blockall").attr("name",a_10133).attr("isblockall","1").addClass("active");
            }
            if(suspendnum == videonum  && suspendnum != 0)
            {
                $("#suspendall").attr("name",a_10135).attr("issuspendall","1").addClass("active");
            }
            /*if(ishasvideo)
            {
                $("#suspendall").show();
            }
            else
            {
                $("#suspendall").hide();
            }*/
            
            setmute_callback(data);
            /*if(mDisableconf == "0")
            {
                var showvideosource = false;
                $("#conf div.remoteline").each(function(){
                    var isvideo = $(this).attr("isvideo");
                    var bfcp = $("#present").attr("bfcp");
                    if(isvideo == "1" && bfcp != "2")
                    {
                        if(!misBFCPSupport){
                            showvideosource = true;
                        }
                        return false;
                    }
                });
                if( showvideosource )
                    $("#switchvideosource").show();
                else
                    $("#switchvideosource").hide();
            }*/
            break;
        case 5:
            data.state = 4;
            init_conference(data);
            data.state = 5;
            handle_holdstate(data);
            break;
        case 8:
            var line = data.line;
            var isvideobefore = data.isvideobefore;
            data.state = 4;
            data.realstate = 8;
            init_conference(data);
            data.state = 8;
            handle_callfailed(data);
            mLineState[data.line] = 0;
            $("#line-"+line).attr("audiovideo",isvideobefore);
            break;
        default:
            break;
    }
}

/*
judge all number is in conference or not.
*/
function isAllInConf(num)
{
    var numarray = num.split(":::");
    var flag = false;
    var i = 0;
    var existnum = 0;
    for(;i<numarray.length;i++)
    {
        $(".remoteline").each(function() {
            var linenumber = $(this).attr("number");            
            var callnum = numarray[i];

            if (callnum.indexOf("#") != -1) {
                callnum = callnum.split("#")[0];
            } else if (callnum.indexOf(".") != -1) {
                callnum = callnum.split(":")[0];
            } else if (callnum.indexOf("]:") != -1) {
                callnum = callnum.split("]:")[0] + "]";
            } else if (callnum.indexOf("]") != -1) {
                callnum = callnum;
            } else {
                callnum = callnum.split(":")[0];
            }

            if (linenumber.indexOf("#") != -1) {
                linenumber = linenumber.split("#")[0];
            } else if (linenumber.indexOf(".") != -1) {
                linenumber = linenumber.split(":")[0];
            } else if (linenumber.indexOf("]:") != -1) {
                linenumber = linenumber.split("]:")[0] + "]";
            } else if (linenumber.indexOf("]") != -1) {
                linenumber = linenumber;
            } else {
                linenumber = linenumber.split(":")[0];
            }

            if(callnum == linenumber && $(this).attr("state") != "8")
            {
                existnum ++;
                return false;
            }
        });
    }    
    if(numarray.length == existnum)
    {
        flag = true;
    }
    return flag;
}

function hasIPVNumber()
{
    var flag = false;
    $(".remoteline").each(function(){
        var acct = $(this).attr("account");
        if(acct == "1")
        {
            flag = true;
            return false;
        }
    });   
    return flag;
}

/*function getConfType()
{
    //type 0:no ipv member, 1:ipv conf and host, 2:ipv conf but not host
    var type = 0;
    $(".remoteline").each(function(){
        var acct = $(this).attr("account");
        var number = $(this).attr("number");
        var state = $(this).attr("state");
        if(acct == "1" && state != "8")
        {
            if(mConfrole == "2")
				type = 1;
			else if(mConfrole == "1")
				type = 2;
        }
    });  
    if( type == 2 ){
        $("#disableipvt",window.parent.document).val("1");
    }else{
        $("#disableipvt",window.parent.document).val("0");
    } 
    return type;
}*/

function isIPVConf()
{
    var flag = false;
    var line;
    $(".remoteline").each(function(){
        var acct = $(this).attr("account");
        if(acct == "1")
        {
            line = $(this).attr("line");
            //flag = true;
            return false;
        }
    });
    if(line != undefined)
        flag = line;
    return flag;
}

function setBusylinenum()
{
    if(mBusylinenum < 0)
        mBusylinenum = 0;
    $mBusyline.val(mBusylinenum);
    var mainmenu = $.cookie( "Mainpage");
    if (mainmenu && mainmenu == "call" ) {
        try{
            window.top.callFrame.updateMaxlineNumber(mBusylinenum, isIPVConf());
        }catch(e)
        {
            setTimeout(function(){setBusylinenum();},200);
        }
    }else{
        //getConfType();
    }
}

/*
This function is used for handleing dbus about video invitation.
*/
function video_Invite(data)
{
    if(data == undefined)
        return false;
    var line = data.line;
    var $inviteline = $("#tabs div[line=\""+line+"\"]");
    var num = $inviteline.attr("number");
    var name = $inviteline.attr("name");    

    var itemdiv = document.createElement("DIV");
    itemdiv.id = num;
    itemdiv.setAttribute("line",line);
    itemdiv.className = "itemdiv";

    var checkdiv = document.createElement('DIV');
    checkdiv.className='itemcheck';
    var checkbox = document.createElement('INPUT');
    checkbox.type = 'checkbox';
    checkbox.className = "inputcbx";
    checkdiv.appendChild(checkbox);
    itemdiv.appendChild(checkdiv);

    var icondiv = document.createElement('DIV');
    icondiv.className='itemicon';
    var itemicon = document.createElement('DIV');
    itemicon.className='appcontacticon';
    icondiv.appendChild(itemicon);
    itemdiv.appendChild(icondiv);
    
    var namediv = document.createElement('DIV');
    namediv.className='itemname';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = htmlEncode(name);
    spantext.setAttribute("title", name);
    namediv.appendChild(spantext);
    itemdiv.appendChild(namediv);
    
    var numberdiv = document.createElement('DIV');
    numberdiv.className='itemtime';
    var numbertext = document.createElement('SPAN');
    numbertext.innerHTML = htmlEncode(num);
    numberdiv.appendChild(numbertext);
    itemdiv.appendChild(numberdiv);

    if($("#selectlist .itemdiv").length > 0)
        $("#selectlist").append(itemdiv);
    else
        $("#selectlist").empty().append(itemdiv);

    mInvitemun++;
    var isfirst = 0;
    $("#selectlist .inputcbx").each(function(){
        if(isfirst == 0)
        {
            $(this).attr("checked","checked");
            isfirst = 1;
        }
        else
            $(this).removeAttr("checked");
    });
    if(!$("#selectvideodiv").is(":visible"))
    {
        $("#selectvideodiv,#accpvideo,#rejectvideo").show();
        ctrl_show_maskdiv(true);
    }
}

function addtoconf(data)
{
    $(".noticetip,.disablediv").hide();
    cb_get_action("get&var-0000=25104");
    
    if(mOEMID != "54")
        $("#pause").show();

    if($("#conf").length <= 0)
    {
        //no conference
        var confheight = window.parent.document.body.clientHeight-280;
        if(data.acct == "1")
            var tabli = "<li class="+mConfid+" line="+mConfid+"><a href='#"+mConfid+"' class="+mConfid+">"+a_309+"</a></li>";
        else
            var tabli = "<li class="+mConfid+" line="+mConfid+"><a href='#"+mConfid+"' class="+mConfid+">"+a_10184+"</a></li>";
        var tabdiv = "<div id="+mConfid+" class="+mConfid+"></div>";

        $("#tabs ul").append(tabli);
        $("#tabs").append(tabdiv).tabs("refresh");
        $("#"+mConfid).css("height",confheight).css("overflow-y","auto");
        mTabnum++;
        addconflist_local();
        addconflist(data,mConfid);
    }
    else
    {//console.log("aaa");
        //conference has been created
        if(data.acct == "1")
            $("a#conf").text(a_309);
        else
            $("a#conf").text(a_10184);
        addconflist(data,mConfid);
    }
    if($("a."+mConfid).parent("li").attr("aria-selected") == "false")
    {
        $("a."+mConfid).click(); 
    }
    
    $("#tabs ul li a").unbind("click").click(function(){return false;});
  
}

function acceptorcallout(data,type)
{
    /**
    type
    0:accept incoming call
    1:calling out
    **/
    if(data == undefined)
        return false;
    
    $(".noticetip,.disablediv").hide();
    $("#pause").parent().hide();
    $("#pause").parent().next("div").css("margin-left","200px");
    if($("#incominglist div",window.parent.document).length <= 0)
        $("#bottombtn button").removeAttr("disabled").removeClass("btndisabled");
    if($("#"+mOnewayid).length <= 0)
    {
        //no call list
        var listheight = window.parent.document.body.clientHeight-280;
        var tabli = "<li class="+mOnewayid+" line="+mOnewayid+"><a href='#"+mOnewayid+"' class="+mOnewayid+">"+a_16660+"</a></li>";
        var tabdiv = "<div id="+mOnewayid+" class="+mOnewayid+"></div>";

        $("#tabs ul").append(tabli);
        $("#tabs").append(tabdiv).tabs("refresh");
        $("#"+mOnewayid).css("height",listheight).css("overflow-y","auto");
        mTabnum++;
        addconflist(data,mOnewayid);
    }
    else
    {
        //conference has been created
        addconflist(data,mOnewayid);
    }
    if($("a."+mOnewayid).parent("li").attr("aria-selected") == "false")
    {
        $("a."+mOnewayid).click();
    }
    
    $("#tabs ul li a").unbind("click").click(function(){return false;});
}
/*
function acceptorcallout(data,type)
{
    /**
    type
    0:accept incoming call
    1:calling out
    **//*
    if(data == undefined)
    return false;
    
    var num = data.num;
    var name = data.name;
    var line = data.line;
    var tabli;
    var tabdiv = "<div id="+num+" class="+line+"></div>"; 

    if($("#tabs div#"+num).length > 0)
        return;

    $(".noticetip,.disablediv").hide();
    $("#bottombtn button").removeAttr("disabled").removeClass("btndisabled");
    if(mDisableconf == "1")
        $("#addmember").attr("disabled","disabled");
    
    if(name == "")
        tabli = "<li class="+line+" line="+line+"><a href=#"+num+" class="+num+">"+htmlEncode(num)+"</a></li>";
    else
        tabli = "<li class="+line+" line="+line+"><a href=#"+num+" class="+num+">"+htmlEncode(name)+"</a></li>";

    $("#tabs ul").append(tabli);
    $("#tabs").append(tabdiv).tabs("refresh");
    mTabnum++;
    settabwidth();
    addconflist(data,num);
    if($("a."+num).parent("li").attr("aria-selected") == "false")
        $("a."+num).click();
}*/

function endcalling(data)
{
    var line = data.line;
    return endcall_callback(line);
}

function update_disable_conf_flag(disconf)
{
    /*
    if GVC disable ipcall, the ipcall option show be removed when choose call mode in addmember
    */
    mDisableconf = disconf;
    var disipcall = $("#disipcall",window.parent.document).val();
    if(disipcall == "1")
    {
        $("#callmodeselect option:eq(1)").remove();
    }
    else if( $("#callmodeselect option").length < 2 )
    {
        var optionstr = "<option value='2'>"+a_506+"</option>";
        $("#callmodeselect").append(optionstr);
    }
    $("#callmodeselect").resetSS({ddMaxHeight: '54px'});
    $("#callmodeselect").getSetSSValue("0");
    if(disipcall == "1")
        $("#callmodediv .newListSelected ul.newList").addClass("disipcall");
}

function update_accountname(accountname, activate, actindex)
{
    if( actindex == 0 ){
        if( accountname == "" )
            mAccountNames[0] = mSIPAccountID;
        else
            mAccountNames[0] = accountname;
        $("#acctselect option:eq(0)").text(mAccountNames[0]);
        $("#acctselect").resetSS();
    }
    
    mAccountActive[actindex] = activate;
}

function update_feccstate(state,line)
{
    if(line == -1)
    {
        if(state == "0")
        {
            $(".remoteline .startFECC").attr("disabled","disabled").addClass("btndisabled");
        }
        else
        {
            $(".remoteline[state=4] .startFECC").show();
        }
    }
    else
    {
        if(state == "1")
        {
            var isvideo = $("#line-"+line).attr("isvideo");
            $("#line-"+line).find(".startFECC").attr("issupport","1");
            if(isvideo == "1")
                $("#line-"+line).find(".startFECC").removeAttr("disabled").removeClass("btndisabled");
            mFECCState[line] = 1;
        }
    }
}

function update_blockstate(data)
{
    clearTimeout(mTipTimeout);
    var line = data.line;
    var state = (data.state).split("=");

    if(state[0] == "BlockHP")
    {
        if(state[1] == "1")
        {
            //enable block
            $("#line-"+line).find(".confblock").attr("isblock","1").attr("title",a_16702).addClass("active");
            var blocknum = 0;
            $(".remoteline").each(function(){
                if($(this).find(".confblock").attr("isblock") == "1")
                    blocknum++;
            });
            if(blocknum == mConfmemeber_num)
            {
                $("#blockall").attr("name",a_10133).attr("isblockall","1").addClass("active");
                if($("#blockall").is(":hover"))
                {
                    $("#tips span.tipcontent").text(a_10133);
                    buttontip_position($("#blockall"));
                }
            }
        }
        else
        {
            //close block
            $("#line-"+line).find(".confblock").attr("isblock","0").attr("title",a_16701).removeClass("active");
            $("#blockall").attr("name",a_10132).attr("isblockall","0").removeClass("active");
            if($("#blockall").is(":hover"))
            {
                $("#tips span.tipcontent").text(a_10132);
                buttontip_position($("#blockall"));
            }
        }
    }
}

function update_suspendstate(data)
{
    clearTimeout(mTipTimeout);
    var line = data.line;
    var state = data.state;
    var isall = data.isall;
    
    if(isall == "0")
    {
        //line suspend
        if(state == "1")
        {
            $("#line-"+line).find(".confsuspend").attr("issuspend","1").attr("title",a_10077).addClass("active");
            var suspendnum = 0,videonum = 0;
            $(".remoteline").each(function(){
                if($(this).attr("isvideo") == "1" && $(this).attr("account") != "8")
                {
                    videonum++;
                    if($(this).find(".confsuspend").attr("issuspend") == "1" && $(this).attr("remotehold") != "1")
                        suspendnum++;
                } 
            });
            if(suspendnum == videonum  && suspendnum != 0)
            {
                $("#suspendall").attr("name",a_10135).attr("issuspendall","1").addClass("active");
                if($("#suspendall").is(":hover"))
                {
                    $("#tips span.tipcontent").text(a_10135);
                    buttontip_position($("#suspendall"));
                }
            }
        }
        else
        {
            //$("#line-"+line).find(".confsuspend").attr("issuspend","0").attr("title",a_10077).removeClass("active");
            $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
            if($("#suspendall").is(":hover"))
            {
                $("#tips span.tipcontent").text(a_10134);
                buttontip_position($("#suspendall"));
            }
        }
    }
    else
    {
        //all suspend
        if(state == "1")
        {
            $("#suspendall").attr("name",a_10135).attr("issuspendall","1").addClass("active");
            if($("#suspendall").is(":hover"))
            {
                $("#tips span.tipcontent").text(a_10135);
                buttontip_position($("#suspendall"));
            }
        }
        else
        {
            $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
            if($("#suspendall").is(":hover"))
            {
                $("#tips span.tipcontent").text(a_10134);
                buttontip_position($("#suspendall"));
            }
        }
    }
}

/*
handle line is held in remote
*/
function handle_remotehold(data)
{
    var state = data.state;
    var line = data.line;
    var $remoteline = $("#line-"+line);
    if(state == "1")
    {
        $remoteline.attr("remotehold","1");
        $remoteline.find(".mute").attr("disabled","disabled").addClass("btndisabled");
        $remoteline.find(".confblock").attr("disabled","disabled").addClass("btndisabled");
        $remoteline.find(".confaudio").attr("disabled","disabled").addClass("btndisabled");
        $remoteline.find(".confvideo").attr("disabled","disabled").addClass("btndisabled");
        if($("#layoutdiv").is(":visible"))
        {
            $("#layoutdiv").hide();
            ctrl_show_maskdiv(false);
        }
    }
    else
    {
        $remoteline.attr("remotehold","0");
        $remoteline.find(".mute").removeAttr("disabled").removeClass("btndisabled");
        $remoteline.find(".confblock").removeAttr("disabled").removeClass("btndisabled");
        $remoteline.find(".confaudio").removeAttr("disabled").removeClass("btndisabled");
        $remoteline.find(".confvideo").removeAttr("disabled").removeClass("btndisabled");
    }
}

function update_line_suspendstate(data)
{
    var line = data.line;
    var state = data.state;
    
    if(state == "0")
    {
        $("#line-"+line).find(".confsuspend").attr("issuspend","0").attr("title",a_16700).removeClass("active");
        $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
    }
    else
    {
        $("#line-"+line).find(".confsuspend").attr("issuspend","1").attr("title",a_10077).addClass("active");
    }
}

function update_line_resumestate(data)
{
    var line = data.line;
    var state = data.state;
    
    if(state == "0")
    {
        //resume failed
        $("#line-"+line).find(".confsuspend").attr("issuspend","1").attr("title",a_10077).addClass("active");
        var suspendnum = 0,videonum = 0;
        $(".remoteline").each(function(){
            if($(this).attr("isvideo") == "1" && $(this).attr("account") != "8")
            {
                videonum++;
                if($(this).find(".confsuspend").attr("issuspend") == "1" && $(this).attr("remotehold") != "1")
                    suspendnum++;
            }
        });
        if(suspendnum == videonum  && suspendnum != 0)
        {
            $("#suspendall").attr("name",a_10135).attr("issuspendall","1").addClass("active");
            if($("#suspendall").is(":hover"))
            {
                $("#tips span.tipcontent").text(a_10135);
                buttontip_position($("#suspendall"));
            }
        }
    }
    else
    {
        $("#line-"+line).find(".confsuspend").attr("issuspend","0").attr("title",a_16700).removeClass("active");
        $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
    }
}

function handle_autoanswer(data){
    autoanswerFlag = true;
    autoanswer.name = data.name;
    autoanswer.num = data.num;
}

//show prompt to response if accept or reject camera invitation
function handle_ipvtcmrinvite(data){
    if(data.line == undefined)
         data.line = $(".remoteline[account=1]").attr("line");
    
    if(data.name == undefined)
        data.name = "";
    var hostinvitetext = htmlEncode(data.name);
    var prompthtml = "<div id='promptdiv'><div class='promptinfo'><span class='prompthost' title=\'" + hostinvitetext + "\'>" + hostinvitetext + "</span><span>&nbsp" + a_10218 + "</span></div><div id='acceptcmrivt'><button class='promptbutton' style='background:#4abe6b;'>" + a_10000 + "</button></div><div id='rejectcmrivt'><button class='promptbutton' style='background:#d8333d;'>" + a_19138 + "</button></div></div>";
    //var backgroundhtml = "<div class='transparentdiv' style='background:#000;opacity:0.5;width:100%;height:700px;z-index:1000;margin-top:-73%;'></div>"
    
    if($("#promptdiv") != undefined)
        $("#promptdiv").remove();
    //$("#tabs").append(backgroundhtml);
    ctrl_show_maskdiv(true);
    $("#selectvideodiv").after(prompthtml);
    
    var textwidth = 0;
    $(".promptinfo span").each(function(){
        textwidth += $(this).width();
    });
    
    var finalmarginleft = ($(".promptinfo").width() - textwidth) / 2;
    $(".prompthost").css("margin-left", finalmarginleft + "px");
    
    $("#promptdiv").attr("line", data.line);
}

function handle_ipvtrejectcmr(data){
    if(data.status != 1){
        handle_promptdiv();
    }
}

function handle_ipvtoperatecmr(data){
    if(data.isvideoed == 1){
        handle_promptdiv();
    }
}

function handle_promptdiv(){
    if($("#promptdiv") != undefined){
        $("#promptdiv").remove();
        if($("#dtmfDiv").css("display") == "none")
            ctrl_show_maskdiv(false);
    }
}

function handle_ipvtchangehost(data){
    var state = data.state;  //0-change to host  1-change to guest  2-change to panelists
    switch (state) {
        case "0":
            mConfrole = "2";
            break;
        case "1":
            mConfrole = "1";
            break;
        case "2":
            mConfrole = "3";
            break;
    }
    
    showhandsup();
}

function handle_handoperate(data){
    var state = data.state;
    
    if(state == "1")
        $("#handsup").attr("name", a_10221).addClass("active");
    else
        $("#handsup").attr("name", a_10220).removeClass("active");
}

function handle_ipvtrcdoperate(data){
    var line = data.line;
    var state = data.state;
    if(state == "1"){
        $("#ipvtswitch").addClass("rcdstop").removeClass("rcdstart");
        if(!$("#record").hasClass("active"))
            $("#record").attr("isrecord", 0).addClass("active");
    }
    else{
        $("#ipvtswitch").addClass("rcdstart").removeClass("rcdstop");
        if($(".rcdstart").length > 1)
            $("#record").attr("isrecord", 1).removeClass("active");
    }
}

function showhandsup(){
    if($(".remoteline[account=1]").length > 0 && (mConfrole == "1" || mConfrole == "3")){
        var callstate = $(".remoteline[account=1]").attr("state");
        if(callstate == 4 || callstate == 5){
            $("#handsup").css("display", "inline-block");
            //if($("#handsup").hasClass("handsup") && $("#pause").attr("ishold") != 0 && mOldstate != 5)
            //    $("#handsup").removeClass("handsup");
            
            if(!$("#handsup").hasClass("active"))
                $("#handsup").attr("name", a_10220);
            $(".confbasebtn").css("width", "660px");
            $(".confctrlbtn").css("margin-left", "-330px");
        }
        else{
            $("#handsup").css("display", "none");
            $(".confbasebtn").css("width", "590px");
            $(".confctrlbtn").css("margin-left", "-300px");
        }
    }
    else{
        $("#handsup").css("display", "none");
        $(".confbasebtn").css("width", "590px");
        $(".confctrlbtn").css("margin-left", "-300px");
    }
}

function countTabs()
{
    return mTabnum;
}

function showTips(type)
{
    $("#selectvideodiv .listtips").remove();
    var html_tip = "<div class='listtips'>";
    var tips;
    switch(type)
    {
        case 0:
            tips = a_16671;
            break;
        case 1:
            tips = a_16672;
            break;
        default:
            break;
    }
    html_tip = html_tip + tips;
    html_tip += "</div>";

    $(html_tip).insertBefore($("#selectlist")).slideDown(800,function(){
        setTimeout(function(){$("#selectvideodiv .listtips").slideUp(800,function(){
            $("#selectvideodiv .listtips").remove();
            });},
            2000);
    });
}

function handle_callout(data)
{
    /*
    *This function is saving call out info. 
    *If the call failed and dbus do not have info about number and name, it can provide these info.
    */
    var line = data.line;
    var num = data.number;
    var name = data.name;
    mCF_number = num;

    mCalloutObj.num = num;
    mCalloutObj.name = name;
}

function handle_updatename(data)
{
    var line = data.line;
    var name = data.name;
    if($("#line-"+line).attr("account") == "1"){
        $("#line-"+line).attr("name",name).find(".confname").children().attr("title",name).text(name);
        $("#line-"+line).attr("name",name).find(".confnum").children().attr("title",name).text(name);
    }
    else{
        $("#line-"+line).attr("name",name).find(".confname").children().attr("title",name).text(name);
    }
}

/*
create local line div
*/
function addconflist_local()
{
    var itemdiv = document.createElement("DIV");
    itemdiv.id = "line-local";
    itemdiv.setAttribute("line","-1");
    itemdiv.className = "confdiv local";

    //add img
    var icondiv = document.createElement('DIV');
    icondiv.className='conficon';
    var itemicon = document.createElement('DIV');
    itemicon.className='appcontacticon';
    icondiv.appendChild(itemicon);
    itemdiv.appendChild(icondiv);

    //add name
    var namediv = document.createElement('DIV');
    namediv.className='confname';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = a_10032;
    namediv.appendChild(spantext);
    itemdiv.appendChild(namediv);

    //add num 
    var numberdiv = document.createElement('DIV');
    numberdiv.className='confnum';
    var numbertext = document.createElement('SPAN');
    numbertext.innerHTML = "";
    numberdiv.appendChild(numbertext);
    itemdiv.appendChild(numberdiv);

    //add call type
    var checkdiv = document.createElement('DIV');
    checkdiv.className='conftype';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = "";
    checkdiv.appendChild(spantext);
    itemdiv.appendChild(checkdiv);

    //add options btn
    var btndiv = document.createElement('DIV');
    btndiv.className='confbtn';
    var mute = document.createElement('BUTTON');
    mute.id = "localmute";
    mute.className="btndisabled";
    mute.setAttribute("ismute",1);
    mute.setAttribute("title",a_649);
    mute.setAttribute("disabled","disabled");
    var videoctrl = document.createElement('BUTTON');
    videoctrl.id = "closecamera";
    videoctrl.className = "confaudio btndisabled";
    videoctrl.setAttribute("ismute",1);
    videoctrl.setAttribute("title",a_628);
    videoctrl.setAttribute("disabled","disabled");
    var block = document.createElement('BUTTON');
    block.className = "confblock btndisabled";
    block.setAttribute("isblock",0);
    block.setAttribute("disabled","disabled");
    block.setAttribute("title",a_16701);
    var suspend = document.createElement('BUTTON');
    suspend.className = "confsuspend btndisabled";
    suspend.setAttribute("issuspend",0);
    suspend.setAttribute("disabled","disabled");
    suspend.setAttribute("title",a_16700);
    var isvideoed = document.createElement('BUTTON');
    isvideoed.className = "isvideoed btndisabled";
    isvideoed.setAttribute("isvideoed",0);
    isvideoed.setAttribute("disabled","disabled");
    isvideoed.setAttribute("title", a_19241);
    var del = document.createElement('BUTTON');
    del.setAttribute("title",a_1);
    del.setAttribute("disabled","disabled");
    del.className = "confdel btndisabled";
    
    btndiv.appendChild(mute);
    btndiv.appendChild(block);
    btndiv.appendChild(videoctrl);
    btndiv.appendChild(suspend);
    btndiv.appendChild(isvideoed);
    
    if(!is4kon){
        var feccbtn = document.createElement('BUTTON');
        feccbtn.className = "startFECC btndisabled";
        feccbtn.setAttribute("feccstate","0");
        feccbtn.setAttribute("title",a_19020);
        feccbtn.setAttribute("disabled","disabled");
        btndiv.appendChild(feccbtn);
    }

    btndiv.appendChild(del);
    itemdiv.appendChild(btndiv);

    
    $("#"+mConfid).append(itemdiv);

    $("#localmute").click(function(e){
        if(!countClickedTimes())
        {
            return false;
        }
        if(!judge_ispause())
        {
            if(mDisableconf == "1")
                $.prompt(a_16677);
            return false;
        }
        muteclick(e,true);
    });

    $("#closecamera").click(function(){
        if(!judge_ispause() || !countClickedTimes())
        {
            return false;
        }
        var isclose = parseInt($(this).attr("isclose"));
        var urihead = "action=ctrlCameraBlockState&region=confctrl";
        var callfn = "closecamera_callback("+isclose+");";
        cb_get_confaction(urihead,callfn,true);  
    });
}

/*
create ringing line div or calling line div
*/
function addconflist(data,todivID)
{
    if(data == undefined)
        return;
    var num = data.num;
    var line = data.line;
    //for bug 59587,but still need to find out why line is undefined
    if( line == undefined )
        return;
    var account = parseInt(data.acct);
    var callname = data.name;
    var state = data.state;
    var calltype = data.msg;//video or audio or message
    var sqlname = data.sqlname;//judge name is frome sql or null
    var $existline = $("#tabs div#line-"+line);
    var dataisvideo = data.isvideoed;
    
    if(mContactitems != undefined)
    {
        for(var i=0;mContactitems[i] != undefined;i++)
        {
            var number = mContactitems[i].Number;
            number = number.replace(/\s/g,"");
            if(number == num)
                callname = mContactitems[i].Name;
        }
    }
    //console.log('exist length = ' + $existline.length + ',state = ' + state + ',realstate = ' + data.realstate + ',oldstate = ' + $existline.attr("state") + ',line = ' + line + ',sqlname = ' + sqlname);
    if($existline.length > 0)
    {
        if( state == "3" ){
            var msgint = parseInt(calltype);
            if( msgint == 0)
            {
                $existline.attr("audiovideo","0");
            }
            else if(msgint == 1)
            {
                $existline.attr("audiovideo","1");
            }
        }
        if($existline.attr("state") == "8")
        {
            //if line is failed, wait for ending it
            return false;
        }

        if(mConfmemeber_num >= mConfmemeber_maxnum)
        {        
            $("#addmember").attr("disabled","disabled");
        }
        if($existline.attr("state") == state && $existline.attr("sqlname") != "1")
        {
            if(num != "")
            {
                if(callname == "")
                    callname = num;
                
                $existline.attr("number",num);
                $existline.attr("name",callname);
                $existline.find(".confname").children("span").attr("title",callname).text(callname);
                if(account == 1)
                    $existline.find(".confnum").children("span").text(callname);
                else
                    $existline.find(".confnum").children("span").text(num);
            }
            return false;
        }
        else
        {
            if(num != "" && callname != "")
            {
                $existline.remove();
                mConfmemeber_num--;
            }
            else
            {
                $existline.attr("state",state);
                return false;
            }
        }
    }

    var itemdiv = document.createElement("DIV");
    itemdiv.id = "line-"+line;
    itemdiv.setAttribute("line",line);
    itemdiv.setAttribute("number",num);
    itemdiv.setAttribute("name",callname);
    itemdiv.setAttribute("account",account);
    itemdiv.setAttribute("state",state);
    itemdiv.setAttribute("sqlname",sqlname);
    itemdiv.setAttribute("remotehold","0");
    itemdiv.className = "confdiv remoteline "+num;

    if(mDisableconf == "1")
    {
        var numlist = document.createElement("DIV");
        numlist.className="numlist";
        itemdiv.appendChild(numlist);
    }
    //add img
    var icondiv = document.createElement('DIV');
    icondiv.className='conficon';
    var itemicon = document.createElement('DIV');
    if(mDisableconf == "0")
        itemicon.className='appcontacticon';
    else
        itemicon.className='unholdicon';
    icondiv.appendChild(itemicon);
    itemdiv.appendChild(icondiv);

    //add name
    var namediv = document.createElement('DIV');
    namediv.className='confname';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = htmlEncode(callname);
    spantext.setAttribute("title", callname);
    namediv.appendChild(spantext);
    itemdiv.appendChild(namediv);

    //add num 
    var numberdiv = document.createElement('DIV');
    numberdiv.className='confnum';
    var numbertext = document.createElement('SPAN');
    numbertext.innerHTML = htmlEncode(num);
    numberdiv.appendChild(numbertext);
    itemdiv.appendChild(numberdiv);

    //add call type
    var calltypeDescp;
    var videoctrlid="";
    var isvideoline = 0;
    var videotitle = a_628;
    var btnDisabled;
    if( state == "3" ){
        var msgint = parseInt(calltype);
        calltypeDescp = a_509;
        videoctrlid = "calling";
        btnDisabled = true;
        if( msgint == 0)
        {
            itemdiv.setAttribute("audiovideo","0");
        }
        else if(msgint == 1)
        {
            itemdiv.setAttribute("audiovideo","1");
        }
    }else if( state == "4" ){
        var msgint = parseInt(calltype);
        var isvideo = parseInt(data.isvideo);
        btnDisabled = false;
        if( msgint < 16 || isvideo == 0)
        {
            calltypeDescp = a_668;
            videoctrlid = "confvideo";
            isvideoline = 0;
            videotitle = a_627;
            itemdiv.setAttribute("isvideo","0");
        }else if( msgint < parseInt("0xfc", 16) || isvideo == 1){
            calltypeDescp = a_669;
            isvideoline = 1;
            videoctrlid = "confaudio";
            videotitle = a_628;
            itemdiv.setAttribute("isvideo","1");
        }
        if( account == 8 )
            account = 3;
        calltypeDescp = calltypeDescp + " (" + mAccountNames[account] + ")";
    }
    var checkdiv = document.createElement('DIV');
    checkdiv.className='conftype';
    var spantext = document.createElement('SPAN');
    if(mselacct != -1)
        spantext.innerHTML = htmlEncode(calltypeDescp);
    else
        spantext.innerHTML = htmlEncode(calltypeDescp);
    spantext.setAttribute("title", calltypeDescp);
    checkdiv.appendChild(spantext);
    itemdiv.appendChild(checkdiv);

    //add options btn
    var btndiv = document.createElement('DIV');
    btndiv.className='confbtn';
    if(mOEMID != "54"){
        var mute = document.createElement('BUTTON');
        mute.className = "mute";
        mute.setAttribute("ismute",1);
        mute.setAttribute("title",a_649);
        var videoctrl = document.createElement('BUTTON');
        videoctrl.className = videoctrlid;
        videoctrl.setAttribute("name","videstate");
        videoctrl.setAttribute("title",videotitle);
        /*if( account == 1){
            videoctrl.setAttribute("disabled","disabled");
            videoctrlid += " btndisabled";
            videoctrl.className = videoctrlid;
        }*/
        var block = document.createElement('BUTTON');
        block.className = "confblock";
        block.setAttribute("title",a_16701);
        block.setAttribute("isblock",0);
        var suspend = document.createElement('BUTTON');
        suspend.className = "confsuspend";
        suspend.setAttribute("issuspend",0);
        suspend.setAttribute("title",a_16700);
        var isvideoed = document.createElement('BUTTON');
        if(dataisvideo == 1){
            isvideoed.className = "isvideoed unisvideoed";
            isvideoed.setAttribute("title",a_10077);
        }
        else{
            isvideoed.className = "isvideoed";
            isvideoed.setAttribute("title",a_19241);
        }
        
        isvideoed.setAttribute("isvideoed",dataisvideo);
        if( account == 8 || account == 3 ){
            //h323 account can't resume or suspend
            suspend.className = "confsuspend btndisabled";
            suspend.setAttribute("disabled","disabled");
        }

        if( account != 1 ){
            isvideoed.className = "isvideoed btndisabled";
            isvideoed.setAttribute("disabled","disabled");
        }
    }
    
    var feccbtn = document.createElement('BUTTON');
    feccbtn.className = "startFECC btndisabled";
    feccbtn.setAttribute("feccstate","0");
    feccbtn.setAttribute("issupport","0");
    feccbtn.setAttribute("disabled","disabled");
    feccbtn.setAttribute("title",a_19020);
    var del = document.createElement('BUTTON');
    del.setAttribute("title",a_1);
    del.className = "confdel";
    var redial = document.createElement('BUTTON');
    redial.className = "redialcall";
    redial.setAttribute("title",a_10008);

    if(mDisableconf == "1")
    {
        //GVC does not support to disable conference, can remove this code.
        var linehold = document.createElement('BUTTON');
        linehold.className = "linehold";
        linehold.setAttribute("ishold",1);
        var transfer = document.createElement('BUTTON');
        transfer.className = "linetransfer";
        btndiv.appendChild(linehold);
        //btndiv.appendChild(mute);
        btndiv.appendChild(videoctrl);
        btndiv.appendChild(transfer);
        if(state == "4")
        {
            $(linehold).show();
            //$(mute).show();
            $(videoctrl).show();
            $(transfer).show();
        }
        else if(state == "3")
        {
            $(linehold).hide();
            //$(mute).hide();
            $(videoctrl).hide();
            $(transfer).hide();
        }
        $("#closecamera").hide();
        //$("#present").hide();
        $("#record").hide();
        $("#switchvideosource").hide();
    }
    else
    {
        if(mOEMID != "54"){
            btndiv.appendChild(mute);
            btndiv.appendChild(block);
            btndiv.appendChild(videoctrl);
            btndiv.appendChild(suspend);
            btndiv.appendChild(isvideoed);
            if(!is4kon)
                btndiv.appendChild(feccbtn);
            if(state == "4")
            {
                $(mute).show();
                $(videoctrl).show();
                $(feccbtn).show();
                $(block).show();
                $(suspend).show();
                $(isvideoed).show();
                if(isvideoline == 0)
                {
                    $(suspend).attr("disabled","disabled").addClass("btndisabled");
                    $(isvideoed).attr("disabled","disabled").addClass("btndisabled");
                }
            }
            else if(state == "3")
            {
                $(mute).hide();
                $(videoctrl).hide();
                $(feccbtn).hide();
                $(block).hide();
                $(suspend).hide();
                $(isvideoed).hide();
            }
        }else{
            if(!is4kon)
                btndiv.appendChild(feccbtn);
            if(state == "4")
            {
                $(feccbtn).show();
            }
            else if(state == "3")
            {
                $(feccbtn).hide();
            }
        }
        
        $("#closecamera").show();
        if($("#present").attr("bfcp") != "2" && ($("#disablepresent",window.parent.document).val() == "0" || hasIPVNumber()) )
            $("#present").show();
        $("#record").show();
    }
    btndiv.appendChild(redial);
    btndiv.appendChild(del);
    itemdiv.appendChild(btndiv);
    
    $("#"+todivID).append(itemdiv);

    //set hover
    $("button").mouseover(function(){
        $(this).addClass('buttonover');
    }).mouseout(function(){
        $(this).removeClass('buttonover');
    });
    $(".confdiv").hover(function(){
        $(this).addClass("conflisthover").children(".confbtn").children("button").addClass("normal");
        if(mDisableconf == "1" && $(this).attr("hold") == "hold")
            $(this).find(".confbtn").show();
    },function(){
        $(this).removeClass("conflisthover").children(".confbtn").children("button").removeClass("normal");
        if(mDisableconf == "1" && $(this).attr("hold") == "hold")
            $(this).find(".confbtn").hide();
    });

    mConfmemeber_num++;
    mBusylinenum = mConfmemeber_num;
    
    if(mConfmemeber_num >=mConfmemeber_maxnum)
    {
        if(!hasIPVNumber())
            $("#addmember").attr("disabled","disabled");
        $("#addnewcall").attr("disabled","disabled");
    }

    if(mConfmemeber_num == 1)
    {
        if(state == "4")
        {
            $("#bottombtn button").removeAttr("disabled").removeClass("btndisabled");
        }
        else if(state == "3")
        {
            $("#bottombtn button").attr("disabled","disabled").addClass("btndisabled");
            $("#bottombtn #close").removeAttr("disabled").removeClass("btndisabled");
        }
        //get dnd info
        var urihead = "action=isdndon&region=confctrl&account=0";
        var callfn = "setdnd_callback(data,'searchDND');";
        cb_get_confaction(urihead,callfn,false);
    }

    //get pause info
    if(mDisableconf == "0" && mConfmemeber_num == 1)
    {
        var urihead = "action=isConfOnHold&region=confctrl";
        var callfn = "setconfpause_callback(data);";
        cb_get_confaction(urihead,callfn,false);

        urihead = "action=isscheduleconf&region=confctrl";
        callfn = "setdnd_callback(data,'isscheduleconf');";
        cb_get_confaction(urihead,callfn,false);

        urihead = "action=isCameraBlocked&region=confctrl";
        callfn = "setcameraBlocked_callback(data);";
        cb_get_confaction(urihead,callfn,false);

        urihead = "action=isBFCPOn&region=confctrl";
        callfn = "setBFCP_callback(data);";
        cb_get_confaction(urihead,callfn,false);
        
        urihead = "action=getBFCPMode&region=confctrl";
        callfn = "";
        cb_get_confaction(urihead,callfn,false);

        urihead = "action=issubstreamon&region=confctrl";
        callfn = "setsubstream_callback(data);";
        cb_get_confaction(urihead,callfn,false);

        urihead = "action=isrecording&region=confctrl";
        callfn = "setrecord_callback(data);";
        cb_get_confaction(urihead,callfn,false);
        
        urihead = "action=ismuteon&region=confctrl";
        callfn = "localmute_callback(data)";
        cb_get_confaction(urihead,callfn,false);
    }

    // if($("#incominglist div",window.parent.document).length > 0)
    //     $("#tabs button").attr("disabled","disabled");
    if(mDisableconf == "1" && state == 3)
    {
        $("#bottombtn button").attr("disabled","disabled").addClass("btndisabled");
        $("#bottombtn #close").removeAttr("disabled").removeClass("btndisabled");
    }
    else if(mDisableconf == "1" && state == 4)
    {
        $("#bottombtn button").removeAttr("disabled").removeClass("btndisabled");
    }

    change_numlist();
    if($("#addmemberdiv").is(":visible"))
    {
        $("#addmemberdiv").hide();
        ctrl_show_maskdiv(false);
    }
    if($("#detailsdiv").is(":visible"))
    {
        $("#detailsback").click();
    }
    if($("#ctrlFECCDiv").is(":visible"))
    {
        $("#closeFECC").click();
    }
    if(mFECCState[line] == 1)
    {
        var isvideo = $("#line-"+line).attr("isvideo");
        $("#line-"+line).find(".startFECC").attr("issupport","1");
        if(isvideo == "1")
            $("#line-"+line).find(".startFECC").removeAttr("disabled").removeClass("btndisabled");
    }
    
    //judge line is conference or not when use IPV
    if(account == 1)
    {
        if( data.realstate != undefined && data.realstate == "8" ){
            if( mProduct == "GVC3202" ){
                mConfmemeber_maxnum = 2;
                mAddmember_maxnum = 2;
                $("#hasipvt", window.parent.document).val("0");
                $("#maxlinenum",window.parent.document).val('2');
            }
        }else{
            mIsIPVConf = true;
            if( mProduct == "GVC3202" ){
                mConfmemeber_maxnum = 3;
                mAddmember_maxnum = 3;
                $("#hasipvt", window.parent.document).val("1");
                $("#maxlinenum",window.parent.document).val('3');
            }
        }
        
        cb_get_action("getipvrole&region=confctrl&line=" + line + "&type=init");
        cb_get_action("resumecamera&region=confctrl");
        cb_get_action("ipvtrcdstate&region=confctrl");
        cb_get_action("isallowipvtrcd&region=confctrl");
    }
    
    if(mOEMID == "54")
        $(".isvideoed").hide();
    setBusylinenum();
}

function update_line_videoedstate(data){
    var line = data.line;
    var type = data.type;
    
    // receive websocket of turning on/off camera func
    // flag:  0-the operation failed   1-the operation successed
    if(data.flag == 1){
        if(type.indexOf("open") != -1)
            $("#line-"+line).find(".isvideoed").removeClass("unisvideoed").attr("isvideoed","0").attr("title", a_19241);
        else
            $("#line-"+line).find(".isvideoed").addClass("unisvideoed").attr("isvideoed","1").attr("title", a_10077);
    }else{
        if(type.indexOf("open") != -1)
            $("#line-"+line).find(".isvideoed").addClass("unisvideoed").attr("isvideoed","1").attr("title", a_10077);
        else
            $("#line-"+line).find(".isvideoed").removeClass("unisvideoed").attr("isvideoed","0").attr("title", a_19241);
    }
}

function change_numlist()
{
    if(mDisableconf == "1")
    {
        var number = 1;
        $(".numlist").each(function(){
            $(this).text(number);
            number++;
        });
    }
}

function judge_failedLine(number)
{
    if(number == "")
        return false;
    var $failedline = $("#tabs div[number=\""+number+"\"]");
    var state = $failedline.attr("state");
    if(state == "8")
    {
        //$failedline.find(".confdel").click();
        cb_send_endcall_action( $failedline.attr("line") );
    }
}

/*
If line state is changed, do this function.
like call state change from 3 to 4.
*/
function change_callconnectstate(data)
{
    var line = data.line;
    var state = data.state;
    var oldstate = data.oldstate;
    var calltype = data.msg;//video or audio or message
    var account = parseInt(data.acct);
    var isvideo = 0;
    var videotitle = a_628;

    if($("#tabs div#line-"+line).length > 0)
    {
        if( state == "4" && oldstate != "5"){
            var msgint = parseInt(calltype);
            var calltypeDescp,videoctrlid;
            if( msgint < 16 )
            {
                calltypeDescp = a_668;
                videoctrlid = "confvideo";
                isvideo = 0;
                videotitle = a_627;
            }else if( msgint < parseInt("0xfc", 16) ){
                calltypeDescp = a_669;
                videoctrlid = "confaudio";
                isvideo = 1;
                videotitle = a_628;
            }
            if(isvideo == 0)
            {
                //if line is audio, hide video details
                $(".onedetails[line=\""+line+"\"] .videodetail .spancontent").text("");
            }
            if(calltypeDescp != undefined)
            {
                // if(mselacct != -1)
                //     account = "("+ mselacct +")";
                if( account == 8 )
                    account = 3;
                calltypeDescp = calltypeDescp + " (" + mAccountNames[account] + ")";
                $("#tabs div#line-"+line).attr("state",state);
                $("#tabs div#line-"+line).attr("isvideo",isvideo);
                $("#tabs div#line-"+line+" .conftype span").text(calltypeDescp).attr("title",calltypeDescp).removeClass("failedtip");
                $("#tabs div#line-"+line+" .confbtn button").show();
                $("#tabs div#line-"+line+" .confbtn button.redialcall").hide();
                $("#tabs div#line-"+line+" .confbtn button[name='videstate']").removeClass().addClass(videoctrlid).attr("title",videotitle);
                if($("#layoutdiv").is(":visible"))
                    $("#layoutdiv").hide();
                var ipvConf = $("#tabs div#line-"+line).attr("number").substring(0,2);
                if(account == 1 && ipvConf == mIPVPrefix)
                    $("#tabs div#line-"+line+" .confbtn button[name='videstate']").attr("disabled","disabled").addClass("btndisabled");
                var $linefecc = $("#tabs div#line-"+line+" .confbtn .startFECC");
                var remotehold = $("#tabs div#line-"+line).attr("remotehold");
                if(remotehold == "1")
                {
                    $("#tabs div#line-"+line+" .confbtn button[name='videstate']").addClass("btndisabled");
                }
                if(isvideo == 0 || account == 3)
                {
                    if(remotehold != "1")
                    {
                        $("#tabs div#line-"+line+" .confbtn .confsuspend").attr("issuspend","0");
                    }
                    $("#tabs div#line-"+line+" .confbtn .confsuspend").attr("disabled","disabled").addClass("btndisabled");
                    $("#tabs div#line-"+line+" .confbtn .isvideoed").attr("disabled","disabled").addClass("btndisabled").removeClass("unisvideoed").attr("isvideoed","0");
                    $linefecc.attr("disabled","disabled").addClass("btndisabled");
                    $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
                }
                else
                {
                    //judge line is conference or not when use IPV
                    if(account == 1)
                    {
                        $("#tabs div#line-"+line+" .confbtn .confsuspend").removeAttr("disabled").removeClass("btndisabled");
                        $("#tabs div#line-"+line+" .confbtn .isvideoed").removeAttr("disabled").removeClass("btndisabled");
                    }
                    else
                        $("#tabs div#line-"+line+" .confbtn .confsuspend").removeAttr("disabled").removeClass("btndisabled");
                    if($linefecc.attr("issupport") == "1")
                    {
                        $linefecc.removeAttr("disabled").removeClass("btndisabled");
                    }
                }
            }
            var feccstate = $("#enablefecc",window.parent.document).val();
            update_feccstate(feccstate,-1);     
            $("#localmute,#closecamera").removeAttr("disabled").removeClass("btndisabled"); 
            $(".local .startFECC").removeAttr("disabled").removeClass("btndisabled"); 
            //search is all line not support presentation
            setTimeout(function(){
                var lines = "";
                var ishasvideo = false;
                var suspendnum = 0,videonum = 0,blocknum = 0,mutenum = 0,notholdline_num = 0;
                $("#muteall").attr("ismuteall","0").attr("name",a_10130).removeClass("active");
                $("#conf div.remoteline").each(function(){
                    if($(this).attr("isvideo") == "1" && $(this).attr("account") != "8")
                    {
                        videonum++;
                        ishasvideo = true;
                        if($(this).find(".confsuspend").attr("issuspend") == "1" && $(this).attr("remotehold") != "1")
                            suspendnum++;
                    }
                    if($(this).attr("remotehold") != "1")
                    {
                        notholdline_num++;
                    }
                    if(lines == "")
                    {
                        lines += $(this).attr("line");
                    }
                    else
                    {
                        lines += ":::";
                        lines += $(this).attr("line");
                    }
                    
                    if($(this).find(".confblock").attr("isblock") == "1" && $(this).attr("remotehold") != "1")
                        blocknum++;
                    if($(this).find(".mute").attr("ismute") == "0" && $(this).attr("remotehold") != "1")
                        mutenum++;
                });
                if( $("#present").attr("bfcp") != "2" && ($("#disablepresent",window.parent.document).val() == "0" || hasIPVNumber()) ){
                    $("#present").show();
                }else{
                    //$("#present").hide();
                }
                $("#blockall").attr("name",a_10132).attr("isblockall","0").removeClass("active");
                $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
                $("#muteall").attr("ismuteall","0").attr("name",a_10130).removeClass("active");
                if(suspendnum == videonum && suspendnum != 0)
                {
                    $("#suspendall").attr("name",a_10135).attr("issuspendall","1").addClass("active");
                }
                if(blocknum == notholdline_num && blocknum != 0)
                {
                    $("#blockall").attr("name",a_10133).attr("isblockall","1").addClass("active");
                }
                if(mutenum == notholdline_num && mutenum != 0)
                {
                    $("#muteall").attr("ismuteall","1").attr("name",a_10131).addClass("active");
                }
            },500);
        }
    }
}

function handle_holdstate(data)
{
    //this function can be reomved
    if(mDisableconf == "1")
    {
        var line = data.line;
        var state = data.state;
        var $holddiv = $("#tabs div#line-"+line);
        var holdstate = $holddiv.attr("hold");
        if($holddiv.length > 0 && state == "5")
        {
            var holdtext = a_648;
            $holddiv.removeClass("unholdline").attr("hold","hold").find(".conficon").children().attr("class","holdicon");
            $holddiv.find(".linehold").attr("ishold",0).addClass("active");
            $holddiv.find(".confbtn").hide(); 
            $holddiv.find(".conftype").children("span").attr("title",holdtext).text(holdtext);
            if($("#dtmfDiv").is(":visible"))
            {
                $("#dtmfDiv").hide();
                $("#DTMF").removeClass("active");
            }
        }
        else if($holddiv.length > 0 && state == "4")
        {
            $holddiv.addClass("unholdline").removeAttr("hold").find(".conficon").children().attr("class","unholdicon");
            $holddiv.find(".linehold").attr("ishold",1).removeClass("active");
            $holddiv.find(".confbtn").show();
        }
    }
    else
    {
        /*var state = data.state;
        var $holddiv = $("#tabs div#conf");
        if($holddiv.length > 0 && state == "5")
        {
            $holddiv.attr("hold","hold");
            $("#pause").attr("ishold",0).addClass("active");
        }
        else if($holddiv.length > 0 && state == "4")
        {
            $holddiv.removeAttr("hold");
            $("#pause").attr("ishold",1).removeClass("active");
        }*/
    }
}

function handle_callfailed(data)
{
    var line = data.line;
    var errortype = parseInt(data.msg);
    var $failedline = $("div#line-" + line);
    var errortip = "";
    switch(errortype)
    {
        case 3:
            errortip = a_539;
            break;
        case 4:
            errortip = a_540;
            break;
        case 5:
            errortip = a_541;
            break;
        case 6:
            errortip = a_542;
            break;
        case 7:
            errortip = a_543;
            break;
        case 8:
            errortip = a_544;
            break;
        case 9:
            errortip = a_545;
            break;
        default:
            break;
    }
    if(mDisableconf == "1")
    {
        $failedline.find(".conficon").children("div").attr("class","failedicon");
    }
    $failedline.attr("state",8);
    $failedline.find(".conftype").children("span").attr("title",errortip).addClass("failedtip").text(a_643);
    $failedline.find(".confbtn").children().hide();
    $failedline.find(".confdel").show();

    if($("#line-" + line).attr("account") == "1"){
        $failedline.find(".redialcall").show();
    }

    mConfmemeber_num--;
    mBusylinenum = mConfmemeber_num;
    setBusylinenum();
    if(mConfmemeber_num < mConfmemeber_maxnum)
    {        
        $("#addmember").removeAttr("disabled");
    }

    var allfailed = 1, linenum = 0;
    $("#tabs .remoteline").each(function(){
        linenum++;
        if($(this).attr("state") != "8")
        {
            allfailed = 0;
            return false;
        }
    });
    if(allfailed == 1)
    {
        if(linenum == 1)
        {
            $("#bottombtn button").attr("disabled","disabled").addClass("disabled");
            $("#line-local").find("#localmute").attr("disabled","disabled").addClass("btndisabled");
            $("#line-local").find("#closecamera").attr("disabled","disabled").addClass("btndisabled");
            $("#line-local").find(".startFECC").attr("disabled","disabled").addClass("btndisabled");
            if($("#line-" + line).attr("account") == "1"){
                $("#addmember").removeAttr("disabled").removeClass("disabled");
            }
        }
        else
        {
            $("#bottombtn button").removeAttr("disabled").removeClass("disabled");
            $("#line-local").find("#localmute").removeAttr("disabled").removeClass("btndisabled");
            $("#line-local").find("#closecamera").removeAttr("disabled").removeClass("btndisabled");
            $("#line-local").find(".startFECC").removeAttr("disabled").removeClass("btndisabled");
        }
        
        $("#close").removeAttr("disabled").removeClass("disabled");
    }
}

/***********get contact and group, calllog*************/
function get_contact(){
    //get contact
    //cb_get_action("getcontactsbyorder&region=webservice&format=json");
    cb_get_action("sqlitecontacts&region=apps&type=contacts&sqlstr=select contacts._id as contacts_id,raw_contacts._id as raw_contacts_id,raw_contacts.display_name as contact_display_name,data.phone,data.accountid,data._id from contacts left join raw_contacts on contacts.name_raw_contact_id=raw_contacts._id left join (select _id, raw_contact_id,data1 as phone,data11 as accountid from data where mimetype_id=(select _id from mimetypes where mimetype='vnd.android.cursor.item/phone_v2')) as data on raw_contacts._id=data.raw_contact_id;");
}

function get_normal_calllog(flag, logtype)
{
    //get callhistory, logtype: 0-all, 1-incoming , 2-outgoing, 3-missed
    //flag: 3-latest single log(not in conf, one-way), 2-latest single log(include in conf members), 0-single log by logtype
    var action = "sqlitecontacts&region=apps&type=calllog&flag=" + flag + "&logtype=" + logtype; 
    cb_get_action_sync(action);
}

function create_member_div(id, disname, number, acctindex, dataid){
    if( id == "" && $("#contact_" + dataid).length != 0) return;
    var memberdiv = document.createElement('DIV');
    memberdiv.className='itemdiv confdiv';
    memberdiv.setAttribute("preconfid", id);
    memberdiv.setAttribute("isgroup", "");
    memberdiv.setAttribute("account", acctindex);
    memberdiv.setAttribute("contactid", id);
    memberdiv.setAttribute("email", "");
    memberdiv.setAttribute("emailid", "");
    memberdiv.setAttribute("groupname", "");
    memberdiv.setAttribute("groupid", "");
    memberdiv.setAttribute("dataid", dataid);
    memberdiv.setAttribute("name", disname);
    memberdiv.setAttribute("number", number);
    memberdiv.setAttribute("acctIndex", acctindex);
    if( id == "" ){
        //id empty means create contact list,and data is contact id
        memberdiv.id = "contact_" + dataid;
        memberdiv.setAttribute("conflistid", "");
    }else{
        memberdiv.setAttribute("conflistid", dataid.replace(/\"/g,"'"));
    }
    
    var checkdiv = document.createElement('DIV');
    checkdiv.className='itemcheck';
    var checkbox = document.createElement('INPUT');
    checkbox.type = 'checkbox';
    checkbox.className = "inputcbx";
    checkdiv.appendChild(checkbox);
    memberdiv.appendChild(checkdiv);

    var iconmemberdiv = document.createElement('DIV');
    iconmemberdiv.className='itempicon';
    var itemicon = document.createElement('DIV');
    
    itemicon.className='appcontacticon';
    iconmemberdiv.appendChild(itemicon);

    memberdiv.appendChild(iconmemberdiv);
    
    var namediv = document.createElement('DIV');
    namediv.className='itemname';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = htmlEncode(disname);
    spantext.setAttribute("title", disname);
    namediv.appendChild(spantext);
    memberdiv.appendChild(namediv);
    
    var numberdiv = document.createElement('DIV');
    numberdiv.className='itemnum';
    var numbertext = document.createElement('SPAN');
    numbertext.innerHTML = htmlEncode(number);
    numbertext.setAttribute("title", number);

    numberdiv.appendChild(numbertext);
    memberdiv.appendChild(numberdiv);
    
    mContactdivObj.appendChild(memberdiv);
}

function create_group_div(id, disname){
    if( $(".itemdiv[groupid=" + id + "]").length == 0 )
    {
        var itemdiv = document.createElement('DIV');
        itemdiv.className='itemdiv confdiv';
        itemdiv.id = "group_" + id;
        itemdiv.setAttribute("name", disname);
        itemdiv.setAttribute("members", "0");
        itemdiv.setAttribute("membersid", "");
        itemdiv.setAttribute("groupid", id);
        
        var checkdiv = document.createElement('DIV');
        checkdiv.className='itemcheck';
        var checkbox = document.createElement('INPUT');
        checkbox.type = 'checkbox';
        checkbox.className = "inputcbx";
        checkdiv.appendChild(checkbox);
        itemdiv.appendChild(checkdiv);
        
        var icondiv = document.createElement('DIV');
        icondiv.className='itemicon';
        var itemicon = document.createElement('IMG');
        itemicon.src='../img/apps/app_groups_icon.png';
        icondiv.appendChild(itemicon);
        itemdiv.appendChild(icondiv);
        
        var namediv = document.createElement('DIV');
        namediv.className='itemname';
        var spantext = document.createElement('SPAN');
        spantext.innerHTML = htmlEncode(disname);
        spantext.setAttribute("title", disname);
        namediv.appendChild(spantext);
        itemdiv.appendChild(namediv);                                 
        
        var numdiv = document.createElement('DIV');
        numdiv.className='itemmembers';
        var numtext = document.createElement('SPAN');
        numtext.innerHTML = "0 " + htmlEncode(a_member);
        numdiv.appendChild(numtext);
        itemdiv.appendChild(numdiv);
        
        mContactdivObj.appendChild(itemdiv);
    }
}

function update_contact_div(dataid, rawid, info, acctid, infotype){
    if( info == "" ) return;

    $updatecontact = $("#contact_" + rawid);
    if( infotype == 1 ){
        //email
        var emailattr = $updatecontact.attr("email");
        var emailnum = parseInt($updatecontact.attr("emailnum"));
        if( emailattr != "" ){
            emailattr += ",";
            emailattr += info;
        }else{
            emailattr = info;
        }
        emailnum ++;
        $updatecontact.attr("email", emailattr).attr("emailnum", emailnum);
    }
    else if( infotype == 5 ){
        //number
        var temp = new Array();
        temp.push(info);
        temp.push(acctid);
        mContactsObj[dataid] = temp;
        var contactid = $updatecontact.attr("contactid");
        if(contactid != dataid && contactid != "")
        {
            var $clone = $updatecontact.clone(true);
            var id = $updatecontact.attr("id") + "_" +dataid;
            $clone.attr("number", info).attr("id",id).attr("acctIndex", acctid).attr("contactid", dataid).children(".itemnum").children("span").text(info);
            $updatecontact.after($clone);
        }
        else
        {
            $updatecontact.attr("number", info).attr("acctIndex", acctid).attr("contactid", dataid).children(".itemnum").children("span").text(info);
        }
    }
}

function create_contact_div(id, disname, number, acctid, rawid){
    var $this = $("#transferlist #contact_" + id);
    if( $this.length == 0){
        var itemdiv = document.createElement('DIV');
        itemdiv.className='itemdiv';
        itemdiv.setAttribute("name", disname);
        itemdiv.setAttribute("number", number);
        if( number != "" ){
            itemdiv.setAttribute("numbernum", "1");
        }else{
            itemdiv.setAttribute("numbernum", "0");
        }
        itemdiv.setAttribute("emailnum", "0");
        itemdiv.setAttribute("account", acctid);
        itemdiv.setAttribute("contactid", id);
        itemdiv.setAttribute("rawcontactid", rawid);
        itemdiv.setAttribute("email", "");
        itemdiv.setAttribute("emailid", "");
        itemdiv.setAttribute("groupname", "");
        itemdiv.setAttribute("groupid", "");
        itemdiv.id = "contact_" + id;

        var picondiv = document.createElement('DIV');
        picondiv.className='itempicon';
        var pitemicon = document.createElement('DIV');
        pitemicon.className = "appcontacticon";
        picondiv.appendChild(pitemicon);
        itemdiv.appendChild(picondiv);
        
        var namediv = document.createElement('DIV');
        namediv.className='itemname';
        var spantext = document.createElement('SPAN');
        spantext.innerHTML = htmlEncode(disname);
        spantext.setAttribute("title", disname);
        namediv.appendChild(spantext);
        itemdiv.appendChild(namediv);
    
        mTransferlistdiv.append(itemdiv);
    }else{
        if( number != "" ){
            var curnumber = $this.attr("number");
            var curacct = $this.attr("account");
            var curnumbernum = parseInt($this.attr("numbernum"));
            if( curnumber != "" ){
                curnumber += ":::";
                curacct += ",";
                curnumbernum ++;
            }
            curnumber += number;
            curacct += acctid;
            $this.attr("number", curnumber).attr("numbernum", curnumbernum).attr("account", curacct);
        }
    }
    //addtransferItemEvent();
}
function add_contactinfo_div(dataid, rawid, info, acctid, infotype){
    if( info == "" ) return;

    var $this = $("#transferlist #rawcontact_" + rawid);
    if( infotype == 1 ){
        //email
        var emailattr = $this.attr("email");
        var emailnum = parseInt($this.attr("emailnum"));
        if( emailattr != "" ){
            emailattr += ":::";
            emailattr += info;
        }else{
            emailattr = info;
        }
        emailnum ++;
        $this.attr("email", emailattr).attr("emailnum", emailnum);
    }
    else if( infotype == 5 ){
        //number
        var curnumber = $this.attr("number");
        var curacct = $this.attr("account");
        var curnumbernum = parseInt($this.attr("numbernum"));
        if( curnumber != "" ){
            curnumber += ":::";
            curacct += ","; 
        }
        curnumber += info;
        curacct += acctid;
        curnumbernum ++;
        $this.attr("number", curnumber).attr("numbernum", curnumbernum).attr("account", curacct);
    }
}

function parse_contacts(items,type){
    var id, disname, number, acctid, dataid;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        disname = items[i].Name;
        number = items[i].Number;
        acctid = items[i].AcctIndex;
        dataid = items[i].DataId;
        number = number.replace(/\s/g,"");

        if(number != "")
        {
            //type = 1 means add contacts,different about member
            if(type == 1)
                create_contact_div(id, disname, number, acctid, dataid);
            else
                create_member_div(id, disname, number, acctid, dataid);
            var temp = new Array();
            temp.push(number);
            temp.push(acctid);
            mContactsObj[id] = temp;
        }
    }
}

function parse_contactinfo(items,type){
    var id, rawid, info, acctid, infotype;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        rawid = items[i].RawId;
        info = items[i].Info;
        acctid = items[i].AcctIndex;
        infotype = items[i].InfoType;

        //type = 1 means add contacts,different about member
        if(type == 1)
            add_contactinfo_div(id, rawid, info, acctid, infotype);
        else
            update_contact_div(id, rawid, info, acctid, infotype);

    } 
}

function parse_calllog(items){
    var id, type, disname, contactname, number, duration, date, acctid, isconf;
    var itemnum = 0;
    var createItem = [];
    var needcreate = true;
    if(items == undefined)
        return false;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        type = items[i].Type;
        disname = items[i].Name;
        number = items[i].Number;
        duration = parseInt(items[i].Duration);
        date = parseInt(items[i].Date);
        acctid = items[i].AcctIndex;
        isconf = items[i].IsConf;
        contactname = items[i].ContactName;
        if( contactname != "" )
            disname = contactname;
        
        needcreate = true;
        for(var n=0; createItem[n] != undefined; n++)
        {
            if(number == createItem[n])
            {
                needcreate = false;
                break;
            }
        }

        if(needcreate)
        {
            var itemdiv = document.createElement('DIV');
            itemdiv.className='itemdiv';
            itemdiv.id = "calllog_" + itemnum;
            itemdiv.setAttribute("name", disname);
            itemdiv.setAttribute("disname", disname);
            itemdiv.setAttribute("logid", id);
            itemdiv.setAttribute("number", number);
            itemdiv.setAttribute("account", acctid);
            itemdiv.setAttribute("isconf", "0");
            
            var icondiv = document.createElement('DIV');
            icondiv.className='itemicon';
            var itemicon = document.createElement('DIV');
            if( type == "3" )
                itemicon.className='appmissedicon';
            else if( type == "1" )
                itemicon.className='appincomingicon';
            else  
                itemicon.className='appcallouticon';
            icondiv.appendChild(itemicon);
            itemdiv.appendChild(icondiv);
            
            var namediv = document.createElement('DIV');
            namediv.className='itemname';
            var nametopdiv = document.createElement('DIV');
            nametopdiv.className='itemnamechild';
            var spantext = document.createElement('SPAN');
            spantext.innerHTML = htmlEncode(disname);
            nametopdiv.appendChild(spantext);
            var namebotdiv = document.createElement('DIV');
            namebotdiv.className='itemnamechild';
            var spantext2 = document.createElement('SPAN');
            spantext2.innerHTML = htmlEncode(number);
            namebotdiv.appendChild(spantext2);
            namediv.appendChild(nametopdiv);
            //namediv.appendChild(namebotdiv);
            itemdiv.appendChild(namediv);    

            var durationdiv = document.createElement('DIV');
            durationdiv.className='logitemduration';
            var durationtext = document.createElement('SPAN');
            if( type == "3" )
                durationtext.innerHTML = a_16401;
            else
                durationtext.innerHTML = htmlEncode(convertDuration(duration));
            durationdiv.appendChild(durationtext);  
            itemdiv.appendChild(durationdiv);                                 
            
            var datediv = document.createElement('DIV');
            datediv.className='itemnumber';
            var datetext = document.createElement('SPAN');
            datetext.innerHTML = htmlEncode(convertTime(date));
            datediv.appendChild(datetext);
            itemdiv.appendChild(datediv);
            
            itemnum ++; 
            mTransferlistdiv.append(itemdiv);
        }
        // var $logitemdiv = $("#transferlist .itemdiv[logid=\""+id+"\"]");
        // if( $logitemdiv.length > 0 ){
        //     var durationdiv = document.createElement('DIV');
        //     durationdiv.className='logitemduration';
        //     var durationtext = document.createElement('SPAN');
        //     if( type == "3" )
        //         durationtext.innerHTML = a_16401;
        //     else
        //         durationtext.innerHTML = convertDuration(duration);
        //     durationdiv.appendChild(durationtext);
        //     $logitemdiv.children(".itemname").after(durationdiv);
        // }
    }
   // addtransferItemEvent();
}

function addnewcall_calllog(items)
{
    var id, type, disname, contactname, number, duration, date, acctid, isconf;
    var itemnum = 0;
    var createItem = [];
    var needcreate = true;
    if(items == undefined)
        return false;
    $("#contactsdiv .contactcalllog").remove();
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        type = items[i].Type;
        disname = items[i].Name;
        number = items[i].Number;
        duration = parseInt(items[i].Duration);
        date = parseInt(items[i].Date);
        acctid = items[i].AcctIndex;
        isconf = items[i].IsConf;
        contactname = items[i].ContactName;
        if( contactname != "" )
            disname = contactname;
        
        needcreate = true;
        for(var n=0; createItem[n] != undefined; n++)
        {
            if(number == createItem[n])
            {
                needcreate = false;
                break;
            }
        }

        if(needcreate)
        {
            var itemdiv = document.createElement('DIV');
            itemdiv.className='itemdiv confdiv contactcalllog';
            itemdiv.id = "contactcalllog_" + itemnum;
            itemdiv.setAttribute("name", disname);
            itemdiv.setAttribute("disname", disname);
            itemdiv.setAttribute("logid", id);
            itemdiv.setAttribute("number", number);
            itemdiv.setAttribute("account", acctid);
            itemdiv.setAttribute("isgroup", "");
            itemdiv.setAttribute("groupid", "");
            itemdiv.setAttribute("isconf", "0");
            
            var checkdiv = document.createElement('DIV');
            checkdiv.className='itemcheck';
            var checkbox = document.createElement('INPUT');
            checkbox.type = 'checkbox';
            checkbox.className = "inputcbx";
            checkdiv.appendChild(checkbox);
            itemdiv.appendChild(checkdiv);

            var icondiv = document.createElement('DIV');
            icondiv.className='itempicon';
            var itemicon = document.createElement('DIV');
            if( type == "3" )
                itemicon.className='appmissedicon';
            else if( type == "1" )
                itemicon.className='appincomingicon';
            else  
                itemicon.className='appcallouticon';
            icondiv.appendChild(itemicon);
            itemdiv.appendChild(icondiv);
            
            var namediv = document.createElement('DIV');
            namediv.className='itemname';
            var nametopdiv = document.createElement('DIV');
            nametopdiv.className='itemnamechild';
            var spantext = document.createElement('SPAN');
            spantext.innerHTML = htmlEncode(disname);
            nametopdiv.appendChild(spantext);
            var namebotdiv = document.createElement('DIV');
            namebotdiv.className='itemnamechild';
            var spantext2 = document.createElement('SPAN');
            spantext2.innerHTML = htmlEncode(number);
            namebotdiv.appendChild(spantext2);
            namediv.appendChild(nametopdiv);
            //namediv.appendChild(namebotdiv);
            itemdiv.appendChild(namediv);    

            // var durationdiv = document.createElement('DIV');
            // durationdiv.className='logitemduration';
            // var durationtext = document.createElement('SPAN');
            // if( type == "3" )
            //     durationtext.innerHTML = a_16401;
            // else
            //     durationtext.innerHTML = convertDuration(duration);
            // durationdiv.appendChild(durationtext);  
            //itemdiv.appendChild(durationdiv);                                 
            
            var datediv = document.createElement('DIV');
            datediv.className='itemnum';
            var datetext = document.createElement('SPAN');
            //datetext.innerHTML = htmlEncode(convertTime(date));
            datetext.innerHTML = htmlEncode(number);
            datediv.appendChild(datetext);
            itemdiv.appendChild(datediv);
            
            itemnum ++; 
            mContactdivObj.appendChild(itemdiv);
        }
    }
}

function getContactitems()
{
    return mContactitems;
}

function cb_get_action_done(data, action) {
    if( data.substring(0, 1) == "{" )
    {
        data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
        if( action.indexOf("sqlitecontacts" ) != "-1" ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if( action.indexOf("type=contacts") != "-1" ){   
                mContactitems = items;
                parse_contacts(items);  
                //window.parent.get_initws();  
                 //get_groups();      

            }else if( action.indexOf("type=contactinfo") != "-1" ){
                parse_contactinfo(items);
                //setaddmember_stat();            
            }
            else if( action.indexOf("type=calllog") != "-1" ){
                mUse24Hour = tObj.Use24Hour;
                mCalllogItems = items;
            }
            else if( action.indexOf("type=groups") != "-1" ){   
                var id, disname, rawcontactid;
                for (var i = 0; items[i] != undefined; i++)
                {
                    id = items[i].Id;
                    disname = items[i].Name;
                    rawcontactid = items[i].ContactId;
                                        
                    create_group_div(id, disname);
                  
                  if( rawcontactid > 0 ){
                      var membernum = $(".itemdiv[name=\"" + disname + "\"]").attr("members");
                      var membersid = $(".itemdiv[name=\"" + disname + "\"]").attr("membersid");
                      if( membersid != "" )
                          membersid += ",";
                      membersid += rawcontactid;
                      membernum ++;
                      var str = " " + a_409;
                      if( membernum > 1 ){
                          str = " " + a_2044;
                      }
                      $(".itemdiv[name=\"" + disname + "\"]").attr("members", membernum).attr("membersid", membersid).children(".itemmembers").text(membernum + str); 
                  } 
                }
                //setaddmember_stat();
            }
            window.parent.unblock_func();
        }else if(action.indexOf("getcontactsbyorder") != -1 ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if( items != undefined )
            {
                parse_contacts(items); 
                get_contact_info();
            }   
        }else if(action.indexOf("getipvrole") != -1){
            var tObj = eval("(" + data + ")");
            if(tObj.res == "success"){
                mConfrole = tObj.role;  //0-normal 1-guest 2-host 3-panelists
                if(action.indexOf("init") != -1){
                    //setTimeout(showhandsup(), 100);
                    cb_get_action("isipvthandup&region=confctrl");
                    showhandsup();
                }
                else if(action.indexOf("closeprompt") != -1){
                    if(mConfrole == "2")
                        promptTxt = a_10224;
                    else if(mConfrole == "1" || mConfrole == "3")
                    {
                        if($(".remoteline[account=0]").length > 0)
                            promptTxt = a_19354;
                        else
                            promptTxt = a_19357;
                    }else
                        promptTxt = a_10103;
                    cb_end_conf(mConfrole);
                }
            }
        }
        else if(action.indexOf("isipvthandup") != -1){
            var tObj = eval("(" + data + ")");
            var state = tObj.isHandUp;
            if(state == "true")
                $("#handsup").attr("name", a_10221).addClass("active");
        }
        else if(action.indexOf("resumecamera") != -1){
            var tObj = eval("(" + data + ")");
            if(tObj.state == "1")
                cb_get_action("getcmrnameandnumber&region=confctrl");
        }
        else if(action.indexOf("getcmrnameandnumber") != -1){
            var tObj = eval("(" + data + ")");
            if(tObj.res == "success"){
                tObj.name = tObj.cameraName;
                tObj.number = tObj.cameraNumber;
                handle_ipvtcmrinvite(tObj);
            }
        }else if(action.indexOf("record") != -1){
            data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
            var tObj = eval("(" + data + ")");
            if(tObj.res.toLowerCase() == "success")
            {
                if(tObj.msg == "false"){
                    showtip(a_605);
                    return false;
                }
            }
            else
            {
                $.prompt(a_63);
                return false;
            }
        }else if(action.indexOf("ipvtrcdstate") != -1){
            var tObj = eval("(" + data + ")");
            var state = tObj.isOn;
            if(state == "true"){
                $("#ipvtswitch").addClass("rcdstop").removeClass("rcdstart");
                $("#record").attr("isrecord", "0").addClass("active");
            }else{
                $("#ipvtswitch").addClass("rcdstart").removeClass("rcdstop");
                if($(".rcdstart").length > 1)
                    $("#record").attr("isrecord", "1").removeClass("active");
            }
        }else if(action.indexOf("isallowipvtrcd") != -1){
            var tObj = eval("(" + data + ")");
            isallowipvtrcd = eval(tObj.isAllow);
            if(isallowipvtrcd){
                $("#record").show();
                
                if(is4kon)
                    $("#localrcd").hide();
                else
                    $("#localrcd").show();
            }
        }
    }else
    {
        var msgs = res_parse_rawtext(data);
        cb_if_auth_fail(msgs);
        if (cb_is_fail(msgs)){
        }else {
            if(action == "status&region=status")
                cb_get_status_done(msgs);
            else if(action.indexOf(":gui_calldetail") != -1){
                var guidetail = msgs.headers[':gui_calldetail'];
                
                if(guidetail == 0 || guidetail == ""){
                    var urihead = "action=callstatusReport&region=confctrl&ctrlopen=0";
                    var callfn = "";
                    cb_get_confaction(urihead,callfn,true);
                }
                $("#web_calldetail").val("0");
                cb_put(req_items,"",3);
            }
            else if(action.indexOf("get&var-0000=25104") != -1){
                var hdmi1out = msgs.headers['25104'];
                hdmi1out = hdmi1out.split("P")[0];
                hdmi1out = hdmi1out.split("x");
                
                if(hdmi1out[0] >= 3840 && hdmi1out[1] >= 2160){
                    //hdmi out is 4k
                    $("#layout, #record").hide();
                    is4kon = true;
                }
                else{
                    $("#layout, #record").show();
                    is4kon = false;
                }
                return;
            }
        }
    }
}

function cb_get_status_done(msgs) {
    if (msgs.headers['account_0_no'] != undefined && msgs.headers['account_0_no'].length > 1) {
        if( mselacct == -1 )
            mselacct = 0;
        //mSIPAccountID = msgs.headers['account_0_no'];
        //mselacct = msgs.headers['account_0_no'];
        if( msgs.headers['account_0_name'].length > 0 )
            mAccountNames[0] = msgs.headers['account_0_name'];
        else
            mAccountNames[0] = mSIPAccountID;   //
    }

    if(msgs.headers['account_0_activate'] == "1"){
        mAccountActive[0] = "1";
    }else{
        mAccountActive[0] = "0";
    }

    if (msgs.headers['account_1_no'] != undefined && msgs.headers['account_1_no'].length > 1) {
        if( mselacct == -1 )
            mselacct = 1;
            //mselacct = msgs.headers['account_1_no'];
        if( msgs.headers['account_1_name'].length > 0 )
            mAccountNames[1] = msgs.headers['account_1_name'];
        else
            mAccountNames[1] = msgs.headers['account_1_no'];
    }

    if(msgs.headers['account_1_activate'] == "1"){
        mAccountActive[1] = "1";
    }else{
        mAccountActive[1] = "0";
    }

    if( msgs.headers['account_2_activate'] == "1") {
        if( msgs.headers['account_2_name'].length > 0 )
            mAccountNames[2] = msgs.headers['account_2_name'];
        else
            mAccountNames[2] = msgs.headers['account_2_no'];
        mAccountActive[2] = "1";           
    }
    else {
        mAccountActive[2] = "0";
    }

    /*if (msgs.headers['account_3_no'] != undefined && msgs.headers['account_3_no'].length > 1) {
        if( mselacct == -1 )
            mselacct = 3;
            //mselacct = msgs.headers['account_3_no'];
        if( msgs.headers['account_3_name'].length > 0 )
            mAccountNames[3] = msgs.headers['account_3_name'];
        else
            mAccountNames[3] = msgs.headers['account_3_no'];
    }
    
    if (msgs.headers['account_4_no'] != undefined && msgs.headers['account_4_no'].length > 1) {
        if( mselacct == -1 )
            mselacct = 4;
            //mselacct = msgs.headers['account_4_no'];
        if( msgs.headers['account_4_name'].length > 0 )
            mAccountNames[4] = msgs.headers['account_4_name'];
        else
            mAccountNames[4] = msgs.headers['account_4_no'];
    }

    if (msgs.headers['account_5_no'] != undefined && msgs.headers['account_5_no'].length > 1) {
        if( mselacct == -1 )
            mselacct = 5;
            //mselacct = msgs.headers['account_5_no'];
        if( msgs.headers['account_2_name'].length > 0 )
            mAccountNames[5] = msgs.headers['account_5_name'];
        else
            mAccountNames[5] = msgs.headers['account_5_no'];
    }*/

    if (msgs.headers['account_6_no'] != undefined && msgs.headers['account_6_no'].length > 1) {
        //H323 account name
        if( mselacct == -1 )
            mselacct = 8;

        if( msgs.headers['account_6_name'].length > 0 )
            mAccountNames[3] = msgs.headers['account_6_name'];
        else if( msgs.headers['account_6_no'].length > 0 )
            mAccountNames[3] = msgs.headers['account_6_no'];
        else
            mAccountNames[3] = "H.323";
    }
    if(msgs.headers['account_6_activate'] == "1"){
        mAccountActive[3] = "1";
    }else{
        mAccountActive[3] = "0";
    }
    var i = 0;
    for(i = 0; i < 4; i++){
        $("#acctselect option:eq(" + i + ")").text(mAccountNames[i]);
    }
    for(i = 3; i >= 0; i--){
        if( mAccountActive[i] == "0" ){
            $("#acctselect option:eq(" + i + ")").remove();
        }
    }
    $("#acctselect").show();
    $("#acctselect").sSelect();
    $("#acctselect").hide();
}

/*
This function is used for sending url request.
urihead: like "action=isconfdndon&region=confctrl"
callbackfn: callback function
isoperate: if retrun failed, pop failed tip or not.
*/
function cb_get_confaction(urihead,callbackfn,isoperate)
{
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            //console.log(data);
            if( data.substring(0, 1) == "{" )
            {
                data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
                if(urihead.indexOf("action=getallLineInfo") != -1)
                {
                    data = eval("([" + data + "])");
                    eval(callbackfn);
                }
                else if(urihead.indexOf("getBFCPMode") != -1){
                    var data = eval("("+data+")");
                    var mode = data.mode;
                    $("#present").attr("bfcp", mode);
                    $("#presentmode").getSetSSValue(mode);
                }
                else if(urihead.indexOf("getpresentsource") != -1){
                    var data = eval("(" + data + ")");
                    var bfcpSource = data.bfcpSource;
                    if(bfcpSource == "hdmi")
                        $("#presource").val("0");
                    else
                        $("#presource").val("1");
                    $("#presource").resetSS();
                }
                else
                {
                    var data = eval("("+data+")");

                    if(data.res == "success" || data == 0)
                        eval(callbackfn);
                    else
                    {
                        if(isoperate == true)
                        {
                            $.prompt(a_63);
                            return false;
                        }
                    }
                }
                if(urihead.indexOf("action=suspendLineOrNot") != -1)
                {
                    mSuspending = false;
                }
            }
            else
            {
                var msgs = res_parse_rawtext(data);
                cb_if_auth_fail(msgs);
            }
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}

/*
control the mask div is show or hide.
*/
function ctrl_show_maskdiv(isshow)
{
    if(isshow)
    {
        $("#transfermaskdiv").fadeTo(100,0.5);
        $("#rightsidebtn #meettingdiv img",window.parent.document).css("z-index","99");
    }
    else
    {
        $("#transfermaskdiv").fadeOut();
        $("#rightsidebtn #meettingdiv img",window.parent.document).css("z-index","999");
    }
}

function acceptvideo_callback()
{
    $("#selectlist .inputcbx").each(function(){
        if($(this).prop("checked") == true)
        {
            $(this).parent().parent().remove();       
        }
    });
    var isfirst = 0;
    $("#selectlist .inputcbx").each(function(){
        if(isfirst == 0)
        {
            $(this).attr("checked","checked");
            isfirst = 1;
        }
        else
            $(this).removeAttr("checked");
    });
}

function endcall_callback(line)
{
    var isexist = 0;
    var type = "";

    if(mDisableconf == "0")
    {
        type = mConfid;
    }
    else
    {
        type = mOnewayid;
    }
    if( $("#incominglist .itemdiv[line=\"" + line + "\"]", window.parent.document).length > 0 )
        isexist = 1;
    if($("#tabs li."+type).length > 0)
    {
        var searchdiv = "#tabs div#"+type+" div";

        $(searchdiv).each(function(){
            if($(this).attr("line") == line)
            {
                if(mDisableconf == "1")
                {
                    if($(this).attr("line") == $("#transferline div").attr("line"))
                    {
                        mAttendtransferMode=0;
                        $("#transferlinediv,#transferdiv,#loadingDiv").hide();
                        $("#incomingcalldiv",window.parent.document).css("z-index","1002");
                        $("#callingtips").hide();
                        ctrl_show_maskdiv(false);
                    }
                    if(mAttendtransferMode == 1)
                    {
                        var number = $("#transfernumselect").val();
                        if(number == undefined)
                            number = $("#transfernum").text();
                        if($(this).attr("number") == number)
                        {
                            mAttendtransferMode = 0;
                            $("#transferlinediv").hide();
                            $("#incomingcalldiv",window.parent.document).css("z-index","1002");
                            $("#callingtips").hide();
                            ctrl_show_maskdiv(false);
                        }
                    }
                }
                $(this).remove();
                //remove details
                if($(".linelist[line=\""+line+"\"]").length > 0)
                {
                    if($(".linelist[line=\""+line+"\"]").attr("class").indexOf("active") != -1)
                        $("#lineinfo").append($("#detailsarrow"));
                    $(".linelist[line=\""+line+"\"]").remove();
                    $(".linelist").first().click();
                }
                if($(this).attr("state") != "8")
                {
                    mConfmemeber_num--;
                }

                mBusylinenum = mConfmemeber_num;
                setBusylinenum();      
                if(mConfmemeber_num < mConfmemeber_maxnum)
                    $("#addmember,#addnewcall").removeAttr("disabled");
                isexist = 2;
                return false;
            }
        });
        delete mFECCState[line];
        delete mBFCPObj[line];
        var $videoinvite  = $("#selectvideodiv #selectlist div[line=\""+line+"\"]");
        delete mVideoOn_obj[line];
        if($videoinvite.length > 0)
        {
            $videoinvite.remove();
            mInvitemun--;
            if(mInvitemun <= 0 || $("#selectlist div").length <= 0)
            {
                mInvitemun = 0;
                $("#selectvideodiv").hide();
                if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible"))
                    ctrl_show_maskdiv(false);
            }
        }
        
        if($("#conf .remoteline").length <= 0)
        {
            $("#tabs li."+type).remove();
            $("#tabs div#"+type).remove();
            mTabnum--;
        }
    }

    if(mTabnum < 0)
        mTabnum = 0;
    //return 1: endingcall is in  cominglist div
    //return 2: end one line call in conf room
    return isexist;
}

function close_callback(closeline)
{
    $("#tabs li."+closeline).remove();
    $("#tabs div#"+closeline).remove();
    $("#tabs").tabs("refresh");
    mTabnum--;
    mConfmemeber_num = 0;
    mBusylinenum = mConfmemeber_num;
    setBusylinenum();
}

function hold_callback(ishold,line)
{
    /****
    0:stop hold
    1:start hold
    ***/
    var $holdbtn;
    if(line == undefined)
        line = 0;
    if(mDisableconf == "0")
        $holdbtn = $("#pause");
    else
        $holdbtn = $("#line-"+line).find(".linehold");
    if(ishold == 0)
    {
        $holdbtn.attr("ishold",1).attr("name",a_648).removeClass("active");
        if(mDisableconf == "1")
        {
            $("#line-"+line).addClass("unholdline").find(".conficon").children().attr("class","unholdicon");
        }
        else
        {
            if(mContinueRecording == 1)
            {
                $("#continuerecording").show(); 
                ctrl_show_maskdiv(true);
            }
            mContinueRecording = 0;
        }
    }
    else
    {
        $holdbtn.attr("ishold",0).attr("name",a_660).addClass("active");
        if(mDisableconf == "1")
        {
            $("#line-"+line).removeClass("unholdline").find(".conficon").children().attr("class","holdicon");
        }
        else
        {
            $("#conf .remoteline").each(function(){
                var account = parseInt($(this).attr("account"));
                if( account == 8 )
                    account = 3;
                var type = a_668+ " (" + mAccountNames[account] + ")";
                $(this).find(".conftype").children().attr("title",type).text(type);
                $(this).find(".confaudio").addClass("confvideo").removeClass("confaudio").attr("title",a_627);
            });
            $("#switchvideosource").hide();
        }
        if($("#dtmfDiv").is(":visible"))
        {
            $("#dtmfDiv").hide();
            $("#DTMF").removeClass("active");
            ctrl_show_maskdiv(false);
        }
    }
}

function closecamera_callback(isclose)
{
    /****
    1:not colse
    0:closed
    ***/
    if(isclose == 0)
    {
        $("#closecamera").attr("isclose",1).attr("title",a_628).removeClass("confvideo").addClass("confaudio");
    }
    else
    {
        $("#closecamera").attr("isclose",0).attr("title",a_627).removeClass("confaudio").addClass("confvideo");
    }
}

function addconfmember_callback()
{
    $("#addmemberdiv").hide();
    if(!$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
        ctrl_show_maskdiv(false);
}

function setdnd_callback(data,searchstr)
{
    var dndmode = "";
    var $dndbtn = $("#dndbtn",window.parent.document);
    if(data.dndtype == "dnd" || searchstr == "searchDND")
    {
        if(data.dndinfo == "dndon" || data.dndinfo == "true")
        {
            
            $("#dnd").attr("dndstate",1).addClass("active").show();
            $dndbtn.attr("dnd", "1").removeClass("dndoff").addClass("dndon");
        }
        else
        {
            $("#dnd").attr("dndstate",0).removeClass("active").show();
            $dndbtn.attr("dnd", "0").removeClass("dndon").addClass("dndoff");
        }
        if(searchstr == "searchDND")
        {
            $("#confdnd").hide();
            $(".confbasebtn button").each(function(){
                if($(this).attr("id") == "confcontrol")
                {
                    return true;
                }
                //$(this).css("marginLeft","51px")
            });
        }
    }
    else if(data.dndtype == "conf_dnd")
    {
        if(data.dndinfo == "dndon" || data.dndinfo == "true")
        {
            
            $("#confdnd").attr("name",a_9322).attr("dndstate",1).addClass("active");
            $("#tips span.tipcontent").text(a_9322);
        }
        else
        {
            $("#confdnd").attr("name",a_9321).attr("dndstate",0).removeClass("active");
            $("#tips span.tipcontent").text(a_9321);
        }
        if($("#confdnd").is(":hover"))
        {
            buttontip_position($("#confdnd"));
        }
    }

    if(searchstr != undefined && searchstr == "searchConfDND")
    {
        var flag = data.flag
        if(flag == "true")
        {
            dndmode = "2";
            $("#confdnd").attr("name",a_9322).attr("dndstate",1).addClass("active");//.show();
        }
        else
        {
            $("#confdnd").attr("name",a_9321).attr("dndstate",0).removeClass("active");//.show();
        }
        $(".confbasebtn button").each(function(){
            if($(this).attr("id") == "confcontrol")
            {
                return true;
            }
            //$(this).css("marginLeft","35px")
        });
    }

    if(searchstr != undefined && searchstr == "isscheduleconf")
    {
        var flag = data.flag;
        if(flag == "true")
        {
            urihead = "action=isconfdndon&region=confctrl";
            callfn = "setdnd_callback(data,'searchConfDND')";
            cb_get_confaction(urihead,callfn,false);
        }
    }
}

function set_ipvinfo(data){
    var IPVTitle = data.IPVTitle;
    var IPVPrefix = data.IPVPrefix;
    var IPVNumber = data.IPVNumber;
    var IPVURL = data.IPVConfURL;
    var IPVPSTN = data.IPVPSTN;
    var IPVPassword = data.IPVPassword;
    var IPVHostcode = data.IPVHostcode;
    var IPVRegion = data.IPVRegion;
    var IPVConfHost = data.IPVConfHost;
    if( IPVNumber != undefined ){
        $("#ipvconftitle").text(IPVTitle);
        $("#ipvconfnumber").text(IPVNumber);
        $("#ipvconfpass").text(IPVPassword);
        $("#ipvconfurl").text(IPVURL);
        $("#ipvconfhost").text(IPVConfHost);
        $("#ipvconfpstn").text(a_9400+" " + IPVPSTN + " " + a_15058);
		if( IPVPSTN == "0" || IPVPSTN == "" ){
            $("#pstndivs").hide();
        } 
        else{
            $("#pstndivs").show();
        }
        
		if(IPVHostcode == ""){
            $("#ipvconfhostcode").parent().hide();
        }
        else{
			$("#ipvconfhostcode").text(IPVHostcode);
            $("#ipvconfhostcode").parent().show();
        }	
		
        $("#ipvconfregion").text(IPVRegion);
		if( IPVRegion == "" ){
            $("#regiondivs").hide();
        }
        else{
            $("#regiondivs").show();
        }
        if( IPVPrefix != "" )
            mIPVPrefix = IPVPrefix;
        mIPVConfNumber = IPVPrefix + IPVNumber;
        if(IPVPassword != "" ){
            mIPVConfNumber += "*";
            mIPVConfNumber += IPVPassword;
        }
        add_linelist_event();
    }
    
}

function setconfpause_callback(data)
{
    clearTimeout(mTipTimeout);
    var state = data.state;
    var flag = data.flag;
    if(state == 4 || flag == "false")
    {
        $("#pause").attr("ishold",1).attr("name",a_648).removeClass("active");
        if($("#pause").is(":hover"))
        {
            $("#tips span.tipcontent").text(a_648);
            buttontip_position($("#pause"));
        }
        if(mContinueRecording == 1)
        {
            $("#continuerecording").show(); 
            ctrl_show_maskdiv(true);
        }
        mContinueRecording = 0;
    }
    else if(state == 5 || flag == "true")
    {
        $("#pause").attr("ishold",0).attr("name",a_660).addClass("active");
        if($("#pause").is(":hover"))
        {
            $("#tips span.tipcontent").text(a_660);
            buttontip_position($("#pause"));
        }
        $("#switchvideosource").hide();
        if($(".remoteline[account=1][state=4]").length > 0 && mConfrole == "2"){
           if($("#localswitch").hasClass("rcdstop"))
               mContinueRecording = 1;
           else
               mContinueRecording = 0;
        }
        else{
           if($("#record").attr("isrecord") == "0")
               mContinueRecording = 1;
           else
               mContinueRecording = 0;
        }
        if($("#dtmfDiv").is(":visible"))
        {
            $("#dtmfDiv").hide();
            $("#DTMF").removeClass("active");
            ctrl_show_maskdiv(false);
        }
        if($("#layoutdiv").is(":visible"))
        {
            $("#layoutdiv").hide();
            ctrl_show_maskdiv(false);
        }
        if($("#recordSelect").is(":visible")){
           $("#recordSelect").hide();
        }
        if(mDisableconf == "0")
        {
            $("#conf .remoteline").each(function(){
                var account = parseInt($(this).attr("account"));
                if( account == 8 )
                    account = 3;
                var type = a_668+ " (" + mAccountNames[account] + ")";
                $(this).find(".conftype").children().attr("title",type).text(type);
                $(this).find(".confaudio").addClass("confvideo").removeClass("confaudio");
            });
        }
    }
}

function setcameraBlocked_callback(data)
{
    var flag = data.flag;
    if(flag == "false" || flag == "0")
    {
        $("#closecamera").attr("isclose",1).attr("title",a_628).removeClass("confvideo").addClass("confaudio");
        
    }
    else if(flag == "true" || flag == "1")
    {
        $("#closecamera").attr("isclose",0).attr("title",a_627).removeClass("confaudio").addClass("confvideo");
        
    }
}

function setmute_callback(data)
{
    clearTimeout(mTipTimeout);
    var line = data.line;
    var flag = 0;
    if(data.islinemute)
       flag = parseInt(data.islinemute);
    else
        if(data.flag)
            flag = parseInt(data.flag);

    var $mutediv = $("div#line-"+line);

    if(flag == 0)
    {
        //not mute
        $mutediv.find(".mute").attr("ismute",1).attr("title",a_649).removeClass("unmute active");
        $("#muteall").attr("ismuteall","0").attr("name",a_10130).removeClass("active");
        if($("#muteall").is(":hover"))
        {
            $("#tips span.tipcontent").text(a_10130);
            buttontip_position($("#muteall"));
        }
    }
    else
    {
        //mute
        $mutediv.find(".mute").attr("ismute",0).attr("title",a_659).addClass("unmute active");
        var mutenum = 0;
        var accpetline = 0;
        $(".remoteline").each(function(){
            if($(this).find(".mute").attr("ismute") == "0" && $(this).attr("state") == "4")
                mutenum++;
            if($(this).attr("state") == "4")
                accpetline++;
        });
        if(mutenum == accpetline && mutenum != 0)
        {
            $("#muteall").attr("ismuteall","1").attr("name",a_10131).addClass("active");
            if($("#muteall").is(":hover"))
            {
                $("#tips span.tipcontent").text(a_10131);
                buttontip_position($("#muteall"));
            }
        }
    }
}

function localmute_callback(data)
{
    var flag = "";
    if(data.flag)
       flag = data.flag;

    if(flag == "true")
        $("#localmute").attr("ismute",0).attr("title",a_659).addClass("unmute active");
    else if(flag.indexOf("=") != -1){
        flag = flag.split("=");
        if(flag[0] == "MuteMic"){
            if(flag[1] == "1")
                $("#localmute").attr("ismute",0).attr("title",a_659).addClass("unmute active");
            else
                $("#localmute").attr("ismute",1).attr("title",a_649).removeClass("unmute active");
        }
    };
}

function setBFCP_callback(data)
{
    clearTimeout(mTipTimeout);
    if(mDisableconf == "1")
        return false;
    /*if($("#disablepresent",window.parent.document).val() == "1" && !hasIPVNumber())
    {
        $("#present").hide();
        return false;
    }*/
    var flag = data.msg;
    var line = data.line;
    var $present = $("#present");
    if(flag == "seton" || flag == "true" || flag == "2" || flag == "3")
    {
        if((data.bfcp != undefined && data.bfcp == "2") || flag == "2")
        {
            $present.hide();
            $("#presentselect").hide();
            var recline = data.recline;
            if(line != undefined && line != "")
                $present.attr("bfcpline",line).attr("bfcp","2");
            if(recline != undefined && recline != "")
                $present.attr("bfcpline",recline).attr("bfcp","2");
        }
        else
        {
            //if there is any one line receive BFCP, hide the present button
            if($present.attr("bfcp") != "2")
            {
                $present.show();
                //$("#switchvideosource").parent().show();
                //$present.attr("ison",1).addClass("active").removeAttr("bfcpline").removeAttr("bytype").removeAttr("bfcp").attr("name",a_10003+" "+a_10004);
                $present.attr("ison",1).addClass("active").removeAttr("bfcpline").removeAttr("bytype").attr("name",a_10003+" "+a_10004);
                if($("#present").is(":hover"))
                {
                    $("#tips span.tipcontent").text(a_10003+" "+a_10004);
                    buttontip_position($present);
                }
                if(line != undefined && line != "")
                {
                    if(line.indexOf(",") != -1)
                    {
                        var linearray = line.split(",");
                        for(var n=0; n <= (linearray.length - 1); n++)
                        {
                            if(linearray[n] != "")
                                mBFCPObj[linearray[n]] = true;
                        }
                    }
                    else
                        mBFCPObj[line] = true;
                }
            }
        }
        /*var allbfcpsupport = true;
        var videoline_notbfcp = false;
        $("#conf div.remoteline").each(function(){
            var bfcpstate = $(this).attr("bfcpstate");
            if (bfcpstate != "1" && bfcpstate != "3" && bfcpstate != "4" && bfcpstate != "5" && allbfcpsupport) {
                allbfcpsupport = false;
            }
            if($(this).attr("isvideo") == "1" && bfcpstate == "0" && !videoline_notbfcp)
            {
                videoline_notbfcp = true;
            }
        });
        if(allbfcpsupport){
            $("#switchvideosource").hide();
        }else if(videoline_notbfcp){
            $("#switchvideosource").show();
        }*/
    }
    else if(flag == "setoff" || flag == "false" || flag == "5")
    {
        if(line != undefined && line != "")
        {
            if(line.indexOf(",") != -1)
            {
                var linearray = line.split(",");
                for(var n=0; n <= (linearray.length - 1); n++)
                {
                    delete mBFCPObj[linearray[n]];
                }
            }
            else
                delete mBFCPObj[line];
        }
        var num = 0;
        for(var i in mBFCPObj)
            num++;

        if($present.attr("bfcp") == "2" && $present.attr("bfcpline") == line)
        {
            mBFCPObj = {};
            $present.show();
            if( $("#switchvideosource").attr("ison") != "1" ){
                $present.attr("ison",0).removeClass("active").removeAttr("bfcpline").removeAttr("bytype").removeAttr("bfcp").attr("name",a_10002+" "+a_10004);
                if($("#present").is(":hover"))
                {
                    $("#tips span.tipcontent").text(a_10002+" "+a_10004);
                    buttontip_position($present);
                }
            }else{
                $present.attr("bytype","videosource");
            }
        }
        else if(num == 0)
        {
            if($present.attr("bfcp") != "2")
            {
                mBFCPObj = {};
                $present.show();
                if( $("#switchvideosource").attr("ison") != "1" ){
                    $present.attr("ison",0).removeClass("active").removeAttr("bfcpline").removeAttr("bytype").removeAttr("bfcp").attr("name",a_10002+" "+a_10004);
                    if($("#present").is(":hover"))
                    {
                        $("#tips span.tipcontent").text(a_10002+" "+a_10004);
                        buttontip_position($present);
                    }
                }else{
                    $present.attr("bytype","videosource");
                }
            }
        }
    }
    
    if(flag != "0" && flag != "1")
    {
        if($("#layoutdiv").css("display") == "block")
            $("#layoutdiv").hide();
    }
}

function FECC_callback(line,flag)
{
    if(flag == 1)
    {
        //start FECC
        var ctrlname = "";
        if(line == "-1")
        {
            //control local
            ctrlname = a_10032;
        }
        else
            ctrlname= $("#line-"+line).attr("name");
            
        var acct = $(".remoteline[line=" + line + "]").attr("account");
        var showp = "<p class='showctrlname'>"+htmlEncode(ctrlname)+"</p>";
        $("#ctrlFECCDiv").attr("line",line);
        ctrl_show_maskdiv(true);
        $("#ctrlFECCDiv .fecctips").find(".showctrlname").remove();
        $("#ctrlFECCDiv .fecctips").append(showp);
        $("#presetbtndiv").hide();
        if(acct == "8"){
            $("#feccleft").hide();
            $("#ctrlFECCDiv").css({"width":"350px", "height":"480px", "top":"0", "left":"0", "right":"0", "bottom":"0", "margin":"auto"});
            $("#ctrldiv").parent().css("left", "5px");
        }
        else{
            create_preset_div(line);
            $("#feccleft").show();
            $("#ctrldiv").parent().css("left", "45px");
        }
        $("#ctrlFECCDiv").show();
    }
    else
    {
        //stop FECC
        $("#ctrlFECCDiv").hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);
    }
}

function updateDNDState(data)
{
    clearTimeout(mTipTimeout);
    var mode = data.dndmode;
    var state = parseInt(data.state);
    switch(mode)
    {
        case "none":
            $("#dnd").attr("dndstate",state).removeClass("active").show();
            break;
        case "dnd":
            if(state == 1)
            {
                $("#dnd").attr("dndstate",state).addClass("active").show();
                $("#dndbtn",window.parent.document).attr("dnd", "1").removeClass("dndoff").addClass("dndon");
            }else
            {
                $("#dnd").attr("dndstate",state).removeClass("active").show();
                $("#dndbtn",window.parent.document).attr("dnd", "0").removeClass("dndon").addClass("dndoff");
            }
            break;
        case "conf_dnd":
            if(state == 1)
            {
                $("#confdnd").attr("name",a_9322).attr("dndstate",state).addClass("active");//.show();
                $("#tips span.tipcontent").text(a_9322);
            }else
            {
                $("#confdnd").attr("name",a_9321).attr("dndstate",state).removeClass("active");//.show();
                $("#tips span.tipcontent").text(a_9321);
            }
            if($("#confdnd").is(":hover"))
            {
                buttontip_position($("#confdnd"));
            }
            break;
        default:
            break;
    }
}

function setsubstream_callback(data)
{
    //this is open/close presentation in PC mode
    clearTimeout(mTipTimeout);
    var state = data.state;
    if(state == "true" || state == "1")
    {
        $("#switchvideosource").addClass("active").attr("ison","1").attr("name",a_10107);
        if( $("#present").attr("ison") == "0" ){
            $("#present").attr("ison",1).addClass("active").attr("bytype","videosource").attr("name",a_10003+" "+a_10004)
            if($("#present").is(":hover"))
            {
                $("#tips span.tipcontent").text(a_10003+" "+a_10004);
                buttontip_position($("#present"));
            }
        }
    }
    else if(state == "false" || state == "0")
    {
        $("#switchvideosource").removeClass("active").attr("ison","0").attr("name",a_10108);
        $("#present").attr("ison",0).removeClass("active").removeAttr("bytype").attr("name",a_10002+" "+a_10004)
        if($("#present").is(":hover"))
        {
            $("#tips span.tipcontent").text(a_10002+" "+a_10004);
            buttontip_position($("#present"));
        }
    }
    
    if($("#layoutdiv").is(":visible"))
        $("#layoutdiv").hide();
    
    urihead = "action=getBFCPMode&region=confctrl";
    cb_get_confaction(urihead, "", false);
}

function setrecord_callback(data)
{
    var isrecord = data.state;
    if(isrecord == "1" || isrecord == "true")
    {
        $("#record").attr("isrecord",0).addClass("active");
        $("#continuerecording").hide(); 
        
        if($(".remoteline[account=1][state=4]").length > 0 && mConfrole == "2"){
            $("#localswitch").addClass("rcdstop").removeClass("rcdstart");
        }
        
        if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);
    }
    else
    {
        if($(".remoteline[account=1][state=4]").length > 0 && mConfrole == "2"){
            $("#localswitch").addClass("rcdstart").removeClass("rcdstop");
            if($(".rcdstart").length > 1)
                $("#record").attr("isrecord",1).removeClass("active");
        }else{
            $("#record").attr("isrecord",1).removeClass("active");
        }
    }
    if(isrecord == "2")
    {
        $("#continuerecording").hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);
    }
}

function handle_unhold_record(data){
    $("#continuerecording").hide();
    if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
        ctrl_show_maskdiv(false);
}

function video_Inviteres_callback(data,res)
{
    /*
    *res
    * 0: means accept video invite
    * 1: means start video invite to other line
    */
    var flag = data.flag;
    var line = data.line;
    var $inviteline = $("#selectlist div[line=\""+line+"\"]");
    if(res == 1)
    {
        delete mVideoOn_obj[line];
        if(flag == "0")
        {
            $("#operatetip span").text(a_632);
            $("#operatetip").fadeIn();
            setTimeout(function(){$("#operatetip").fadeOut();},2000);
        }
        else
        {
            $("#line-"+line).find(".confsuspend").attr("issuspend","0").attr("title",a_16700).removeClass("active");
            $("#line-"+line).find(".isvideoed").attr("isvideoed","0").attr("title",a_19241).removeClass("active");
            $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
        }
    }
    else
    {
        $("#selectlist div[line=\""+line+"\"]").remove();
        $("#line-"+line).find(".confsuspend").attr("issuspend","0").attr("title",a_16700).removeClass("active");
        if(flag == "1")
        {
            $("#suspendall").attr("name",a_10134).attr("issuspendall","0").removeClass("active");
        }
        mInvitemun--;
        if(mInvitemun <= 0 || $("#selectlist div").length <= 0)
        {
            mInvitemun = 0;
            $("#selectvideodiv").hide();
            if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible"))
                ctrl_show_maskdiv(false);
        }
    }
}

function handle_video_on(data)
{
    /*
    *send video invite to other line
    */
    var line = data.line;
    mVideoOn_obj[line] = 1;
    
    var ipvtline = $(".remoteline[account=1]").attr("line");
    if(line == ipvtline){
        handle_promptdiv();
    }
}

/*
Call Features tips
*/
function handle_callfeature(data)
{
    var state = parseInt(data.state);
    var tipstr = "";
    var number = mCF_number;
    var forward = mCF_number;

    switch(state)
    {
        case 0:
            tipstr = a_612;
            break;
        case 1:
            tipstr = a_611;
            break;
        case 2:
            tipstr = a_613;
            break;
        case 3:
            tipstr = a_614;
            break;
        case 4:
            break;
        case 5:
            break;
        case 6:
            break;
        case 7:
            break;
        case 8:
            forward = number.substring(3,number.length);
            tipstr = a_38 + " " +a_617 + " " + forward;//enable
            break;
        case 9:
            tipstr = a_39 + " " +a_618;//disable
            break;
        case 10:
            tipstr = a_619;
            break;
        case 11:
            tipstr = a_620;
            break;
        case 12:
            break;
        case 13:
            break;
        case 14:
            break;
        case 15:
            tipstr = a_621;
            break;
        case 16:
            tipstr = a_622;
            break;
        case 17:
            forward = number.substring(3,number.length);
            tipstr = a_38 + " " +a_10137 + " " + forward;
            break;
        case 18:
            tipstr = a_39 + " " +a_623;
            break;
        case 19:
            forward = number.substring(3,number.length);
            tipstr = a_38 + " " +a_10136 + " " + forward;
            break;
        case 20:
            tipstr = a_39 + " " +a_624;
            break;
        case 21:
            tipstr = a_38 + " SRTP";
            break;
        case 22:
            tipstr = a_39 + " SRTP";
            break;
        default:
            break;
    }

    $("#tabs #conf div[number=\""+number+"\"]").find(".confdel").click();
    //cb_send_endcall_action( $("#tabs #conf div[number=\""+number+"\"]").attr("line") );
    
    if(tipstr != "")
    {
        $("#cf_message span",window.parent.document).text(tipstr);
        $("#cf_message",window.parent.document).fadeIn();
        setTimeout(function(){$("#cf_message",window.parent.document).fadeOut();},2000);
    }
}

function handle_feccstate(data)
{
    var line = data.line;
    var state = data.state;

    if(state == "0")
    {
        $("#ctrlFECCDiv").hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);
    }
    else
    {
        var ctrlname = "";
        if(line == "-1")
        {
            //control local
            ctrlname = a_10032;
        }
        else
            ctrlname= $("#line-"+line).attr("name");
            
        var acct = $(".remoteline[line=" + line + "]").attr("account");
        var showp = "<p class='showctrlname'>"+htmlEncode(ctrlname)+"</p>";
        $("#ctrlFECCDiv").attr("line",line);
        ctrl_show_maskdiv(true);
        $("#ctrlFECCDiv .fecctips").find(".showctrlname").remove();
        $("#ctrlFECCDiv .fecctips").append(showp);
        $("#DTMF").removeClass("active");
        $("#presetbtndiv, #layoutdiv, #dtmfDiv").hide();
        if(acct == "8"){
            $("#feccleft").hide();
            $("#ctrlFECCDiv").css({"width":"350px", "height":"480px", "top":"0", "left":"0", "right":"0", "bottom":"0", "margin":"auto"});
            $("#ctrldiv").parent().css("left", "5px");
        }
        else{
            create_preset_div(line);
            $("#feccleft").show();
            $("#ctrldiv").parent().css("left", "45px");
        }
        $("#ctrlFECCDiv").show();
    }
}

/*
line transfer can be removed
*/
function attend_trnf_callback(data)
{
    if(mAttendtransferMode != 0 && $("#transfernext").attr("mode") != "blind_1")
        return false;
    
    var attendline = data.line;
    var attendtonumber = data.number;   
    var dialsel = "<span id='transfernum' dialacct=0 style='display:none;'>"+htmlEncode(attendtonumber)+"</span>";
    var noticespan = "<p id='transfernotice'></p>";
    if(!$("#transferdiv").is(":visible") && $("#transferdiv").attr("line") != attendline)
        $("#onewaycall div[line=\""+attendline+"\"]").find(".linetransfer").click();
    mAttendtransferMode = 1;
    $("#transferselectlist").empty().append(noticespan);
    $("#transferselectlist").append(dialsel);
    $("#transferselectlist #transfernotice").text(a_634).show();
    $("#transferselectlist #transfernotice").siblings().hide();
    $("#transferlinediv .selectbtn button").hide();
    $("#transferlinediv,#attendcancel").show();
    $("#incomingcalldiv",window.parent.document).css("z-index","-1");
    $("#transfernext").attr("mode","blind_3");
    ctrl_show_maskdiv(true);
}
/*
line transfer can be removed
*/
function blind_trnf_callback(data)
{
    if(mAttendtransferMode != 0 && $("#transfernext").attr("mode") != "blind_1")
        return false;

    var attendline = data.line;
    var attendtonumber = data.number;   
    if(!$("#transferdiv").is(":visible") && $("#transferdiv").attr("line") != attendline)
        $("#onewaycall div[line=\""+attendline+"\"]").find(".linetransfer").click();
    mAttendtransferMode = 3;
    transfer_callback();
    ctrl_show_maskdiv(true);
    $("#loadingDiv .downfont").text(a_524);
    $("#loadingDiv").show();
    $("#incomingcalldiv",window.parent.document).css("z-index","-1");
}

function getdtmfstring_callback(data)
{
    var dtmfstr = "";
    var maxlength=12;
    var hide_content,new_content;

    if(mDisableconf == "0")
    {
        dtmfstr = data.dtmfstr;
    }
    else
    {
        //data = data.split(",");
        for(var n=0; n < data.length ; n++)
        {
            var state = data[n].state;
            if(state == "4")
            {
                dtmfstr = data[n].dtmf;
                break;
            }
        }
    }
    if(mIncalldtmf == "1")
    {
        var pswstr = "";
        var pswlength = 0;
        if(dtmfstr.length > maxlength) 
        {
            pswlength = maxlength - 1;
        }
        else
        {
            pswlength = dtmfstr.length;
        }
        for(var n=0; n<pswlength ; n++)
        {
            pswstr += mReplacement;
        }
        $("#dtmfinput p").html(pswstr);
    }
    else
    {
        if(dtmfstr.length > maxlength)
        {
            hide_content = dtmfstr.substr(0, dtmfstr.length-maxlength );
            dtmfstr = dtmfstr.substr(dtmfstr.length-maxlength, dtmfstr.length );
        }
        new_content = "<span style='display: none'>" + hide_content + "</span>" + dtmfstr;
        $("#dtmfinput p").html(new_content);
    }

    mDTMFstr = dtmfstr;
}

/*
judge the conference is held or not.
if the conference is held, some button will not be enabled.
*/
function judge_ispause()
{
    if(mDisableconf == "0")
    {
        if($("#pause").attr("ishold") == "0")
        {
            $.prompt(a_10126);
            return false;
        }
        else
            return true;
    }
    else
    if(mDisableconf == "1")
    {
        var isallhold = true;
        $("#onewaycall .confdiv").each(function(){
            var state = $(this).attr("hold");
            if(state != "hold")
            {
                isallhold = false;
                return;
            }
        });
        if(isallhold)
        {
            return false;
        }
        else
            return true;
    }
}

/*
when click "Add Member", reset state about member list.
*/
function setaddmember_stat()
{
    var selectid;
    $("#contactsdiv .inputcbx").attr("checked",false).removeAttr("disabled");
    $("#contactsdiv .itemdiv.confdiv.searchnewItem").remove();
    if(mDisableconf == "1")
        return ;
    $("#tabs div").each(function(){
        if($(this).attr("aria-hidden") == "false")
        {
            selectid = $(this).attr("id");
            return;
        }

    });
    $("#addmemberdiv #contactsdiv div.itemdiv").removeAttr("isexist");
    $("#tabs div#"+selectid+" div.remoteline").each(function(){
        var id = $(this).attr("number");
        var callingname = $(this).children(".confname").children("span").attr("title");
        $("#addmemberdiv #contactsdiv div.itemdiv").each(function(){
            var $this = $(this);
            var num = $this.attr("number");
            var membername = $this.attr("name");
            var classname = $this.attr("class");
            if(classname.indexOf("contactcalllog") == -1)
            {
                if(num == "")
                {
                    //group
                    if(id == $this.attr("id"))
                    {
                        $this.children(".inputcbx").attr("checked","checked");
                        $this.attr("isexist","exist");//if existed, it would not be clone to conf room
                    }
                }
                else
                {
                    //contact
                    if(id == num && callingname==membername)
                    {
                        $this.children().find(".inputcbx").attr("checked","checked").attr("disabled","disabled");
                        $this.attr("isexist","exist");
                    }
                }
            }
        });
    });
}

function transfer_callback()
{
    $("#transferlinediv,#transferdiv").hide();
}

function getlayout_callback(data)
{
    //get layout_channellist
    var cunstomdata = "";
    var urihead = "action=getlayoutlineinfo&region=confctrl";
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        async:false,
        dataType:'text',
        success:function(data) {
            if( data.substring(0, 1) == "{" )
            {
                data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
                data = eval("("+data+")");
                cunstomdata = data;
                var res = data.res;
                if(res.toLowerCase() == "success")
                {
                }
                else
                {
                    $.prompt(a_63);
                    return false;
                }
            }
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
    var action = "gethdmi1state&region=status";
    var hdmi1state = getHDMIinfo(action);
    action = "get&var-0000=hdmi2&var-0001=hdmi3";
    var hdmi23state = getHDMIinfo(action);
    var hdmioutmode;
    //console.log("hdmi1state = " + hdmi1state + ",hdmi23state = " + hdmi23state);
    if(hdmi1state == 0 && hdmi23state == 6)
    {
        showLayout_onlyhdmi1(data,cunstomdata);
        hdmioutmode = 1;
    }
    else if(hdmi1state == 0 && hdmi23state == 4)
    {
        //all hdmi out is plugged
        showLayout_allhdmiout(data,cunstomdata);
        hdmioutmode = 3;
    }
    else if(hdmi1state == 0 && hdmi23state == 5)
    {
        //hdmi out 1 and 2 are plugged
        showLayout_withouthdmi3(data,cunstomdata);
        hdmioutmode = 2;
    }
    //urihead = "action=getcustomslayout&region=confctrl";
    //callbackfn = "showLayout_custom(data)";
    //cb_get_confaction(urihead,callbackfn);
    $("#layout").attr("hdmioutmode",hdmioutmode);
    urihead = "action=getcustomslayout&region=confctrl";
    var callbackfn = "showLayout_custom(data,"+cunstomdata.mode+")";
    cb_get_confaction(urihead,callbackfn);
}

function displayLayout(data){
    var hdmi1state = data.state;
    if(hdmi1state != 1){
        $.prompt(a_10081 + a_19380);
        return false;
    }
    
    mIsSysrcmd = parseInt(cb_get_layoutinfo("action=issysrcmdmode&region=confctrl"));
    var hdmi2state = cb_get_layoutinfo("action=gethdmi2state&region=status");
    mHdmi2state = hdmi2state;
    
    var hdmi1mode, hdmi1content;
    hdmi1mode = cb_get_layoutinfo("action=gethdmi1displaymode&region=confctrl");
    hdmi1content = cb_get_layoutinfo("action=gethdmi1displaycontent&region=confctrl");
    
    if(hdmi1content.indexOf("15") != -1 || $("#present").attr("bfcp") == "2")
        mHdmiModeContent[4] = 1;   //to identify if current presentation contains signal 15
    else
        mHdmiModeContent[4] = 0;
    if(parseInt(hdmi1mode) >= 4)
        mHdmiModeContent[0] = (parseInt(hdmi1mode) - 3).toString();
    else
        mHdmiModeContent[0] = hdmi1mode;

    var re1 = new RegExp(",", "g");
    var re2 = new RegExp("15", "g");
    mHdmiModeContent[1] = hdmi1content.replace(re1, ":::").replace(re2, "12");
    
    if(hdmi2state == 1){
        var hdmi2mode = cb_get_layoutinfo("action=gethdmi2displaymode&region=confctrl");
        var hdmi2content = cb_get_layoutinfo("action=gethdmi2displaycontent&region=confctrl");
        if(hdmi2content.indexOf("15") != -1)
            mHdmiModeContent[4] = 1;
        else{
            if(hdmi1content.indexOf("15") == -1 && $("#present").attr("bfcp") != "2")
                mHdmiModeContent[4] = 0;
        }
        
        if(parseInt(hdmi2mode) >= 4)
            mHdmiModeContent[2] = (parseInt(hdmi1mode) - 3).toString();
        else
            mHdmiModeContent[2] = hdmi2mode;
        mHdmiModeContent[3] = hdmi2content.replace(re1, ":::").replace(re2, "12");
    }
    
    var linecount = $(".remoteline[isvideo=1]").length;
    if(linecount > 1){
        $(".modelist li[mode=pop]").hide();
        $(".lastline").hide();
    }
    else{
        $(".modelist li[mode=pop]").attr("title", a_19386);
    }
    $(".modelist li[mode=sysrcmd]").attr("title", a_19383);
    $(".modelist li[mode=overlap]").attr("title", a_19384);
    $(".modelist li[mode=childmother]").attr("title", a_19385);
    $(".modelist li[mode=custom]").attr("title", a_10151);
    
    layout_choosemode(hdmi1mode);
    
    $(".layoutcontainer").children().remove();

    if(hdmi1mode >= 4 && hdmi2state == 0)
        display_default1screenlayout(hdmi1mode, mHdmiModeContent[1]);
    else if(hdmi1mode >= 4 && hdmi2state == 1)
        display_default2screenlayout(hdmi1mode, mHdmiModeContent[1], hdmi2mode, mHdmiModeContent[3]);
    else if(hdmi1mode < 4){
        mCurhdmi = 1;
        $(".modelist li[mode=custom]").attr("childmode", hdmi1mode);
        display_customscreenlayout(hdmi1mode, mHdmiModeContent[1], 1, hdmi2state);
    }
    
    $("#layoutdiv").show();
}

function cb_get_layoutinfo(urihead){
    var returninfo;
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        async:false,
        dataType:'text',
        success:function(data) {
            data = eval("(" + data + ")");
            if(data.res == "success"){
                if(urihead.indexOf("gethdmi2state") != -1)
                    returninfo = data.state;
                else if(urihead.indexOf("displaymode") != -1)
                    returninfo = data.mode;
                else if(urihead.indexOf("displaycontent") != -1)
                    returninfo = data.lines;
                else if(urihead.indexOf("issysrcmdmode") != -1)
                    returninfo = data.state;
            }
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
    
    return returninfo;
}

function layout_choosemode(mode){
    $(".modelist li").removeClass("active");
    $(".modelist li div").removeClass("active");
    
    if(mIsSysrcmd){
        $(".modelist li[mode=sysrcmd]").addClass("active");
        $(".modelist li[mode=sysrcmd] div").addClass("active");
        return;
    }
    
    switch (mode) {
        case "1":
        case "2":
        case "3":
            $(".modelist li[mode=custom]").addClass("active");
            $(".modelist li[mode=custom] div").addClass("active");
            break;
        case "4":
            $(".modelist li[mode=overlap]").addClass("active");
            $(".modelist li[mode=overlap] div").addClass("active");
            break;
        case "5":
            $(".modelist li[mode=childmother]").addClass("active");
            $(".modelist li[mode=childmother] div").addClass("active");
            break;
        case "6":
            $(".modelist li[mode=pop]").addClass("active");
            $(".modelist li[mode=pop] div").addClass("active");
            break;
    }
}

/*only available for one remote line*/
function layout_adjuststyle(type, mode, content){
    var presenton = parseInt($("#present").attr("ison"));
    if(!presenton && mHdmiModeContent[4] == 1)
        presenton = 1;
    
    var isvideo = false;
    $("#conf .remoteline").each(function(){
        var videocall = $(this).attr("isvideo");
        if(videocall == "1")
        {
            isvideo = true;
            return false;
        }
    });
    
    var oemflag = 0;
    if(mOEMID == "54" && mIsSysrcmd && mode == 6 && mHdmiModeContent[1].indexOf("12") != -1)
        oemflag = 1;
    
    switch (type) {
        case 1: //one screen with default mode
            $(".layoutcontainer").css({"height":"63%", "min-height":"500px"});
            $(".layoutbkgdiv").css({"min-height":"488.8px", "width":"78%", "height":"75%", "margin":"5% 0 0 11.5%"});
            if(mode == 4 || oemflag == 1){
                if(!presenton || (presenton && !isvideo && !mIsSysrcmd)){
                    $(".layoutlinediv").css({"margin":"17% 0 0 1.7%", "width":"47.5%", "height":"50%"});
                    $(".layoutlinediv .layoutlinename").css("margin-top", "31%");
                }
                else{
                    if(mIsSysrcmd)
                        $(".layoutlinediv").css({"margin":"11px", "width":"97.2%", "height":"95.5%"});
                    else{
                        $(".layoutlinediv").css({"margin":"13px 0 0 1.7%", "width":"47.5%", "height":"46%"});
                        $("#layoutline-12").css({"margin-left":"26%"});
                    }
                }
            }
            else if(mode == 5){
                if(!presenton || (presenton && !isvideo)){
                    $(".largelinediv").css({"width":"65%", "height":"65%", "margin":"12% 0 0 13px"});
                    $(".smalllinediv").css({"width":"30%", "height":"30%", "margin":"23% 13px 0 0"});
                }
                else{
                    $(".largelinediv").css({"width":"65%", "height":"62.5%", "margin":"12.5% 0 0 13px"});
                    $(".smalllinediv").css({"width":"30%", "height":"30%", "margin":"12.5% 13px 0 0"});
                    $("#layoutline-13").css({"margin-top":"13px"});
                }
            }
            else if(mode == 6){
                if(!presenton || (presenton && !isvideo)){
                    $(".layoutlinename").css("margin-top", "30%");
                    //$(".smalllinediv .layoutlinename").css("margin-top", "30%");
                    $(".largelinediv").css({"width":"97%", "height":"95%", "margin":"12px", "position":"relative"});
                    $(".smalllinediv").css({"bottom":"0", "right":"0", "border":"2px solid #6b6b6b", "width":"30%", "height":"30%", "position":"absolute"});
                }
                else{
                    $(".largelinediv").css({"margin":"11px", "width":"97.2%", "height":"95.5%", "position":"relative"});
                    $(".largelinediv .layoutlinename").css("margin-top", "31%");
                    $(".smalllinediv").css({"bottom":"0", "right":"0", "border":"2px solid #6b6b6b", "width":"30%", "height":"30%", "position":"absolute"});
                    $("#layoutline-13").css({"left":"0"});
                }
            }
            break;
        case 2: //one/two screen with custom mode
            $("#layoutcustom").css({"width":"65%", "height":"100%", "float":"left", "margin-left":"15px"});
            $(".hdmititle").css({"height":"8.4%", "width":"100%", "position":"relative"});
            $(".layoutcontainer").css({"height":"67%", "min-height":"550px"});
            $(".layoutbkgdiv").css({"min-height":"488.8px", "height":"75%", "width":"100%"});
            if(content.length == 1){
                $(".layoutlinediv").css({"margin":"10px", "width":"97%", "height":"87.5%"});
                $(".layoutlinediv .layoutlinename").css({"margin-top":"33%"});
                
                $(".layoutnumber").each(function(){
                    if($(this).attr("line") == content){
                        if(mode == "1")
                            $(this).children(".normalscreen").addClass("active");
                        else
                            $(this).children(".fullscreen").addClass("active");
                    }
                    else{
                        $(this).children(".hidescreen").addClass("active");
                    }
                });
            }
            else{
                var layouthtml = "";
                switch (mode) {
                    case "1":
                        if(content.length == 2){
                            $(".layoutlinediv").css({"margin":"21% 0 0 1.7%", "width":"47.5%", "height":"40%"});
                            $(".layoutnumber").each(function(){
                                var line = $(this).attr("line");
                                if(line == content[0] || line == content[1])
                                    $(this).children(".normalscreen").addClass("active");
                                else
                                    $(this).children(".hidescreen").addClass("active");
                            });
                        }
                        else if(content.length == 3){
                            $(".layoutlinediv").css({"margin":"13px 0 0 2%", "width":"47%", "height":"38%"});
                            $(".layoutlinediv:eq(0)").css({"margin-left":"26.5%", "margin-top":"33px"});
                            $(".normalscreen").addClass("active");
                        }
                        break;
                    case "2":
                        if(content.length == 2){
                            $(".largelinediv").css({"width":"65%", "height":"53%", "margin":"16% 0 0 11px"});
                            $(".smalllinediv").css({"width":"30%", "height":"27%", "margin":"27% 11px 0 0"});
                            $(".layoutnumber").each(function(){
                                var line = $(this).attr("line");
                                if(line == content[0])
                                    $(this).children(".fullscreen").addClass("active");
                                else if(line == content[1])
                                    $(this).children(".normalscreen").addClass("active");
                                else
                                    $(this).children(".hidescreen").addClass("active");
                            });
                        }
                        else if(content.length == 3){
                            $(".largelinediv").css({"width":"64%", "height":"52.5%", "margin":"17% 0 0 13px"});
                            $(".layoutlinediv .layoutlinename").css({"margin-top":"31%"});
                            $(".smalllinediv").css({"width":"30%", "height":"25%", "margin":"17% 13px 0 0"});
                            $(".smalllinediv:eq(1)").css({"margin-top":"13px"});
                            $(".layoutnumber").each(function(){
                                var line = $(this).attr("line");
                                if(line == content[1] || line == content[2])
                                    $(this).children(".normalscreen").addClass("active");
                                else
                                    $(this).children(".fullscreen").addClass("active");
                            });
                        }
                        break;
                    case "3":            
                        if(content.length == 2){
                            $(".layoutlinename").css("margin-top", "33%");
                            $(".smalllinediv .layoutlinename").css("margin-top", "30%");
                            $(".largelinediv").css({"width":"97%", "height":"87.5%", "margin":"10px", "position":"relative"});
                            $(".smalllinediv").css({"bottom":"0", "right":"0", "border":"2px solid #6b6b6b", "width":"30%", "height":"28%", "position":"absolute"}); 

                            $(".layoutnumber").each(function(){
                                var line = $(this).attr("line");
                                if(line == content[0])
                                    $(this).children(".fullscreen").addClass("active");
                                else if(line == content[1])
                                    $(this).children(".normalscreen").addClass("active");
                                else
                                    $(this).children(".hidescreen").addClass("active");
                            });
                        }
                        else if(content.length == 3){
                            $(".largelinediv").css({"margin":"10px", "width":"97%", "height":"87.5%", "position":"relative"});
                            $(".largelinediv .layoutlinename").css("margin-top", "31%");
                            $(".smalllinediv").css({"bottom":"0", "right":"0", "border":"2px solid #6b6b6b", "width":"30%", "height":"30%", "position":"absolute"});
                            $(".smalllinediv:eq(1)").css({"left":"0"});
                            
                            $(".layoutnumber").each(function(){
                                var line = $(this).attr("line");
                                if(line == content[1] || line == content[2])
                                    $(this).children(".normalscreen").addClass("active");
                                else
                                    $(this).children(".fullscreen").addClass("active");
                            });
                        }
                    break;
                }
            }
            $(".cusmode").removeClass("active");
            if(mode == "1")
                $(".cusoverlap").addClass("active");
            else if(mode == "2")
                $(".cuschildmother").addClass("active");
            else
                $(".cuspop").addClass("active");
            
            break;
        case 3: //two screen with default mode;
            $(".layouthdmi").css({"width":"50%", "float":"left", "height":"80%"});
            $(".layouthdmitext").css({"width":"90%", "height":"20%", "text-align":"center", "font-size":"22px", "line-height":"120px", "margin-left":"8%"});
            $(".layoutcontainer").css({"height":"63%", "min-height":"500px"});
            $(".layoutbkgdiv").css({"width":"90%", "min-height":"338.9px", "height":"65%", "margin-left":"8%"});
            $("#layoutbkg2, #layouthdmitext2").css({"margin-left":"4%"});
            
            if(presenton && !isvideo){
                $(".layoutbkgdiv").children().css({"margin":"10px", "width":"95.5%", "height":"94.2%"});
                $(".layoutlinename").css({"margin-top":"35%"});
                
                if(mode == 6)
                    $("#layoutbkg2").children().children(".smalllinediv").remove();
            }
            else{
                if(mode == 4){
                    if(!presenton){
                        if(!mIsSysrcmd){
                            $("#layoutbkg1 .layoutlinediv").css({"margin":"10px", "width":"95.5%", "height":"94.2%"});
                            $("#layoutbkg1 .layoutlinename").css({"margin-top":"35%"});
                            $("#layoutbkg2 .layoutlinediv").css({"margin":"25% 0 0 1.7%", "width":"47.5%", "height":"40%"});
                            $("#layoutbkg2 .layoutlinename").css({"margin-top":"26%"});
                        }
                        else{
                            $(".layoutlinediv").css({"margin":"10px", "width":"95.5%", "height":"94.2%"});
                            $(".layoutlinename").css({"margin-top":"35%"});
                        }
                    }
                    else{
                        $("#layoutbkg1 .layoutlinediv").css({"margin":"10px", "width":"95.5%", "height":"94.2%"});
                        $("#layoutbkg1 .layoutlinename").css({"margin-top":"35%"});
                        $("#layoutbkg2 .layoutlinediv").css({"margin":"25% 0 0 1.7%", "width":"47.5%", "height":"40%"});
                        $("#layoutbkg2 .layoutlinename").css({"margin-top":"26%"});
                    }
                }
                else if(mode == 5){
                    $("#layoutbkg1 .layoutlinediv").css({"margin":"10px", "width":"95.5%", "height":"94.2%"});
                    $("#layoutbkg1 .layoutlinename").css({"margin-top":"35%"});
                    $("#layoutbkg2 .largelinediv").css({"width":"64%", "height":"55%", "margin":"19% 0 0 9px"});
                    $("#layoutbkg2 .smalllinediv").css({"width":"30%", "height":"28%", "margin":"30% 9px 0 0"});
                    $("#layoutbkg2 .layoutlinename").css({"margin-top":"26%"});
                }
                else if(mode == 6){
                    $("#layoutbkg1 .layoutlinediv").css({"margin":"10px", "width":"95.5%", "height":"94.2%"});
                    $("#layoutbkg1 .layoutlinename").css({"margin-top":"35%"});
                    $("#layoutbkg2 .largelinediv").css({"width":"95.5%", "height":"94.2%", "margin":"10px", "position":"relative"});
                    $("#layoutbkg2 .smalllinediv").css({"position":"absolute", "right":"0", "bottom":"0", "border":"2px solid #6b6b6b", "width":"30%", "height":"28%"});
                    $("#layoutbkg2 .largelinediv .layoutlinename").css({"margin-top":"35%"});
                    $("#layoutbkg2 .smalllinediv .layoutlinename").css({"margin-top":"26%"});
                }
            }
            break;
    }
}

function layout_customscreenadjuststyle(mode, content){
    content = content.split(":::");
    
    $(".layoutbkgdiv").children().each(function(){
        if(!$(this).hasClass("cusmodecls"))
            $(this).remove();
    });
    
    if(content.length == 1){
        var layouthtml = display_layoutlinediv(content, 1);
        $(".cusmodecls").before(layouthtml);
        $(".layoutlinediv").css({"margin":"10px", "width":"97%", "height":"87.5%"});
        $(".layoutlinediv .layoutlinename").css({"margin-top":"33%"});
    }
    else{
        var layouthtml = "";
        switch (mode) {
            case "1":
                for(var i = 0; i < content.length; i++){
                    layouthtml += display_layoutlinediv(content[i], mode);
                }
                $(".cusmodecls").before(layouthtml);
                if(content.length == 2){
                    $(".layoutlinediv").css({"margin":"21% 0 0 1.7%", "width":"47.5%", "height":"40%"});
                }
                else if(content.length == 3){
                    $(".layoutlinediv").css({"margin":"13px 0 0 2%", "width":"47%", "height":"38%"});
                    $(".layoutlinediv:eq(0)").css({"margin-left":"26.5%", "margin-top":"33px"});
                }
                break;
            case "2":
                for(var i = 0; i < content.length; i++){
                    layouthtml += display_layoutlinediv(content[i], mode, i);
                }
                $(".cusmodecls").before(layouthtml);
                if(content.length == 2){
                    $(".largelinediv").css({"width":"65%", "height":"53%", "margin":"16% 0 0 11px"});
                    $(".smalllinediv").css({"width":"30%", "height":"27%", "margin":"27% 11px 0 0"});
                }
                else if(content.length == 3){
                    $(".largelinediv").css({"width":"64%", "height":"52.5%", "margin":"17% 0 0 13px"});
                    $(".layoutlinediv .layoutlinename").css({"margin-top":"31%"});
                    $(".smalllinediv").css({"width":"30%", "height":"25%", "margin":"17% 13px 0 0"});
                    $(".smalllinediv:eq(1)").css({"margin-top":"13px"});
                }
                break;
            case "3":            
                    layouthtml = display_layoutlinediv(content, mode);
                    $(".cusmodecls").before(layouthtml);
                    if(content.length == 2){
                        $(".layoutlinename").css("margin-top", "33%");
                        $(".smalllinediv .layoutlinename").css("margin-top", "30%");
                        $(".largelinediv").css({"width":"97%", "height":"87.5%", "margin":"10px", "position":"relative"});
                        $(".smalllinediv").css({"bottom":"0", "right":"0", "border":"2px solid #6b6b6b", "width":"30%", "height":"30%", "position":"absolute"});
                    }
                    else if(content.length == 3){
                        $(".largelinediv").css({"margin":"10px", "width":"97%", "height":"87.5%", "position":"relative"});
                        $(".largelinediv .layoutlinename").css("margin-top", "31%");
                        $(".smalllinediv").css({"bottom":"0", "right":"0", "border":"2px solid #6b6b6b", "width":"30%", "height":"30%", "position":"absolute"});
                        $(".smalllinediv:eq(1)").css({"left":"0"});
                    }
                break;
        }
    }
}

function layout_returncontent(mode, hdmi){
    var presenton = parseInt($("#present").attr("ison"));
    if(!presenton && mHdmiModeContent[4] == 1)
        presenton = 1;
    var hdmi2state = parseInt(mHdmi2state);
    
    var flag = false;
    $("#conf .remoteline").each(function(){
        var isvideo = $(this).attr("isvideo");
        if(isvideo == "1")
        {
            flag = true;
            return false;
        }
    });
    
    var content1, content2;
    if(!hdmi2state && !presenton)
        content1 = "0:::13";
    else if(!hdmi2state && presenton){
        if(mIsSysrcmd || (mode == "1" && mIsSysrcmdBefore))
            content1 = "12";
        else{
            if(!flag){
                content1 = "12:::13";
            }
            else{
                content1 = "12:::0:::13";
            }
        }
    }
    else if(hdmi2state && !presenton){
        if(mIsSysrcmd || (mode == "1" && mIsSysrcmdBefore)){
            content1 = "0";
            content2 = "13";
        }
        else{
            content1 = "0";
            content2 = "13:::0";
        }
    }
    else if(hdmi2state && presenton){
        if(!flag){
            content1 = "12";
            content2 = "13";
        }
        else{
            content1 = "12";
            content2 = "0:::13";
        }
    }
    
    if(hdmi == 1)
        return content1;
    else
        return content2;
}

function handle_hdmistatus(data){
    var hdmi = data.hdmi;
    var status = data.status;
    if(hdmi.indexOf("2") != -1)
        mHdmi2state = status;
    if($("#layoutdiv").css("display") == "block")
        $("#layoutdiv").hide();
}

function display_default1screenlayout(mode, content){
    var layouthtml = "<div class='layoutbkgdiv'>";
    content = content.split(":::");
    if(mode == 6){
        layouthtml += display_layoutlinediv(content, mode);
    }
    else{
        for(var i = 0; i < content.length; i++){
            layouthtml += display_layoutlinediv(content[i], mode, i);
        }
    }

    layouthtml += "</div>";
    $(".layoutcontainer").append(layouthtml);
    var type = 1;
    layout_adjuststyle(type, mode);
}

function display_default2screenlayout(hdmi1mode, hdmi1content, hdmi2mode, hdmi2content){
    var layouthtml = "<div class='layouthdmi'><div class='layouthdmitext'>HDMI 1</div><div id='layoutbkg1' class='layoutbkgdiv'></div></div>" + 
                     "<div class='layouthdmi'><div id='layouthdmitext2' class='layouthdmitext'>HDMI 2</div><div id='layoutbkg2' class='layoutbkgdiv'></div></div>";
                     
    $(".layoutcontainer").append(layouthtml);
    
    hdmi1content = hdmi1content.split(":::");
    hdmi2content = hdmi2content.split(":::");
    
    for(var i = 0; i < hdmi1content.length; i++){
        $("#layoutbkg1").append(display_layoutlinediv(hdmi1content[i], 4));
    }
    
    if(hdmi2mode == 6){
        $("#layoutbkg2").append(display_layoutlinediv(hdmi2content, hdmi2mode, i));
    }
    else{
        for(var i = 0; i < hdmi2content.length; i++){
            $("#layoutbkg2").append(display_layoutlinediv(hdmi2content[i], hdmi2mode, i));
        }
    }
    
    var type = 3;
    layout_adjuststyle(type, hdmi1mode);
}

function display_customscreenlayout(mode, content, hdmi, hdmi2state){
    $(".layoutcontainer").children().remove();
    var layoutnumberlisthtml = "<div class='layoutnumberlist'>"    
        
    if($("#present").attr("ison") == "1" || mHdmiModeContent[4] == 1){
        layoutnumberlisthtml += "<div id='presentline' class='layoutnumber' line='12' name=" + a_10004 + "><span class='linename'>" + a_10004 + "</span><span class='layoutpresenticon' title=" + a_10004 + "></span><span class='hidescreen screendiv' title=" + a_19339 + "></span><span class='normalscreen screendiv' title=" + a_12168 + "></span><span class='fullscreen screendiv' title=" + a_12167 + "></span></div>"
    }
    
    var linecount = 0;
    $(".remoteline[isvideo=1]").each(function(){
        var name = $(this).attr("name");
        var number = $(this).attr("number");
        var line = $(this).attr("line");
        layoutnumberlisthtml += "<div id='remoteline-" + line + "' class='layoutnumber' line="+ line +" name=" + name + " number=" + number + "><span class='linename' title=" + name + ">" + name + "</span><span class='hidescreen screendiv' title=" + a_19339 + "></span><span class='normalscreen screendiv' title=" + a_12168 + "></span><span class='fullscreen screendiv' title=" + a_12167 + "></span></div>"
        linecount++;
    });
    
    var account = $(".remoteline").attr("account");
    layoutnumberlisthtml += "<div id='localline' class='layoutnumber' line='13' name=" + a_10032 + " number=" + mAccountNames[parseInt(account)] + "><span class='linename' title=" + mAccountNames[parseInt(account)] + ">" + mAccountNames[parseInt(account)] + "</span><span class='layoutlocalicon' title=" + a_10032 + "></span><span class='hidescreen screendiv' title=" + a_19339 + "></span><span class='normalscreen screendiv' title=" + a_12168 + "></span><span class='fullscreen screendiv' title=" + a_12167 + "></span></div>"
    
    layoutnumberlisthtml += "</div>";
    
    $(".layoutcontainer").append(layoutnumberlisthtml);
    if(mode == 1)
        $(".fullscreen").hide();
    else
        $(".fullscreen").show();
    
    checkifhidenormalsrc(mode, hdmi, hdmi2state);
    
    var layouthtml = "<div id='layoutcustom'>" +
                     "<div class='hdmititle'>" +
                     "<div id='hdmi1div' class='hdmidiv'><div>HDMI 1</div><div class='hdmi_arrow'></div></div>" +
                     "<div id='hdmi2div' class='hdmidiv'><div>HDMI 2</div><div class='hdmi_arrow'></div></div></div>" +
                     "<div class='layoutbkgdiv'>";
                
    var mcontent = content.split(":::");
    if(mcontent.length == 1){
        layouthtml += display_layoutlinediv(mcontent, 1);
    }
    else{
        switch (mode) {
            case "1":
                for(var i = 0; i < mcontent.length; i++){
                    layouthtml += display_layoutlinediv(mcontent[i], mode);
                }
                break;
            case "2":
                for(var i = 0; i < mcontent.length; i++){
                    layouthtml += display_layoutlinediv(mcontent[i], mode, i);
                }
                break;
            case "3":
                layouthtml += display_layoutlinediv(mcontent, mode);
                break;
        }
    }
             
    layouthtml += "<div class='cusmodecls'>" +
                  "<ul><li class='cusmode cusoverlap' mode='1'></li>" +
                  "<li class='cusmode cuschildmother' mode='2'></li>" +
                  "<li class='cusmode cuspop' mode='3'></li></ul>" +
                  "</div></div></div>";
                  
    $(".layoutcontainer").append(layouthtml);

    var type = 2;
    if(hdmi2state == 0){
        $("#hdmi2div").hide();
    }
    else{
        var cuscontent = "";
        for(var i = 0; i < mcontent.length; i++)
            cuscontent += mcontent[i] + ":::";
        cuscontent = cuscontent.substring(0, cuscontent.length - 3);
        
        if(hdmi == 1){
            mHdmiModeContent[0] = mode;
            mHdmiModeContent[1] = cuscontent;
            //$("#hdmi1div").attr("mode", mode).attr("content", cuscontent);
            $("#hdmi1div .hdmi_arrow").show();
            $("#hdmi2div .hdmi_arrow").hide();
        }
        else{
            mHdmiModeContent[2] = mode;
            mHdmiModeContent[3] = cuscontent;
            //$("#hdmi2div").attr("mode", mode).attr("content", cuscontent);
            $("#hdmi2div .hdmi_arrow").show();
            $("#hdmi1div .hdmi_arrow").hide();
        }
    }

    layout_adjuststyle(type, mode, mcontent);
}

function display_layoutlinediv(line, mode, order){
    var name, number;
    var account = $(".remoteline").attr("account");
    
    if(line == 13){
        name = a_10032;
        number = "(" + mAccountNames[parseInt(account)] + ")";
    }else if(line == 12){
        name = a_10004;
        number = "";
    }
    else{
        name = $("#line-" + line).attr("name");
        number = "(" + $("#line-" + line).attr("number") + ")";
    }
    
    var oemflag = 0;
    if(mOEMID == "54" && mIsSysrcmd && mode == 6 && mHdmiModeContent[1].indexOf("12") != -1)
        oemflag = 1;
    
    var linedivhtml = "";
    if(mode == 1 || mode == 4 || oemflag == 1)
        linedivhtml = "<div id='layoutline-" + line + "' class='layoutlinediv'><div class='layoutlinename' title="+name+">" + name + "</div><div class='layoutlinenumber' title="+number+">" + number + "</div></div>";
    else if(mode == 2 || mode == 5){
        if(order == 0){
            linedivhtml = "<div id='layoutline-" + line + "' class='largelinediv'><div class='layoutlinename' title="+name+">" + name + "</div><div class='layoutlinenumber' title="+number+">" + number + "</div></div>";
        }
        else{
            linedivhtml = "<div id='layoutline-" + line + "' class='smalllinediv'><div class='layoutlinename' title="+name+">" + name + "</div><div class='layoutlinenumber' title="+number+">" + number + "</div></div>";
        }
    }
    else if(mode == 3 || mode  == 6){
        var name = new Array();
        var number = new Array();
        
        for(var i = 0; i < line.length; i++){
            if(line[i] == "12"){
                name.push(a_10004);
                number.push("");
            }
            else if(line[i] == "13"){
                name.push(a_10032);
                number.push("(" + mAccountNames[parseInt(account)] + ")");
            }
            else{
                name.push($("#line-" + line[i]).attr("name"));
                number.push("(" + $("#line-" + line[i]).attr("number") + ")");
            }
        }
        
        if (line.length < 3 || ($("#present").attr("ison") == "0" && mHdmiModeContent[4] != 1)) {
            linedivhtml = "<div id='layoutline-" + line[0] + "' class='largelinediv'><div><div class='layoutlinename' title="+name[0]+">" + name[0] + "</div><div class='layoutlinenumber' title="+number[0]+">" + number[0] + "</div></div><div id='layoutline-" + line[1] + "' class='smalllinediv'><div class='layoutlinename' title="+name[1]+">" + name[1] + "</div><div class='layoutlinenumber' title="+number[1]+">" + number[1] + "</div></div></div>";
        }
        else{
            linedivhtml = "<div id='layoutline-" + line[0] + "' class='largelinediv'><div><div class='layoutlinename' title="+name[0]+">" + name[0] + "</div><div class='layoutlinenumber' title="+number[0]+">" + number[0] + "</div></div><div id='layoutline-" + line[1] + "' class='smalllinediv'><div class='layoutlinename' title="+name[1]+">" + name[1] + "</div><div class='layoutlinenumber' title="+number[1]+">" + number[1] + "</div></div><div id='layoutline-" + line[2] + "' class='smalllinediv'><div class='layoutlinename' title="+name[2]+">" + name[2] + "</div><div class='layoutlinenumber' title="+number[2]+">" + number[2] + "</div></div></div>";
        }
    }
    return linedivhtml;
}

function switch_screenactive(line, nextline){
    $(".layoutnumber[line=" + line + "]").children(".screendiv").each(function(){
        if($(this).hasClass("active") && $(this).is(":visible"))
            $(this).removeClass("active");
        else if(!$(this).hasClass("active") && $(this).is(":visible")){
            $(this).addClass("active");
        }
    });
    
    $(".layoutnumber[line=" + nextline + "]").children(".screendiv").each(function(){
        if($(this).hasClass("active") && $(this).is(":visible"))
            $(this).removeClass("active");
        else if(!$(this).hasClass("active") && $(this).is(":visible")){
            $(this).addClass("active");
        }
    });
}

/*if device performance allowed this function can be removed*/
function checkifhidenormalsrc(mode, hdmi, hdmi2state){
    if(hdmi2state == 1){
        if(hdmi == 1){
            var allowscreenum = 4 - mHdmiModeContent[3].split(":::").length;
        }else{
            var allowscreenum = 4 - mHdmiModeContent[1].split(":::").length;
        }
            
        if(allowscreenum == 1 && mode != 1){
            $(".layoutnumber").children(".normalscreen").hide();
        }
        else if(allowscreenum > 1 && mode != 1){
            $(".layoutnumber").children(".normalscreen").show();
        }
    }
}

function addfullscreenEvent()
{
    $(".fullscreenbtn").unbind("click").click(function(){
        var fullhdmi = $(this).parent().parent().attr("id");
        var max_show_line = $(this).parent().attr("pipstate");
        var layoutmode = "max_show_chn";
        var suspendstate = $("#line-"+max_show_line).find(".confsuspend").attr("issuspend");
        var urihead = "action=setlayoutmode&region=confctrl&mode="+encodeURIComponent(layoutmode)+"&pipstate="+max_show_line;
        var movetoid;
        if(suspendstate == "1")
        {
            return false;
        }
        //cb_get_confaction(urihead,"");
        if(fullhdmi == "hdmiout3" || fullhdmi == "hdmiout1")
        {
            movetoid = "#hdmiout2";
            if(fullhdmi == "hdmiout3")
                urihead = "action=setlayoutmode&region=confctrl&mode=max_hdmi_out&pipstate=3";
            else
                urihead = "action=setlayoutmode&region=confctrl&mode=max_hdmi_out&pipstate=1";
        }
        else if(fullhdmi == "hdmiout2")
        {
            urihead = "action=setlayoutmode&region=confctrl&mode=max_hdmi_out&pipstate=2";
            if($("#hdmiout3").length > 0)
            {
                movetoid = "#hdmiout3";
            }
            else
            {
                movetoid = "#hdmiout1";
            }
        }
        //cb_get_confaction(urihead,"");
        $(this).parent().removeClass("minhdmipip").addClass("mainhdmipip");
        $(this).parent().parent().children(".picturehdmi.minhdmipip").appendTo($(movetoid));
        $(movetoid).children(".mainhdmipip").removeClass("mainhdmipip").addClass("minhdmipip");
        $(".fullscreenbtn").hide();
        addfullscreenEvent();
    });
    $(".mainhdmipip").unbind("hover");
    $(".minhdmipip").hover(function(){
        $(this).children(".fullscreenbtn").show();
    },function(){
        $(this).children(".fullscreenbtn").hide();
    });
}

function muteclick(e,islocal){
    /**
    parameter:ismute
    0:it can be muted
    1:cancel mute

    parameter:islocal
    true:local mute
    false:Line Mute
    **/
    var clicktarget = e.target;
    var ismute = $(clicktarget).attr("ismute");

    if(!islocal)
    {
        var line = $(clicktarget).parent().parent().attr("line");
        var urihead = "action=ctrllinemute&region=confctrl&line="+line+"&setmute="+ismute;
    }
    else
    {
        var urihead = "action=ctrllocalmute&region=confctrl&setmute="+ismute;
    }
  
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            //console.log(data);
            if( data.substring(0, 1) == "{" )
            {
                data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
                var data = eval("("+data+")");
                var res = data.res;
                if(res.toLowerCase() == "success")
                {
                    if(islocal)
                    {
                        if(ismute == 0)
                            $("#tips span.tipcontent").text(a_649);
                        else
                            $("#tips span.tipcontent").text(a_659);

                        buttontip_position($("#localmute"));
                    }
                }
                else
                {
                    $.prompt(a_63);
                    return false;
                }
            }else
            {
                var msgs = res_parse_rawtext(data);
                cb_if_auth_fail(msgs);
            }
            if(ismute == 0)
                $(clicktarget).attr("ismute",1).attr("title",a_649).removeClass("unmute active");
            else
                $(clicktarget).attr("ismute",0).attr("title",a_659).addClass("unmute active");
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}

/*
redial line
*/
function ctrlredialline(e)
{
    var redialine = e.target;
    var line = $(redialine).parent().parent().attr("line");
    var urihead = "action=redialLines&region=confctrl&line=" + line;
    cb_get_confaction(urihead,"",true);
    
    /*var number = $(redialine).parent().parent().attr("number");
    var acctindex = $(redialine).parent().parent().attr("account");
    var isvideo = $(redialine).parent().parent().attr("audiovideo");
    var urihead = "";
    var callfn = "";
    var redialtime = 50;
    var isip = 0;
    var callmode = "call";
    if(mIPtest.test(number.split(":")[0]))
    {
        isip = 1;
        callmode = "ipcall";
    }
    //$(redialine).siblings(".confdel").click();
    cb_send_endcall_action( line );
    
    if(mConfmemeber_num <= 1)
        redialtime = 1200;
    setTimeout(function(){
        if(mDisableconf == "1")
            cb_start_single_call(number, acctindex, 0,isip);
        else
        {
            urihead = "action=addconfmemeber&region=confctrl&numbers=" + encodeURIComponent(number) + "&accounts=" + encodeURIComponent(acctindex) + "&callmode="+encodeURIComponent(callmode)+"&confname=";

            callfn = "";
            cb_start_addmemberconf(number, acctindex, callmode,"",isvideo);
            //cb_get_confaction(urihead,callfn,true);
        }
    },redialtime);
    */
}

function ctrlvideostate(e,ison)
{
    /**
    parameter:ison
    0:set video off
    1:set video on
    **/
    var clicktarget = e.target;
    var line = $(clicktarget).parent().parent().attr("line");
    var urihead = "action=ctrlvideostate&region=confctrl&isflag="+ison+"&line="+line;

    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            var account = "";
            if( data.substring(0, 1) == "{" )
            {
                data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
                var data = eval("("+data+")");
                var res = data.res;
                if(res.toLowerCase() == "success")
                {}
                else
                {
                    $.prompt(a_63);
                    return false;
                }
            }else
            {
                var msgs = res_parse_rawtext(data);
                cb_if_auth_fail(msgs);
            }
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}

function ctrlFECC(line,flag)
{
    /**
    parameter:flag
    0:set FECC off
    1:set FECC on
    **/
    var urihead = "";
    var callbackfn = "";
    if(flag == 1)
    {
        urihead = "region=confctrl&action=startFECC&line="+line;
        callbackfn = "FECC_callback("+line+",1)";
    }
    else
    {
        urihead = "region=confctrl&action=stopFECC&line="+line;
        callbackfn = "FECC_callback("+line+",0)";
    }
    cb_get_confaction(urihead,callbackfn,true);
}

function isEnableFECC(line)
{
    var flag = true;
    var urihead = "region=confctrl&action=isFECCEnable&line="+line;
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        async:false,
        success:function(data) {
            //console.log(data);
            if( data.substring(0, 1) == "{" )
            {
                data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
                var data = eval("("+data+")");
                var res = data.res;
                if(res.toLowerCase() == "success")
                {
                    if(data.flag == "true")
                    {
                        flag = true;
                    }
                    else
                    {
                        flag = false;
                    }
                }
                else
                {
                    flag = false;
                }
            }else
            {
                var msgs = res_parse_rawtext(data);
                cb_if_auth_fail(msgs);
            }
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });

    return flag;
}

function ctrllinetransfer(e)
{
    $("#transferline").empty();
    $("#transfersearch").val("");
    $("#transferlist").empty();
    var $this = $(e.target).parent().parent();
    var $clonediv = $this.clone();
    var cloneid = $this.attr("id") + "-clone";
    var line = $this.attr("line");
    var defaultmode = $("#tranfermode",window.parent.document).val();
    if(defaultmode == undefined)
        defaultmode = "0";
    $clonediv.attr("id",cloneid);
    $clonediv.removeClass("conflisthover").children(".confbtn").remove();
    $clonediv.find(".numlist").remove();
    $clonediv.find(".conficon").children().attr("class","appcontacticon");
    $clonediv.find(".conftype").css("width","300px");
    $("#transferline").append($clonediv);

    $this.siblings().each(function(){
        var clone_holdid = $(this).attr("id") + "-clone";
        if(clone_holdid != cloneid)
        {
            $clonediv = $(this).clone();
            $clonediv.attr("id",clone_holdid).addClass("itemdiv").css("font-size","13px");
            $clonediv.children(".confbtn").remove();
            $clonediv.find(".numlist").remove(); 
            $clonediv.find(".confname").addClass("itemname");
            $clonediv.find(".confnum").addClass("logitemduration");
            $clonediv.find(".conftype").addClass("itemnumber");
            mTransferlistdiv.append($clonediv);
        }
    });

    if(mCalllogItems != "")
        parse_calllog(mCalllogItems);

    if(mContactitems == "")
    {
        window.parent.block_download_func(a_6660);
        get_contact();
    }
    parse_contacts(mContactitems,1);

    $("#transferdiv").attr("line",line).show();
    $("#transfermode").val(defaultmode).resetSS();
    addtransferItemEvent();
}

function dealwith_transfer(e)
{
    var $this = $(e.currentTarget);
    var mode = $("#transfermode").val();
    var noticetip = a_16674;
    var noticespan = "<p id='transfernotice'>"+htmlEncode(noticetip)+"</p>";
    var dialsel = "<select id='dialnumselect' dialacct="+dialacct+">";
    var id = $this.attr("id");

    $("#transferselectlist").empty().append(noticespan);

    if(id.indexOf("contact") != -1)
    {
        var dialnum = $this.attr("number")
        var dialnumarray = dialnum.split(":::");
        var numbernum = $this.attr("numbernum");
        var dialacct = $this.attr("account");
        numbernum = parseInt(numbernum);
        if(numbernum == 1)
        {
            var dialsel = "<span id='transfernum' dialacct="+dialacct+">"+htmlEncode(dialnumarray[0])+"</span>";
            $("#transferselectlist").append(dialsel);
        }
        else
        {
            dialacct = dialacct.split(",");
            var dialsel = "<select id='transfernumselect' dialacct="+dialacct[0]+">";
            for(var i = 0;i < numbernum; i++)
            {
                var numopt = "<option value="+dialnumarray[i]+">"+htmlEncode(dialnumarray[i])+"</option>";
                dialsel += numopt;
            }
            dialsel += "</select>";
            $("#transferselectlist").append(dialsel);
            $("#transfernumselect option:eq(0)").attr("selected","selected");
            $("#transferlinediv").show();
            $("#transfernumselect").sSelect({ddMaxHeight:'250px'});
            $("#transferlinediv").hide();
            $("#transfernumselect").next(".newListSelected").hide();
        }
    }
    else
        if(id.indexOf("calllog") != -1)
        {
            var number = $this.attr("number");
            var dialacct;
            var dialsel = "<span id='transfernum' dialacct="+dialacct+" style='display:none;'>"+htmlEncode(number)+"</span>";
            $("#transferselectlist").append(dialsel);
        }
        else
            if(id.indexOf("line") != -1)
            {
                var number = $this.attr("number");
                var dialacct;
                var dialsel = "<span id='transfernum' dialacct="+dialacct+" style='display:none;'>"+htmlEncode(number)+"</span>";
                $("#transferselectlist").append(dialsel);
            }
            else
            if(id.indexOf("transferok") != -1)
            {
                var number = $.trim($("#transfersearch").val());
                var dialacct;
                var dialsel = "<span id='transfernum' dialacct="+dialacct+" style='display:none;'>"+htmlEncode(number)+"</span>";
                if(number == "")
                {
                    $.prompt(a_7483);
                    return false;
                }
                $("#transferselectlist").append(dialsel);
            }
    mAttendtransferMode = 4;//ready to transfer
    $("#transferdetach,#attendcancel").hide();
    $("#transfernext, #transferpopcancel").attr("mode","blind_1").show();
    $("#transferlinediv").show();
    $("#incomingcalldiv",window.parent.document).css("z-index","-1");
    ctrl_show_maskdiv(true);
}

function judge_addmemeber(number,account)
{
    var numlist = mConfnumlist.split(":::");
    var acclist = mConfacctlist.split(":::");
    var flag = false;

    for(var i=0;i<numlist.length;i++)
    {
        if(numlist[i] == number && acclist[i] == account)
        {
            flag = true;
            break;
        }
    }

    return flag;
}

/*
The function is used for details.
*/
function add_linelist_event()
{
    $("#lineinfo .linelist").click(function(){
        var $this = $(this);
        var line = $this.attr("line");
        var isvideo = $("#conf div[line=\""+line+"\"]").attr("isvideo");
        $("#linedetails .onedetails").show();
        $("#linedetails .onedetails .presentdetail").hide();
        var account = $("#conf .remoteline[line=\""+line+"\"]").attr("account");
        if(account == 1){
            $("#ipvconfdetails").show();
            $("#detailscontent").css("height","630px");
            
        }else{
            $("#ipvconfdetails").hide();
            $("#detailscontent").css("height","375px");
        }
        $("#detailsarrow").show();
        $("#linedetails .onedetails").attr("line",line);
        $this.siblings().removeClass("active");
        if(!$this.hasClass("active"))
            $("#linedetails .onedetails").find(".spancontent").text("");
        $this.append($("#detailsarrow")).addClass("active");
        if(isvideo == "0")
        {
            //if line is audio, hide video details
            $(".onedetails[line=\""+line+"\"] .videodetail .spancontent").text("");
        }
    });
    $("#lineinfo .linelist").first().click();
}

function showDetails(data)
{
    if( $("#detailsdiv").is(":hidden") ){
        return false;
    }
    var detailtype;
    if(data.video_snd == "" && data.video_rcv == "")
        detailtype = "audio";
    else
        detailtype = "video";

    var line = data.line;
    if( parseInt(line) > 7 )
        return false;
    var str_array = new Array();
    /*var strinfo = data.str;
    str_array.push(strinfo);
    str_array.push(data.str2);
    str_array.push(data.str3);*/
    
    if(detailtype == "video"){
        str_array.push(data.video_snd);
        str_array.push(data.video_rcv);
        str_array.push(data.audio_snd);
        str_array.push(data.audio_rcv);
    }else {
        str_array.push(data.audio_snd);
        str_array.push(data.audio_rcv);
    }


    var detailDivline = $("#linedetails .onedetails").attr("line");
    if(detailDivline == line){
        //if( detailtype == "audio" ){
            $("#detailsendnum").text(mSendWholeBit);
            $("#detailreceivenum").text(mRecvWholeBit);
            mSendWholeBit = 0;
            mRecvWholeBit = 0;
        //}
    }
    
    var curbite = 0;
    var curstr = "";
    for(var i=0; i<str_array.length ;i++){
        curstr = str_array[i];
        if( curstr != "" ){
            var bitstr = curstr.split("bitrate=");
            var bitstr1 = bitstr[1].split(";");
            curbite = parseInt(bitstr1[0]);
            if( curstr.indexOf("mode=snd") != -1 ){
                mSendWholeBit += curbite;
            }else if( curstr.indexOf("mode=rcv") != -1 ){
                mRecvWholeBit += curbite;
            }
        }
    }
    
    
    if(detailDivline != line){  
        return false;
    }

    //var $linedetails = $("#linedetails .onedetails[line=\""+line+"\"]");
    //var $needupdateline;
    
    for(var i = 0; i < str_array.length; i++){
        var tObj;
        var $updatediv;
        var curtype;
        
        if(detailtype == "video"){
            switch (i) {
                case 0:
                    tObj = splitStrarray(str_array[i].split("snd;")[1], "video");
                    $updatediv = $(".videodetail .sendinfo");
                    curtype = "video";
                    break;
                case 1:
                    tObj = splitStrarray(str_array[i].split("rcv;")[1], "video");
                    $updatediv = $(".videodetail .receinfo");
                    curtype = "video";
                    break;
                case 2:
                    tObj = splitStrarray(str_array[i].split("snd;")[1], "audio");
                    $updatediv = $(".audiodetail .sendinfo");
                    curtype = "audio";
                    break;
                case 3:
                    tObj = splitStrarray(str_array[i].split("rcv;")[1], "audio");
                    $updatediv = $(".audiodetail .receinfo");
                    curtype = "audio";
                    break;
            }
        }else{
            switch (i) {
                case 0:
                    tObj = splitStrarray(str_array[i].split("snd;")[1], "video");
                    $updatediv = $(".audiodetail .sendinfo");
                    curtype = "audio";
                    break;
                case 1:
                    tObj = splitStrarray(str_array[i].split("rcv;")[1], "video");
                    $updatediv = $(".audiodetail .receinfo");
                    curtype = "audio";
                    break;
            }
        }
        
        if(curtype == "video"){
            $updatediv.children(".lostdiv").children(".spancontent").text(tObj.lost);
            $updatediv.children(".bitratediv").children(".spancontent").text(tObj.bitrate);
            $updatediv.children(".fpsdiv").children(".spancontent").text(tObj.fps + a_16277);
            $updatediv.children(".codecdiv").children(".spancontent").text(tObj.codec);
            $updatediv.children(".resolutiondiv").children(".spancontent").text(tObj.resolution);
        }
        else{
            $updatediv.children(".lostdiv").children(".spancontent").text(tObj.lost);
            $updatediv.children(".bitratediv").children(".spancontent").text(tObj.bitrate);
            $updatediv.children(".codecdiv").children(".spancontent").text(tObj.codec);
        }

        if(data.present_content != ""){
            $(".presentdetail").show();
            var presentdetail = data.present_content.split(";");
            var $sndorrev;
            if(presentdetail[1].indexOf("snd") != -1){
                $(".presentdetail .sendinfo").show();
                $(".presentdetail .receinfo").hide();
                $sndorrev = $(".presentdetail .sendinfo");
            }
            else{
                $(".presentdetail .receinfo").show();
                $(".presentdetail .sendinfo").hide();
                $(".presentdetail .receinfo").css({"float":"right", "margin-right":"19px"});
                $sndorrev = $(".presentdetail .receinfo");
            }
            
            $sndorrev.children(".lostdiv").children(".spancontent").text(presentdetail[2].split("=")[1]);
            $sndorrev.children(".bitratediv").children(".spancontent").text(presentdetail[3].split("=")[1]);
            $sndorrev.children(".fpsdiv").children(".spancontent").text(presentdetail[4].split("=")[1] + a_16277);
            $sndorrev.children(".codecdiv").children(".spancontent").text(presentdetail[5].split("=")[1]);
            $sndorrev.children(".resolutiondiv").children(".spancontent").text(presentdetail[6].split("=")[1]);
        }
        
        var detailsheight;
        if(!$("#ipvconfdetails").is(":visible")){
            if(data.present_content == "")
                detailsheight = 375;
            else
                detailsheight = 570;
        }else{
            if(data.present_content == "")
                detailsheight = 630;
            else
                detailsheight = 835;
        }
        
        $("#detailscontent").css("height", detailsheight + "px");
    }
}

function splitStrarray(str, type){
    var tObj = {};
    if(type == "video"){
        //string  "lost=0.0%;bitrate=1677Kbps;fps=30;codec=H264/HP;resolution=1920x1080"
        var curstr = str.split(";");
        for(var i = 0; i < curstr.length; i++){
            var resstr = curstr[i].split("=");
            switch (resstr[0]) {
                case "lost":
                    tObj.lost = resstr[1];
                    break;
                case "bitrate":
                    tObj.bitrate = resstr[1];
                    break;
                case "fps":
                    tObj.fps = resstr[1];
                    break;
                case "codec":
                    tObj.codec = resstr[1];
                    break;
                case "resolution":
                    tObj.resolution = resstr[1];
                    break;
            }
        }
    }
    else{
        //lost=N/A;bitrate=0Kbps;codec=PCMU"
        var curstr = str.split(";");
        for(var i = 0; i < curstr.length; i++){
            var resstr = curstr[i].split("=");
            switch (resstr[0]) {
                case "lost":
                    tObj.lost = resstr[1];
                    break;
                case "bitrate":
                    tObj.bitrate = resstr[1];
                    break;
                case "codec":
                    tObj.codec = resstr[1];
                    break;
            }
        }
    }
    
    return tObj;
}

function changeShowDetails_Status(data)
{
    var state = data.state;
    if(state == "1")
        $("#details").attr("isshow","1").addClass("active");
    else
        $("#details").attr("isshow","0").removeClass("active");
}

function addtransferItemEvent()
{
    $("#transferlist .itemdiv").hover(function(){
        $(this).addClass("hoverItem");
    },function(){
        $(this).removeClass("hoverItem");
    });
    $("#transferlist .itemdiv").click(function(e){
        e.stopPropagation();
        dealwith_transfer(e);
    });
}

/*
get information about HDMI plugined.
*/
function getHDMIinfo(action, isall)
{
    var flag = 0;
    var urihead = "action="+action;
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        async:false,
        dataType:'text',
        success:function(data) {
            if( data.substring(0, 1) == "{" )
            {
                data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
                var data = eval("("+data+")");
                var res = data.res;
                if(res.toLowerCase() == "success")
                {
                    flag = data.msg;
                    if(action.indexOf("isBFCPSupport") != -1)
                    {
                        if( isall == 1 )
                            flag = data.allsupport;
                        var linebfcpstate = (data.linesbfcp).split(":::");
                        var lines = (data.lines).split(":::");
                        var n = 0;
                        misBFCPSupport = false;
                        for(;n < lines.length;n++)
                        {
                            var lineid = "#line-"+lines[n];
                            var bfcpstate = linebfcpstate[n];
                            $(lineid).attr("bfcpstate",bfcpstate);
                            if(bfcpstate != "0" && !misBFCPSupport)
                            {
                                misBFCPSupport = true;
                            }
                        }
                    }
                    else if(action.indexOf('gethdmi1state') != -1)
                    {
                        if(data.state == "1")
                            flag = 0;
                        else
                            flag = 1;//HDMI 1 not connected
                    }
                    else if(action.indexOf('gethdmiinstate') != -1)
                    {
                        var state = data.state;
                        if(state == "1")
                            flag = 1;
                        else
                            flag = 0;
                    }
                    else if(action.indexOf('getwifidisplaystate') != -1){
                        if(data.state == "1")
                            flag = 1;
                        else
                            flag = 0;
                    }
                }
                else
                {
                    $.prompt(a_63);
                    return false;
                }
            }
            else
            {
                var msgs = res_parse_rawtext(data);
                cb_if_auth_fail(msgs);
                if (cb_is_fail(msgs)){}
                else
                {
                    if(action == "get&var-0000=hdmi2&var-0001=hdmi3")
                    {
                        var hdmi2 = msgs.headers["hdmi2"];
                        var hdmi3 = msgs.headers["hdmi3"];
                        if(hdmi3 == "1" && hdmi2 == "1")
                            flag = 4;
                        else if(hdmi3 != "1" && hdmi2 == "1")
                            flag = 5;
                        else if(hdmi3 != "1" && hdmi2 != "1")
                            flag = 6;
                    }
                }
            }
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
    return flag;
}

function convertTime(date){
    mDateObj.setTime(date);
    var timestr = mDateObj.getFullYear()+"-";
    var month = mDateObj.getMonth()+1;
    if( month < 10 )
        timestr += "0";
    timestr += month;
    timestr += "-";
    var date = mDateObj.getDate();
    if( date < 10 )
        timestr += "0";
    timestr += date;
    timestr += " ";
    var hours = mDateObj.getHours();
    if( hours < 10 )
        timestr += "0"
    timestr += hours;
    timestr += ":";
    var minutes = mDateObj.getMinutes();
    if( minutes < 10 )
        timestr += "0";
    timestr += minutes;
    return timestr;
}

function convertDuration(duration){
    if( duration == 0 )
        return "00:00";
    var day = parseInt(duration / (24 * 3600));
    duration %= (24 * 3600);
    var hour = parseInt(duration / 3600);
    duration %= 3600;
    var min = parseInt(duration / 60);
    var sec = parseInt(duration % 60);
    var timestr = "";
    if( day > 0 ){
        timestr += day + " ";
        if( day > 1 )
            timestr += a_days;
        else
            timestr += a_day;
        timestr += " ";
    }
    if( hour > 0 ){
        if( hour < 10 )
            timestr += "0";
        timestr += hour + ":";
    }
    if( min > 0 ){
        if( min < 10 )
            timestr += "0";
        timestr += min + ":";
    }else{
        timestr += "00:";
    } 
    if( sec > 0 ){
        if( sec < 10 )
            timestr += "0";
        timestr += sec;
    }else{
        timestr += "00";
    }   
    return timestr;
}

function countClickedTimes(){  
    if(mClicktimes == 0){  
        mPreClickTime = new Date().getTime();  
        mClicktimes ++;  
        return true;  
    }  
    mCurrentClickTime = new Date().getTime();  
    if((mCurrentClickTime - mPreClickTime) < 1000) {
        $.prompt(a_552);  
        mPreClickTime = mCurrentClickTime;  
        return false;  
    }     
    mClicktimes ++ ;  
    mPreClickTime = mCurrentClickTime;   
    return true; 
}  

function buttontip_position(obj)
{
    $this = obj;
    var btntop = $this.parent().parent().position().top - 15;
    var btnleft = $this.offset().left;
    var btnwth = $this.width() + parseInt($this.css("paddingLeft")) + parseInt($this.css("paddingRight"));;
    var tipwth = $("#tips").width();
    var moveleft = (btnwth - tipwth)/2;
    $("#tips").css("top",btntop).css("left",btnleft).css("margin-left",moveleft+"px");
}

function cb_send_key_done(data){
    if( data.substring(0, 1) != "{" ){
        var msgs = res_parse_rawtext(data);
        cb_if_auth_fail(msgs);
    } 
}

/*
Be used for fecc
*/
function cb_send_key(action, keycode, repeattimes){
    var urihead = "action=remotekeypress&region=remotekey&keyaction=" + action + "&keycode=" + keycode + "&repeattimes=" + repeattimes;
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_send_key_done(data);
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}

function getSDCardstate()
{
    var urihead = "action=getsdcardstate&region=status";
    urihead += "&time=" + new Date().getTime();
    var state = false;
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        async:false,
        success:function(data) {
            var tObj = eval("(" + data + ")");
            var status = parseInt(tObj.msg);
            if(status == 3 || status == 4 || status == 5 || status == 7)
            {
                state = true;
            }
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });

    return state;
}

function showtip(tipstr)
{
    clearTimeout(mTipTimeout);
    $("#operatetip span").text(tipstr);
    var tipwidth = $("#operatetip").width();
    var tipmarginLeft = (990 - tipwidth) / 2 - 480;
    $("#operatetip").css("margin-left", tipmarginLeft + "px");
    $("#operatetip").fadeIn();
    setTimeout(function(){$("#operatetip").fadeOut();},2000);
}

function delayshowtip(tipstr)
{
    clearTimeout(mTipTimeout);
    mTipTimeout = setTimeout(function(){
        $("#operatetip span").text(tipstr);
        $("#operatetip").fadeIn();
        setTimeout(function(){$("#operatetip").fadeOut();},1500);
    },500);
}

function translate_page()
{
    $("#noticetipmsg").text(a_610);
    $("#pause").attr("name",a_11);
    $("#record").attr("name",a_12098);
    $("#addmember").attr("name",a_517);
    $("#localmute").attr("title",a_649);
    $("#present").attr("name",a_10002+" "+a_10004);
    //$("#present").attr("name",a_10004);
    $("#a_presentselect").text(a_10004);
    $("#presentmode option[value=1]").text(a_1317);
    $("#presentmode option[value=0]").text(a_32);
    $("#caption").attr("name",a_16006);
    $("#close").attr("name",a_1);
    $("#details").attr("name",a_10015);
    $("#addnewcall").attr("name",a_520);
    $("#transferlinediv .selecttitle span").text(a_607);
    $("#accpvideo").text(a_10000);
    $("#rejectvideo").text(a_523);
    $("#pincode").attr("name", a_19133);
    $("#a_pincode").text(a_19133);
    $("#a_pincodetip").text(a_16709);
    $("#addmemberdiv .poptitlediv").text(a_517);
    $("#dndsave,#presentsave,#layoutSave, #pincodesave").text(a_17);
    $("#addsave").text(a_23);
    $("#cancel,#transferpopcancel,#dndcancel,#presentcancel,#attendcancel,#recordingcancel,#layoutCancel, #pincodecancel").text(a_3);
    $("#dndmode option:eq(0)").text(a_8);
    $("#dndmode option:eq(1)").text(a_7);
    $("#dndmode option:eq(2)").text(a_10053);
    $("#transfermode option:eq(0)").text(a_630);
    $("#transfermode option:eq(1)").text(a_629);
    $("#closecamera").attr("title",a_628);
    $("#switchvideosource").attr("name",a_10108);
    $("#transferdetach").text(a_631);
    $("#transfernext").text(a_637);
    $("#transferdiv .titlediv span").text(a_637);
    $("#selectvideodiv .poptitlediv span").text(a_607);
    $("#transferlinediv .poptitlediv span,#continuerecording .poptitlediv span").text(a_415);
    $("#detailsdiv .poptitlediv span").text(a_10015);
    $(".lostdiv .spantitle").attr("title",a_10019).text(a_10019);
    $(".bitratediv .spantitle").attr("title",a_10020).text(a_10020);
    $(".fpsdiv .spantitle").attr("title",a_12147).text(a_12147);
    $(".codecdiv .spantitle").attr("title",a_16115).text(a_16115);
    $(".resolutiondiv .spantitle").attr("title",a_10023).text(a_10023);
    $(".audiodetail .titlediv span").text(a_10017);
    $(".videodetail .titlediv span").text(a_10016);
    $(".presentdetail .titlediv span").text(a_10004);
    $(".audiodetail .bitratediv .spantitle").attr("title",a_10069).text(a_10069);
    $(".audiodetail .codecdiv .spantitle").attr("title",a_10022).text(a_10022);
    $("#a_detailsend").text(a_4);
    $("#a_detailreceive").text(a_10018);
    $("#recordingOK").text(a_2);
    $("#goonrecording p").text(a_10119);
    $("#dnd").attr("name", a_1302);
    $("#DTMF").attr("name",a_67 + " " + a_10232);
    $("#confcontrol").attr("name",a_10127);
    $("#fecclang").text(a_10121);
    $("#blockall").attr("name",a_10132);
    $("#suspendall").attr("name",a_10134);
    $("#layout").attr("name",a_16703);
    $("#callmodeselect option:eq(1)").text(a_506);
    //$("#callmodeselect option:eq(1)").text(a_505);
    $("#callmodeselect option:eq(0)").text(a_504);
    $("#callvideoselect option:eq(1)").text(a_10017);
    $("#callvideoselect option:eq(0)").text(a_10016);
    $("#a_ipvconftitle").text(a_15054);
    $("#a_ipvconfnumber").text(a_15055);
    $("#a_ipvconfhost").text(a_10055);
    $("#a_ipvconfpass").text(a_6759);
    $("#a_ipvconfpstn").text(a_15057);
    $("#a_ipvconfregion").text(a_15065);
    $("#a_ipvconfhostcode").text(a_19212);
    $("#a_presettitle").text(a_10024);
    $("#gotopreset").text(a_19174);
    $("#savepreset").text(a_17);
    $("#layouttitletext").text(a_16703);
    $("#preflow").text(a_19247 + ": ");
    $("#recordtitle span").text(a_19252);
    $("#localrcd .rcdlinename").text(a_19249);
    $("#ipvtrcd .rcdlinename").text(a_19250);
}

function addDragEvent()
{
    var $dragline,dragnum;
    $(".minorpip").draggable({ 
        cursor: "move",
        revert: true,
        opacity:0.5,
        containment:".layoutcontainer",
        start:function(){
            $dragline = $(this);
            dragnum = $(this).index();
            if(dragnum == 1)
                dragnum = 0;
        },
        stop:function(){}
    });

    $( ".mainpip" ).droppable({
        activeClass: "draghover",
        hoverClass: "",
        drop: function( event, ui ) {
            var max_show_line = $dragline.attr("pipstate");
            var layoutmode = "max_show_chn";
            var suspendstate = $("#line-"+max_show_line).find(".confsuspend").attr("issuspend");
            var urihead = "action=setlayoutmode&region=confctrl&mode="+encodeURIComponent(layoutmode)+"&pipstate="+max_show_line;
            if(suspendstate == "1")
            {
                return false;
            }
            //cb_get_confaction(urihead,"");
            $(".minorpip").draggable("destroy");
            $(".mainpip").droppable("destroy");
            $(this).removeClass().addClass("minorpip");
            $(".layoutlist").prepend($dragline);
            $(".layoutlist li").eq(dragnum).after($(this));
            $dragline.removeClass().addClass("mainpip").removeAttr("style");
            addDragEvent();
        }
    });
    //plugin more screen
    var $draghdmiline;
    $(".minhdmipip,.picturehdmi.mainhdmipip").draggable({ 
        cursor: "move",
        revert: true,
        opacity:0.5,
        containment:".layoutcontainer",
        start:function(){
            $draghdmiline = $(this);
            if($draghdmiline.parent().attr("id") == "hdmiout3" || $draghdmiline.parent().attr("id") == "hdmiout1")
            {
                $("#hdmiout2 .picturehdmi").hide();
                $(".droptips").hide();
                $("#hdmiout2 .droptips").show();
            }
            else if($draghdmiline.parent().attr("id") == "hdmiout2")
            {
                if($("#hdmiout3").length > 0)
                {
                    $("#hdmiout3 .picturehdmi").hide();
                    $(".droptips").hide();
                    $("#hdmiout3 .droptips").show();
                }
                else
                {
                    $("#hdmiout1 .picturehdmi").hide();
                    $(".droptips").hide();
                    $("#hdmiout1 .droptips").show();
                }
            }
        },
        stop:function(){
            if($draghdmiline.parent().attr("id") == "hdmiout3" || $draghdmiline.parent().attr("id") == "hdmiout1")
            {
                $("#hdmiout2 .picturehdmi").show();
            }
            else if($draghdmiline.parent().attr("id") == "hdmiout2")
            {
                if($("#hdmiout3").length > 0)
                {
                    $("#hdmiout3 .picturehdmi").show();
                }
                else
                {
                    $("#hdmiout1 .picturehdmi").show();
                }
            }
            $(".droptips").hide();
        }
    });
    $(".overlaphdmi").draggable("destroy");

    $( "#hdmiout2,#hdmiout3,#hdmiout1" ).droppable({
        activeClass: "",
        hoverClass: "",
        drop: function( event, ui ) {
            if($draghdmiline == undefined)
            {
                return false;
            }
            var max_show_line = $draghdmiline.attr("pipstate");
            var drophdmi_id = $(this).attr("id");
            var layoutmode = "max_show_chn";
            var suspendstate = $("#line-"+max_show_line).find(".confsuspend").attr("issuspend");
            var urihead = "action=setlayoutmode&region=confctrl&mode="+encodeURIComponent(layoutmode)+"&pipstate="+max_show_line;
            var movetoid;
            if(suspendstate == "1" || $draghdmiline.parent().attr("id") == drophdmi_id)
            {
                return false;
            }
            if($("#hdmiout3").length > 0 && drophdmi_id == "hdmiout1")
            {
                return false;
            }
            //cb_get_confaction(urihead,"");
            if(drophdmi_id == "hdmiout2")
            {
                if($("#hdmiout3").length > 0)
                {
                    movetoid = "#hdmiout3";
                }
                else
                {
                    movetoid = "#hdmiout1";
                }
                urihead = "action=setlayoutmode&region=confctrl&mode=max_hdmi_out&pipstate=2";
            }
            else if(drophdmi_id == "hdmiout3")
            {
                movetoid = "#hdmiout2";
                urihead = "action=setlayoutmode&region=confctrl&mode=max_hdmi_out&pipstate=3";
            }else if(drophdmi_id == "hdmiout1")
            {
                movetoid = "#hdmiout2";
                urihead = "action=setlayoutmode&region=confctrl&mode=max_hdmi_out&pipstate=1";
            }
            //cb_get_confaction(urihead,"");

            $(this).children(".picturehdmi").removeClass("mainhdmipip").addClass("minhdmipip").appendTo($(movetoid));
            $draghdmiline.removeClass("minhdmipip").addClass("mainhdmipip").unbind("hover");
            $(this).append($draghdmiline);
            $(".fullscreenbtn").hide();
            $(".droptips").hide();
            addfullscreenEvent();
        }
    });
}

function addmember_inputclick(obj)
{
    var existIpvt = false;
    $this = obj;
    if( $this.parent().parent().attr("number") == "anonymous")
    {
        $.prompt(a_10083);
        return false;
    }
    
    var $chosenitemdiv = $this.parent().parent();
    var existlinenum = $(".remoteline").length;
    var allowaddmaxnum = mConfmemeber_maxnum - existlinenum;
    if($chosenitemdiv.attr("class").indexOf("searchnewItem") != -1){
        var curacct = $("#acctselect option:selected").val();
    }else{
        var curacct = $chosenitemdiv.attr("account");
    }
    
    $(".remoteline").each(function(){
        if($(this).attr("account") == 1){
            existIpvt = true;
            return false;
        }
    });
    
    /*if(existIpvt == false){
        $(".itemcheck .inputcbx").each(function(){
            if($(this).prop("checked") == true){
                var chosentype = $(this).parent().parent().children('.itemtype').children('span').text();
                if(chosentype == "IPVideoTalk"){
                    existIpvt = true;
                    return false;
                }        
            }
        });
    }*/
    
    if($this.prop("checked"))
    {
        if( curacct == undefined ){
            curacct = $this.parent().parent().attr("account");
        }
        var acctorder = parseInt(curacct);
        if( curacct == 8 )
            var acctorder = 3;
        if( mAccountActive[acctorder] == "0" ){
            //$this.prop("checked", false);
            $("#addmemberdiv p").text(a_18564);
            setTimeout(function(){$("#addmemberdiv p").text("");},1000);
            return false;
        }
        /*if( curacct == 1 && getConfType() == 2 ){
            //$this.prop("checked", false);
            $("#addmemberdiv p").text(a_15051);
            setTimeout(function(){$("#addmemberdiv p").text("");},4000);
            return false;
        }*/
        
        /*no limit for ipvt account to add conference members*/
        if(curacct != 1)
            mCheckedmembernum++;
        else if(curacct == 1 && !existIpvt)
            mCheckedmembernum++;
            
        $chosenitemdiv.attr("account", curacct);
        /*if member is ipvideotalk, max number should reduce 1
        if(!mIsreduce && curacct == 1)
        {
            mAddmember_maxnum = mAddmember_maxnum - 1;
            mIsreduce = true;
        }*/
    }else
    {
        var oldacct;
        $("#acctselect option").each(function(){
            if($(this).text() == curchosen)
                oldacct = $(this).val();
        });
        
        /*in case that change the account before uncheck the item*/
        if(oldacct != undefined){
            if(oldacct != 1)
                mCheckedmembernum--;
            else if(oldacct == 1 && !existIpvt)
                mCheckedmembernum--;
        }
        else{
            if(curacct != 1)
                mCheckedmembernum--;
            else if(curacct == 1 && !existIpvt)
                mCheckedmembernum--;
        }
    }

    if(mCheckedmembernum > allowaddmaxnum)
    {
        mCheckedmembernum--;
        $("#addmemberdiv p").text(a_10097);
        setTimeout(function(){$("#addmemberdiv p").text("");},1000);
        return false;
    }
    
    $("#search").removeAttr("disabled");
    //$("#search").val(a_4016);
    $("#search").val("");
    $("#bjpassword").val(a_6759);
    $("#addmemberdiv .itemdiv").show();
    
    if($this.prop("checked")){
        $("#contactsdiv").prepend($this.parent().parent());
    }
    
    return true;
}

function getpincode_callback(data){
    var pincode = data.msg;
    if( pincode == "" || pincode == undefined ){
        $("#newpincode").val(a_15046).addClass("inputhint");
    }else{
        $("#newpincode").val(pincode).removeClass("inputhint");
    }
}

function setpincode_callback(data){
    if( data.msg == "is verifying"){
        delayshowtip(a_10164 + ". " + a_16005);
    }
}

function change_presentation_type(){
    if(!judge_ispause() || !countClickedTimes())
    {
        return false;
    }
    var ison = $("#presentmode").val();
    var source = 0;
    var flag = "";
    if(ison > 0)
    {
        //open presentation
        var action = "gethdmi1state&region=status";
        flag = getHDMIinfo(action);
        if(flag == 1)
        {
            $.prompt(a_10081+" HDMI 1!");
            return false;
        }
        action = "gethdmiinstate&region=status";
        var hdmiin = getHDMIinfo(action);
        action = "getwifidisplaystate&region=confctrl";
        var wifidisplay = getHDMIinfo(action);
        if(!hdmiin && !wifidisplay)
        {
            $.prompt(a_10085);
            return false;
        }
        
        if(!hdmiin && wifidisplay)
            source = 1;
        else if(hdmiin && wifidisplay)
            source = $("#presource").val();
    }
    var videoon_num = 0;
    for(var i in mVideoOn_obj)
        videoon_num++;
    if(videoon_num != 0)
    {
        $("#operatetip span").text(a_7355);
        $("#operatetip").fadeIn();
        setTimeout(function(){$("#operatetip").fadeOut();},2000);
        return false;
    }
    
    var urihead = "action=ctrlBFCPState&region=confctrl&source=" + source + "&ison=" + ison;
    /*if(ison == "0")
    {
        urihead = "action=ctrlBFCPState&region=confctrl&ison=1";
    }
    else
    {
        urihead = "action=ctrlBFCPState&region=confctrl&ison=0";
    }*/
    var callfn = "";
    cb_get_confaction(urihead,callfn,true);
    
    $("#present").attr("bfcp", ison);
    delayshowtip(a_7355);
}
function cb_send_endcall_action(line){
    if(mConfrole == "2"){
        if($("#line-" + line).attr("account") == "1"){
            var urihead = "action=endcall&region=webservice&line=" + line + "&flag=1";
        }
        else{
            var urihead = "action=endcall&region=webservice&line=" + line + "&flag=0";
        }
    }else{
        var urihead = "action=endcall&region=webservice&line=" + line + "&flag=0";
    }
    
    var callfn = "";
    cb_get_confaction(urihead,callfn,true);
}

function cb_end_conf(role){
    if(role == "2"){
        var btnarray = new Array(a_10067, a_10225);
        alertPrompt($("#wholepage"), promptTxt, btnarray);
    }else{
        var txt = '<div>' + promptTxt + '</div>'
        $.prompt(txt,{
            buttons:{
                Yes: true, No: false
            },
            callback: function(v,m,f){
                if (v)
                {
                    mIPVConfNumber = "";
                    $("#tabs ul li").each(function(){
                        if($(this).attr("aria-selected") == "true")
                        {
                            var line = $(this).attr("line");
                            var callfn = "close_callback('"+line+"');";
                            if(line == mConfid)
                            {
                                callfn = "close_callback('"+mConfid+"');";
                                var urihead = "action=endconf&region=confctrl&flag=1";
                                cb_get_confaction(urihead,callfn,true);
                            }
                            else
                            {
                                var urihead = "action=endallcall&region=confctrl";
                                cb_get_confaction(urihead,callfn,true);
                            }
                            return false;
                        }
                    });
                }
            }
        });     
    }
}

function pageEventActions()
{
    var hoverTimer;  
    $("#bottombtn button").hover(function(){
        var $this = $(this);
        hoverTimer = setTimeout(function(){
            var tipcontent = $this.attr("name");

            if(tipcontent == "" || tipcontent == undefined)
                return false;

            $("#tips span.tipcontent").text(tipcontent);
            buttontip_position($this);
            $("#tips").slideDown(150);
            $this.addClass('buttonover');
        },100);
    }
    ,function(){
        clearTimeout(hoverTimer);
        $("#tips").slideUp(150);
        $(this).removeClass('buttonover');
    });
    
    $("#acceptcmrivt").unbind().live("click",function(){
        var line = $("#promptdiv").attr("line");
        cb_get_action("acceptorejectipvtcmr&region=confctrl&line=" + line + "&accept=1");
        handle_promptdiv();
    });
    
    $("#rejectcmrivt").unbind().live("click",function(){
        var line = $("#promptdiv").attr("line");
        cb_get_action("acceptorejectipvtcmr&region=confctrl&line=" + line + "&accept=0");
        handle_promptdiv();
    });

    $("#confcontrol").hover(function(){
        var marginleft = parseInt($("#record").css("marginLeft"));
        var margintop = parseInt($(".confbasebtn").css("marginTop"));
        $(this).addClass("confctrlopen");
        $("#record").css("marginLeft",marginleft-6);
        $(".confbasebtn").css("marginTop",margintop-3);
    },function(){
        var divwidth = "width:" + $(".confbasebtn").width() + "px";
        var marginleft = parseInt($("#record").css("marginLeft"));
        $(this).removeClass("confctrlopen");
        $("#record").css("marginLeft",marginleft+6);
        $(".confbasebtn").attr("style",divwidth);
    });

    $("#confcontrol").click(function(){
        var endwidth = $(".confbasebtn").width() - 250 + "px";
        $("#closeconfctrl").hide();
        $(".confctrlbtn").show().stop().animate({width:endwidth},{queue:false, duration:1000, easing:'swing'}); 
        setTimeout(function(){$("#closeconfctrl").show();},800);
    });

    $("#closeconfctrl").click(function(){
        $(this).hide();
        $(".confctrlbtn").stop().animate({width:"0px"},{queue:false, duration:1000, easing:'swing'}); 
        setTimeout(function(){$(".confctrlbtn").hide();},800);
    });

    /*******FECC ctrl********/
    $("#direction button").hover(function(){
        var direction = $(this).attr("arrowtype");
        if(direction == "up")
        {
            $("#direction").removeClass().addClass("uphover");
        }
        else if(direction == "left")
        {
            $("#direction").removeClass().addClass("lefthover");
        }
        else if(direction == "down")
        {
            $("#direction").removeClass().addClass("downhover");
        }
        else if(direction == "right")
        {
            $("#direction").removeClass().addClass("righthover");
        }
    },function(){
        $("#direction").removeClass().addClass("normal");
    });
    /************************/
    $("#gotopreset").click(function(e) {
        var presetid = $("#presetbtndiv").attr("presetid");
        var urihead = "action=FECCpreset&region=confctrl&type=goto&line=" + $("#ctrlFECCDiv").attr("line") + "&presetid=" + presetid;
        cb_get_confaction(urihead, "", true);
    });
    $("#savepreset").click(function(e) {
        if( mSaveingPreset ){
            $("#fecctip").text(a_552).fadeIn(500);
            return false;
        }
        mSaveingPreset = true;
        var presetid = $("#presetbtndiv").attr("presetid");
        var urihead = "action=FECCpreset&region=confctrl&type=save&line=" + $("#ctrlFECCDiv").attr("line") + "&presetid=" + presetid;
        cb_get_confaction(urihead, "", true);
        setTimeout(function(){$("#fecctip").fadeOut();mSaveingPreset = false;},2000);
    });

    $("#addmember").click(function(){ 
        if(!judge_ispause() || !countClickedTimes())
        {
            return false;
        }
        if(mContactitems == "")
        {
            window.parent.block_download_func(a_6660);
            get_contact();
        }
        if(mCalllogItems == "")
        {
            window.parent.block_download_func(a_6660);
            get_normal_calllog(2, 0);
        }
        //var conftype = getConfType();
        var count = 0;
        /*if( conftype == 2 ){
            $("#acctselect").empty();
            for(var i = 0; i < 4; i++){
                if( mAccountActive[i] == "1" && i != 1 ){
                    count ++;
                    var $toneop;
                    if( i == 3 )
                        $toneopt = $("<option value='8'>" + htmlEncode(mAccountNames[i]) + "</option>");
                    else
                        $toneopt = $("<option value='" + i + "'>" + htmlEncode(mAccountNames[i]) + "</option>");
                    $('#acctselect').append($toneopt);
                }
            }
            $("#acctselect").resetSS();
        }else{
            $("#acctselect").empty();
            for(var i = 0; i < 4; i++){
                if( mAccountActive[i] == "1" ){
                    count ++;
                    var $toneop;
                    if( i == 3 )
                        $toneopt = $("<option value='8'>" + htmlEncode(mAccountNames[i]) + "</option>");
                    else
                        $toneopt = $("<option value='" + i + "'>" + htmlEncode(mAccountNames[i]) + "</option>");
                    $('#acctselect').append($toneopt);
                }
            }
            $("#acctselect").resetSS();
        }*/
        $("#acctselect").empty();
        for(var i = 0; i < 4; i++){
            if( mAccountActive[i] == "1" ){
                count ++;
                var $toneop;
                if( i == 3 )
                    $toneopt = $("<option value='8'>" + htmlEncode(mAccountNames[i]) + "</option>");
                else
                    $toneopt = $("<option value='" + i + "'>" + htmlEncode(mAccountNames[i]) + "</option>");
                $('#acctselect').append($toneopt);
            }
        }
        $("#acctselect").resetSS();
        $("#acctselect").next(".newListSelected").children(".newList").css("height", count * 26);
        var urihead = "action=get&var-0000=22046";
        urihead += "&time=" + new Date().getTime();
        $.ajax ({
            type: 'get',
            url:'/manager',
            data:urihead,
            dataType:'text',
            success:function(data) {
                var msgs = res_parse_rawtext(data);
                cb_if_auth_fail(msgs);
                var dftacct = msgs.headers["22046"];
                if(dftacct == "" || dftacct == undefined)
                    dftacct = "0";
                //if( conftype == 2 && dftacct == "1" )
                //    dftacct = "2";
                $("#acctselect").getSetSSValue(dftacct);
            },
            error:function(xmlHttpRequest, errorThrown) {
                //view_message("Get Error", MSG_ALERT);
            }
        });
        addnewcall_calllog(mCalllogItems);
        setaddmember_stat();
        $("#search").removeAttr("disabled");
        $("#search").attr("placeholder", a_4016).val("");
        $("#bjpassword").removeAttr("disabled").val(a_6759);
        $("#addmemberdiv").find(".titlediv").text(a_517);
        ctrl_show_maskdiv(true);
        $("#addmemberdiv").show();
        $("#addmemberdiv .itemdiv").show();
        mCheckedmembernum = 0;
        mAddmember_maxnum = mConfmemeber_maxnum;
        if(mIsIPVConf)
        {
            mIsreduce = true;
        }
        else
        {
            mIsreduce = false;
        }
        $(".itemdiv.confdiv .inputcbx").unbind().click(function(){
            if(!addmember_inputclick($(this)))
            {
                return false;
            }
        });
    });

    $("#addnewcall").click(function(){
        if(mContactitems == "")
        {
            window.parent.block_download_func(a_6660);
            get_contact();
        }
        if(mCalllogItems == "")
        {
            window.parent.block_download_func(a_6660);
            get_normal_calllog(2, 0);
        }
        addnewcall_calllog(mCalllogItems);
        setaddmember_stat();
        $("#search").val("");
        $("#addmemberdiv").find(".titlediv").text(a_520);
        $("#addmemberdiv").show();
        $("#addmemberdiv .itemdiv").show();
        $(".itemdiv.confdiv .inputcbx").unbind();
    });
    
    $("#handsup").click(function(){
        if(!countClickedTimes())
        {
            return false;
        }
        cb_get_action("upordownhand&region=confctrl");
        if(!$("#handsup").hasClass("active")){
            $("#handsup").attr("name", a_10221).addClass("active");
            $("#tips span.tipcontent").text(a_10221);
        }
        else{
            $("#handsup").attr("name", a_10220).removeClass("active");
            $("#tips span.tipcontent").text(a_10220);
        }    
    });

    $("#close").click(function(){
        var line;
        $(".remoteline").each(function(){
            if($(this).attr("account") == "1"){
                line = $(this).attr("line");
                return false;
            }
        });
        if(line != undefined){
            cb_get_action("getipvrole&region=confctrl&line=" + line + "&type=closeprompt");
            return false;
        }
        else{
            promptTxt = a_10103;  //only exists sip call
            cb_end_conf();
        }      
    });
    
    $("#btngroup button:eq(0)").live("click", function(){
        callfn = "close_callback('"+mConfid+"');";
        var urihead = "action=endconf&region=confctrl&flag=0";
        cb_get_confaction(urihead, callfn, true);
        $("#cancelbtn").click();
    });
    
    $("#btngroup button:eq(1)").live("click", function(){
        var urihead = "action=endconf&region=confctrl&flag=1";
        cb_get_confaction(urihead, "", true);
        $("#cancelbtn").click();
    });

    $("#record").click(function(){
        if(!judge_ispause() || !countClickedTimes())
        {
            return false;
        }
        
        if($(".remoteline[account=1][state=4]").length > 0 && mConfrole == "2" && isallowipvtrcd){
            $("#recordSelect").show();
            return;
        }
        
        if(is4kon){
            showtip(a_605);
            return;
        }
        var isrecord = parseInt($(this).attr("isrecord"));  /* 0-stop record  1-start record */
        if(isrecord == 1)
            cb_get_action("startrecord&region=confctrl");
        else
            cb_get_action("stoprecord&region=confctrl");
    });
    
    $("#recordtitle img").click(function(){
       $("#recordSelect").hide();
    });
   
    $("#localswitch").click(function(){
        if(!judge_ispause() || !countClickedTimes())
        {
            return false;
        }
       
        if($(this).hasClass("rcdstart"))
            cb_get_action("startrecord&region=confctrl");
        else
            cb_get_action("stoprecord&region=confctrl");
    });
   
    $("#ipvtswitch").click(function(){
        if(!judge_ispause() || !countClickedTimes())
        {
            return false;
        }
       
        if($(this).hasClass("rcdstart"))
            cb_get_action("ipvtrecord&region=confctrl&state=1");
        else
            cb_get_action("ipvtrecord&region=confctrl&state=0");
    });

    $("#pause").click(function(){
        if(!countClickedTimes())
        {
            return false;
        }
        var ishold = parseInt($(this).attr("ishold"));
        var urihead;
        var flag = true;
        $("#tabs #conf div.remoteline").each(function(){
            var state = $(this).attr("state");
            if(state == "3" || state == "8" || state == "12")
            {
                // conference can not be held
                flag = false;
                return false;
            }
        });
        if(!flag)
        {
            $.prompt(a_548);
            return false;
        }
        //if there is remoting video, hold is disabled
        for(var n in mVideoOn_obj)
        {
            if(mVideoOn_obj[n] == 1)
            {
                flag = false;
                break;
            }
        }
        if(!flag)
        {
            $.prompt(a_10129);
            return false;
        }
        if(ishold == "1")
        {
            if($(".remoteline[account=1][state=4]").length > 0 && mConfrole == "2"){
                if($("#localswitch").hasClass("rcdstop"))
                    mContinueRecording = 1;
                else
                    mContinueRecording = 0;
            }
            else{
                if($("#record").attr("isrecord") == "0")
                    mContinueRecording = 1;
                else
                    mContinueRecording = 0;
            }
        }
        delayshowtip(a_7355);
        $("#tabs ul li").each(function(){
            if($(this).attr("aria-selected") == "true")
            {
                //var callfn = "hold_callback("+ishold+");";
                var callfn = "";
                //var urihead = "action=ctrlConfPauseState&region=confctrl&ispause="+ishold;
                var urihead = "action=confholdstate&region=confctrl&sethold="+ishold;
                cb_get_confaction(urihead,callfn,true);  
                return false;
            }
        });
    });

    $(".linehold").live("click",function(){
        if(!countClickedTimes())
        {
            return false;
        }
        var ishold = parseInt($(this).attr("ishold"));
        var urihead;
        var line = $(this).parent().parent().attr("line");
        var callfn = "hold_callback("+ishold+","+line+");";
        var urihead = "action=lineholdstate&region=confctrl&line="+line+"&sethold="+ishold;
        cb_get_confaction(urihead,callfn,true);
        $("#closedtmf").click();
    });

    $("#addsave").click(function(){
        var mode;
        var addconfmember = new Object();
        var tempnum = 0;
        var hasIPVT = 0;
        var dialnum = $.trim($("#search").val());
        var callmode = $("#callmodeselect").val();
        var dialacct = $("#acctselect").val();
        var isvideo = $("#callvideoselect").val();
        /*if( dialnum == a_4016 || dialnum == "")
            dialnum = "";*/
        if(dialacct == "2")
        {
            var bjpassword = $("#bjpassword").val();
            if( bjpassword != a_6759 && bjpassword != "" )
                dialnum += "." + bjpassword;
        }
        if(callmode == "0")
            mode = "call";
        else if(callmode == "1")
            mode = "paging";
        else if(callmode == "2")
        {
            mode = "ipcall";
            var usequickipcall = $("#usequickipcall",window.parent.document).val();
            if(usequickipcall == "1" && dialnum != "")
            {
                var urihead = "action=network&region=status";
                urihead += "&time=" + new Date().getTime();
                $.ajax ({
                    type: 'get',
                    url:'/manager',
                    data:urihead,
                    dataType:'text',
                    async:false,
                    success:function(data) {
                        var msgs = res_parse_rawtext(data);
                        cb_if_auth_fail(msgs);
                        if (cb_is_fail(msgs)){}   
                        else {
                            if (msgs.headers['ip'].length > 1) {
                                var ipserver = msgs.headers['ip'].split(".");
                                if( dialnum.indexOf(":") != -1 ){
                                    var ipandport = dialnum.split(":");
                                    if(ipandport[0] >= 0 && ipandport[0] <= 255)
                                        dialnum = ipserver[0] + "." + ipserver[1] + "." + ipserver[2] + "." + dialnum; 
                                }else{
                                    if(dialnum >= 0 && dialnum <= 255)
                                        dialnum = ipserver[0] + "." + ipserver[1] + "." + ipserver[2] + "." + dialnum; 
                                }
                            }
                        }
                    },
                    error:function(xmlHttpRequest, errorThrown) {
                        cb_networkerror(xmlHttpRequest, errorThrown);
                    }
                });
            }
        }
        mConfnumlist = "";
        mConfacctlist = "";

        if(mDisableconf == "1")
        {
            var number;
            var temp;
            $("#contactsdiv .inputcbx").each(function(){
                if($(this).prop("checked") == true)
                {
                    number = $(this).parent().parent().attr("number");
                    tempnum++;
                }
            });

            if(tempnum == 0)
            {
                if(dialnum == "")
                {
                    $("#addmemberdiv p").text(a_16656); 
                    setTimeout(function(){$("#addmemberdiv p").text("");},2000);
                    return false;
                }
                else
                    number = dialnum;
            }
            if(tempnum > 1)
            {
                $("#addmemberdiv p").text(a_16659); 
                setTimeout(function(){$("#addmemberdiv p").text("");},2000);
                return false;
            }
            cb_start_single_call(number, mselacct, 0, "");
            addconfmember_callback();

            return false;
        }
        $("#contactsdiv .inputcbx").each(function(){
            if($(this).prop("checked") == true && $(this).parent().parent().attr("isexist") != "exist" )
            {
                var temp;
                var number;
                var acct;
                var isgroup = $(this).parent().parent().attr("groupid");
                if(isgroup != "")
                {
                    var members = $(this).parent().parent().attr("membersid").split(",");
                    for(var i=0;i<members.length;i++)
                    {
                        temp = mContactsObj[members[i]];
                        if(temp != undefined)
                        {
                            number = temp[0];
                            acct = temp[1];
                            if( acct == 1 && hasIPVT == 0 )
                                hasIPVT = 1;
                            delete addconfmember[number];
                            addconfmember[number] = temp;
                            tempnum++;
                        }
                    }
                }
                else
                {
                    temp = [];
                    number = $(this).parent().parent().attr("number");
                    acct = $(this).parent().parent().attr("account");
                    temp.push(number);
                    temp.push(acct);
                    if( acct == 1 && hasIPVT == 0 )
                        hasIPVT = 1;
                    delete addconfmember[number];
                    addconfmember[number] = temp;
                    tempnum++;
                }
            }
        });


        if(dialnum != "")
        {
            tempnum++;
            var temp = [];
            temp[0] = dialnum;
            temp[1] = dialacct;
            if( dialacct == 1 && hasIPVT == 0 ){
                tempnum++;
                hasIPVT = 1;
            }else if( dialacct != 1 )
                tempnum++;
            delete addconfmember[dialnum];
            addconfmember[dialnum] = temp;
        }

        if(tempnum == 0)
        {
            $("#addmemberdiv p").text(a_16436); 
            setTimeout(function(){$("#addmemberdiv p").text("");},1000);
            return false;
        }
        /*if( hasIPVT == 1 && !mIsIPVConf && mProduct != "GVC3202" )
            tempnum ++;
        if((tempnum+mConfmemeber_num) > mConfmemeber_maxnum)
        {
            $("#addmemberdiv p").text(a_10097);
            setTimeout(function(){$("#addmemberdiv p").text("");},1000);
            //$("#addmember").attr("disabled","disabled");
            return false;
        }*/

        var confname = "";
        var isdialplan = "";
        for(var i in addconfmember)
        {
            var acct = addconfmember[i][1];
            if(acct == undefined || acct == "")
                acct = mselacct;
            
            mConfnumlist += addconfmember[i][0] + ":::"; 
            mConfacctlist += acct + ":::"; 
            isdialplan += "0:::";
        }
        mConfnumlist = mConfnumlist.substring(0, mConfnumlist.length-3);
        mConfacctlist = mConfacctlist.substring(0, mConfacctlist.length-3);
        isdialplan = isdialplan.substring(0, isdialplan.length-3);

        cb_start_addmemberconf(mConfnumlist, mConfacctlist, mode, "", isdialplan, "", isvideo);
        addconfmember_callback();
        
        //var urihead = "action=addconfmemeber&region=confctrl&numbers=" + encodeURIComponent(mConfnumlist) + "&accounts=" + encodeURIComponent(mConfacctlist) + "&confname=" + confname;
        //var callfn = "addconfmember_callback();";
        //cb_get_confaction(urihead,callfn,true);
    });

    $("#cancel").click(function(){
        $("#addmemberdiv").hide();
        if(!$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);
    });

    $(".closecalldiv").click(function(){
        if($(this).parent().parent().attr("id") == "layouttitle")
            $(this).parent().parent().parent().hide();
        else
            $(this).parent().parent().hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#selectvideodiv").is(":visible") && !$("#detailsdiv").is(":visible"))
            ctrl_show_maskdiv(false);
    });

    $("#accpvideo, #rejectvideo").click(function(){
        var num = 0;
        var line=0,isaccept=0;
        var id = $(this).attr("id");
        if(id == "accpvideo")
            isaccept = 1;
        $("#selectlist .inputcbx").each(function(){
            if($(this).prop("checked") == true)
            {
                num ++;
                var dataline = $(this).parent().parent().attr("line");
                line = parseInt(dataline);
                var urihead = "action=isacceptvideo&region=confctrl&isflag="+isaccept+"&line="+line;
                var callfn = "acceptvideo_callback();";
                
                cb_get_confaction(urihead,callfn,true);
                //return false;
            }
        });
        if(num == 0)
        {
            showTips(0);
            return false;
        }
    });
  
    $("#dnd,#confdnd").click(function(e){
        /*
        mode
        1: dnd
        2: lock
        */
        var mode = $(this).attr("isdnd"); 
        // $("#dndmode option[value=\""+mode+"\"]").attr("selected", true);
        // $("#dndselect").show();
        // ctrl_show_maskdiv(true);
        // $("#dndmode").resetSS();
        var setdnd = $(this).attr("dndstate");
        var urihead = "";
        if(isIPVConf())
        {
            $.prompt(a_16710);
            return false;
        }
        if(setdnd == "0")
        {
            urihead = "action=setdndonoroff&region=confctrl&setdnd=1&account=0&dndtype="+mode;
        }
        else
        {
            urihead = "action=setdndonoroff&region=confctrl&setdnd=0&account=0&dndtype="+mode;
        }
        var callfn = "setdnd_callback(data);";
        cb_get_confaction(urihead,callfn);
        delayshowtip(a_7355);
    });

    $("#details").click(function(){
        $("#detailsdiv").show();
        var isIPV = isIPVConf();
        if(isIPV){
            cb_get_confaction("action=getIPVConfInfo&region=confctrl&line="+isIPV,"set_ipvinfo(data);", false);
        }
        ctrl_show_maskdiv(true);
        if($(this).attr("isshow") == "0")
        {
            var ctrlopen = 1;
            var urihead = "action=callstatusReport&region=confctrl&ctrlopen="+ctrlopen;
            var callfn = "";
            //$(this).attr("isshow","1").addClass("active");
            //$("#detailDiv").show();
        }
        else
        {
            var ctrlopen = 0;
            var urihead = "action=callstatusReport&region=confctrl&ctrlopen="+ctrlopen;
            var callfn = "";
            //$(this).attr("isshow","0").removeClass("active");
            //$("#detailDiv").hide();
        }
        cb_get_confaction(urihead,callfn,true);
        $("#tabs .remoteline").each(function(){
            var line = $(this).attr("line");
            if($(".linelist[line=\""+line+"\"]").length <= 0)
            {
                var name = $(this).attr("name");
                var linelistdiv = document.createElement("DIV");
                linelistdiv.className = "linelist";
                linelistdiv.setAttribute("line",line);
                var linespan = document.createElement("SPAN");
                linespan.innerHTML = htmlEncode(name);
                linespan.setAttribute("title",name);
                linelistdiv.appendChild(linespan);
                //$("#lineinfo").append($(linelistdiv));
                $(linelistdiv).appendTo($("#lineinfo"));
            }
        });
        if( !isIPV ){
            add_linelist_event();
        }
        $("#web_calldetail").val("1");
        cb_put(req_items,"",3);
    });

    $("#detailsback").click(function(){
        var guicalldetail_status = 0;
        var urihead = "action=get&var-0000=:gui_calldetail";
        urihead += "&time=" + new Date().getTime();
        $.ajax ({
            type: 'get',
            url:'/manager',
            data:urihead,
            dataType:'text',
            async:false,
            success:function(data) {
                var msgs = res_parse_rawtext(data);
                var state = msgs.headers[":gui_calldetail"];
                cb_if_auth_fail(msgs);
                if(state == "" || state == undefined)
                    state = "0";
                guicalldetail_status = parseInt(state);
            },
            error:function(xmlHttpRequest, errorThrown) {
                view_message("Get Error", MSG_ALERT);
            }
        });
        if(guicalldetail_status == 0)
        {
            var urihead = "action=callstatusReport&region=confctrl&ctrlopen=0";
            var callfn = "";
            cb_get_confaction(urihead,callfn,true);
        }
        $("#detailsdiv").hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);
        $("#web_calldetail").val("0");
        cb_put(req_items,"",3);
    });

    $("#mixing").click(function(){
        if($(this).attr("isopen") == "0")
            $(this).attr("isopen","1").addClass("active");
        else
            $(this).attr("isopen","0").removeClass("active");
    });

    /*before jQuery 1.9, use live*/
    $(".mute").live("click",function(e){
        if(!judge_ispause() || !countClickedTimes())
        {
            return false;
        }
        muteclick(e,false);
    });



    $(".redialcall").live("click",function(e){
        if(mDisableconf == "0")
        {
            if(!judge_ispause())
                return false;
        }
        ctrlredialline(e);
    });

    $(".confdel").live("click",function(e){
        //end line call
        if(mDisableconf == "0")
        {
            if(!judge_ispause())
                return false;
        }
        $this = $(e.target);
        var line = $this.parent().parent().attr("line");
        cb_send_endcall_action(line);
    });

    $(".remoteline .confvideo").live("click",function(e){
        if(!countClickedTimes())
        {
            return false;
        }
        if(mDisableconf == "0")
        {
            if(!judge_ispause())
                return false;
        }
        if($(this).parent().parent().attr("hold") == "hold")
        {
            $.prompt(a_16676);
            return false;
        }
        ctrlvideostate(e,1);
    });

    $(".remoteline .confaudio").live("click",function(e){
        if(!countClickedTimes())
        {
            return false;
        }
        if(mDisableconf == "0")
        {
            if(!judge_ispause())
                return false;
        }
        if($(this).parent().parent().attr("hold") == "hold")
        {
            $.prompt(a_16676);
            return false;
        }
        ctrlvideostate(e,0);
    });

    $(".startFECC").live("click",function(e){
        var line = $(this).parent().parent().attr("line");
        if(!countClickedTimes())
        {
            return false;
        }
        if(mDisableconf == "0" && line != "-1")
        {
            if(!judge_ispause())
                return false;
        }
        if($(this).parent().parent().attr("hold") == "hold")
        {
            $.prompt(a_16676);
            return false;
        }
        if($(this).prev(".confsuspend").attr("issuspend") == "1")
        {
            $.prompt(a_16676);
            return false;
        }
        var action = "gethdmi1state&region=status";
        var hdmi1state = getHDMIinfo(action);
        action = "get&var-0000=hdmi2&var-0001=hdmi3";
        var hdmi23state = getHDMIinfo(action);
        if(hdmi1state == 0)
        {
            if(hdmi23state == 4 || hdmi23state == 5 || hdmi23state == 6)
            {
                /**
                open FECC
                1. HDMI1
                2. HDMI1, HDMI2
                3. HDMI1, HDMI2, HDMI3
                **/
                var isenable = isEnableFECC(line);
                if(isenable)
                {
                    //start FECC
                    ctrlFECC(line,1);
                }
                else
                {
                    //not enable FECC
                    $("#operatetip span").text(a_63);
                    $("#operatetip").fadeIn();
                    setTimeout(function(){$("#operatetip").fadeOut();},2000);
                }
            }
            else
            {
                $.prompt(a_16707+" "+a_63);
            }
        }
        else
        {
            $.prompt(a_16707+" "+a_63);
        }
    });

    $("#closeFECC").click(function(){
        //stop FECC
        var line = $(this).parent().parent().attr("line");
        ctrlFECC(line,0);
    });

    $(".linetransfer").live("click",function(e){
        var distransfer = $("#distranfer",window.parent.document).val();
        var line = $(this).parent().parent().attr("line");
        if(distransfer == "1")
        {
            $.prompt(a_561);
            return false;
        }
        if(mCalllogItems == "")
        {
            window.parent.block_download_func(a_6660);
            get_normal_calllog(2, 0);
        }
        var urihead = "action=switchline&region=confctrl&line="+line;
        cb_get_confaction(urihead,"",true);
        ctrllinetransfer(e);
    });

    $("#transferback").click(function(){
        $("#transferdiv,#transferlinediv").hide();
        ctrl_show_maskdiv(false);
        $("#incomingcalldiv",window.parent.document).css("z-index","1002");
        $("#callingtips").hide();
        mAttendtransferMode = 0;
    });

    $("#transferok").click(function(e){
        dealwith_transfer(e);
    });

    $("#transfernext").click(function(){
        var mode = $(this).attr("mode");
        var transfermode = $("#transfermode").val();
        var flag = false;
        var number = "";
        if(mode == "blind_1")
        {
            if($("#transfernumselect").length > 0)
            {
                var tiptitle = a_16673;
                $("#transferlinediv .selecttitle span").text(tiptitle);
                $("#transfernumselect").siblings().hide();
                $("#transfernumselect").next(".newListSelected").show();
                $("#transfernext, #transferpopcancel").attr("mode","blind_2");
            }
            else
            {
                flag = true;
                number = $("#transferselectlist #transfernum").text();
            }
        }
        else
            if(mode == "blind_2")
            {
                flag = true;
                $("#transferlinediv .selecttitle span").text("");
                number = $("#transfernumselect").val();
            }
            else
                if(mode == "blind_3")
                {
                    //attend
                    flag = false;
                    number = $("#transfernumselect").val();
                    if(number == undefined)
                        number = $("#transfernum").text();
                    mAttendtransferMode = 0;
                    var line = $("#onewaycall div[number=\""+number+"\"]").attr("line");
                    var urihead = "action=attendtransferline&region=confctrl&line="+line;
                    var callfn = "transfer_callback();";
                    cb_get_confaction(urihead,callfn,true);
                }

        var dialplanflag = true;
        var urihead = "action=dialPlanCheck&region=confctrl&account=0&number="+number;
        urihead += "&time=" + new Date().getTime();
        $.ajax ({
            type: 'get',
            url:'/manager',
            data:urihead,
            dataType:'text',
            async:false,
            success:function(data) {
                var data = eval("("+data+")");
                if(parseInt(data.msg)<1)
                {
                    dialplanflag = false;
                }
            },
            error:function(xmlHttpRequest, errorThrown) {
                cb_networkerror(xmlHttpRequest, errorThrown);
            }
        });
        if(!dialplanflag)
        {
            $.prompt(a_533);
            $("#transferlinediv").hide();
            ctrl_show_maskdiv(false);
            $("#incomingcalldiv",window.parent.document).css("z-index","1002");
            $("#callingtips").hide();
            return false;
        }

        if(flag && transfermode == "0")
        {
            //blind
            mAttendtransferMode = 3;
            var urihead = "action=transfernumber&region=confctrl&number="+encodeURIComponent(number);
            var callfn = "transfer_callback();";
            cb_get_confaction(urihead,callfn,true);
            ctrl_show_maskdiv(true);
            $("#loadingDiv .downfont").text(a_524);
            $("#loadingDiv").show();
            $("#incomingcalldiv",window.parent.document).css("z-index","-1");
        }
        else if(flag && transfermode == "1")
        {
            //attend
            mAttendtransferMode = 1;
            var line = $("#transferline div").attr("line");
            var urihead = "action=attendtransfer&region=confctrl&line="+line+"&number="+encodeURIComponent(number)+"&iscancel=0";
            var callfn = "";
            cb_get_confaction(urihead,callfn,true);
            $("#transferselectlist #transfernotice").text(a_634).show();
            $("#transferselectlist #transfernotice").siblings().hide();
            $("#transferlinediv .selectbtn button").hide();
            $("#transferlinediv,#attendcancel").show();
            $("#incomingcalldiv",window.parent.document).css("z-index","-1");
            $("#transfernext").attr("mode","blind_3");
            ctrl_show_maskdiv(true);
        }
    });

    $("#attendcancel").click(function(){
        var line = $("#transferline div").attr("line");
        //var urihead = "action=attendtransfercancel&region=confctrl&line="+line;
        var urihead = "action=attendtransfer&region=confctrl&line="+line+"&number=''&iscancel=1";
        var callfn = "";
        cb_get_confaction(urihead,callfn,true);
        mAttendtransferMode = 0;
        $("#transferlinediv,#attendcancel").hide();
        ctrl_show_maskdiv(false);
        $("#incomingcalldiv",window.parent.document).css("z-index","1002");
        $("#callingtips").hide();
    });

    $("#transferdetach").click(function(){
        var urihead = "action=attendtransfersplit&region=confctrl";
        var callfn = "transfer_callback();";
        cb_get_confaction(urihead,callfn,true);
        $("#transferlinediv,#transferdiv").hide();
        ctrl_show_maskdiv(false);
        $("#incomingcalldiv",window.parent.document).css("z-index","1002");
        $("#callingtips").hide();
        mAttendtransferMode = 0;
    })

    $("#transferpopcancel").click(function(){
        var mode = $(this).attr("mode");
        if(mode == "blind_1")
        {
            $("#transferlinediv").hide();
            ctrl_show_maskdiv(false);
            $("#incomingcalldiv",window.parent.document).css("z-index","1002");
            $("#callingtips").hide();
        }
        else
            if(mode == "blind_2")
            {
                $("#transferlinediv .selecttitle span").text("");
                $("#transfernotice").siblings().hide();
                $("#transfernotice").show();
                $("#transfernext, #transferpopcancel").attr("mode","blind_1");
            }
        mAttendtransferMode = 0;
    });

    $("#dndsave").click(function(){
        var mode = $("#dndmode").val();
        var setdnd = "1";
        var urihead = "";
        var callfn = "setdnd_callback(data);";

        if(mode == "0")
            setdnd = "0";
        if(mode == "2")
        {
            urihead = "action=setdndonoroff&region=confctrl&setdnd=0&dndtype=1&account=0";    
            cb_get_confaction(urihead,"",true);
        }

        urihead = "action=setdndonoroff&region=confctrl&setdnd="+setdnd+"&dndtype="+mode+"&account=0";
        
        cb_get_confaction(urihead,callfn,true);
        $("#dndselect").hide();
        ctrl_show_maskdiv(false);
    });

    $("#dndcancel").click(function(){
        $("#dndselect").hide();
        ctrl_show_maskdiv(false);
    });

    $("#pincodesave").click(function(){
        var pincode = $("#newpincode").val();
        if( pincode == a_15046 )
            pincode = "";
        var reg = new RegExp("^[0-9]*$");
        if(!reg.test(pincode)){
            $("#a_pincodetip").show();
            return false;
        }

        var urihead = "action=setpincode&region=confctrl&pincode="+pincode;
        var callfn = "setpincode_callback(data);";
        cb_get_confaction(urihead,callfn,true);
        $("#pincodediv").hide();
        ctrl_show_maskdiv(false);
    });
    
    $("#pincodecancel").click(function(){
        $("#pincodediv").hide();
        ctrl_show_maskdiv(false);
    });
    
    $("#pincode").click(function(){
        var urihead = "action=getpincode&region=confctrl";
        var callfn = "getpincode_callback(data);";
        cb_get_confaction(urihead,callfn,true);
        $("#pincodediv").show();
        ctrl_show_maskdiv(true);
    });
    
    $("#newpincode").focus(function(){
        if( $(this).val() == a_15046 ){
            $(this).val("").removeClass("inputhint");
        }
        $("#a_pincodetip").hide();
    }).blur(function(){
        if( $(this).val() == "" ){
            $(this).val(a_15046).addClass("inputhint");
        }
    });
    
    $("#search").bind('input propertychange', function() {
        var searchkey = ($("#search").val()).toLowerCase();
        var reg = new RegExp("^[0-9]|/.*$");
        var $searchitem = $("#contactsdiv .itemdiv.confdiv.creatednewItem");
        if($searchitem.length <= 0 && searchkey != "")
        {
            var checkedDiv = document.createElement("DIV");
            checkedDiv.className = "itemdiv confdiv searchnewItem creatednewItem";
            checkedDiv.setAttribute("name","");
            checkedDiv.setAttribute("acctindex",$("#acctselect").val());
            checkedDiv.setAttribute("account",$("#acctselect").val());
            checkedDiv.setAttribute("number","");
            checkedDiv.setAttribute("groupid","");

            var inputcbxdiv = document.createElement("DIV");
            inputcbxdiv.className = "itemcheck";
            var cbx = document.createElement("INPUT");
            cbx.className = "inputcbx sreachitemcbx";
            cbx.type = "checkbox";
            inputcbxdiv.appendChild(cbx);
            checkedDiv.appendChild(inputcbxdiv);

            var icondiv = document.createElement("DIV");
            icondiv.className = "itempicon";
            var icon = document.createElement("DIV");
            icon.className = "searchitemicon";
            icondiv.appendChild(icon);
            checkedDiv.appendChild(icondiv);

            var namediv = document.createElement("DIV");
            namediv.className = "itemname";
            var spantext = document.createElement("SPAN");
            spantext.innerHTML = "";
            spantext.setAttribute("title","");
            namediv.appendChild(spantext);
            checkedDiv.appendChild(namediv);

            var numdiv = document.createElement("DIV");
            numdiv.className = "itemnum";
            var numtext = document.createElement("SPAN");
            numtext.innerHTML = "";
            numtext.setAttribute("title","");
            numdiv.appendChild(numtext);
            checkedDiv.appendChild(numdiv);

            $("#contactsdiv").append(checkedDiv);

            $(".sreachitemcbx").bind("click",function(e){
                var $parent = $(this).parent().parent();
                var acct = $("#acctselect").val();
                $("#contactsdiv .itemdiv.confdiv").show();
                $parent.attr("acctindex",acct).removeClass("creatednewItem");
                $(this).removeClass("sreachitemcbx");
                $("#search").removeAttr("disabled");
                $(this).unbind().click(function(){
                    if(!addmember_inputclick($(this)))
                    {
                        return false;
                    }
                });
                if($(this).prop("checked"))
                {
                    if(acct != "1")
                        mCheckedmembernum++;
                    else if(acct == "1" && !mIsreduce){
                        mCheckedmembernum++;
                        mIsreduce = true;
                    }
                        
                    $("#contactsdiv").prepend($parent);
                    
                    /*if(!mIsreduce && acct == "1" && (mProduct != "GVC3202" || (mProduct == "GVC3202" && !mIsIPVConf)) )
                    {
                        mAddmember_maxnum = mAddmember_maxnum - 1;
                        mIsreduce = true;
                    }*/
                }else{}
                
                /*if((mCheckedmembernum+mConfmemeber_num) >= mAddmember_maxnum)
                {
                    $("#search").attr("disabled","disabled");
                }*/
                if((mCheckedmembernum+mConfmemeber_num) > mAddmember_maxnum)
                {
                    mCheckedmembernum--;
                    $("#addmemberdiv p").text(a_10097);
                    setTimeout(function(){$("#addmemberdiv p").text("");},1000);
                    $(this).parent().parent().remove();
                    $("#search").val("");
                    return false;
                }
                $("#search").val("");
                $("#bjpassword").val(a_6759);
                e.stopPropagation();
            });
        }

        if(reg.test(searchkey))
        {
            $searchitem.attr("name",searchkey).attr("number",searchkey);
            $searchitem.find(".itemname").children("span").attr("title",searchkey).text(searchkey);
            $searchitem.find(".itemnum").children("span").attr("title",searchkey).text(searchkey);
            $searchitem.show();
        }

        $(".itemdiv").each(function(){
            var $this = $(this);
            if( ($this.attr("number").toLowerCase()).indexOf(searchkey) == -1 && ($this.attr("name").toLowerCase()).indexOf(searchkey) == -1 )
            {
                $this.hide();
            }else{
                $this.show();
            }
        });
    });

    $("#transfersearch").bind('input propertychange', function() {
        var searchkey = ($("#transfersearch").val()).toLowerCase();
        $(".itemdiv").each(function(){
            var $this = $(this);
            if( ($this.attr("number").toLowerCase()).indexOf(searchkey) == -1 && ($this.attr("name").toLowerCase()).indexOf(searchkey) == -1 )
            {
                $this.hide();
            }else{
                $this.show();
            }
        });
    });

    $("#tabs li a").unbind();
    $("#tabs ul li").unbind();

    $("#DTMF").click(function(){
        if(!judge_ispause())
        {
            return false;
        }
        if($("#details").attr("isshow") != "0")
            return false;
        var $dtmfdiv = $("#dtmfDiv");
        mIncalldtmf = $("#incalldtmf",window.parent.document).val();
        if($dtmfdiv.is(":visible"))
        {
            $dtmfdiv.hide();
            $(this).removeClass("active");
        }
        else
        {
            var urihead,callfn;
            if(mDisableconf == "0")
            {
                urihead = "action=getconfdtmf&region=confctrl";
                callfn = "getdtmfstring_callback(data);";
                cb_get_confaction(urihead,callfn,false);
            }
            else
            {
                urihead = "action=getallLineInfo&region=confctrl";
                callfn = "getdtmfstring_callback(data);";
                cb_get_confaction(urihead,callfn,false);
            }
            $dtmfdiv.show();
            ctrl_show_maskdiv(true);
            $(this).addClass("active");
        }
    });

    $("#switchvideosource").click(function(){
        if(!judge_ispause() || !countClickedTimes())
        {
            return false;
        }
        var ison = $(this).attr("ison");
        var flag = 0;
        if(ison == "0")
        {   
            if($("#present").attr("bfcp") != "2")
            { 
                action = "get&var-0000=vgaIn&var-0001=hdmiIn&var-0002=hdmi2&var-0003=hdmi3";
                var returnflag = getHDMIinfo(action);
                if(returnflag == 3)
                {
                    $.prompt(a_10047);
                    return false;
                }
            }
            flag = 1;
        }
        else
            flag = 0;
        var urihead = "action=ctrlswitchtosubstream&region=confctrl&ison="+flag;
        var callfn = "setsubstream_callback(data);";
        cb_get_confaction(urihead,callfn,true);
        delayshowtip(a_7355);
    });

    $("#closedtmf").click(function(){
        $("#dtmfDiv").hide();
        $("#DTMF").removeClass("active");
        if( !$("#addmemberdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);
    });

    $(".dtmfkeypad").mouseup(function(){
        var number = $(this).text();
        var inputtext = $("#dtmfinput p").text();
        var hide_content = "";
        var new_content = "";
        var maxlength = 12;
        var urihead = "action=sendDTMFchar&region=confctrl&dtmfvalue="+ encodeURIComponent(number);
        var callfn = "";
        mDTMFstr += number;
        mIncalldtmf = $("#incalldtmf",window.parent.document).val();
        if(mIncalldtmf == "1")
        {
            maxlength--;
            number = mReplacement;
            var pswstr = "";
            for(var n=0; n<inputtext.length; n++)
                pswstr += mReplacement;
            inputtext = pswstr+number;
        }
        else
        {
            inputtext = mDTMFstr;
        }
        //inputtext = inputtext + number;
        if(inputtext.length > maxlength)
        {
            hide_content = inputtext.substr(0, inputtext.length - maxlength );
            inputtext = inputtext.substr( inputtext.length - maxlength );
        }
        new_content = "<span style='display: none'>" + hide_content + "</span>" + inputtext;
        $("#dtmfinput p").html(new_content);

        cb_get_confaction(urihead,callfn,true);
    });

    $("#present").click(function(){
        if( $("#presentflow").children(".presentlist").children(".newListSelected").length == 0 ){
            $("#presentmode").sSelect();
        }
        $("#presentselect").show();
        var hdmiInOn = 0, wifiDisplayOn = 0;
        var urihead = "action=gethdmiinstate&region=status&time=" + new Date().getTime();
        $.ajax ({
            type: 'get',
            url:'/manager',
            data:urihead,
            dataType:'text',
            async: false,
            success:function(data) {
                var tObj = eval("(" + data + ")");
                
                if(tObj.res == "success"){
                    $("#presentmode").resetSS();
                    var state = tObj.state;
                    if( state == "1"){
                        hdmiInOn = 1;
                    }
                }
                else{}
            },
            error:function(xmlHttpRequest, errorThrown) {
                $("#presentmode").getSetSSValue("0");
            }
        });
        
        var urihead = "action=getwifidisplaystate&region=confctrl&time=" + new Date().getTime();
        $.ajax ({
            type: 'get',
            url:'/manager',
            data:urihead,
            dataType:'text',
            async: false,
            success:function(data) {
                var tObj = eval("(" + data + ")");
                
                if(tObj.res == "success"){
                    var state = tObj.state;
                    if( state == "1"){
                        wifiDisplayOn = 1;
                    }
                }
                else{}
            },
            error:function(xmlHttpRequest, errorThrown) {
                $("#presentmode").getSetSSValue("0");
            }
        });
        
        /*if hdmi1 out is 4k or video codec is H.265, PC mode should be disabled*/
        if(is4kon || videocodec || !hdmiInOn && !wifiDisplayOn){
            $("#presentsource").hide();
            if( $("#presentmode option").length == 3 ){
                $("#presentmode option:eq(1)").remove();
                $("#presentmode").resetSS();
            }
        }else if(!is4kon && !videocodec && (hdmiInOn || wifiDisplayOn)){
            $("#presentsource").hide();
            if( $("#presentmode option").length < 3 ){
                $("#presentmode option:eq(1)").remove();
                var optionstr = "<option value='3'>PC</option><option value='0'>"+a_32+"</option>";
                $("#presentmode").append(optionstr);
                $("#presentmode").resetSS();
            }
        }
        
        if(hdmiInOn & wifiDisplayOn){
            if($("#presource").length > 0)
                $("#presentsource").show();
            else{
                var presourcehtml = "<div id='presentsource' class='presentitem'>" + 
                                        "<div class='presentlabel'>" + a_19248 + ": </div>" + 
                                        "<div class='presentlist'>" + 
                                            "<select id='presource'>" + 
                                                "<option value='0'>HDMI</option>" + 
                                                "<option value='1'>WifiDisplay</option>" + 
                                            "</select>" + 
                                        "</div>" +
                                    "</div>";
                $("#presentflow").after(presourcehtml);
                $("#presource").sSelect();
            }
            
            urihead = "action=getpresentsource&region=confctrl";
            cb_get_confaction(urihead, "", false);
        }
        
        $("#presentselect").show();
        
        urihead = "action=getBFCPMode&region=confctrl";
        cb_get_confaction(urihead, "", false);

    });
    
    $("#presentsave").click(function(){
        change_presentation_type();
        $("#presentselect").hide();
    });
    $("#presentcancel").click(function(){
        $("#presentselect").hide();
    });
    $("#recordingOK").click(function(){
        cb_get_action("startrecord&region=confctrl");
        var urihead = "action=continueRecord&region=confctrl&flag=1";
        cb_get_confaction(urihead,"");
        /*$("#continuerecording").hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);*/
    });

    $("#recordingcancel").click(function(){
        var urihead = "action=continueRecord&region=confctrl&flag=0";
        cb_get_confaction(urihead,"");
        /*$("#continuerecording").hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#detailsdiv").is(":visible") && !$("#layoutdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#selectvideodiv").is(":visible"))
            ctrl_show_maskdiv(false);*/
    });

    $("#direction button, #feccoptbtn button").mousedown(function(){
        var keycode = $(this).attr("keycode");
        if( keycode != undefined && keycode != "" ){
            var counttimes = 0;
            cb_send_key(0, keycode, 0);
            mInterval = setInterval(function(){cb_send_key(0, keycode, ++counttimes);}, 200);
        }
        
    }).mouseup(function(){
        clearInterval(mInterval);
        var keycode = $(this).attr("keycode");
        if( keycode != undefined && keycode != "" ){
            cb_send_key(1, keycode, 0);
        }
    });

    $("#direction button, #feccoptbtn button").mouseout(function(){
        clearInterval(mInterval);
        var keycode = $(this).attr("keycode");
        if( keycode != undefined && keycode != "" ){
            cb_send_key(1, keycode, 0);
        }
    });

    /*layout*/
    $("#layout").click(function(){
        if(!judge_ispause())
        {
            return false;
        }
        var flag = false;
        $("#conf .remoteline").each(function(){
            var isvideo = $(this).attr("isvideo");
            if(isvideo == "1")
            {
                flag = true;
                return false;
            }
        });
        
        if( ($("#present").attr("ison") == "1" && $("#present").attr("bytype") != "videosource" ) || ($("#present").attr("bfcp") == "2") || (!flag && $("#present").attr("bfcp") != "0" && $("#present").attr("bfcp") != undefined))  //audio call & pc presentation mode is on
            flag = true;
        if(!flag)
        {
            $.prompt(a_10109);
            return false;
        }
        var urihead = "action=gethdmi1state&region=status";
        var callbackfn = "displayLayout(data)";
        cb_get_confaction(urihead,callbackfn);
    });
    
    $(".hdmidiv").live("click", function(){
        var id = $(this).attr("id");
        //var mode = $(".modelist li[mode=custom]").attr("childmode");
        
        var mode, content;
        if(id.indexOf("2") != -1){
            mCurhdmi = 2;
        }
        else{
            mCurhdmi = 1;
        }
        
        if(mHdmi2state == 1 && mCurhdmi == 2){
            mode = mHdmiModeContent[2];
            content = mHdmiModeContent[3];
        }
        else {
            mode = mHdmiModeContent[0]
            content = mHdmiModeContent[1];
        }
        display_customscreenlayout(mode, content, mCurhdmi, mHdmi2state);
        $(".cusmode[mode=" + mode + "]").addClass("active");
    });


    $(".modelist li[mode=sysrcmd], #sysrcmdmode").mouseover(function(){
        $("#sysrcmdmode").show();
    }).mouseleave(function(){
        $("#sysrcmdmode").hide();
    });

    $(".modelist li").click(function(){
        var beforemode;
        $(".modelist li").each(function(){
            if($(this).hasClass("active")){
                beforemode = $(this).attr("mode");
                return;
            }
        });
        
        var mode = $(this).attr("mode");
        if(mode == "sysrcmd")
            mIsSysrcmd = 1;
        else
            mIsSysrcmd = 0;

        switch (mode) {
            case "sysrcmd":
                if(mOEMID == "54" && mHdmi2state == 0)
                    mode = "6";
                else
                    mode = "4";
                break;
            case "overlap":
                mode = "4";
                break;
            case "childmother":
                mode = "5";
                break;
            case "pop":
                mode = "6";
                break;
            case "custom":
                mCurhdmi = 1;
                if(beforemode == "sysrcmd"){
                    if(mOEMID == "54" && mHdmi2state == 0)
                        mode = "3";
                    else
                        mode = "1";
                }
                else if(beforemode == "overlap")
                    mode = "1";
                else if(beforemode == "childmother")
                    mode = "2";
                else if(beforemode == "pop")
                    mode = "3";
                else if(beforemode == "custom")
                    return false;
                
                $(".modelist li[mode=custom]").attr("childmode", mode);
                
                if(beforemode == "sysrcmd")
                    mIsSysrcmdBefore = 1;
                else
                    mIsSysrcmdBefore = 0;
                break;
        }
        layout_choosemode(mode);
        
        $(".layoutcontainer").children().remove();
        
        if(mode < 4){
            display_customscreenlayout(mode, mHdmiModeContent[1], 1, mHdmi2state);
            $(".cusmode[mode=" + mode + "]").addClass("active");
        }
        else{
            if(mHdmi2state == 0){
                display_default1screenlayout(mode, layout_returncontent(mode, 1));
            }
            else{
                display_default2screenlayout(mode, layout_returncontent(mode, 1), mode, layout_returncontent(mode, 2));
            }
        }
    });
    
    $(".screendiv").live("click", function(){
        //var mode = $(".modelist li[mode=custom]").attr("childmode");
        var mode;
        $(".cusmode").each(function(){
            if($(this).hasClass("active")){
                mode = $(this).attr("mode");
                return false;
            }
        });
        var presenton = parseInt($("#present").attr("ison"));
        if(!presenton && mHdmiModeContent[4] == 1)
            presenton = 1;
            
        var line = $(this).parent().attr("line");
        if($(this).hasClass("active"))
            return false;
            
        var isvideo = false;
        $("#conf .remoteline").each(function(){
            var videocall = $(this).attr("isvideo");
            if(videocall == "1")
            {
                isvideo = true;
                return false;
            }
        });
        
        var linelength = $(".layoutnumber").length;
        
        if(linelength > 2 && mHdmi2state == 1){
            /*new requirement --- hdmi1 & hdmi2 can't display more than 4 screens at same time*/
            if(mCurhdmi == 1){
                var allowscreenum = 4 - mHdmiModeContent[3].split(":::").length;
            }else{
                var allowscreenum = 4 - mHdmiModeContent[1].split(":::").length;
            }
            
            var linearray = new Array("12", "0", "13");
            var line = $(this).parent().attr("line");
            var nextorder = ($.inArray(line, linearray) + 1) % 3;
            var nextline = linearray[nextorder];
            var next2line = linearray[(nextorder + 1) % 3];
            //var line = $(this).parent().attr("line");
            switch (mode) {
                case "1":
                    if(allowscreenum == 1){
                        if($(this).hasClass("normalscreen")){
                            var chooseline;
                            $(".normalscreen").each(function(){
                                if($(this).hasClass("active")){
                                    chooseline = $(this).parent().attr("line");
                                    return false;
                                }
                            });
                            switch_screenactive(line ,chooseline);
                        }else{
                            switch_screenactive(line ,nextline);
                        }
                    }else if(allowscreenum == 2){
                        if($(this).hasClass("normalscreen"))
                            var chosenscr = "normalscreen";
                        else
                            var chosenscr = "hidescreen";
                            
                        var countscr = 0;
                        $("." + chosenscr).each(function(){
                            if($(this).hasClass("active"))
                                countscr ++;
                        });
                        
                        if(countscr == 1){
                            $(this).parent().children(".screendiv").removeClass("active");
                            $(this).addClass("active")
                        }else{
                            switch_screenactive(line ,nextline);
                        }
                    }else{
                        if($(this).hasClass("normalscreen")){
                            $(this).parent().children(".screendiv").removeClass("active");
                            $(this).addClass("active")
                        }else{
                            var countscr = 0;
                            $(".hidescreen").each(function(){
                                if($(this).hasClass("active"))
                                    countscr ++;
                            });
                            
                            if(countscr < 2){
                                $(this).parent().children(".screendiv").removeClass("active");
                                $(this).addClass("active")
                            }else{
                                switch_screenactive(line ,nextline);
                            }
                        }
                    }
                    break;
                case "2":
                case "3":
                    if(allowscreenum == 1){
                        if($(this).hasClass("fullscreen")){
                            var chooseline;
                            $(".fullscreen").each(function(){
                                if($(this).hasClass("active")){
                                    chooseline = $(this).parent().attr("line");
                                    return false;
                                }
                            });
                            switch_screenactive(line ,chooseline);
                        }else{
                            switch_screenactive(line ,nextline);
                        }
                    }else if(allowscreenum == 2){
                        if($(this).hasClass("fullscreen")){
                            $(".fullscreen").each(function(){
                                if($(this).hasClass("active")){
                                    $(this).removeClass("active");
                                    $(this).parent().children(".normalscreen").addClass("active");
                                    return false;
                                }
                            });
                            
                            $(this).parent().children(".screendiv").removeClass("active");
                            $(this).addClass("active");
                            var countnorsct = 0;
                            $(".normalscreen").each(function(){
                                if($(this).hasClass("active"))
                                    countnorsct ++;
                            });
                            
                            if(countnorsct > 1){
                                $(".layoutnumber[line=" + nextline + "]").children(".screendiv").removeClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".hidescreen").addClass("active");
                            }
                        }
                        else if($(this).hasClass("normalscreen")){
                            if($(".layoutnumber[line=" + line + "]").children(".hidescreen").hasClass("active")){
                                $(".normalscreen").each(function(){
                                    if($(this).hasClass("active")){
                                        $(this).removeClass("active");
                                        $(this).parent().children(".hidescreen").addClass("active");
                                        return false;
                                    }
                                });
                                $(this).addClass("active");
                                $(this).parent().children(".hidescreen").removeClass("active");
                            }
                            else{
                                $(this).parent().children(".fullscreen").removeClass("active");
                                $(this).addClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".screendiv").removeClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".fullscreen").addClass("active");
                                $(".layoutnumber[line=" + next2line + "]").children(".screendiv").removeClass("active");
                                $(".layoutnumber[line=" + next2line + "]").children(".hidescreen").addClass("active");
                            }
                        }else{
                            if($(".layoutnumber[line=" + line + "]").children(".normalscreen").hasClass("active")){
                                $(this).parent().children(".normalscreen").removeClass("active");
                                $(this).addClass("active");
                            }
                            else{
                                $(this).parent().children(".fullscreen").removeClass("active");
                                $(this).addClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".screendiv").removeClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".fullscreen").addClass("active");
                            }
                        }
                    }else{
                        if($(this).hasClass("fullscreen")){
                            $(".fullscreen").each(function(){
                                if($(this).hasClass("active")){
                                    $(this).parent().children(".normalscreen").addClass("active");
                                    $(this).removeClass("active");
                                    return false;
                                }
                            });
                            $(this).parent().children(".screendiv").removeClass("active");
                            $(this).addClass("active");
                        }
                        else if($(this).hasClass("normalscreen")){
                            if($(".layoutnumber[line=" + line + "]").children(".hidescreen").hasClass("active")){
                                $(this).addClass("active");
                                $(this).parent().children(".hidescreen").removeClass("active");
                            }
                            else{
                                $(this).parent().children(".fullscreen").removeClass("active");
                                $(this).addClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".screendiv").removeClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".fullscreen").addClass("active");
                            }
                        }
                        else{
                            if($(".layoutnumber[line=" + line + "]").children(".normalscreen").hasClass("active")){
                                $(this).parent().children(".normalscreen").removeClass("active");
                                $(this).addClass("active");
                            }else{
                                $(this).parent().children(".fullscreen").removeClass("active");
                                $(this).addClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".screendiv").removeClass("active");
                                $(".layoutnumber[line=" + nextline + "]").children(".fullscreen").addClass("active");
                            }
                        }
                    }
                    break;
            }
            
        }else{
            if(linelength == 2)
                $(".screendiv").removeClass("active");
            $(this).addClass("active"); 
            if($(this).hasClass("fullscreen")){
                switch (mode) {
                    case "2":
                    case "3":
                        if(linelength == 2){
                            $(".layoutnumber").each(function(){
                                var curline = $(this).attr("line");
                                if(curline != line){
                                    $(this).children(".normalscreen").addClass("active");
                                }
                            });
                        }
                        else{
                            $(this).parent().children(".normalscreen").removeClass("active");
                            $(this).parent().children(".hidescreen").removeClass("active");
                            $(".layoutnumber").each(function(){
                                var curline = $(this).attr("line");
                                if(curline != line){
                                    if($(this).children(".fullscreen").hasClass("active")){
                                        $(this).children(".fullscreen").removeClass("active");
                                        $(this).children(".normalscreen").addClass("active");
                                    }
                                }
                            });
                        }
                        break;
                }
            }else if($(this).hasClass("normalscreen")){
                switch (mode) {
                    case "1":
                        if(!presenton || presenton && !isvideo){
                            $(".layoutnumber").children(".normalscreen").addClass("active");
                        }
                        else{
                            $(this).parent().children(".hidescreen").removeClass("active");
                        }
                        break;
                    case "2":
                    case "3":
                        if(linelength == 2){
                            $(".layoutnumber").each(function(){
                                var curline = $(this).attr("line");
                                if(curline != line){
                                    $(this).children(".fullscreen").addClass("active");
                                }
                            });
                        }
                        else{
                            if($(this).parent().children(".fullscreen").hasClass("active")){
                                $(this).parent().children(".fullscreen").removeClass("active");
                                if(line == "12"){
                                    $("#remoteline-0").children(".screendiv").removeClass("active");
                                    $("#remoteline-0").children(".fullscreen").addClass("active");
                                }
                                else if(line == "13"){
                                    $("#presentline").children(".screendiv").removeClass("active");
                                    $("#presentline").children(".fullscreen").addClass("active");
                                }
                                else{
                                    $("#localline").children(".screendiv").removeClass("active");
                                    $("#localline").children(".fullscreen").addClass("active");
                                }
                            }
                            else if($(this).parent().children(".hidescreen").hasClass("active")){
                                $(this).parent().children(".hidescreen").removeClass("active");
                            }
                        }
                        break;
                }
            }else{
                switch (mode) {
                    case "1": 
                        if(linelength == 2){
                            $(".layoutnumber").each(function(){
                                var curline = $(this).attr("line");
                                if(curline != line){
                                    $(this).children(".normalscreen").addClass("active");
                                }
                            });
                        }
                        else{
                            var hidelinecount = 0;
                            $(".layoutnumber").each(function(){
                                if($(this).children(".hidescreen").hasClass("active"))
                                    hidelinecount ++;
                            });
                            if(hidelinecount <= 2){
                                $(this).parent().children(".normalscreen").removeClass("active");
                            }
                            else{
                                $(this).parent().children(".normalscreen").removeClass("active");
                                if(line == "12"){
                                    $("#remoteline-0").children(".normalscreen").addClass("active");
                                    $("#remoteline-0").children(".hidescreen").removeClass("active");
                                }
                                else if(line == "13"){
                                    $("#presentline").children(".normalscreen").addClass("active");
                                    $("#presentline").children(".hidescreen").removeClass("active");
                                }
                                else{
                                    $("#localline").children(".normalscreen").addClass("active");
                                    $("#localline").children(".hidescreen").removeClass("active");
                                }
                            }
                        }
                        break;
                    case "2":
                    case "3":
                        if(linelength == 2){
                            $(".layoutnumber").each(function(){
                                var curline = $(this).attr("line");
                                if(curline != line){
                                    $(this).children(".fullscreen").addClass("active");
                                }
                            });
                        }
                        else{
                            if($(this).parent().children(".fullscreen").hasClass("active")){
                                $(this).parent().children(".fullscreen").removeClass("active");
                                if(line == "12"){
                                    $("#remoteline-0").children(".screendiv").removeClass("active");
                                    $("#remoteline-0").children(".fullscreen").addClass("active");
                                }
                                else if(line == "13"){
                                    $("#presentline").children(".screendiv").removeClass("active");
                                    $("#presentline").children(".fullscreen").addClass("active");
                                }
                                else{
                                    $("#localline").children(".screendiv").removeClass("active");
                                    $("#localline").children(".fullscreen").addClass("active");
                                }
                            }
                            else if($(this).parent().children(".normalscreen").hasClass("active")){
                                $(this).parent().children(".normalscreen").removeClass("active");
                            }
                        }
                        break;
                }    
            }
        }
        
        var content = "";
        if(mode == "1"){
            $(".layoutnumber").each(function(){
                if($(this).children(".normalscreen").hasClass("active")){
                    var line = $(this).attr("line");
                    content += line + ":::";
                }
            });
            
        }
        else{
            $(".fullscreen").each(function(){
                if($(this).hasClass("active")){
                    var line = $(this).parent().attr("line");
                    content += line + ":::";
                    return false;
                }
            });
            $(".normalscreen").each(function(){
                if($(this).hasClass("active")){
                    var line = $(this).parent().attr("line");
                    content += line + ":::";
                }
            });
        }
        
        content = content.substring(0, content.length - 3);
        if(mCurhdmi == 1){
            mHdmiModeContent[0] = mode;
            mHdmiModeContent[1] = content;
        }
        else{
            mHdmiModeContent[2] = mode;
            mHdmiModeContent[3] = content;
        }
        layout_customscreenadjuststyle(mode, content);
    });
    
    $(".cusmode").live("click", function(){
        var mode = $(this).attr("mode");
        var childmode = $(".modelist li[mode=custom]").attr("childmode");
        if(mCurhdmi == 1){
            var content = mHdmiModeContent[1];
        }
        else{
            var content = mHdmiModeContent[3];
        }

        display_customscreenlayout(mode, content, mCurhdmi, mHdmi2state);
        
        if(mode == childmode)
            return false;
        else{
            $(".cusmode").removeClass("active");
            $(".modelist li[mode=custom]").attr("childmode", mode);
            if(mode == "1"){
                $(".cusoverlap").addClass("active");
            }
            else if(mode == "2"){
                $(".cuschildmother").addClass("active");
            }
            else{
                $(".cuspop").addClass("active");
            }
            
            if(mCurhdmi == 1)
                mHdmiModeContent[0] = mode;
            else
                mHdmiModeContent[2] = mode;
        }
    });

    $("#layoutSave").click(function(){
        if(mHdmiModeContent[4] == 1){
            var re = new RegExp("12", "g");
            mHdmiModeContent[1] = mHdmiModeContent[1].replace(re, "15");
            
            if(mHdmiModeContent[2] != undefined){
                mHdmiModeContent[3] = mHdmiModeContent[3].replace(re, "15");
            }
        }
        
        var mode = $(".modelist li.active").attr("mode");
        if(mode == "sysrcmd")
            cb_get_action("setsysrcmdmode&region=confctrl");        
        else if(mode == "overlap")
            cb_get_action("setdefaultaverage&region=confctrl");
        else if(mode == "childmother")
            cb_get_action("setdefaultpop&region=confctrl");
        else if(mode == "pop")
            cb_get_action("setdefaultpip&region=confctrl");
        else{
            if(mHdmiModeContent[2] == undefined){
                mHdmiModeContent[2] = mHdmiModeContent[0];
                mHdmiModeContent[3] = "-1";
            }
            
            cb_get_action("setcustommode&region=confctrl&hdmi1mode=" + mHdmiModeContent[0] + "&hdmi1content=" + mHdmiModeContent[1] + "&hdmi2mode=" + mHdmiModeContent[2] + "&hdmi2content=" + mHdmiModeContent[3]);
        }

        $("#layoutdiv").hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#selectvideodiv").is(":visible") && !$("#detailsdiv").is(":visible"))
            ctrl_show_maskdiv(false);
    });

    $("#layoutCancel").click(function(){
        $("#layoutdiv").hide();
        if( !$("#addmemberdiv").is(":visible") && !$("#ctrlFECCDiv").is(":visible") && !$("#dtmfDiv").is(":visible") && !$("#selectvideodiv").is(":visible") && !$("#detailsdiv").is(":visible"))
            ctrl_show_maskdiv(false);
    });

    $(".closecontain button").hover(function(){
        $(this).addClass("buttonover").parent().addClass("buttonover");        
    },function(){
        $(this).removeClass("buttonover").parent().removeClass("buttonover");
    });

    $("#acctselect").change(function(){
        var acct = $(this).val();
        if(acct == "2")
        {
            $("#search").addClass("bjinput");
            $(".bjinput").show();
        }
        else
        {
            $("#search").removeClass("bjinput");
            $(".bjinput").hide();
        }
    });

    $("#bjpassword").focus(function(){
        if( $(this).val() == a_6759 ){
            $(this).val("").css("color", "#222");
        }
    }).blur(function(){
        if( $(this).val() == "" ){
            $(this).val(a_6759).css("color", "#999");
        }
    });

    /*$("#search").focus(function(){
        if( $(this).val() == a_4016 ){
            $(this).val("").css("color", "#222");
        }
    }).blur(function(){
        if( $(this).val() == "" ){
            $(this).val(a_4016).css("color", "#999");
        }
    });*/

    $(".confblock").live("click",function(){
        if(!countClickedTimes())
        {
            return false;
        }
        if(!judge_ispause())
        {
            return false;
        }
        var line = $(this).parent().parent().attr("line");
        var urihead = "action=blockLineOrNot&region=confctrl&line="+line;
        cb_get_confaction(urihead,"");
    });

    $(".confsuspend").live("click",function(){
        if(mSuspending)
        {
            $.prompt(a_552);  
            return false;
        }
        if(!countClickedTimes())
        {
            return false;
        }
        if(!judge_ispause())
        {
            return false;
        }
        mSuspending = true;
        var line = $(this).parent().parent().attr("line");
        var urihead = "action=suspendLineOrNot&region=confctrl&line="+line;
        cb_get_confaction(urihead,"");
    });

    $(".isvideoed").live("click",function(){
        if(!countClickedTimes())
            return false;
         if(!judge_ispause())
            return false;
        var flag = 1;
        if($(this).attr("isvideoed") == "1")
            flag = 0;
        var line = $(this).parent().parent().attr("line");
        var urihead = "action=conflinevideoedstate&region=confctrl&isvideoed="+flag+"&line="+line;
        cb_get_confaction(urihead,"");
    })
    
    $("#blockall").click(function(){
        if(!countClickedTimes())
        {
            return false;
        }
        if(!judge_ispause())
        {
            return false;
        }
        
        var flag = 0;
        if($(this).attr("isblockall") == "0")
            flag = 1;
        var urihead = "action=blockAllLinesOrNot&region=confctrl&flag="+flag;
        cb_get_confaction(urihead,"");
        delayshowtip(a_7355);
    });

    $("#suspendall").click(function(){
        if(!countClickedTimes())
        {
            return false;
        }
        if(!judge_ispause())
        {
            return false;
        }
        var cansuspend = false;
        $("#conf div.remoteline").each(function(){
            if( $(this).attr("state") == 4 && $(this).attr("isvideo") == "1" && $(this).attr("account") != "8" && $(this).attr("number").substring(0,2) != mIPVPrefix ){
                cansuspend = true;
                return false;
            }
        });
        if(!cansuspend)
        {
            return false;
        }                
        var flag = 0;
        if($(this).attr("issuspendall") == "0")
            flag = 1;
        var urihead = "action=suspendAllLinesOrNot&region=confctrl&flag="+flag;
        cb_get_confaction(urihead,"");
        delayshowtip(a_7355);
    });

    $("#muteall").click(function(){
        if(!countClickedTimes())
        {
            return false;
        }
        if(!judge_ispause())
        {
            return false;
        }
        var flag = 0;
        if($(this).attr("ismuteall") == "0")
            flag = 1;
        var urihead = "action=muteAllLinesOrNot&region=confctrl&flag="+flag;
        cb_get_confaction(urihead,"");
        delayshowtip(a_7355);
    });

}

/*********************Caption**********************************************/
function calleftheight(fnblockpos){
    var topheight = $("#topCaption").height();
    var bottomheight = $("#bottomCaption").height();
    var wholeheight = $("#captionContainer").height();
    var btnheight = $("#captionbtn").height();
    if(fnblockpos == "")
    {
        //init
        topheight = bottomheight = 30;
        btnheight = 30;
    }
    var leftheight = wholeheight - topheight - bottomheight - btnheight - 6;
    $("#leftCaption").css("height",leftheight+"px");

    if(fnblockpos == "top")
        changeBlockpostion(topheight,fnblockpos);
    if(fnblockpos == "bottom")
        changeBlockpostion(bottomheight,fnblockpos);
}
function initfnBlock(){
    calleftheight("");
    var fnblockContainer = $("<div id='fnblockContainer'></div>").appendTo($("#captionContainer"));
    var font = "<select id='fontfamily'>";
    font += "<option value='sans'>sans</option>";
    font += "<option value='serif'>serif</option>";
    font += "<option value='monospace'>monospace</option>";
    font += "</select>";
    var fontsize = "<select id='capfontsize'>";
    fontsize += "<option value='24px'>"+a_16246+"</option>";//smallest
    fontsize += "<option value='28px'>"+a_16247+"</option>";//smaller
    fontsize += "<option value='32px'>"+a_16248+"</option>";//small
    fontsize += "<option value='36px'>"+a_16236+"</option>";//medium
    fontsize += "<option value='40px'>"+a_16249+"</option>";//large
    fontsize += "<option value='46px'>"+a_16250+"</option>";//larger
    fontsize += "<option value='50px'>"+a_16251+"</option>";//largest
    fontsize += "</select>";
    var blod = "<button id='capBold'>B</button>";
    var fontcolor = "<div id='ftcolordiv'><span>A</span><input class='color' autocomplete='off' id='capfontcolor'/></div>";
    var bgcolor = "<div id='bgcolordiv'><input class='color' autocomplete='off' id='capbgcolor'/></div>";
    var leftalign = "<button id='capleftalign' align='left'></button>";
    var centeralign = "<button id='capcenteralign' align='center'></button>";
    var rightalign = "<button id='caprightalign' align='right'></button>";
    var lineheight = "<select id='caplineheight'>";
    lineheight += "<option value='sans'>"+a_16246+"</option>";//smallest
    lineheight += "<option value='sans'>"+a_16247+"</option>";//smaller
    lineheight += "<option value='sans'>"+a_16248+"</option>";//small
    lineheight += "<option value='sans'>"+a_16236+"</option>";//medium
    lineheight += "<option value='sans'>"+a_16249+"</option>";//large
    lineheight += "<option value='sans'>"+a_16250+"</option>";//larger
    lineheight += "<option value='sans'>"+a_16251+"</option>";//largest
    lineheight += "</select>";
    var speedcbx = "<input type='checkbox' id='capspeedcbx'/>";
    var speed = "<select id='capspeed'>";
    speed += "<option value='sans'>"+a_16244+"</option>";//slowest
    speed += "<option value='sans'>"+a_16243+"</option>";//slower
    speed += "<option value='sans'>"+a_16242+"</option>";//slow
    speed += "<option value='sans'>"+a_16236+"</option>";//medium
    speed += "<option value='sans'>"+a_16241+"</option>";//fast
    speed += "<option value='sans'>"+a_16240+"</option>";//faster
    speed += "<option value='sans'>"+a_16239+"</option>";//fastest
    speed += "</select>";

    fnblockContainer.append($(font));
    fnblockContainer.append($(fontsize));
    fnblockContainer.append($(blod));
    fnblockContainer.append($(fontcolor));
    fnblockContainer.append($(bgcolor));
    fnblockContainer.append($(leftalign));
    fnblockContainer.append($(centeralign));
    fnblockContainer.append($(rightalign));
    fnblockContainer.append($(lineheight));
    fnblockContainer.append($(speedcbx));
    fnblockContainer.append($(speed));

    mjsfontColor = new jscolor.color(document.getElementById('capfontcolor'), {}, "font", 0,jscolorCallback);
    mjsbgColor = new jscolor.color(document.getElementById('capbgcolor'), {}, "bg", 1,jscolorCallback);
    $("#capsend").text(a_4);
    $("#capapply").text(a_16003);
    setfnBlock_Event();
}

function changeBlockpostion(height,fnblockpos){
    var wholeheight = $("#captionContainer").height();
    var thistop = $("#fnblockContainer").position().top;
    var selfheight = $("#fnblockContainer").height();
    var btnheight = $("#captionbtn").height();
    var changetop;

    if(fnblockpos == "top")
    {
        changetop = height + 'px';  
        $("#fnblockContainer").css("top",changetop);    
    }
    else if(fnblockpos == "bottom")
    {
        changetop =  wholeheight - height - btnheight - selfheight + 'px';
        $("#fnblockContainer").css("top",changetop);
    }   
}

function setfnBlock_Event(){
    //set position
    $("#captionContainer .capinput").click(function(){
        var inputHeight = $(this).parent().height();
        var inputWidth = $(this).parent().width();
        var inputtop = $(this).parent().position().top;
        var inputleft = $(this).parent().position().left;
        var fnblockpos = $(this).attr("position");
        var fnblockWidth = 0;
        var fnblocktop = 0;
        var fnblockleft = 0;
        //init fnblock
        var fsize = $(this).css("font-size");
        var ffamily = $(this).css("font-family");
        var fbold = $(this).css("font-weight");
        var fcolor = $(this).css("color");
        var bgcolor = $(this).parent().css("background-color");
        var lheight = $(this).css("line-height");

        //set position
        $("#fnblockContainer").css("top",fnblocktop).css("left",fnblockleft);
        fnblockWidth = $("#fnblockContainer").width();
        if(fnblockpos == "top")
        {
            fnblocktop = inputtop + inputHeight + 'px';
            fnblockleft = inputleft + inputWidth - fnblockWidth + 'px';
            $("#capspeedcbx,#capspeed,#caplineheight").hide();
            $("#capleftalign,#capcenteralign,#caprightalign").show();
        }
        else if(fnblockpos == "left")
        {
            fnblocktop = inputtop + inputHeight/2 + 'px';
            fnblockleft = inputleft + inputWidth + 'px';
            $("#capspeedcbx,#capspeed,#caplineheight,#capleftalign,#capcenteralign,#caprightalign").show();
            $("#capspeedcbx").prop("checked",true);
            $("#capspeed").removeAttr("disabled");
        }
        else if(fnblockpos == "bottom")
        {
            fnblocktop = inputtop - inputHeight + 'px';
            fnblockleft = inputleft + inputWidth - fnblockWidth + 'px';
            $("#caplineheight,#capleftalign,#capcenteralign,#caprightalign").hide();
            $("#capspeedcbx,#capspeed").show();
            $("#capspeedcbx").prop("checked",false);
            $("#capspeed").attr("disabled","disabled");
        }

        $("#fnblockContainer").css("top",fnblocktop).css("left",fnblockleft).attr("position",fnblockpos).show();

        //init fnblock
        if(ffamily)
        {
            $("#fontfamily").val(ffamily);
        }
        else
        {
            $("#fontfamily").val("sans");
        }
        if(fsize)
        {
            $("#fontfamily").val();
        }
        else
        {
            $("#fontfamily").val();
        }
        if(fbold && fbold != "normal")
        {
            $("#capBold").addClass("active");
        }
        else
        {
            $("#capBold").removeClass("active");
        }
        if(fcolor)
        {
            mjsfontColor.fromString("#"+fcolor.colorHex());
        }
        else
        {
            mjsfontColor.fromString("#ffffff");
        }
        if(bgcolor)
        {
            var that = bgcolor;
            var opacity = 1;
            if(/^(rgba|RGBA)/.test(that)){
                var aColor = that.replace(/(?:\(|\)|rgba|RGBA)*/g,"").split(",");
                bgcolor = "rgb("+aColor[0]+","+aColor[1]+","+aColor[2]+")";
                opacity = aColor[3];
            }
            mjsbgColor.fromString("#"+bgcolor.colorHex(),"",opacity);
        }
        else
        {
            mjsbgColor.fromString("#ffffff");
        }
        if(lheight)
        {
            $("#caplineheight").val();
        }
        else
        {
            $("#caplineheight").val();
        }
    });

    $("#fontfamily").change(function(){
        var value = $(this).val();
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";

        $(changeInput).css("font-family",value);
        var fnblockpos = $(this).parent().attr("position");
        calleftheight(fnblockpos);
    });
    
    $("#capBold").click(function(){
        var classattr = $(this).attr("class");
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";
        if(classattr == undefined)
            classattr = "";
        if( classattr.indexOf("active") != -1 )
        {
            $(changeInput).css("font-weight","normal");
            $(this).removeClass("active");
        }
        else
        {
            $(changeInput).css("font-weight","bold");
            $(this).addClass("active");
        }
        var fnblockpos = $(this).parent().attr("position");
        calleftheight(fnblockpos);
    });

    $("#capleftalign, #capcenteralign, #caprightalign").click(function(){
        var classattr = $(this).attr("class");
        var align = $(this).attr("align");
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";
        if(classattr == undefined)
            classattr = "";
        if( classattr.indexOf("active") != -1 )
        {
            //$(changeInput).css("text-align","");
            $(this).removeClass("active");
        }
        else
        {
            $(changeInput).css("text-align",align);
            $(this).addClass("active");
        }
    });

    $("#capfontsize").change(function(){
        var value = $(this).val();
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";

        $(changeInput).css("font-size",value);
        var fnblockpos = $(this).parent().attr("position");
        calleftheight(fnblockpos);
    });

    $("#caplineheight").change(function(){
        var value = $(this).val();
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";

        $(changeInput).css("line-height",value);
        var fnblockpos = $(this).parent().attr("position");
        calleftheight(fnblockpos);
    });

    $("#captionContainer .capinput").blur(function(){
        //$("#fnblockContainer").hide();
    });

    $("#closecaption").click(function(){
        $("#captionContainer").hide();
    });
    $("#capsend").click(function(){
        $(this).hide();
        $("#stopsending").show();
    });
    $("#capapply").click(function(){
        $(this).hide();
        $("#capstop").show();
    });
    $("#stopsending").click(function(){
        $(this).hide();
        $("#capsend").show();
    });
    $("#capstop").click(function(){
        $(this).hide();
        $("#capapply").show();
    });
    $("#ftcolordiv, #bgcolordiv").click(function(){
        $(this).children("input").click();
    });
}

function jscolorCallback(target,value,opacity)
{
    if(target && target == "font")
    {
        var fontcolor = "#"+$("#capfontcolor").val();
        var position = $("#fnblockContainer").attr("position");
        var changeInput = "#"+position+"Caption input";
        $(changeInput).css("color",fontcolor);
    }
    else
        if(target && target == "bg")
        {
            var bgcolor = "#"+$("#capbgcolor").val();
            var position = $("#fnblockContainer").attr("position");
            var changeInput = "#"+position+"Caption";
            $(changeInput).css("background-color","rgba("+bgcolor.colorRgb()+","+opacity+")");
        }
}
/*******************************************************************/
</script>
</html>
