<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<link href="../css/perfect-scrollbar.min.css" rel="stylesheet">
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.stylish-select.min.js'></script>
<script type="text/javascript" src='../js/jquery.prompt.js'></script>
<script type="text/javascript" src="../js/perfect-scrollbar.with-mousewheel.min.js"></script>
<script type="text/javascript" src="../js/perfect-scrollbar.min.js"></script>
<script type="text/javascript" src="../js/jquery.manifest.min.js"></script>
<style>
body{overflow-y:hidden;height:100%;}
.maindiv{background:transparent;border:none;height:100%;min-height:515px;}
#leftdiv{width:660px;height:100%;display:block;float:left;border:1px solid #D0D0D0;border-left:none;margin-left:-3px;padding-left:5px;margin-top:15px;background:#FFFFFF}
#rightdiv{width:300px;display:block;float:left;margin:15px 0 0 15px;height:99%;position:relative;}
#righttopdiv{height:45%;width:295px;border:1px solid #D0D0D0;background:#F6F6F6;/*overflow:scroll;*/}
#rightbottomdiv{height:45%;width:295px;border:1px solid #D0D0D0;margin:0;position:absolute;bottom:0px;background:#F6F6F6;/*overflow:scroll;*/}

.calldiv{width:650px;height:89px;margin: 20px 0 0 10px;}
.dialdiv{width:440px;height:89px;margin:0;float:left;}
.dialdiv input{border-radius:0;border:2px solid #a5a8a6;border-right:none;width:400px;background:transparent;height:14px;line-height:40px;padding:0 0 0 9px;color:#222;font-size:18px;margin:0;*height:44px !important;*line-height:44px !important;}
.dialdiv .bjinput{width:423px;height:38px;display:block;float:left;border:1px solid #a5a8a6;border-radius:4px;font-size:16px;color:#999;}
.dialdiv .bjinput.inputHover, .dialdiv .bjinput.inputActive{border: 1px solid #4abe6b;}
#dialnow{border-radius:4px;border:0;float:left;background:url("../img/call/call.png") center center no-repeat #4ABE6B;width:187px;height:53px;padding:0;margin:0;outline:0;min-width:0px;}
#dialnow.buttonover{border-color:#4ABE6B;background-color:#32A954;}
.calldiv .newListSelected{width:89px;height:25px;color:#222;padding:0;background:url("../img/call/meeting_control_triangle.png") 0 0 no-repeat #EAEAEA;margin:0 0 0 5px;outline:0;border:1px solid #A6A6A6;background-position:70px center;font-size:14px;text-align:center;border-radius:4px;}
.calldiv .selectedTxtDiv{width:85px !important;}
.calldiv .newListSelected:focus, .calldiv .newListSelHover{cursor:pointer;background-color:#DEDFE0;}
.calldiv .newListSelected .selectedTxt{width:75px !important;height:25px;line-height:25px;padding:0;margin-left:-5px;}
.calldiv .newListSelected ul.newList{width:87px;height:52px !important;border:1px solid #d9d9d9;color:#999;padding:0;border-bottom:0;*height:79px !important;}
#dialvideodiv ul.newList{height:52px !important;*height:53px !important;}
.calldiv .newListSelected ul.newList.disipcall{height:26px !important;*height:27px !important;}
.calldiv .newListSelected ul.newList li{padding:0 0 0 13px;height:25px;line-height:25px;float:none;margin:0;text-align:left;border:0;border-bottom:1px solid #d9d9d9;*width:auto;}
.calldiv .newListSelected ul.newList li a{padding:0;float:none;margin:0;text-align:left;}
.calldiv .newListSelected ul.newList li:first-child{border-bottom:1px solid #d9d9d9;}
.calldiv .newListSelected ul.newList li:hover{background:#E9EBED;}
.calldiv .newListSelected ul.newList li a.newListHover{background:transparent !important;cursor:pointer;}

.dialvideodivoem .newListSelected{width:187px;background-position:115px center;}
.dialvideodivoem .newListSelected .selectedTxt{width:173px !important;}
.dialvideodivoem .newListSelected ul.newList{width:187px;}
.dialvideodivoem .newListSelected ul.newList li{padding:0 0 0 73px}

.itemsdiv{width: 650px;margin:15px 0 0 10px;height:85%;overflow-x:hidden;overflow-y:auto;}

.itemdiv{width:636px;height:42px;line-height:42px;background:transparent;color:#222;font-size:14px;border-bottom:1px solid #E1E1E1;}
.itemdiv:hover{background:#DFDFDF;}
.itemdiv div{display:block;float:left;}
.memberitemdiv{background:#EEEEEE;display:none;}
.itemarrow{width:7px;height:11px;margin:0 0 0 13px;}
.rightarrowicon{width:5px;height:11px;background:transparent url(../img/apps/app_more_triangle_normal.png) center center no-repeat;border:none;margin-top: 11px;}
.downarrowicon{width:7px;height:8px;background:transparent url(../img/apps/app_more_triangle_pressed.png) center center no-repeat;border:none;margin-top: 10px;}
.itemicon{width:14px;height:36px;margin:0 0 0 13px;}
.itemicon img{vertical-align:middle;margin:10px 0 0 0;}
.itemname{width:412px;text-align:left;margin:0 0 0 15px;overflow:hidden;white-space:nowrap;text-overflow: ellipsis;}
.itemnametopchild, .itemnamebotchild{display:block;float:left;width:100%;text-overflow: ellipsis;white-space:nowrap;overflow:hidden;}
.itemnametopchild{height:16px;margin-top:12px;line-height:16px;font-size:14px;text-align:bottom;}
.itemdiv .itemnamebotchild{height:10px;line-height:10px;font-size:12px;display:none;}
.namedividerdiv{display:block;float:left;width:340px;}
.itemduration{width:90px;text-align:right;margin:0 0 0 6px;}
.itemtime{width:137px;margin:0 0 0 36px;overflow:hidden;text-align:right;color:#999;}
.itemmembericon{margin-right:8px;}

#divcallbtn{width:132px;height:30px;padding-top:6px;margin-left:40px;text-align:right;display:none;}
#itemcallbtn{height:30px;width:30px;min-width:0px;z-index:2;background:url(../img/apps/call_status_icons.png) -60px 0px no-repeat;border:none;margin:0 0 0 15px;padding:0;outline:0;}
#itemcallbtn.buttonover{background:url("../img/apps/call_status_icons.png") -90px 0px no-repeat;}
#itemaddbtn{height:30px;width:30px;min-width:0px;z-index:2;background:url(../img/apps/call_status_icons.png) 0px 0px no-repeat;border:none;margin:0;padding:0;outline:0;}
#itemaddbtn.buttonover{background:url("../img/apps/call_status_icons.png") -30px 0px no-repeat;}

#a_accttitle, #a_callstatus{height:38px;line-height:38px;padding:0 0 0 24px;color:#fff;background:#545B60;font-size:16px;font-weight: bold;margin-bottom:10px;}
.accountstate{width:295px;height:42px;line-height:42px;margin:0;color:#222;font-size:14px;background:#F6F6F6;border-bottom:1px solid #E1E1E1;}
.activeuse{background:#FFFFFF url("../img/call/account_selected.png") no-repeat left;font-weight:bold;}
.activehover{background:#FFFFFF url("../img/call/account.png") no-repeat left;font-weight:bold;}
.activeonly{color:#222;}
.unactive{color:#999;}
.accountstate img{vertical-align:middle;margin:0 0 0 23px;}
.activeuse img{margin:0 0 0 21px;}
.acctreg{display:block;float:left;width:24px;height:24px;margin:9px 10px 0 10px;}
.acctname{display:block;float:left;width:142px;overflow:hidden;white-space:nowrap;text-align:left;text-overflow: ellipsis;}
.acctnum{display:block;float:left;margin:0 0 0 3px;text-align:left;overflow:hidden;width:93px;white-space:nowrap;text-overflow: ellipsis;}
.statuscont{color:#222;font-size:16px;width:272px;margin:10px 0 0 12px;line-height:30px;}
#calltime, #inconfname{color:#f35353;}
#a_confintime{margin-right:5px;}

.appcontacticon{width:20px;height:18px;background:url("../img/apps/call_status_icons.png") 0px -107px no-repeat;margin-top:11px;}
.appgroupicon{width:23px;height:16px;background:url("../img/apps/call_status_icons.png") -18px -93px no-repeat;}
.appincomingicon{width:18px;height:18px;margin-top:13px;background:url("../img/apps/call_status_icons.png") -18px -54px no-repeat;}
.appcallouticon{width:18px;height:18px;margin-top:13px;background:url("../img/apps/call_status_icons.png") -36px -54px no-repeat;}
.appmissedicon{width:18px;height:18px;margin-top:13px;background:url("../img/apps/call_status_icons.png") 0px -54px no-repeat;}
.appconficon{width:26px;height:18px;margin-top:11px;background:url("../img/apps/call_status_icons.png") 0px -72px no-repeat;}
.audioicon{width:13px;height:16px;margin-top:13px;background:url("../img/apps/call_status_icons.png") -13px -90px no-repeat;margin-left:1px;}
.videoicon{width:13px;height:16px;margin-top:13px;background:url("../img/apps/call_status_icons.png") 0px -90px no-repeat;}

.unreg{background:url("../img/apps/call_status_icons.png") -72px -30px no-repeat;}
.unregtext{color:#C8C8C8;}
.reg_0{background:url("../img/apps/call_status_icons.png") 0 -30px no-repeat;}
.reg_1{background:url("../img/apps/call_status_icons.png") -24px -30px no-repeat;}
.reg_2{background:url("../img/apps/call_status_icons.png") -48px -30px no-repeat;}
.reg_8{background:url("../img/apps/call_status_icons.png") -144px -30px no-repeat;}

/*** Manifest ***/
/* Manifest container that wraps the elements and now acts as, and should be styled as, the input. */
div.mf_container {border: 1px solid #A5A8A6;border-radius:4px;cursor: text;display: inline-block; height: 89px;width: 432px;overflow:auto;}

/* Ordered list for displaying selected items. */
div.mf_container ol.mf_list {display: inline;list-style: none;margin-left:-40px;}

/* Selected item, regardless of state (highlighted, selected). */
div.mf_container ol.mf_list li.mf_item {background:#E4E5E5;cursor: pointer;display: inline-block;margin: 6px 0 0 6px;height:18px;border-radius:20px;padding:2px 6px;color:#fff;*float:left;}
div.mf_container ol.mf_list li.mf_item_0 {background:#AEE0FE;}
div.mf_container ol.mf_list li.mf_item_0_unreg {background:#B4B3B3;}
div.mf_container ol.mf_list li.mf_item_1 {background:#69B2FE;}
div.mf_container ol.mf_list li.mf_item_2 {background:#0A65DF;}
div.mf_container ol.mf_list li.mf_item_8 {background:#014298;}
div.mf_container ol.mf_list li.mfred_item{color: red;}
/* Selected item that's highlighted by mouseover. */
div.mf_container ol.mf_list li.mf_item.mf_highlighted {background-color: #C5C6C6;}
div.mf_container ol.mf_list li.mf_item.mf_selected { background-color:#1D6EA8; color: #FFFFFF; }
div.mf_container ol.mf_list li.mf_item_0.mf_highlighted, div.mf_container ol.mf_list li.mf_item_0.mf_selected {background-color: #88C1E5;}
div.mf_container ol.mf_list li.mf_item_0_unreg.mf_highlighted, div.mf_container ol.mf_list li.mf_item_0_unreg.mf_selected {background:#B4B3B3;}
div.mf_container ol.mf_list li.mf_item_1.mf_highlighted, div.mf_container ol.mf_list li.mf_item_1.mf_selected {background-color: #4F94DC;}
div.mf_container ol.mf_list li.mf_item_2.mf_highlighted, div.mf_container ol.mf_list li.mf_item_2.mf_selected {background-color: #0553BC;}
div.mf_container ol.mf_list li.mf_item_8.mf_highlighted, div.mf_container ol.mf_list li.mf_item_8.mf_selected {background-color: #003375;}

/* Selected item that's selected by click or keyboard. */

/* Remove link. */
div.mf_container ol.mf_list li.mf_item a.mf_remove {color: #FFFFFF;margin-left: 10px;text-decoration: none; }

/* Remove link that's highlighted. */
div.mf_container ol.mf_list li.mf_item.mf_highlighted a.mf_remove { color: #E32834; }

/* Remove link that's selected. */
div.mf_container ol.mf_list li.mf_item.mf_selected a.mf_remove { color: #E32834; }

/* Actual input, styled to be invisible within the container. */
div.mf_container input.mf_input {border: 0;font: inherit;font-size: 100%;margin: 2px;outline: none;padding: 4px;}

/*** Marco Polo ***/

/* Ordered list for display results. */
ol.mp_list {background-color: #FFFFFF;border-left: 1px solid #C0C0C0;border-right: 1px solid #C0C0C0;overflow: hidden;position: absolute;width: 498px;z-index: 99999;}

/* Each list item, regardless of success, error, etc. */
ol.mp_list li { border-bottom: 1px solid #C0C0C0;padding: 4px 4px 5px 9px; }

/* Each list item from a successful request. */
ol.mp_list li.mp_item {}

/* Each list item that's selectable. */
ol.mp_list li.mp_selectable {cursor: pointer;}

/* Currently highlighted list item. */
ol.mp_list li.mp_highlighted { background-color: #E0E0E0;}

/* When a request is made that returns zero results. */
ol.mp_list li.mp_no_results {}

/* When a request is made that doesn't meet the 'minChars' length option. */
ol.mp_list li.mp_min_chars {}

/* When a request is made that fails during the ajax request. */
ol.mp_list li.mp_error {}

/*select members when number of conf member more than 8*/
#selectcalldiv{width:400px;height:auto;position:absolute;top:40%;margin-top:-180px;left:50%;margin-left:-200px;z-index:1000;background:#F6F7F7;color:#FFF;font-size:16px;box-shadow:0px 0px 10px 2px #919191;display:none;}
.selecttitle{width:auto;height:35px;line-height:35px;background:#1D6EA8;padding-left:15px;}
.selecttitle span{float: left;}
#selectlist{color:#222;height:340px;overflow-y:auto;}
.selectbtn{text-align:center;height:50px;position:relative;*z-index:-1;}
.selectbtn button{margin:8px 0 0 15px;}
#selectcalldiv #closecalldiv{width:24px;height:24px;min-width:0px;border:0;background:url("../img/call/close_incomingcall.png") center center transparent no-repeat;border-radius:0px;float:right;margin:5px 5px 0 0;}
#selectcalldiv #closecalldiv.buttonover{background-color:#E32632;}
#selectcall{width:100px;height:30px;background:#4ABE6B;position:relative;}
#selectcall.buttonover{background-color:#32A553;}
#selectcancel{width:100px;height:30px;position:relative;margin-left:48px;}
#selectlist div{width:330px;margin-left:45px;height:30px;margin-top:7px;}
#selectlist div span{width:130px;margin-left:15px;display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.selecttips{color:red;width:100%;height:20px;text-align: center;}
.selectItem{background:#EEEEEE;}
</style>
<!--[if IE 9]>
<style>
.dialdiv input{height:44px;line-height:44px;}
</style>
<![endif]-->
<body id="framebody" class="maintenancebody">
<div id="mainbody" class="maindiv">
    <div class="navi"><span id="a_patetitle">Call</span></div>
    <div id="statusdiv" style="display:none;"></div>
	<div id="rightdiv">
        <div id="righttopdiv">
            <div id="a_accttitle">Account Select</div>
            <div id="acctsepline" style="height:1px;border-bottom:1px solid #d0d0d0;"></div>
            <div id="acct1state" class="accountstate" acctindex="0">
                <div class="acctreg" id="acct1reg"></div>
                <div class="acctname" id="acct1name"></div>
                <div class="acctnum" id="acct1num"></div>
            </div>
            <div id="acct2state" class="accountstate" acctindex="1">
                <div class="acctreg" id="acct2reg"></div>
                <div class="acctname" id="acct2name"></div>
                <div class="acctnum" id="acct2num"></div>
            </div>
            <div id="acct3state" class="accountstate" acctindex="2">
                <div class="acctreg" id="acct3reg"></div>
                <div class="acctname" id="acct3name"></div>
                <div class="acctnum" id="acct3num"></div>
            </div>
            <div id="acct4state" class="accountstate" acctindex="3">
                <div class="acctreg" id="acct4reg"></div>
                <div class="acctname" id="acct4name"></div>
                <div class="acctnum" id="acct4num"></div>
            </div>
            <div id="acct5state" class="accountstate" acctindex="4">
                <div class="acctreg" id="acct5reg"></div>
                <div class="acctname" id="acct5name"></div>
                <div class="acctnum" id="acct5num"></div>
            </div>
            <div id="acct6state" class="accountstate" acctindex="5">
                <div class="acctreg" id="acct6reg"></div>
                <div class="acctname" id="acct6name"></div>
                <div class="acctnum" id="acct6num"></div>
            </div>
            <div id="acct9state" class="accountstate" acctindex="8">
                <div class="acctreg" id="acct9reg"></div>
                <div class="acctname" id="acct9name"></div>
                <div class="acctnum" id="acct9num"></div>
            </div>
            <button id="setdftacct" style="position:absolute;margin:0;float:right;right:9px;white-space:nowrap;height:23px;line-height:12px;border-radius:11px;font-size:12px;margin-top:9px;display:none;">Set as Default</button>
            <span id="dftacct" style="display:none;font-weight:normal;color:#5089ba;">Default Account</span>
            <div id="noacctstate" style="width: 270px; height: 36px;display:none;">
                <span id="a_noacctstate" style="line-height: 36px;margin-left:20px;font-size:16px;"></span>
            </div>
        </div>
        <div id="rightbottomdiv">
            <div id="a_callstatus">Reservation Status</div>
            <div class="statuscont">
                <div id="hasconfdiv" style="display:none;"><span id="a_schedule"></span><span id="inconfname" style="word-wrap:break-word;"></span><span id="a_confintime"></span><span id="calltime"></span><span id="a_confintime2"></span></div>
                <div id="noconfdiv" style="display:none;line-height: 24px;word-break: break-all;"><span id="a_noconf"></span></div>
            </div>
        </div>
    </div>
    <div id="leftdiv">
        <div class="calldiv">
            <div class="dialdiv" id="sipcalldiv">
                <input id="dialnum" name="dialnum" style="display:none;" /> 
                <div id="membernumdiv" style="position:relative;top:-22px;left:395px;font-size:16px;color:#444;width:30px;">
                    <span id="membernum">0</span>/<span id="membermaxnum">8</span>
                </div>
                <div style="position:relative;top:-102px;left:10px;font-size:14px;color:#444;width:420px;color:#999;" id="numbertipdiv" onclick="$('#dialnum').focus();">
                    <span id="numbertip">Multiply numbers can seperate with ",".</span>
                </div>
            </div>
            <div class="dialdiv" id="bluejeansdiv" style="display:none;">
                <input id="bjnumber" name="bjnumber" class="bjinput" /> 
                <input id="bjpassword" name="bjpassword" class="bjinput" style="margin-top:11px;" /> 
            </div>
            <div style="display:block;float:left;width:200px;margin-left:10px;">
                <div style="width:187px;height:53px;"><button id="dialnow" type="button"></button></div>
                <div style="margin-top:5px;margin-left:-5px;">
                    <div style="display:block;float:left;" id="dialtypediv">
                        <select id="dialtype" name="dialtype">
                            <option value="0">Call</option>
                            <!--<option value="1">Paging</option>-->
                            <option value="2">IP Call</option>
                        </select> 
                    </div>
                    <div style="display:block;float:left;" id="dialvideodiv">
                        <select id="dialvideo" name="dialvideo">
                            <option value="1">Video</option>
                            <option value="0">Audio</option>
                        </select> 
                    </div>
                </div>  
            </div>
        </div>
        <div webtip="" id="itemsdiv" class="itemsdiv">
            <div id="divcallbtn"><button id="itemaddbtn"></button><button id="itemcallbtn"></button></div>
            <div id="shadowdiv" style="width:636px;height:1px;background:transparent url(../img/call/member_shadow.png);display:none;"></div>
        </div>        
    </div>
    <div id="selectcalldiv">
        <div class="selecttitle"><span></span><button id="closecalldiv"></button></div>
        <div class="selecttips"></div>
        <div id="selectlist">

        </div>
        <div class="selectbtn">
            <button id="selectcall">Call</button><button id="selectcancel" class="cancelbtn">Cancel</button>
        </div>
    </div>
</div>
<script type="text/javascript">
	var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
	}
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");

</script>
<script type="text/javascript" src='../js/apps.js'></script>
<script type="text/javascript">
var selacct = -1;
var selectid;
var itemnum = 0;
var mDateObj = new Date();
var mItemsdivObj;
var mUse24Hour = 1;
var mSearchTimer = 0;
var mOpenItemId = "";
var mInputNum = 0;
var mNeedRemove = 0;    //to tell if just for search or add manual when input
var mClickAdd = 0;
var mMaxlineNum = 0;
var mDftAcct = "-1";
var mNewDftAcct = "-1";
var mSipReg = 0;
var mHasIPVNumber = 0;
var mDisableIPVT = 0;
var mEnableIPVT = 0;
var mMaxNumber = 1;
var mCalling = false;
var mOEMID = '0';
var mPromodel = "GVC3200";
var mAcctStatus = new Array();

$(function(){
    mPromodel = $("#promodel", window.parent.document).val();
    mMaxNumber = $("#maxlinenum", window.parent.document).val();
    $("#membermaxnum").text(mMaxNumber);
    if( mPromodel == "GVC3202" ){
        mMaxNumber = 2;
        $("#membermaxnum").text("2");
    }
    mOEMID = $('#existcolore', window.parent.document).val();
    translate_page();
    var disipcall = $("#disipcall",window.parent.document).val();
    var dialtype = $("#dialtype", window.parent.document).val();
    if(disipcall == "1")
    {
        $("#dialtype option:eq(1)").remove();
        if( dialtype == '2' )
            dialtype = '0';
    }
    if( dialtype == "" )
        dialtype = '0';
    $("#dialvideo").sSelect({ddMaxHeight: '54px'});
    $("#dialtype").sSelect({ddMaxHeight: '27px'});
    $("#dialtype").getSetSSValue(dialtype);
    if(window.parent.mAutovideo == "0")
        $("#dialvideo").getSetSSValue("0");
    else
        $("#dialvideo").getSetSSValue("1");
    if(disipcall == "1")
        $(".calldiv .newListSelected ul.newList").addClass("disipcall");
    var mainheight = $("#mainbody").height();
    var leftheight = mainheight - 17;
    var rightheight = leftheight;
    $("#leftdiv").css("height",leftheight+"px");
    $("#rightdiv").css("height",(leftheight+2)+"px");   //no border
    if( mOEMID == '54' ){
        $("#righttopdiv").css("height",rightheight+"px");
        $("#numbertipdiv").css("top","-86px");
        $("#dialtypediv, #rightbottomdiv, #itemaddbtn, #membernumdiv").hide();
        $("#dialvideodiv").addClass("dialvideodivoem");
        $("#dialtype").getSetSSValue('0');
        mMaxNumber = 1;
    }else{
        $("#righttopdiv").css("height",(rightheight/2)+"px");
        $("#rightbottomdiv").css("height",(rightheight/2)+"px");
    }
    mItemsdivObj = document.getElementById('itemsdiv');
    //$('#itemsdiv').perfectScrollbar({suppressScrollX: true});
    //mMaxlineNum = mMaxNumber - parseInt($("#busylinenum",window.parent.document).val());
    try{
        if( window.top.confFrame.isIPVConf() ){
            mHasIPVNumber = 1;
        }
    }catch(e)
    {
    }
    //$("#membermaxnum").text(mMaxlineNum);
    updateMaxlineNumber(parseInt($("#busylinenum",window.parent.document).val()), mHasIPVNumber);
    
    window.parent.block_download_func(a_6660);
    cb_get_action('get&var-0000=22046');
    //get_conflog();
    if( mOEMID == '54' ){
        get_normal_calllog(0, 0);
    }else{
        get_left_calllog(0);
        get_schedulecall();
    }
    var height = parseInt(parseInt($("#callframediv",parent.document.body).css('height')) * 0.99);
    $("#itemsdiv").css("height", height - 155);
    pageEventActions();
});

function updateMaxlineNumber(line, hasIPV){
    //console.log('line = ' + line + ',hasIPV = ' + hasIPV + ',real ipv = ' + $("#hasipvt", window.parent.document).val() + ',busylinenum = ' + $("#busylinenum", window.parent.document).val() );
    if( hasIPV ){
        mMaxlineNum = mMaxNumber - parseInt(line);
        if( mPromodel == "GVC3202" && mMaxlineNum < 2 && $("#hasipvt", window.parent.document).val() == "1" ){
            mMaxlineNum ++;
        }
        mHasIPVNumber = 1;
    }else if(mHasIPVNumber == 1){
        if( mPromodel == "GVC3202" ){
            mMaxlineNum = mMaxNumber - parseInt(line);
        }else{
            mMaxlineNum = mMaxNumber - 1 - parseInt(line);
        }
    }else{
        mMaxlineNum = mMaxNumber - parseInt(line);
    }
    if( mMaxlineNum < 0 )
        mMaxlineNum = 0;
    if( hasIPV == 2 ){
        mDisableIPVT = 1;
        $("#acct2state").hide();
        if( $("#acct2state").hasClass("activeuse") ){
            $(".accountstate:visible").eq(0).click();    
        }
    }else if( mEnableIPVT == 1 ){
        mDisableIPVT = 0;
        $("#acct2state").show();
    }
    $("#membermaxnum").text(mMaxlineNum);
}
function add_item_event(){
    if( $(".itemdiv").length > 0 ) 
        selectid = $(".itemdiv").eq(0).attr("id");;  

    $(".itemdiv").unbind(); //to avoid too many click callback by one click
    $(".itemdiv").hover(function(){
        $(this).css("background", "#DFDFDF").siblings(".itemdiv").css("background", "transparent");
        if( $(this).hasClass("memberitemdiv") )
            $(this).siblings(".memberitemdiv").css("background", "#EEEEEE");
        else
            $(".memberitemdiv").css("background", "#EEEEEE");
        if( !$(this).hasClass("selectItem") )
            $(".selectItem").css("background", "#EEEEEE");
        selectid = $(this).attr("id");
        /*var top = parseInt(selectid.substring(8)) * 41 + 32;    //41=36+5
        $("#itemcallbtn").css("top", top).show();*/
        $(this).children(".itemtime").hide();
        $("#divcallbtn").appendTo($(this)).show();
        if( $(this).attr("isconf") != "1" ){
            if( $(this).attr("confmember") == "1" )
                $(this).children(".itemname").children(".namedividerdiv").children(".itemnamebotchild").show();
            else
                $(this).children(".itemname").children(".itemnamebotchild").show();
        }
    },function(){
        if( $(this).hasClass("memberitemdiv") || $(this).hasClass("selectItem") )
            $(this).css("background", "#EEEEEE");
        else
            $(this).css("background", "transparent");
        selectid = $(this).attr("id");
        /*var top = parseInt(selectid.substring(8)) * 41 + 32;    //41=36+5
        $("#itemcallbtn").css("top", top).show();*/
        $(this).children(".itemtime").show();
        $("#divcallbtn").hide();
        if( $(this).attr("isconf") != "1" ){
            if( $(this).attr("confmember") == "1" )
                $(this).children(".itemname").children(".namedividerdiv").children(".itemnamebotchild").hide();
            else
                $(this).children(".itemname").children(".itemnamebotchild").hide();
        }
    });
    
    $(".itemname").unbind();
    $(".itemname").click(function(){
        if( $(this).parent(".itemdiv").attr("isconf") == "1" ){
            $(this).parent(".itemdiv").addClass("selectItem").siblings(".itemdiv").removeClass("selectItem");
            var confname = $(this).parent(".itemdiv").attr("name");
            var afterid = $(this).parent(".itemdiv").attr("id");
            var isopen = $(this).attr("isopen");
            if( mOpenItemId != "" && mOpenItemId != afterid ){
                $("#"+mOpenItemId).children(".itemname").attr("isopen", "0");
            }
            mOpenItemId = afterid;
            if( isopen != "1" ){
                $(".memberitemdiv").remove();
                var numbers = $(this).parent(".itemdiv").attr("number").split(":::");
                var names = $(this).parent(".itemdiv").attr("mnames").split(":::");
                var accts = $(this).parent(".itemdiv").attr("account").split(":::");
                var dates = $(this).parent(".itemdiv").attr("mdates").split(":::");
                var isvideos = $(this).parent(".itemdiv").attr("misvideo").split(":::");
                var types = $(this).parent(".itemdiv").attr("mtype").split(":::");
                for( var i = 0; i < types.length; i++ ){
                    create_conf_member_div(names[i], numbers[i], accts[i], dates[i], types[i], isvideos[i]);
                }
                add_item_event();
                $("#shadowdiv").addClass("memberitemdiv");
                $("#"+mOpenItemId).after( $(".memberitemdiv") );
                $(".memberitemdiv").show();
                $("#shadowdiv").removeClass("memberitemdiv");
                $(this).attr("isopen", "1");
            }else{
                $(".memberitemdiv").remove();
                $("#shadowdiv").hide();
                $(this).attr("isopen", "0");
            } 
        }   
    });

    window.parent.unblock_func();       
}

function add_selectlist_event()
{
    $("#selectlist input").click(function(){
        var num_member = 0;
        if($(this).prop("checked") == true)
        {
            if( mDisableIPVT && $(this).parent("div").attr("account") == "1" ){
                $(".selecttips").text(a_15051);
                setTimeout(function(){$(".selecttips").text("");},4000);
                return false;
            } 
            $("#selectlist input").each(function(){
                if($(this).prop("checked") == true)
                {
                    num_member++;
                }
            });

            if(num_member > mMaxlineNum)
            {
                $(".selecttips").text(a_10097);
                setTimeout(function(){
                    $(".selecttips").text("");
                },2000);
                return false;
            }
        }
    });
}

function cb_get_action_done(data, action) {
    if( data.substring(0, 1) == "{" )
    {
        data = data.replace(/\r/g, "\\r").replace(/\n/g, "\\n");
        if( action.indexOf("sqlitecontacts" ) != "-1" ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if(action.indexOf("type=leftcalllogall") != "-1")
            {
                mUse24Hour = tObj.Use24Hour;
                parse_all_log(items);
                get_all_conf_member();
            }
            else if( action.indexOf("type=calllog&flag=0") != "-1"){
                mUse24Hour = tObj.Use24Hour;
                parse_all_log(items);
                mInit = 1;
                add_item_event();
            }
            else if( action.indexOf("type=confmember") != "-1" )
            {
                parse_conf_members(items);
                get_normal_calllog_names();
            }
            else if( action.indexOf("type=leftcalllogname") != "-1" ){
                parse_calllog_name(items);
                get_contact();
            }
            else if( action.indexOf("type=contacts") != "-1" ){
                parse_contacts(items);
                mInit = 1;
                add_item_event(); 
            }
        }else if( action.indexOf("sqliteconf" ) != "-1" ){
            var tObj = eval("(" + data + ")");
            var items = tObj.Data;
            if( action.indexOf("type=preconf") != "-1" ){
                var confid, confname;
                for (var i = 0; items[i] != undefined; i++)
                { 
                    confid = items[i].Id;
                    confname = items[i].Confname;
                    if($(".itemdiv[name=\"" + confname + "\"]").length > 0){
                        $(".itemdiv[name=\"" + confname + "\"]").attr("confid", confid); 
                    }  
                }
                get_normal_calllog(3, 0);	
            }
            else if( action.indexOf("type=schedulecall") != "-1" ){
                var curtime, starttime, schedulename;
                var hasconf = 0;
                for (var i = 0; items[i] != undefined; i++)
                {
                    curtime = items[i].Curtime;
                    schedulename = items[i].ScheduleName;
                    
                    
                    var curdate = new Date();
                    var curdateint = (curdate.getTime()) / 1000;    //seconds
                    starttime = items[i].Starttime;
                    //starttime = starttime.replace(/-/g, "/");
                    //var date = new Date(starttime);
                    //var dateint = (date.getTime()) / 1000;    //seconds
                    var dateint = parseInt(starttime) / 1000;    //seconds
                    if( dateint > curdateint ){
                        $("#calltime").text( convert_time(dateint - curdateint) );
                        var sch = schedulename.replace(/</g, "&lt;");
                        $("#inconfname").text(sch);
                        $("#hasconfdiv").show();
                        $("#noconfdiv").hide();
                        hasconf = 1;
                        break;
                    }
                }
                if( !hasconf ){
                    $("#hasconfdiv").hide();
                    $("#noconfdiv").show();
                }
            }
        }else if(action.indexOf("setdefaultacct") != -1){
            mDftAcct = mNewDftAcct;
            var id = "acct" + (parseInt(mDftAcct)+1) + "state";
            $("#acctsepline").after( $("#" + id) );
            $(".acctnum").show();
            $("#setdftacct").hide();
            setTimeout("mNewDftAcct = '-1';", 1000);
        }
        return;
    }
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    if (cb_is_fail(msgs)){
    }else {
        if(action == "status&region=status"){
            cb_get_status_done(msgs);
        }
        else if(action == "get&var-0000=22046"){
            if( msgs.headers["22046"] != undefined && msgs.headers["22046"] != "" )
                mDftAcct = msgs.headers["22046"];
            cb_get_action('status&region=status');
        }/*else if( action.indexOf("put&var-0000=22046") != -1 ){
            mDftAcct = mNewDftAcct;
            var id = "acct" + (parseInt(mDftAcct)+1) + "state";
            $("#acctsepline").after( $("#" + id) );
            $(".acctnum").show();
            $("#setdftacct").hide();
            setTimeout("mNewDftAcct = '-1';", 1000);
        }*/
    }
}
function convert_time(interval)
{
    var timestr = "";
    var day = Math.floor(interval/(24*3600));
    if( day > 0 ){
        timestr += day;
        timestr += " "; 
        if( day > 1 )
            timestr += a_106;
        else
            timestr += a_105;
        timestr += " ";            
    }
    
    var leave1 = interval%(24*3600);
    var hour = Math.floor(leave1/(3600));
    if( hour > 0 ){
        timestr += hour;
        timestr += " "; 
        if( hour > 1 )
            timestr += a_108;
        else
            timestr += a_107;
        timestr += " ";            
    }
    
    var leave2=leave1%(3600);
    var minute = Math.floor(leave2/(60));
    if( minute > 0 ){
        timestr += minute;
        timestr += " "; 
        if( minute > 1 )
            timestr += a_110;
        else
            timestr += a_109;           
    }
    if( timestr == "" ){
        var seconds = parseInt(leave2%(60));
        timestr += seconds;
        timestr += " "; 
        if( seconds > 1 )
            timestr += a_114;
        else
            timestr += a_113; 
    }
    return timestr; 
}
function parse_conf_members(items){
    var logid, confid, type, disname, contactname, number, duration, date, acctid, isconf, isvideo, iscontact, acctindex;
    var tmpnames, tmpnumbers, tmpduration, tmpdate, tmpiscontact, tmpdisname, checknumber;
    for (var i = 0; items[i] != undefined; i++)
    {
        confid = items[i].Id;
        if( $("#conflog_"+confid).length <= 0 )
            continue;
        //if( $("#conflog_"+confid).attr("justload") != "1" )
        //    continue;
        logid = items[i].LogId;
        disname = items[i].Name;
        number = items[i].Number;
        duration = parseInt(items[i].Duration);
        date = parseInt(items[i].Date);
        type = items[i].Type;
        isvideo = items[i].IsVideo;
        iscontact = items[i].IsContact;
        acctindex = items[i].Account;
        
        tmpnumbers = $("#conflog_"+confid).attr("number");
        checknumber = ":::" + tmpnumbers + ":::";
        if( checknumber.indexOf(":::"+number+":::") != -1 )
            continue;
        tmpdisname = $("#conflog_"+confid).attr("disname");
        tmpid = $("#conflog_"+confid).attr("mids");
        tmpnames = $("#conflog_"+confid).attr("mnames");
        tmpaccts = $("#conflog_"+confid).attr("account");
        //tmpduration = $("#conflog_"+confid).attr("mdurations");
        tmpdate = $("#conflog_"+confid).attr("mdates");
        tmptype = $("#conflog_"+confid).attr("mtype");
        tmpisvideo = $("#conflog_"+confid).attr("misvideo");
        tmpiscontact = $("#conflog_"+confid).attr("miscontact");
        if( tmpnumbers != "" ){
            tmpdisname += ",";
            tmpid += ":::";
            tmpnames += ":::";
            tmpnumbers += ":::";
            tmpaccts += ":::";
            //tmpduration += ":::";
            tmpdate += ":::";
            tmptype += ":::";
            tmpisvideo += ":::";
            tmpiscontact += ":::";
        }
        tmpdisname += disname;
        tmpid += logid;
        tmpnames += disname;
        tmpnumbers += number;
        //tmpduration += duration;
        tmpdate += date;
        tmptype += type;
        tmpisvideo += isvideo;
        tmpiscontact += iscontact;
        tmpaccts += acctindex;
        $("#conflog_"+confid).attr("mids", tmpid).attr("mnames", tmpnames).attr("number", tmpnumbers).attr("account", tmpaccts).attr("mdates", tmpdate).attr("mtype", tmptype).attr("misvideo", tmpisvideo).attr("miscontact", tmpiscontact);
        //if not schedule
        if( $("#conflog_"+confid).attr("isschedule") != "1" )
            $("#conflog_"+confid).attr("disname", tmpdisname).children(".itemname").children("span").text(tmpdisname);
        //create_conf_member_div(logid, type, isvideo, disname, number, 0, date, confid, iscontact);
        /*if( mInit == 0 )
            $("#memberlog_"+logid).show();
        $("#conflog_"+confid).attr("loaded", "1");*/
    }
    var isInCall = $("#busylinenum",window.parent.document).val();
    $(".itemdiv[isconf=1][justload=1]").each(function(){
        var membernumbers = $(this).attr("number");
        if( membernumbers == "" ){
            $(this).remove();
        }
        $(this).attr("justload", "0"); 
    });
}
function parse_calllog_name(items){
    var id, disname, iscontact;
    var groupsdiv = document.getElementById('addgroups');
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        if( $("#calllog_" + id).length > 0 )
        {
            disname = items[i].Name;
            iscontact = items[i].IsContact;
            $("#calllog_" + id).attr("iscontact", iscontact);
            if( disname != "" ){
                $("#calllog_" + id).attr("disname", disname).attr("name", disname).children(".itemname").children(".itemnametopchild").children("span").text(disname);
            }
        } 
    }
}

function create_single_conf_item(id, disname, duration, date, isschedule, show){
    var nameattr = disname.replace(/\"/g,"'");  //change " to '
    //if( $(".confitemdiv[name=\"" + nameattr + "\"]").length == 0 )
    if( $("#conflog_" + id ).length == 0 )
    {
        var itemdiv = document.createElement('DIV');
        itemdiv.className='itemdiv confitemdiv';
        itemdiv.id = "conflog_" + id;
        itemdiv.setAttribute("name", nameattr);
        if( isschedule == "1" )
            itemdiv.setAttribute("disname", nameattr); 
        else
            itemdiv.setAttribute("disname", "");    //will replace to member names
        itemdiv.setAttribute("isconf", "1");
        itemdiv.setAttribute("isschedule", isschedule);
        itemdiv.setAttribute("confid", id);
        itemdiv.setAttribute("justload", "1");
        itemdiv.setAttribute("loaded", "0");
        itemdiv.setAttribute("mloaded", "0");
        itemdiv.setAttribute("mids", "");
        itemdiv.setAttribute("mnames", "");
        itemdiv.setAttribute("account", "");
        itemdiv.setAttribute("number", "");
        //itemdiv.setAttribute("mdurations", "");
        itemdiv.setAttribute("mdates", "");
        itemdiv.setAttribute("misvideo", "");
        itemdiv.setAttribute("miscontact", "");
        itemdiv.setAttribute("mtype", "");
        if( show == 0 ){
            itemdiv.style.display = "none";
        }
        /*var arrowdiv = document.createElement('DIV');
        arrowdiv.className='itemarrow';
        arrowdiv.setAttribute("isopen", "0");
        var itemarrow = document.createElement('DIV');
        itemarrow.className='rightarrowicon';
        arrowdiv.appendChild(itemarrow);
        itemdiv.appendChild(arrowdiv);*/
        
        var icondiv = document.createElement('DIV');
        icondiv.className='itemicon';
        var itemicon = document.createElement('DIV');
        itemicon.className='appconficon';
        icondiv.appendChild(itemicon);
        itemdiv.appendChild(icondiv);
        
        var namediv = document.createElement('DIV');
        namediv.className='itemname';
        namediv.setAttribute("isopen", "0");
        var spantext = document.createElement('SPAN');
        spantext.innerHTML = htmlEncode(disname);
        namediv.appendChild(spantext);
        itemdiv.appendChild(namediv);	                                
        
        var datediv = document.createElement('DIV');
        datediv.className='itemtime';
        var datetext = document.createElement('SPAN');
        datetext.innerHTML = htmlEncode(convertTime(date));
        datediv.appendChild(datetext);
        itemdiv.appendChild(datediv);
        
        mItemsdivObj.appendChild(itemdiv);
    }
}
function create_calllog_div(id, type, isvideo, disname, number, acctindex, date, iscontact){
    if( $(".normalitemdiv[number=\"" + number + "\"]").length == 0 )
    //if( $("#calllog_" + id).length == 0 )
    {
        var itemdiv = document.createElement('DIV');
        itemdiv.className='itemdiv normalitemdiv';
        itemdiv.id = "calllog_" + id;
        itemdiv.setAttribute("name", disname);
        itemdiv.setAttribute("disname", disname);
        itemdiv.setAttribute("number", number);
        itemdiv.setAttribute("account", acctindex);
        itemdiv.setAttribute("confmember", "0");
        itemdiv.setAttribute("confid", "0");
        itemdiv.setAttribute("logid", id);
        itemdiv.setAttribute("iscontact", iscontact);
        itemdiv.setAttribute("loaded", "0");

        /*var arrowdiv = document.createElement('DIV');
        arrowdiv.className='itemarrow';
        arrowdiv.style.display = "none";
        itemdiv.appendChild(arrowdiv);*/
        
        var icondiv = document.createElement('DIV');
        icondiv.className='itemicon';
        var itemicon = document.createElement('DIV');
        if( type == "3" )
            itemicon.className='appmissedicon';
        else if( type == "1" )
            itemicon.className='appincomingicon';
        else  
            itemicon.className='appcallouticon';
        icondiv.appendChild(itemicon);
        itemdiv.appendChild(icondiv);

        var namediv = document.createElement('DIV');
        namediv.className='itemname';
        /*var videoicondiv = document.createElement('DIV');
        videoicondiv.className='itemmembericon';
        var videoicon = document.createElement('DIV');
        if( isvideo == "1" )
            videoicon.className='videoicon';
        else  
            videoicon.className='audioicon';
        videoicondiv.appendChild(videoicon);
        namediv.appendChild(videoicondiv);*/
        /*var spantext = document.createElement('SPAN');
        spantext.innerHTML = htmlEncode(disname);
        namediv.appendChild(spantext);*/
        var nametopdiv = document.createElement('DIV');
        nametopdiv.className='itemnametopchild';
        var spantext = document.createElement('SPAN');
        spantext.innerHTML = htmlEncode(disname);
        nametopdiv.appendChild(spantext);
        var namebotdiv = document.createElement('DIV');
        namebotdiv.className='itemnamebotchild';
        var spantext2 = document.createElement('SPAN');
        spantext2.innerHTML = htmlEncode(number);
        namebotdiv.appendChild(spantext2);
        namediv.appendChild(nametopdiv);
        namediv.appendChild(namebotdiv);    
        itemdiv.appendChild(namediv);

        var datediv = document.createElement('DIV');
        datediv.className='itemtime';
        //datediv.style.marginLeft = '43px';
        var datetext = document.createElement('SPAN');
        datetext.innerHTML = htmlEncode(convertTime(date));
        datediv.appendChild(datetext);
        itemdiv.appendChild(datediv);
	
        mItemsdivObj.appendChild(itemdiv);
    }
}

function parse_all_log(items){
    var id, confid, type, nameornumber, number, duration, date, acctid, isconf, isvideoorschedule, iscontact, acctindex;
    for (var i = 0; items[i] != undefined; i++)
    {
        id = items[i].Id;
        nameornumber = items[i].NameOrNumber;
        duration = parseInt(items[i].Duration);
        date = parseInt(items[i].Date);
        type = items[i].Type;
        isvideoorschedule = items[i].IsVideo;
        isconf = items[i].IsConf;
        acctindex = items[i].Account;
        
        if( isconf == "1" && mOEMID != "54" ){
            hasconf = 1;
            create_single_conf_item(id, nameornumber, duration, date, isvideoorschedule, 1);
        }else{
            hassingle = 1;
            if( mOEMID == "54" ){
                nameornumber = items[i].ContactName;
                if( nameornumber == undefined || nameornumber == "" )
                    nameornumber = items[i].Name;
                acctindex = items[i].AcctIndex;
                number = items[i].Number;
            }else{
                number = nameornumber;
            }
            create_calllog_div(id, type, isvideoorschedule, nameornumber, number, acctindex, date, "2");
        }
    }
}

function create_conf_member_div(membername, membernumber, acctid, date, type, isvideo){
    var memberitemdiv = document.createElement('DIV');
    memberitemdiv.className='itemdiv memberitemdiv';
    memberitemdiv.setAttribute("name", membername);
    memberitemdiv.setAttribute("disname", membername);
    memberitemdiv.setAttribute("number", membernumber);   //do not set number attr,or else will affect calllog
    memberitemdiv.setAttribute("account", acctid);
    memberitemdiv.setAttribute("confmember", "1");
    
    var membericondiv = document.createElement('DIV');
    membericondiv.className='itemicon';
    memberitemdiv.appendChild(membericondiv);
    
    var membernamediv = document.createElement('DIV');
    membernamediv.className='itemname';
    var memberrealicondiv = document.createElement('DIV');
    memberrealicondiv.className='itemmembericon';
    var membericon = document.createElement('DIV');
    if( type == "3" )
        membericon.className='appmissedicon';
    else if( type == "1" )
        membericon.className='appincomingicon';
    else  
        membericon.className='appcallouticon';
    memberrealicondiv.appendChild(membericon);
    membernamediv.appendChild(memberrealicondiv);
    var videoicondiv = document.createElement('DIV');
    videoicondiv.className='itemmembericon';
    var videoicon = document.createElement('DIV');
    if( isvideo == "1" )
        videoicon.className='videoicon';
    else  
        videoicon.className='audioicon';
    videoicondiv.appendChild(videoicon);
    membernamediv.appendChild(videoicondiv);
    /*var membernametext = document.createElement('SPAN');
    membernametext.innerHTML = htmlEncode(membername);
    membernametext.setAttribute("title", membername);
    membernamediv.appendChild(membernametext);*/
    var namedivdiv = document.createElement('DIV');
    namedivdiv.className='namedividerdiv';
    var nametopdiv = document.createElement('DIV');
    nametopdiv.className='itemnametopchild';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = htmlEncode(membername);
    nametopdiv.appendChild(spantext);
    var namebotdiv = document.createElement('DIV');
    namebotdiv.className='itemnamebotchild';
    var spantext2 = document.createElement('SPAN');
    spantext2.innerHTML = htmlEncode(membernumber);
    namebotdiv.appendChild(spantext2);
    namedivdiv.appendChild(nametopdiv);
    namedivdiv.appendChild(namebotdiv);
    membernamediv.appendChild(namedivdiv);  
    memberitemdiv.appendChild(membernamediv);
    
    /*var memberdurationdiv = document.createElement('DIV');
    memberdurationdiv.className='itemduration';
    var memberdurationtext = document.createElement('SPAN');
    memberdurationtext.innerHTML = htmlEncode(convertDuration(duration));
    memberdurationdiv.appendChild(memberdurationtext);
    memberitemdiv.appendChild(memberdurationdiv);*/
    
    var membernumberdiv = document.createElement('DIV');
    membernumberdiv.className='itemtime';
    var membernumbertext = document.createElement('SPAN');
    membernumbertext.innerHTML = htmlEncode(convertTime(date));
    membernumberdiv.appendChild(membernumbertext);
    memberitemdiv.appendChild(membernumberdiv);
    
    mItemsdivObj.appendChild(memberitemdiv);
}

function create_contact_div(rawid, disname, number, acctid, pinyin, pinyinfirst){
    var itemdiv = document.createElement('DIV');
    itemdiv.className='itemdiv contactitemdiv';
    itemdiv.setAttribute("number", number);
    itemdiv.setAttribute("name", disname);
    itemdiv.setAttribute("disname", disname);
    itemdiv.setAttribute("account", acctid);
    itemdiv.setAttribute("pinyin", pinyin.toLowerCase());
    itemdiv.setAttribute("pinyinfirst", pinyinfirst.toLowerCase());
    if( number != "" )
        itemdiv.id = "contact_" + rawid + new Date().getTime();
    else
        itemdiv.id = "contact_" + rawid;
        
    var icondiv = document.createElement('DIV');
    icondiv.className='itemicon';
    var itemicon = document.createElement('DIV');
    itemicon.className='appcontacticon';
    icondiv.appendChild(itemicon);
    itemdiv.appendChild(icondiv);
    
    var namediv = document.createElement('DIV');
    namediv.className='itemname';
    var spantext = document.createElement('SPAN');
    spantext.innerHTML = htmlEncode(disname);
    spantext.setAttribute("title", disname);
    namediv.appendChild(spantext);
    itemdiv.appendChild(namediv);
    
    /*var emptydiv = document.createElement('DIV');
    emptydiv.className='itemduration';
    var emptytext = document.createElement('SPAN');
    emptytext.innerHTML = "&nbsp;";
    emptydiv.appendChild(emptytext);
    itemdiv.appendChild(emptydiv);*/
    
    var numberdiv = document.createElement('DIV');
    numberdiv.className='itemtime';
    var numbertext = document.createElement('SPAN');
    if( number != "" )
        numbertext.innerHTML = htmlEncode(number);
    else
        numbertext.innerHTML = "&nbsp;";
    numberdiv.appendChild(numbertext);
    itemdiv.appendChild(numberdiv);
    
    if( number != "" )
        mItemsdivObj.insertBefore( itemdiv, document.getElementById('contact_' + rawid) );
    else
        mItemsdivObj.appendChild(itemdiv);
}
function parse_contacts(items)
{
    
    var rawid, disname, number, acctid, pinyin, pinyinfirst;
    for (var i = 0; items[i] != undefined; i++)
    {
        rawid = items[i].RawId;
        disname = items[i].Name;
        number = items[i].Number;
        acctid = items[i].AcctIndex;
        pinyin = items[i].Pinyin;
        pinyinfirst = items[i].PinyinFirst;
        
        if( number != "" )
            create_contact_div(rawid, disname, number, acctid, pinyin, pinyinfirst);
    }
}
function translate_page(){
    $("#a_patetitle").text(a_504);
    $("#a_accttitle").text(a_16637);//a_4812
    $("#a_callstatus").text(a_16649);
    $("#a_dial").text(a_1151);
    $("#a_noconf").text(a_16043);
    $("#a_confintime").text(" " + a_16044);
    $("#a_schedule").text(a_10011 + " ");
    $("#a_confintime2").text(" " + a_16045);
    $("#dialtype option:eq(1)").text(a_506);
    //$("#dialtype option:eq(1)").text(a_505);
    $("#dialtype option:eq(0)").text(a_504);
    $("#dialvideo option:eq(1)").text(a_10017);
    $("#dialvideo option:eq(0)").text(a_10016);
    $("#selectcancel").text(a_3);
    $("#setdftacct").text(a_16697);
    $("#dftacct").text(a_19113);
    $("#selectcall").text(a_504);
    if( mOEMID == "54" )
        $("#numbertip").text(a_4016);
    else
        $("#numbertip").text(a_16693);
}
function cb_get_status_done(msgs) {
    //if (msgs.headers['account_0_no'] != undefined && msgs.headers['account_0_no'].length > 1 && msgs.headers['account_0_activate'] == "1") {
    for(var i = 0; i < 7; i++){
        var acctstatus = {};
        acctstatus.activate = msgs.headers['account_' + i + '_activate'];
        acctstatus.status = msgs.headers['account_' + i + '_status'];
        mAcctStatus.push(acctstatus);
    }
    
    if (msgs.headers['account_0_activate'] == "1") {
        if( msgs.headers['account_0_name'].length > 0 )
            $("#acct1name").text( msgs.headers['account_0_name'] );
        else if( msgs.headers['account_0_no'].length > 0 )
            $("#acct1name").text( msgs.headers['account_0_no'] );
        else
            $("#acct1name").text( "SIP" );
        $("#acct1num").text( msgs.headers['account_0_no'] );
        var status = msgs.headers['account_0_status'];
        if( status == "0" ){
            status = msgs.headers['account_3_status'];
            if( status == "0" ){
                status = msgs.headers['account_4_status'];  
            }
        }
        
        //$("#acct1reg").css("background", view_status_img_to_text( 0, status ));
        $("#acct1reg").addClass( view_status_img_to_text( 0, status ) );
        $("#acct1state").show();
        if( selacct == -1 )
            selacct = 0;
    }else{
        $("#acct1state").hide();
    }
    
    if (msgs.headers['account_1_no'] != undefined && msgs.headers['account_1_no'].length > 1 && msgs.headers['account_1_activate'] == "1") {
        if( msgs.headers['account_1_name'].length > 0 )
            $("#acct2name").text( msgs.headers['account_1_name'] );
        else
            $("#acct2name").text( msgs.headers['account_1_no'] );
        $("#acct2num").text( msgs.headers['account_1_no'] );
        //$("#acct2reg").css("background", view_status_img_to_text( 1, msgs.headers['account_1_status'] ));
        $("#acct2reg").addClass( view_status_img_to_text( 1, msgs.headers['account_1_status'] ) );
        mDisableIPVT = 0;
        mEnableIPVT = 1;
        try{
            if( window.top.confFrame.getConfType() == "2" ){
                mDisableIPVT = 1;
            }
        }catch(e)
        {
        }
        if( mDisableIPVT ){
            $("#acct2state").hide();
        }else{
            $("#acct2state").show();
            if( selacct == -1 )
                selacct = 1;
            }
        
    }else{
        mEnableIPVT = 0;
        $("#acct2state").hide();
    }

    //if (msgs.headers['account_2_no'] != undefined && msgs.headers['account_2_no'].length > 1 && msgs.headers['account_2_activate'] == "1") {
    if( msgs.headers['account_2_activate'] == "1") {
        if( msgs.headers['account_2_name'].length > 0 )
            $("#acct3name").text( msgs.headers['account_2_name'] );
        else
            $("#acct3name").text( msgs.headers['account_2_no'] );
        $("#acct3num").text( msgs.headers['account_2_no'] );
        //$("#acct3reg").css("background", view_status_img_to_text( 2, "1" ));
        $("#acct3reg").addClass( view_status_img_to_text( 2, msgs.headers['account_2_status'] ) );
        $("#acct3state").show();
        if( selacct == -1 )
            selacct = 2;
    }else{
        $("#acct3state").hide();
    }

    if (msgs.headers['account_3_no'] != undefined && msgs.headers['account_3_no'].length > 1 && msgs.headers['account_3_activate'] == "1") {
        if( msgs.headers['account_3_name'].length > 0 )
            $("#acct4name").text( msgs.headers['account_3_name'] );
        else
            $("#acct4name").text( msgs.headers['account_3_no'] );
        $("#acct4num").text( msgs.headers['account_3_no'] );
        //$("#acct4reg").css("background", view_status_img_to_text( 3, msgs.headers['account_3_status'] ));
        $("#acct4reg").addClass( view_status_img_to_text( 3, msgs.headers['account_3_status'] ) );
        $("#acct4state").show();
        if( selacct == -1 )
            selacct = 3;
    }else{
        $("#acct4state").hide();
    }
    
    if (msgs.headers['account_4_no'] != undefined && msgs.headers['account_4_no'].length > 1 && msgs.headers['account_4_activate'] == "1") {
        if( msgs.headers['account_4_name'].length > 0 )
            $("#acct5name").text( msgs.headers['account_4_name'] );
        else
            $("#acct5name").text( msgs.headers['account_4_no'] );
        $("#acct5num").text( msgs.headers['account_4_no'] );
        //$("#acct5reg").css("background", view_status_img_to_text( 4, msgs.headers['account_4_status'] ));
        $("#acct5reg").addClass( view_status_img_to_text( 4, msgs.headers['account_4_status'] ) );
        $("#acct5state").show();
        if( selacct == -1 )
            selacct = 4;
    }else{
        $("#acct5state").hide();
    }

    if (msgs.headers['account_5_no'] != undefined && msgs.headers['account_5_no'].length > 1 && msgs.headers['account_5_activate'] == "1") {
        if( msgs.headers['account_5_name'].length > 0 )
            $("#acct6name").text( msgs.headers['account_5_name'] );
        else
            $("#acct6name").text( msgs.headers['account_5_no'] );
        $("#acct6num").text( msgs.headers['account_5_no'] );
        //$("#acct6reg").css("background", view_status_img_to_text( 5, msgs.headers['account_5_status'] ));
        $("#acct6reg").addClass( view_status_img_to_text( 5, msgs.headers['account_5_status'] ) );
        $("#acct6state").show();
        if( selacct == -1 )
            selacct = 5;
    }else{
        $("#acct6state").hide();
    }

    //if (msgs.headers['account_6_no'] != undefined && msgs.headers['account_6_no'].length > 1 && msgs.headers['account_6_activate'] == "1") {
    if (msgs.headers['account_6_activate'] == "1") {
        $("#acct9name").text( "H.323" );
        if( msgs.headers['account_6_no'].length > 0 )
            $("#acct9num").text( msgs.headers['account_6_no'] );
        else
            $("#acct9num").text( msgs.headers['account_6_name'] );
        //$("#acct9reg").css("background", view_status_img_to_text( 8, msgs.headers['account_6_status'] ));
        $("#acct9reg").addClass( view_status_img_to_text( 8, msgs.headers['account_6_status'] ) );
        $("#acct9state").show();
        if( selacct == -1 )
            selacct = 8;
    }else{
        $("#acct9state").hide();
    }
    
    if( mDftAcct == "-1" )
        mDftAcct = selacct;
    
    if( selacct == -1 ){
        $("#a_noacctstate").text(a_62);
        $("#noacctstate").show();
    }else{
        //$("#acct2state,#acct3state,#acct4state,#acct5state,#acct6state").hide();
        var id = "acct" + (parseInt(mDftAcct)+1) + "state";
        $(".accountstate").addClass("activeuse");
        //$("#" + id).css("borderColor","#4abe6b");
        $("#" + id).addClass("activeuse");
        $("#acctsepline").after( $("#" + id) );
        if( $("#" + id).is(":visible") ){
            $("#" + id).click();
        }else{
            $(".accountstate:visible").eq(0).click();
        }  
    }
}
function view_status_img_to_text(acct, code) {
    var classname = "";
    if( code == 0 ){
        classname = "unreg";
        var id = "acct" + (parseInt(acct)+1) + "name";
        $("#" + id).addClass("unregtext");
        id = "acct" + (parseInt(acct)+1) + "num";
        $("#" + id).addClass("unregtext");
    }else{   
        classname = "reg_" + acct;
    }
    if( acct == 0 )
        mSipReg = code;
    
    return classname;
    /*var imgsrc;
    
    switch (code){
        case "0":
            imgsrc = "url(../img/apps/call_status_icons.png) -72px -30px no-repeat";
            return imgsrc;
        case "1":
        case "2":
            imgsrc = "url(../img/apps/call_status_icons.png) -48px -54px no-repeat";
            return imgsrc;
        case "3":
        case "5":
            imgsrc = "url(../img/apps/call_status_icons.png) -48px -54px no-repeat";    //busy
            return imgsrc;
        case "4":
            imgsrc = "url(../img/apps/call_status_icons.png) -48px -54px no-repeat"; //ringing
            return imgsrc;
        case "6":
        default:
            imgsrc = "url(../img/apps/call_status_icons.png) -48px -54px no-repeat"; //talking
            return imgsrc;
    
    }*/
}
function on_search_key(){
    var searchkey = "";
    if( selacct == "2" ){
        if( $("#bjnumber").val() == a_15055 )
            searchkey = "";
        else
            searchkey = $("#bjnumber").val().toLowerCase();
    }else{
        searchkey = $("#dialnum").val().toLowerCase();
    }
    var numberattr, nameattr, pinyinattr, pinyinfirstattr;
    $(".itemdiv").each(function(){
        /*if( $(this).attr("isconf") == "1" ){
            numberattr = $(this).attr("confnumber");
        }else if( $(this).attr("confmember") == "1" ){
            numberattr = $(this).attr("membernumber");
        }else{
            numberattr = $(this).attr("number");
        }*/
        numberattr = $(this).attr("number");
        nameattr = $(this).attr("disname").toLowerCase();   //could not use name attr, as this will be conf name
        //pinyinattr = $(this).attr("pinyin");
        //pinyinfirstattr = $(this).attr("pinyinfirst");
        if( numberattr.indexOf(searchkey) != -1 || nameattr.indexOf(searchkey) != -1 )  // || (pinyinattr != undefined && pinyinattr.indexOf(searchkey) != -1) || (pinyinfirstattr != undefined && pinyinfirstattr.indexOf(searchkey) != -1)
        {
            $(this).show();
        }else{
            $(this).hide();
        }
    });
    if( searchkey == "" ){
        var confid = "";
        $(".itemdiv[isconf=1]").each(function(){
            if( $(this).children(".itemarrow").attr("isopen") == "0" ){
                confid = $(this).attr("confid");
                $(".memberitemdiv[confid="+confid+"]").hide();
            }
        });
    }
}
function update_input_num(){
    var values = $('#dialnum').manifest('values');
    $("#membernum").text(values.length);
    if( values.length > mMaxlineNum ){
        $("#membernum").css("color", "red");
        $(".mf_item:gt("+(mMaxlineNum-1)+")").addClass("mfred_item");
    }else{
        $("#membernum").css("color", "#444");
        $(".mf_item").removeClass("mfred_item");
    }
}
function pageEventActions(){
    /***************hover function********************/
    $("#dialnow,#dialnum").hover(function(){
            $(this).css("borderColor","#4ABE6B").siblings().css("borderColor","#4ABE6B");
        },function(){
            $(this).css("borderColor","#d9d9d9").siblings().css("borderColor","#d9d9d9");
    });
    
    $(".accountstate").hover(function(){
            if( !$(this).hasClass("activeuse") )
                $(this).addClass("activehover").siblings().removeClass("activehover");
            if( mNewDftAcct == "-1" && mDftAcct != $(this).attr("acctindex") ){
                $(this).children(".acctnum").hide();
                $("#setdftacct").appendTo($(this)).show();
            }else{
                //mNewDftAcct will be -1 after 1 sec of setdftacct click
                if( mNewDftAcct == "-1" ){
                    $(this).children(".acctnum").hide();
                    $("#dftacct").appendTo($(this)).show();
                }
            }
        },function(){
            $(this).removeClass("activehover");
            $(this).children(".acctnum").show();
            $("#setdftacct, #dftacct").hide();
    });
    /***************hover function end********************/

    $("#setdftacct").click(function(){
        mNewDftAcct = $(this).parent(".accountstate").attr("acctindex");
        if( mDftAcct != mNewDftAcct ){
            $("#setdftacct").hide();
            cb_get_action("setdefaultacct&region=account&account=" + mNewDftAcct);
            //cb_get_action("put&var-0000=22046&val-0000="+mNewDftAcct);
        }   
    });
    
    $("#dialnum, #bjnumber").bind('input propertychange', function() {
        if(mSearchTimer > 0) 
            clearTimeout(mSearchTimer);
        mSearchTimer = setTimeout("on_search_key();", 350);
    });
    
    $(".bjinput").focus(function(){
		$(this).addClass("inputActive");
    }).blur(function(){
		$(this).removeClass("inputActive");
    });
    
    $(".bjinput").mouseover(function(){
        $(this).addClass("inputHover");
    }).mouseout(function(){
        $(this).removeClass("inputHover");
    });
    
    $("#bjnumber").focus(function(){
        if( $(this).val() == a_15055 ){
            $(this).val("").css("color", "#222");
        }
    }).blur(function(){
        if( $(this).val() == "" ){
            $(this).val(a_15055).css("color", "#999");
        }
    });
    
    $("#bjpassword").focus(function(){
        if( $(this).val() == a_16705 ){
            $(this).val("").css("color", "#222");
        }
    }).blur(function(){
        if( $(this).val() == "" ){
            $(this).val(a_16705).css("color", "#999");
        }
    });
    
    $("#dialnum").focus(function(){
        $("#numbertip").hide();
        //$("#membernumdiv").css("top", "-22px");
    }).blur(function(){
        if( $("#dialnum").val() == "" ){
            var values = $('#dialnum').manifest('values');
            if( values.length == 0 ){
                $("#numbertip").show();
                //$("#membernumdiv").css("top", "-39px");
            }
        }
    });
    
    $('#dialnum').manifest({
        formatDisplay: function (data, $item, $mpItem) {
            if( data.name == undefined ){
                if( $(".contactitemdiv[number=\""+data+"\"]").length > 0 ){
                    mName = $(".contactitemdiv[number=\""+data+"\"]").eq(0).attr("name");
                }else{
                    mName = data;
                }
            }else{
                mName = data.name;
            }
            return mName;
        },
        formatValue: function (data, $value, $item, $mpItem) {
            if( data.name == undefined ){
                mNumber = data+":::"+selacct;
                if( mHasIPVNumber == 0 && selacct == 1 && mPromodel != "GVC3202" ){
                    mHasIPVNumber = 1;
                    mMaxlineNum --;
                    $("#membermaxnum").text(mMaxlineNum);
                }
                if( selacct == 0 && mSipReg == 0 )
                    $item.addClass("mf_item_0_unreg");
                else
                    $item.addClass("mf_item_"+selacct);
                $item.attr("acctId", selacct);
            }else{
                mNumber = data.number;
                var account = mNumber.split(":::")[1];
                if( mHasIPVNumber == 0 && account == 1 && mPromodel != "GVC3202" ){
                    mHasIPVNumber = 1;
                    mMaxlineNum --;
                    $("#membermaxnum").text(mMaxlineNum);
                }
                if( account == 0 && mSipReg == 0 )
                    $item.addClass("mf_item_0_unreg");
                else
                    $item.addClass("mf_item_"+account);
                $item.attr("acctId", account);
            }
            return mNumber;
        },
        onAdd: function (data, $item, initial) {
            $("#numbertip").hide();
            //$("#membernumdiv").css("top", "-22px");
            if( data.number == undefined ){
                //add by input a number
                mNumber = data;
                mName = data;
                mNeedRemove = 1;
                setTimeout("mNeedRemove = 0;", 500);
            }else{
                //add by press add button
                mName = data.name;
                mNumber = data.number;
                mNeedRemove = 0;
            }
            var exist = 0;
            var values = $('#dialnum').manifest('values');
            for(var i = 0; i < values.length; i++){
                if( values[i] == mNumber ){
                    exist = 1;
                    return false;
                }
            }
            if( exist == 1 ){
                return false;
            }
            
        },
        onChange: function (type, data, $item) {
            if( type == "add" ){
                mInputNum ++;
            }else if( type == "remove" ){
                mInputNum --;
            }
            $("#membernum").text(mInputNum);
            $(".mf_item").removeClass("mfred_item");
            if( mInputNum > mMaxlineNum ){
                $("#membernum").css("color", "red");
                $(".mf_item:gt("+(mMaxlineNum-1)+")").addClass("mfred_item");
            }else{
                $("#membernum").css("color", "#444");
            }
            if( mInputNum >= mMaxlineNum ){
                $("#dialnum").hide();
            }else{
                $("#dialnum").show();
            }
            if( type == "add" && mClickAdd == 0 ){
                //$("#dialnum").val("");
                //on_search_key();
                //need use a timeout or else can't add the searched item
                mSearchTimer = setTimeout("on_search_key();", 500);
            }else if( type == "remove" ){
                if( mHasIPVNumber == 1 && !window.top.confFrame.isIPVConf() ){
                    if( $item.attr("acctId") == 1 ){
                        var values = $('#dialnum').manifest('values');
                        var hasIPV = 0;
                        for(var i = 0; i < values.length; i++){
                            if( values[i].split(":::")[1] == 1 ){
                                hasIPV = 1;
                                break;
                            }
                        }
                        if( hasIPV == 0 && mPromodel != "GVC3202" ){
                            mHasIPVNumber = 0;
                            mMaxlineNum ++;
                            $("#membermaxnum").text(mMaxlineNum);
                        }
                    }
                }
            }
        }
    });
    $('#dialnum').show();
    
    $("#itemaddbtn").click(function(){
        if( mNeedRemove == 1 ){
            $('#dialnum').manifest('remove', ':last');
        }
        //mNeedRemove = 0;
        $('#dialnum').val("");
        mClickAdd = 1;
        var values = $('#dialnum').manifest('values');
        if( values.length >= mMaxlineNum ) return;
        var addnumber = $(this).parent().parent(".itemdiv").attr("number").split(":::");
        var addacct = $(this).parent().parent(".itemdiv").attr("account").split(":::");
        var addnames = "";
        if( $(this).parent().parent(".itemdiv").attr("isconf") == "1" )
            addnames = $(this).parent().parent(".itemdiv").attr("mnames").split(":::");
        else
            addnames = $(this).parent().parent(".itemdiv").attr("name").split(":::");
        var hasdisipv = false;
        var newmembernum = 0;
        for(var i = 0; i < addnumber.length; i++){
            if( mDisableIPVT && addacct[i] == 1 ){
                hasdisipv = true;
                continue;
            }
            newmembernum ++;
            $('#dialnum').manifest('add', {
                name: htmlEncode(addnames[i]),
                number: htmlEncode(addnumber[i])+":::"+addacct[i]
            });
        }
        mClickAdd = 0;
        //update_input_num();
        if( hasdisipv && newmembernum == 0 ){
            $.prompt(a_15051);
        }
    });
       
    $(".accountstate").click(function(){
        selacct = $(this).attr("acctindex");
        //selacct = parseInt( selid.substring(4, 5) ) - 1;
        //$(this).addClass("activeuse").siblings().removeClass("activeuse");
        //$(this).css("borderColor","#4abe6b").siblings().css("borderColor","transparent");
        $(this).addClass("activeuse").siblings().removeClass("activeuse");
        if( selacct == 2 ){
            $("#sipcalldiv").hide();
            $("#bluejeansdiv").show();
            if( $("#bjnumber").val() == "" ){
                $("#bjnumber").val(a_15055);
            }
            if( $("#bjpassword").val() == "" ){
                $("#bjpassword").val(a_16705);
            }
            //$("#bjnumber").val( $("#dialnum").val() );
        }else{
            $("#bluejeansdiv").hide();
            $("#sipcalldiv").show();
            //$("#dialnum").val( $("#bjnumber").val() );
        }
        if( mOEMID == "54" ){
            $("#numbertip").text(a_4016);
        }else if( selacct == 1 ){
            $("#numbertip").text(a_16693+" ("+a_10158+")");
        }else{
            $("#numbertip").text(a_16693);
        }
        on_search_key();
    });
    
    $("#itemcallbtn").click(function(){
        var confstate = $("#disconfstate",window.parent.document).val();
        var callmode = $("#dialtype").val();
        var mode = "call";
        var isipcall = 0;
        if(callmode == "0")
            mode = "call";
        else if(callmode == "1")
            mode = "paging";
        else if(callmode == "2")
        {
            mode = "ipcall";
            isipcall = 1;
        }
        var ispage = parseInt($("#dialtype").val());
        var isvideo = $("#dialvideo").val();
        if( $(this).parent().parent(".itemdiv").attr("isconf") != "1" ){
            var dialnum = "";
            var dialacct = "";
            
            if( $(this).parent().parent(".itemdiv").attr("confmember") == "1") {
                dialnum = $(this).parent().parent(".itemdiv").attr("number");
                dialacct = $(this).parent().parent(".itemdiv").attr("account");
            }else{
                dialnum = $("#divcallbtn").parent(".itemdiv").attr("number");
                dialacct = $("#divcallbtn").parent(".itemdiv").attr("account");
            }
            if(callmode == "2")
            {
                var usequickipcall = $("#usequickipcall",window.parent.document).val();
                if(usequickipcall == "1")
                {
                    var urihead = "action=network&region=status";
                    urihead += "&time=" + new Date().getTime();
                    $.ajax ({
                        type: 'get',
                        url:'/manager',
                        data:urihead,
                        dataType:'text',
                        async:false,
                        success:function(data) {
                            var msgs = res_parse_rawtext(data);
                            cb_if_auth_fail(msgs);
                            if (cb_is_fail(msgs)){}   
                            else {
                                if (msgs.headers['ip'].length > 1) {
                                    var ipserver = msgs.headers['ip'].split(".");
                                    if(dialnum >= 0 && dialnum <= 255)
                                        dialnum = ipserver[0] + "." + ipserver[1] + "." + ipserver[2] + "." + dialnum; 
                                }
                            }
                        },
                        error:function(xmlHttpRequest, errorThrown) {
                            cb_networkerror(xmlHttpRequest, errorThrown);
                        }
                    });
                }
            }
            if( dialnum != "" ){
                if( mDisableIPVT && dialacct == 1 ){
                    $.prompt(a_15051);
                    return false;
                }
                cb_start_single_call(dialnum, dialacct, ispage, isipcall, isvideo); 
            }
        }else{
            if(confstate == "1")
            {
                $.prompt(a_560);
                return false;
            }
            var dialnum = $(this).parent().parent(".itemdiv").attr("number");
            var dialname = $(this).parent().parent(".itemdiv").attr("disname");
            var dialacct = $(this).parent().parent(".itemdiv").attr("account");
            var numbers = dialnum.split(":::");
            var names = dialname.split(",");
            var dialaccts = dialacct.split(":::");
            var numlength = numbers.length;
            if( numlength > mMaxlineNum)
            {
                //list all members
                $("#selectlist").attr("callmode",mode).empty();
                for(var i = 0; i < numlength; i++){
                    var listdiv = "<div number='"+numbers[i]+"' account='"+dialaccts[i]+"'>";
                    if(i < mMaxlineNum)
                        listdiv += "<input type='checkbox' checked='checked'/>";
                    else
                        listdiv += "<input type='checkbox' />";
                    listdiv += "<span title='"+names[i]+"'>"+htmlEncode(names[i])+"</span>";
                    listdiv += "<span title='"+numbers[i]+"'>"+htmlEncode(numbers[i])+"</span>";
                    listdiv += "</div>";

                    $("#selectlist").append(listdiv);
                }
                add_selectlist_event();
                $("#selectcalldiv").show();
                return false;
            }
            //dialnum = dialnum.substring(1, dialnum.length-1);
            var tmpnum = dialnum.replace(/-/g,"");
            if( tmpnum == "" ){
                $.prompt(a_16665);
                return false;
            }
            //dialnum = dialnum.replace(/-/g,":::");
            //dialacct = dialacct.replace(/,/g,":::");
            var confname = "";
            if( $(this).parent().parent(".itemdiv").attr("confid") != "" )
                confname = encodeURIComponent($(this).parent().parent(".itemdiv").attr("name"));
            //cb_get_action("addconfmemeber&region=confctrl&numbers=" + encodeURIComponent(dialnum) + "&accounts=" + encodeURIComponent(dialacct) + "&confname=" + confname + "&callmode="+mode);
            if( numlength == 1 && dialacct != 2 ){
                if( mDisableIPVT && dialacct == 1 ){
                    $.prompt(a_15051);
                    return false;
                }
                cb_start_single_call(dialnum, dialacct, ispage, isipcall, isvideo); 
            }else{
                if( mDisableIPVT ){
                    var dialnum = "", dialacct = "";
                    for(var i = 0; i < dialaccts.length; i++){
                        if( dialaccts[i] != 1 ){
                            if( dialnum != "" ){
                                dialnum += ":::";
                                dialacct += ":::";
                            }
                            dialnum += numbers[i];
                            dialacct += dialaccts[i];
                        }
                    }
                    if( dialnum == "" ){
                        $.prompt(a_15051);
                        return false;
                    }
                }
                
                cb_start_addmemberconf(dialnum, dialacct, mode,"", isvideo);
            }
        }
    });
    
    $("#selectcall").click(function(){
        var nums = "";
        var accts = "";
        var num_member = 0;
        $("#selectlist input").each(function(){
            if($(this).prop("checked") == true)
            {
                var number = $(this).parent().attr("number");
                var account = $(this).parent().attr("account");
                if(nums == "")
                    nums += number;
                else
                    nums += ":::" + number;

                if(accts == "")
                    accts += account;
                else
                    accts += ":::" + account;

                num_member++;
            }
        });

        if(num_member == 0)
        {
            $(".selecttips").text(a_16436);
            setTimeout(function(){
                $(".selecttips").text("");
            },2000);
            return false;
        }

        var isvideo = $("#dialvideo").val();
        if( num_member == 1 ){
            var callmode = parseInt($("#dialtype").val());
            cb_start_single_call(nums, accts, callmode, callmode == 2 ? 1 : 0, isvideo); 
        }else{ 
            cb_start_addmemberconf(nums, accts, $("#selectlist").attr("callmode"),"", isvideo);
        }
        $("#selectcalldiv").hide();
    });

    $("#closecalldiv,#selectcancel").click(function(){
        $("#selectcalldiv").hide();
    });
    
    $("#dialtype").change(function(){
        $("#dialtype", window.parent.document).val($(this).val());
    });
    
    $("#dialnow").click(function(){
        if( mCalling )  return;
        mCalling = true;
        var isvideo = $("#dialvideo").val();
        if( selacct == "2" ){
            var leftline = mMaxNumber - parseInt($("#busylinenum",window.parent.document).val());
            if( $("#hasipvt", window.parent.document).val() == "1" && mPromodel == "GVC3202" && mMaxlineNum < 2 ){
                leftline ++;
            }
            if( leftline <= 0 ) 
                return;
            var dialnum = $("#bjnumber").val();
            if( dialnum == a_15055 || dialnum == "")
                return false;
            var bjpassword = $("#bjpassword").val();
            if( bjpassword != a_16705 && bjpassword != "" )
                dialnum += "." + bjpassword;
            //cb_start_single_call(dialnum, selacct, 0, 0, isvideo);
            cb_start_addmemberconf(dialnum, selacct, "call", "", isvideo);
            setTimeout(function(){mCalling = false;},1000);
            return;
        }
        
        mHasIPVNumber = 0;
        var values = $('#dialnum').manifest('values');
        if( selacct == "1" && values.length == 0 && mOEMID != '54' ){
            if( window.top.confFrame.isIPVConf() ){
                window.top.isopenincall(true);
                setTimeout(function(){mCalling = false;},1000);
                return;
            }
            cb_get_action("quickStartIPVConf&region=confctrl&isvideo=" + isvideo);
            setTimeout(function(){mCalling = false;},1000);
            return;
        }
        
        var dialnum = "";
        var dialacct = "";
        for(var i = 0; i < values.length; i++){
            if( i > mMaxlineNum-1 ) break;
            if( dialnum != "" ){
                dialnum += ":::";
                dialacct += ":::";
            }
            dialnum += values[i].split(":::")[0];
            dialacct += values[i].split(":::")[1];
        }
        if( dialnum == "" ){
            setTimeout(function(){mCalling = false;},1000);
            return;
        }
        
        //var dialnum = $.trim($("#dialnum").val());
        var ispage = parseInt($("#dialtype").val());
        var callmode = $("#dialtype").val();
        var mode = "call";
        var isipcall = 0;
        if(callmode == "0")
            mode = "call";
        else if(callmode == "1")
            mode = "paging";
        else if(callmode == "2")
        {
            mode = "ipcall";
            isipcall = 1;
            var usequickipcall = $("#usequickipcall",window.parent.document).val();
            if(usequickipcall == "1")
            {
                var urihead = "action=network&region=status";
                urihead += "&time=" + new Date().getTime();
                $.ajax ({
                    type: 'get',
                    url:'/manager',
                    data:urihead,
                    dataType:'text',
                    async:false,
                    success:function(data) {
                        var msgs = res_parse_rawtext(data);
                        cb_if_auth_fail(msgs);
                        if (cb_is_fail(msgs)){}   
                        else {
                            if (msgs.headers['ip'].length > 1) {
                                var ipserver = msgs.headers['ip'].split(".");
                                if( dialnum.indexOf(":") != -1 ){
                                    var ipandport = dialnum.split(":");
                                    if(ipandport[0] >= 0 && ipandport[0] <= 255)
                                        dialnum = ipserver[0] + "." + ipserver[1] + "." + ipserver[2] + "." + dialnum; 
                                }else{
                                    if(dialnum >= 0 && dialnum <= 255)
                                        dialnum = ipserver[0] + "." + ipserver[1] + "." + ipserver[2] + "." + dialnum; 
                                } 
                            }
                        }
                    },
                    error:function(xmlHttpRequest, errorThrown) {
                        cb_networkerror(xmlHttpRequest, errorThrown);
                    }
                });
            }
        }
        if( dialnum != "" ){
            //cb_start_single_call(dialnum, selacct, ispage, isipcall);
            //selacct may be 1 for bluejeans account when no account configured,so use 0 forever as only one account
            //cb_start_single_call(dialnum, 0, ispage, isipcall);
            if( values.length == 1 ){
                cb_start_single_call(dialnum, dialacct, ispage, isipcall, isvideo); 
            }else{
                cb_start_addmemberconf(dialnum, dialacct, mode,"", isvideo);
            }
            $('#dialnum').manifest('remove');
        }
        setTimeout(function(){mCalling = false;},1000);
    });
}

</script>

</body>

</html>
