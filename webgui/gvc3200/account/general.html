<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<link href='../css/black_frame.css' type='text/css' rel='stylesheet' id="framecssfile">
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.validate.min.js'></script>
<script type="text/javascript" src='../js/jquery.stylish-select.min.js'></script>
<script type="text/javascript" src='../js/jquery.prompt.js'></script>
<script type="text/javascript" src='../js/jquery.md5.js'></script>
<script type="text/javascript" src='../js/hideShowPassword.min.js'></script>
<style>
.serverside{display:none;}
</style>
<body id="framebody">
<div class="tooltip"></div>

<div id="mainbody" class="maindiv">
    <div class="navi"><span id="a_general">General Settings</span></div>
    <div id="statusdiv"></div>
	<form action="" method="get" id="Formvalidate">
		<fieldset>
		    <div webtip="Enable IPVideoTalk" id="ipvideotalkdiv" class="iptalkmode" style="display:none;">
                <div class="noreboot"><span id="a_enableiptalkpro">Enable IPVideoTalk</span> :</div>
                <input name="enableiptalkpro" type="checkbox" id="enableiptalkpro"><span id="a_enableiptalkproyes">Yes</span>
            </div>
            <!--<div webtip="Account Active" id="activeacctdiv">
                <div class="rebootitem"><span id="a_activeaccount">Active Account</span> :</div>
                <select id="activeaccount" name="activeaccount">
                    <option value="1">Account 1</option>
                    <option value="6">Account 2</option>
                </select>
            </div>-->
            <div webtip="Current Packages" id="ipvpackagediv" style="display:none;">
                <div class="rebootitem"><span id="a_curpackage">Current Packages</span> :</div>
                <div><span id="curpackagehtml"></span><a href="" id="viewpackage" target="_blank" style="margin-left:50px;">View</a></div>
            </div>
            <div webtip="Account Active" id="activeacctdiv" class="h323mode">
                <div class="rebootitem"><span id="a_accountactive">Account Active</span> :</div>
                <input name="accountacctive" type="checkbox" id="accountacctive"><span id="a_accountacyes">Yes</span>
            </div>
            <div webtip="Enable GK" class="h323mode" style="display:none;">
                <div class="rebootitem"><span id="a_enablegk">Enable GK</span> :</div>
                <input name="enablegk" type="checkbox" id="enablegk"><span id="a_enablegkyes">Yes</span>
            </div>
            <div webtip="Enable H.460" class="h323mode" style="display:none;">
                <div class="rebootitem"><span id="a_enableh460">Enable H.460</span> :</div>
                <input name="enableh460" type="checkbox" id="enableh460"><span id="a_enableh460yes">Yes</span>
            </div>
            <div webtip="GK Discover Mode" style="display:none;" class="h323mode">
                <div class="noreboot"><span id="a_gkdiscovermode">GK Discover Mode</span> :</div>
                <select name="gkdiscovermode" id="gkdiscovermode">
                    <option value="0">Auto</option>
                    <option value="1">Manual</option>
                </select>
            </div>
            <div webtip="Account Name" class="serverside">
                <div class="rebootitem"><span id="a_accountname">Account Name</span> :</div>
                <input id="accountname" name="accountname" type="text" />
            </div>
            <div webtip="SIP Server" class="serverside h323mode" id="sipserverdiv">
                <div class="rebootitem"><span id="a_sipserver">SIP Server</span> :</div>
                <input id="sipserver" name="sipserver" type="text" />
            </div>
            <div webtip="Secondary SIP Server" class="serverside">
                <div class="rebootitem"><span id="a_secsipserver">Secondary SIP Server</span> :</div>
                <input id="secsipserver" name="secsipserver" type="text" />
            </div>
            <div webtip="Tertiary SIP Server" class="serverside">
                <div class="rebootitem"><span id="a_thirdsipserver">Tertiary SIP Server</span> :</div>
                <input id="thirdsipserver" name="thirdsipserver" type="text" />
            </div>
            <div webtip="SIP User ID" class="serverside h323mode">
                <div class="rebootitem"><span id="a_sipuid">SIP User ID</span> :</div>
                <input id="userid" name="userid" type="text" />
            </div>
            <div webtip="SIP Authentication ID" class="serverside h323mode">
                <div class="rebootitem"><span id="a_authid">SIP Authentication ID</span> :</div>
                <input id="authid" name="authid" type="text" />
            </div>
            <div webtip="SIP Authentication Password" class="serverside h323mode">
                <div class="rebootitem"><span id="a_authpwd">SIP Authentication Password</span> :</div>
                <input id="authpwd" name="sauthpwdserver" type="password" autocomplete="off" />
            </div>
            <div webtip="Voice Mail Access Number" class="serverside">
                <div class="noreboot"><span id="a_voicemailuid">Voice Mail Access Number</span> :</div>
                <input id="vmuserid" name="vmuserid" type="text" />
            </div>
            <div webtip="Display Name">
                <div class="rebootitem"><span id="a_name">Display Name</span> :</div>
                <input id="name" name="name" type="text" maxlength="32" />
            </div>
            <div webtip="Tel URI" class="serverside" id="teluridiv">
                <div class="noreboot"><span id="a_teluri">Tel URI</span> :</div>
                <select id="teluri" name="teluri">
                    <option value="0">Disabled</option>
                    <option value="1">User=Phone</option>
                    <option value="2">Enabled</option>
                </select>
            </div>
            <div webtip="SIP Transport" class="iptalkmode">
                <div class="rebootitem"><span id="a_siptranport">SIP Transport</span> :</div>
                <select name="siptranport" id="siptranport">
                    <option value="1">TCP</option>
                    <option value="2">TLS</option>
                </select>
            </div>
            <div webtip="Register Expiration (H323)" style="display:none;" class="h323mode">
                <div class="noreboot"><span id="a_regexp">Register Expitation (m)</span> :</div>
                <input id="regexp" name="regexp" type="text" value="60" />
            </div>
            <div webtip="H.323 Local Port" style="display:none;" class="h323mode">
                <div class="noreboot"><span id="a_localport">H.323 Local Port</span> :</div>
                <input id="localport" name="localport" type="text" value="1720" />
            </div>
            <div webtip="Symmetric RTP" style="display:none;" class="h323mode">
                <div class="noreboot"><span id="a_symrtp">Symmetric RTP</span> :</div>
                <input name="symrtp" type="checkbox" id="symrtp"><span id="a_symrtpyes">Yes</span>
            </div>
        </fieldset>
        <div class="savediv">
            <button id="a_save" type="button" class="savebtn">Save</button>
            <button id="a_cancel" type="button" class="cancelbtn">Cancel</button>
        </div>
	</form>


</div>

<div id="newdftacctdiv" class="jqibox" style="position: fixed; height: 504px; width: 100%; top: 0px; left: 0px; right: 0px; bottom: 0px; z-index: 999;display:none;">
    <div id="jqifade" class="jqifade" style="position:absolute;height:504px;width:100%;top: 0px; left: 0px; right: 0px; bottom: 0px; z-index: 999; opacity: 0.6;"></div>
    <div id="jqi" class="jqi" style="position: absolute; top: 15%; left: 50%; margin-left: -313px; z-index: 1000;">
        <div class="jqicontainer">
            <div class="jqiclose"></div>
            <div id="jqistates">
                <div style="display: block;" class="jqi_state" id="jqi_state_state0">
                    <div class="jqimessage">
                        <div style="height: 50px;" class="jqimessage">
                            <div><span id="dfttiptext">Unactive the default account, set new default account to</span>:</div>
                            <select name="newdftacct" id="newdftacct"></select>
                        </div>
                    </div>
                    <div class="jqibuttons">
                        <button value="true" id="newdftacctok" name="jqi_state0_buttonYes" class="jqidefaultbutton">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<input id="dftacct" name="dftacct" type="text" style="display:none;" value="0" />
<input id="ipvtoken" name="ipvtoken" type="text" style="display:none;" value="" />
<script type="text/javascript">
	var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
	}
    if ( cookie_lang == 'zh' ){
        document.write("<script src='../js/jquery.validate.messages_cn.js'><\/script>");
	}
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");

</script>
<script type="text/javascript">
    var req_items = new Array;
	var sub_req_items = new Array;
	var accountindex = 1;
    var mInit = 1;
    var mProType = -1;
    var mDisName = "";
    var mSIPChecked = 0;
    var mDftacctSelect = '';
    var mNewDftAcct = 0;
    var mOEMID = '0';
    
$(function(){
    accountindex = $('#accountindex',parent.document.body).val();
    mOEMID = $('#existcolore', window.parent.document).val();
    setInitState();
    //cb_get_index(req_indexs);
    cb_get_action('get&var-0000=22046&var-0001=271&var-0002=401&var-0003=501&var-0004=25059');
    if( accountindex == '2' ){
        $("#a_curpackage").text(a_9623);
        $(".iptalkmode").show();
        $("#activeacctdiv").hide();
    }else if( accountindex == '4' ){
        $("fieldset > div").hide();
        $("#a_gkdiscovermode").text(a_19122);
        $("#gkdiscovermode option:eq(0)").text(a_1317);
        $("#gkdiscovermode option:eq(1)").text(a_1016);
        $("#a_regexp").text(a_16069);
        $("#a_localport").text(a_19210);
        $("#a_symrtp").text(a_16096);
        $("#a_symrtpyes").text(a_5);
        $(".h323mode").show();
        $("#gkdiscovermode").sSelect();
        $("#gkdiscovermode").change(function(){
            change_h323_mode();
        });
    }else{
        /*if( accountindex == '3' )
            $("#activeacctdiv").hide();
        else*/
        $("#activeacctdiv").show();
        $(".iptalkmode").hide();
    }
    cb_get_pvalue(accountindex);
    pageEventActions();
});
function setInitState(){
    translate_general();
    if( accountindex == '1' )
        $('#teluridiv').show();
    $('#teluri, #siptranport').sSelect();
    $("#Formvalidate").validate({
		rules: {
            //secsipserver: { url:true, maxlength: 64 },
            regexp: { digits:true, range:[1,1440] },
            localport: { digits:true, range:[1024,65535] },
            authpwd: { maxlength: 64 }
        },
		errorElement: "em",
		success: function(label) { label.text(" ").addClass("success"); }
    });
}
function change_h323_mode(){
    if( $("#gkdiscovermode").val() == "0" ){
        $("#sipserverdiv").hide();
    }else{
        $("#sipserverdiv").show();
    }
}
function get_item_suc_callback() {
    mDisName = $("#accountname").val();
    if( $("#accountacctive").attr("checked") )
        mSIPChecked = 1;
    else
        mSIPChecked = 0;
    if( accountindex == "1" ){
        $(".serverside").show();
        //$(".serverside").children("div").children("span").removeClass("grayfont").addClass("netfontcolor");
        //$(".serverside").children("input").attr("disabled", false);
    }else if( accountindex == '4' ){
        $(".h323mode").show();
        change_h323_mode();
    }else {
        if( accountindex == '2' ){
            if( $("#enableiptalkpro").attr("checked") ){
                mSIPChecked = 1;
                if( $("#ipvtoken").val() != "" )
                    cb_get_plan(); 
                else
                    cb_get_ipvinfo();          
            }else{
                mSIPChecked = 0;
            }
        }
        $(".serverside").hide();
        //$(".serverside").children("div").children("span").removeClass("netfontcolor").addClass("grayfont");
        //$(".serverside").children("input").attr("disabled", true);
    }
}
function date2str(x,y) { 
    var z ={y:x.getFullYear(),M:x.getMonth()+1,d:x.getDate(),h:x.getHours(),m:x.getMinutes(),s:x.getSeconds()}; 
    return y.replace(/(y+|M+|d+|h+|m+|s+)/g,function(v) {return ((v.length>1?"0":"")+eval('z.'+v.slice(-1))).slice(-(v.length>2?v.length:2))}); 
} 
function getUTCTimestamp(){
    var myDate = new Date();
    var time = myDate.getTime();
    var offset = myDate.getTimezoneOffset();
    myDate.setTime(time+offset*60000);
    return date2str(myDate,"yyyyMMddhhmmss");
}
function cb_get_plan(){
    var timestamp = getUTCTimestamp();
    var queryUrl ="http://api.ipvideotalk.com/pro/package/info?source=WIN&version=1.0&format=JSON&appID=2012&jsoncallback=mycallback&timeStamp=" + timestamp + "&accessToken=" + $("#ipvtoken").val();
    var signature = "&accessToken=" + $("#ipvtoken").val() + "&appID=2012&format=JSON&jsoncallback=mycallback&source=WIN&timeStamp=" + timestamp + "&version=1.0&testandtest&";
    queryUrl += "&signature=";
    queryUrl += $.md5(signature);

    $.ajax({
        url:queryUrl,            
        type:"GET",
        contentType: 'application/json;charset=utf-8',
        dataType:"jsonp",
        jsonpCallback:"mycallback",
        success:function(data){
            var response = data.retCode;
            if( response == 30000 ){
                cb_get_ipvinfo();
            }else if( response == 0 ){
                var planinfo = data.data;
                var name = planinfo.name;
                if( name == undefined || name == "" ){
                    $("#curpackagehtml").text(a_9626);
                    $("#viewpackage").hide();
                }else{
                    $("#curpackagehtml").text( name );
                    var detailURL = planinfo.detailURL;
                    $("#viewpackage").attr("href", detailURL).text(a_584);
                }
                $("#ipvpackagediv").show();
            }
        },
        error: function(xmlHttpRequest, errorThrown) {
			//cb_networkerror(xmlHttpRequest, errorThrown);
		}
    });
}
function cb_get_ipvinfo(){
    var urihead = "action=getipvtacctinfo&region=account&time=" + new Date().getTime();
	$.ajax ({
		type: 'get',
		url: '/manager',
		data: urihead,
		async: false,
		dataType: 'text',
		success: function(data) {
		    var msgs = res_parse_rawtext(data);
		    cb_login_pro(msgs);
		},
		error: function(xmlHttpRequest, errorThrown) {
			cb_networkerror(xmlHttpRequest, errorThrown);
		}
	});
}
function cb_login_pro(msgs){
    var account = msgs.headers["405"];
    var pwdinfo = msgs.headers["406"];
    //pwdinfo = $.md5(pwdinfo);
    var timestamp = getUTCTimestamp();
    var queryUrl ="http://api.ipvideotalk.com/pro/user/login?source=WIN&version=1.0&format=JSON&appID=2012&jsoncallback=mycallback&timeStamp=" + timestamp + "&proAccount=" + account + "&password=" + pwdinfo;
    var signature = "&appID=2012&format=JSON&jsoncallback=mycallback&password=" + pwdinfo + "&proAccount=" + account + "&source=WIN&timeStamp=" + timestamp + "&version=1.0&testandtest&";
    queryUrl += "&signature=";
    queryUrl += $.md5(signature);

    $.ajax({
        url:queryUrl,            
        type:"GET",
        contentType: 'application/json;charset=utf-8',
        dataType:"jsonp",
        jsonpCallback:"mycallback",
        success:function(data){
            var response = data.retCode;
            if( response == 0 ){
                var logininfo = data.data;
                var token = logininfo.accessToken;
                $("#ipvtoken").val(token);
                cb_get_action("put&flag=3&var-0000=ipv_token&val-0000=" + token);
                cb_get_plan();
            }
        },
        error:function(xmlHttpRequest, errorThrown){
            //cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}

function cb_get_pvalue(acctindex){
	accountindex = acctindex;
	req_items.push(
        new ReqItem("enableiptalkpro", "7059", "")
        //new ReqItem("dftacct", "22046", "")
    );
    /*sub_req_items.push(
        new ReqItem("dftacct", "22046", "")
    );*/
	switch(acctindex)
	{
	    case '1':
			req_items.push(
				new ReqItem("accountacctive", "271", ""),
				new ReqItem("accountname", "270", ""),
				new ReqItem("sipserver", "47", ""),
				//new ReqItem("secsipserver", "2312", ""),
				new ReqItem("secsipserver", "602", ""),
				new ReqItem("thirdsipserver", "1702", ""),
				new ReqItem("userid", "35", ""),
				new ReqItem("authid", "36", ""),
				//new ReqItem("authpwd", "34", ""),
				new ReqItem("vmuserid", "33", ""),
				new ReqItem("name", "3", ""),
				new ReqItem("teluri", "63", "")
			);
			break;
        case '2':
            sub_req_items.push(
                new ReqItem("enableiptalkpro", "7059", ""),
                new ReqItem("accountacctive", "401", ""),
                new ReqItem("siptranport", "448", ""),
                new ReqItem("name", "407", "")
            );
			req_items.push(
				/*new ReqItem("accountacctive", "401", ""),
				new ReqItem("accountname", "417", ""),
				new ReqItem("sipserver", "402", ""),
				new ReqItem("secsipserver", "2412", ""),
				new ReqItem("userid", "404", ""),
				new ReqItem("authid", "405", ""),
				//new ReqItem("authpwd", "406", ""),
				new ReqItem("vmuserid", "426", ""),*/
				new ReqItem("ipvtoken", "ipv_token", ""),
                new ReqItem("name", "407", ""),
				//new ReqItem("teluri", "409", "")
				new ReqItem("siptranport", "448", "")
			);
			break;
		case '3':
		    sub_req_items.push(
                new ReqItem("accountacctive", "501", ""),
                new ReqItem("name", "507", "")
            );
			req_items.push(
				new ReqItem("accountacctive", "501", ""),
				/*new ReqItem("accountname", "517", ""),
				new ReqItem("sipserver", "502", ""),
				new ReqItem("secsipserver", "2512", ""),
				new ReqItem("userid", "504", ""),
				new ReqItem("authid", "505", ""),
				//new ReqItem("authpwd", "506", ""),
				new ReqItem("vmuserid", "526", ""),*/
				new ReqItem("name", "507", "")
				//new ReqItem("teluri", "509", "")
			);
			break;
		case '4':
			req_items.push(
			    new ReqItem("accountacctive", "25059", ""),
			    new ReqItem("enablegk", "25032", ""),
			    new ReqItem("enableh460", "25066", ""),
			    new ReqItem("gkdiscovermode", "25051", ""),
			    new ReqItem("regexp", "25054", ""),
				new ReqItem("symrtp", "25067", ""),
				new ReqItem("localport", "25068", ""),
				new ReqItem("sipserver", "25033", ""),
				new ReqItem("userid", "25034", ""),
				new ReqItem("authid", "25035", ""),
				new ReqItem("authpwd", "25036", "")
				//new ReqItem("accountacctive", "601", ""),
				//new ReqItem("accountname", "617", ""),
				
				//new ReqItem("secsipserver", "2612", ""),
				/*new ReqItem("sipserver", "602", ""),
				new ReqItem("userid", "604", ""),
				new ReqItem("authid", "605", "")
				//new ReqItem("authpwd", "606", ""),
				new ReqItem("vmuserid", "626", ""),
				new ReqItem("name", "607", ""),
				new ReqItem("teluri", "609", "")*/
			);
			break;
		case '5':
			req_items.push(
				new ReqItem("accountacctive", "1701", ""),
				new ReqItem("accountname", "1717", ""),
				new ReqItem("sipserver", "1702", ""),
				new ReqItem("secsipserver", "2712", ""),
				new ReqItem("userid", "1704", ""),
				new ReqItem("authid", "1705", ""),
				//new ReqItem("authpwd", "1706", ""),
				new ReqItem("vmuserid", "1726", ""),
				new ReqItem("name", "1707", ""),
				new ReqItem("teluri", "1709", "")
			);
			break;

        case '6':
			req_items.push(
				new ReqItem("accountacctive", "1801", ""),
				new ReqItem("accountname", "1817", ""),
				new ReqItem("sipserver", "1802", ""),
				new ReqItem("secsipserver", "2812", ""),
				new ReqItem("userid", "1804", ""),
				new ReqItem("authid", "1805", ""),
				//new ReqItem("authpwd", "1806", ""),
				new ReqItem("vmuserid", "1826", ""),
				new ReqItem("name", "1807", ""),
				new ReqItem("teluri", "1809", "")
			);
			break;
	}
	cb_get(req_items);
    //cb_get_lock_acct(1);
}

function translate_general(){
    $("#a_general").text(a_16023);
    $("#a_activeaccount").text(a_1119);
    $("#activeaccount option:eq(0)").text(a_16035);
    $("#activeaccount option:eq(1)").text(a_16036);
    $("#a_accountactive").text(a_1119);
    $("#a_accountacyes").text(a_5);
    $("#a_enableiptalkpro").text(a_1119);  //a_19028
    $("#a_enableiptalkproyes").text(a_5);
    $("#a_accountname").text(a_1120);
    if(accountindex == "4"){
        $("#a_enablegk").text(a_19120);
        $("#a_enableh460").text(a_19204);
        $("#a_enablegkyes, #a_enableh460yes").text(a_5);
        $("#a_sipserver").text(a_19116);
        $("#a_sipuid").text(a_19117);
        $("#a_authid").text(a_19118);
        $("#a_authpwd").text(a_19119);
        $("#a_sipserver").parent().parent().attr("webtip","GK Address");
        $("#a_sipuid").parent().parent().attr("webtip","GK Site Number");
        $("#a_authid").parent().parent().attr("webtip","GK Authentication Username");
        $("#a_authpwd").parent().parent().attr("webtip","GK Authentication Password");
    }else{
        $("#a_sipserver").text(a_1121);
        $("#a_sipuid").text(a_1122);
        $("#a_authid").text(a_1123);
        $("#a_authpwd").text(a_1124);
        $("#a_sipserver").parent().parent().attr("webtip","SIP Server");
        $("#a_sipuid").parent().parent().attr("webtip","SIP User ID");
        $("#a_authid").parent().parent().attr("webtip","SIP Authentication ID");
        $("#a_authpwd").parent().parent().attr("webtip","SIP Authentication Password");
    }
    $("#a_secsipserver").text(a_16055);
    $("#a_thirdsipserver").text(a_19168);
    $("#a_voicemailuid").text(a_1125);
    $("#a_name").text(a_1126);
    $("#a_siptranport").text(a_16093);
    $("#a_teluri").text(a_16056);
    $("#teluri option:eq(0)").text(a_39);
    $("#teluri option:eq(1)").text(a_16065);
    $("#teluri option:eq(2)").text(a_40);
    $("#dfttiptext").text(a_19198);
    $("#newdftacctok").text(a_2);
    $("#a_cancel").text(a_3);
    $("#a_save").text(a_17);
}

function cb_get_action_done(data, action){
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    if (cb_is_fail(msgs)){
        if( action.indexOf("enableiptalkpro") != -1 ){
            mProType = 0;
            $("#enableiptalkpro").prop("checked", false).attr("disabled", "disabled");
            $("#a_enableiptalkpro, #a_enableiptalkproyes").addClass("grayfont");
            window.parent.unblock_func();
            $.prompt(a_63+a_19029);
        }
    }   
    else {
        if( action.indexOf("enableiptalkpro") != -1 ){
            mProType = 1;
            window.parent.unblock_func();
        }else if( action.indexOf("get&var-0000=22046") != -1 ){
            $("#dftacct").val( msgs.headers['22046'] );
            var option;
            if( msgs.headers['271'] == '1' && accountindex != '1' ){
                option = $("<option value='0'>SIP</option>");
                $("#newdftacct").append(option);
            }
            
            if(mOEMID != "54"){
                if( msgs.headers['401'] == '1' && accountindex != '2' ){
                    option = $("<option value='1'>IPVideoTalk</option>");
                    $("#newdftacct").append(option);
                }
                if( msgs.headers['501'] == '1' && accountindex != '3' ){
                    option = $("<option value='2'>BlueJeans</option>");
                    $("#newdftacct").append(option);
                }
            }
            
            if( msgs.headers['25059'] == '1' && accountindex != '4' ){
                option = $("<option value='8'>H.323</option>");
                $("#newdftacct").append(option);
            }
            $("#newdftacctdiv").show();
            $('#newdftacct').sSelect();
            $("#newdftacctdiv").hide();
        }else if( action.indexOf("put&flag=1&var-0000=22046") != -1 ){
            $("#dftacct").val(mNewDftAcct);
        }
    } 
}
function cb_put_suc(data, mode)
{
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    if( cb_if_is_fail(msgs) )
        view_message(a_16419, MSG_FAIL);
    else {
        view_message(a_7479, MSG_OK); 
        var curchecked = 0;
        if( $("#accountacctive").prop("checked") )
            curchecked = 1;
        /*var needchange = 0;
        if( accountindex == "1" && ($("#accountname").val() != mDisName || curchecked != mSIPChecked )){
            needchange = 1;
        }else if( accountindex == "2" && curchecked != mSIPChecked ){
            needchange = 1;
        }else if( accountindex == "4" && curchecked != mSIPChecked ){
            needchange = 1;
        }
        if( needchange == 1 ){
            var curacct = parseInt(accountindex) - 1;
            mDisName = $("#accountname").val();
            
            var applyfun = $.cookie("applyfunc");
            if (applyfun != undefined && applyfun != "")
			    applyfun += ";cb_set_displayname('" + mDisName + "'" + ",'" + curchecked + "'," + curacct + ")";
		    else
			    applyfun = "cb_set_displayname('" + mDisName + "'" + ",'" + curchecked + "'," + curacct + ")";
			$.cookie("applyfunc", applyfun, {path: '/', expires: 10});
        }*/
        /*if( curchecked != mSIPChecked ){
            var acctval = parseInt(accountindex) - 1;
            if( accountindex == "4" )
                acctval = 8;
            if( curchecked == 0 ){
                if( $("#dftacct").val() == acctval ){
                    $("#newdftacctdiv").show();
                }
            }
            else{
                var txt = '<div class="jqimessage">' + a_19197 + '</div>';
                $.prompt(txt,{
                    buttons:{
                        Yes: true, No: false
                    },
                    callback: function(v,m,f){
                        if(v) {  mNewDftAcct = acctval;cb_get_action('put&flag=1&var-0000=22046&val-0000='+acctval); }
                        else {}
                    }
                });
            }
        }*/
        mSIPChecked = curchecked;
    }
    checkIsApplyNeed(); 
}

function save_settings(){
    if( accountindex != "1" && accountindex != "4" ){
        cb_put(sub_req_items);
    }else{
	    var pwd = $("#authpwd").val();
	    if( pwd !="" && pwd != undefined ){
		    switch (accountindex) 
		    {
			    case '1':
				    req_items.push(new ReqItem("authpwd", "34", ""));
				    break;
			    case '2':
				    req_items.push(new ReqItem("authpwd", "406", ""));
				    break;
			    case '3':
				    req_items.push(new ReqItem("authpwd", "506", ""));
				    break;
			    /*case '4':
				    req_items.push(new ReqItem("authpwd", "25036", ""));
				    break;*/
			    case '5':
				    req_items.push(new ReqItem("authpwd", "1706", ""));
				    break;
			    case '6':
				    req_items.push(new ReqItem("authpwd", "1806", ""));
				    break;
		    }
        }
        cb_put(req_items, "");
	    if( pwd !="" && pwd !=undefined && accountindex != '4')
		    req_items.pop();
    }
}

function pageEventActions(){
    /*$("#enableiptalkpro").click(function(){
        if( $(this).attr("checked") ){
            if( mProType == -1 ){
                window.parent.block_download_func(a_4024);
                cb_get_action("enableiptalkpro&region=advanset");
            }else if( mProType == 0 ){
                $("#enableiptalkpro").prop("checked", false);
            }
        }
    });*/
    $("#authpwd").hideShowPassword({
        innerToggle: true
    });
    
    $("#newdftacctok").click(function(){
        mNewDftAcct = $("#newdftacct").val();
        cb_get_action('put&flag=1&var-0000=22046&val-0000='+mNewDftAcct);
        $("#newdftacctdiv").hide();
        save_settings();
    });
    
    $("#a_save").click(function(){
        /*if( $("#name").val().indexOf('"') != -1 ){
            view_message(a_19196,MSG_FAIL);
            return false;
        }*/
        
        $("#sipserver").val( $("#sipserver").val().replace(/(^\s*)|(\s*$)/g, "") );
        if( accountindex == "4" ){
            $("#sipserver").rules("remove");
            if( $("#enablegk").attr("checked") && $("#gkdiscovermode").val() != "0" ){
                $("#sipserver").rules("add", { required: true });
            }
        }
        if( !$("#Formvalidate").valid() ){
            view_message(a_16442,MSG_FAIL);
            return false;
        }
        var reg = new RegExp("^[A-Za-z0-9-_.!~*'()+]+$");
        if($("#userid").val() != "" && !reg.test($("#userid").val())){
            if( accountindex == "4" )
                view_message(a_19193,MSG_FAIL);
            else
                view_message(a_16441,MSG_FAIL);
            return false;
        }
        reg = new RegExp("^[A-Za-z0-9-_.!~*'()+@]+$");
        if($("#authid").val() != "" && !reg.test($("#authid").val())){
            if( accountindex == "4" )
                view_message(a_19195,MSG_FAIL);
            else
                view_message(a_19194,MSG_FAIL);
            return false;
        }
        
        reg = new RegExp("^[\x21-\x7E]+$");
        if(!reg.test($("#authpwd").val())){
            view_message($("#a_authpwd").text() + " " + a_19275, MSG_FAIL);
            return false;
        }
        
        if( accountindex == "2" ){
            if( $("#enableiptalkpro").attr("checked") ){
                $("#accountacctive").prop("checked", true);
            }else{
                $("#accountacctive").prop("checked", false);
            }
        }
        var curchecked = 0;
        if( $("#accountacctive").prop("checked") )
            curchecked = 1;
        var blocked = true;
        if( curchecked != mSIPChecked ){
            var acctval = parseInt(accountindex) - 1;
            if( accountindex == "4" )
                acctval = 8;
            if( $("#newdftacct option").length > 0 ){
                if( curchecked == 0 && $("#dftacct").val() == acctval ){
                    $("#newdftacctdiv").show();
                }else{
                    blocked = false;
                }
            }else{
                blocked = false;
                if( curchecked == 0 )
                    cb_get_action('put&flag=1&var-0000=22046&val-0000=0');
                else
                    cb_get_action('put&flag=1&var-0000=22046&val-0000='+acctval);
            }
        }else{
            blocked = false;
        }
        if( !blocked ){
            save_settings();
        }
    });
}

</script>

</body>

</html>
