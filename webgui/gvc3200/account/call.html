<!-- saved from url=(0022)http://internet.e-mail -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link href='../css/pageframe.css' type='text/css' rel='stylesheet'>
<link href='../css/black_frame.css' type='text/css' rel='stylesheet' id="framecssfile">
<script type='text/javascript' src='../js/jquery.tools.min.js'></script>	
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../js/jquery.validate.min.js'></script>
<script type="text/javascript" src='../js/jquery.stylish-select.min.js'></script>
<script type="text/javascript" src='../js/ajaxupload.3.5.js'></script>
<script type="text/javascript" src='../js/jquery.prompt.js'></script>
<style>
body{}
.dotline { width:600px; margin-left:50px;}
.checkdiv{padding:0px;width:160px;display:inline;margin:0 !important;}
.checkrowdiv{width:330px;padding-left:0px;margin:0px !important;}
</style>
<body id="framebody">
<div class="tooltip"></div>

<div id="mainbody" class="maindiv">
    <div class="navi"><span id="a_call">Call Settings</span></div>
    <div id="statusdiv"></div>
    <form action="" method="get" id="Formvalidate">
        <fieldset>
            <div webtip="Start Video Automatically" style="display:none;">
                <div class="noreboot"><span id="a_autovideo">Start Video Automatically</span> :</div>
                <input name="autovideo" type="checkbox" id="autovideo"><span id="a_autovideoyes">Yes</span>
            </div>
            <div webtip="Start Video Call Fullscreen" style="display:none;">
                <div class="noreboot"><span id="a_startfull">Start Video Call Fullscreen</span> :</div>
                <input name="startfull" type="checkbox" id="startfull"><span id="a_startfullyes">Yes</span>
            </div>
            <div webtip="Remote Video Request" class="bjmode iptalkmode">
                <div class="noreboot"><span id="a_remotevideo">Remote Video Request</span> :</div>
                <select id="remotevideo" name="remotevideo">
                    <option value="0">Prompt</option>
                    <option value="1">Accept</option>
                    <option value="2">Deny</option>
                </select>
            </div>
            <!--<div webtip="Dial Mode">
                <div class="noreboot"><span id="a_dialmode">Dial Mode</span> :</div>
                <select id="dialmode" name="dialmode">
                    <option value="0">Prompt</option>
                    <option value="1">Audio</option>
                    <option value="2">Video</option>
                </select>
            </div>-->
            <div webtip="Dial Plan Prefix" class="iptalkmode">
                <div class="noreboot"><span id="a_dialplanpr">Dial Plan Prefix</span> :</div>
                <input id="prefix" name="prefix" type="text" />
            </div>
            
            <div webtip="Disable Dial Plan" class="iptalkmode">
                <div class="noreboot"><span id="a_disdialplan">Disable DialPlan</span> :</div>
                <div id="dialplancheckdiv" style="width:330px;padding-left:0px;margin:0px !important;">
                    <div class="checkrowdiv">
                        <div class="checkdiv"><input name="disdialpage" type="checkbox" id="disdialpage"><span id="a_disdialpage">Dial Page</span></div>
                        <div class="checkdiv"><input name="discontact" type="checkbox" id="discontact"><span id="a_discontact">Contact</span></div>
                    </div>
                    <div class="checkrowdiv">
                        <div class="checkdiv"><input name="disincoming" type="checkbox" id="disincoming"><span id="a_disincoming">Incoming Call History</span></div>
                        <div class="checkdiv"><input name="disoutgoing" type="checkbox" id="disoutgoing"><span id="a_disoutgoing">Outgoing Call History</span></div>
                    </div>
                    <div class="checkrowdiv">
                        <div class="checkdiv"><input name="dismpkclick" type="checkbox" id="dismpkclick"><span id="a_dismpkclick">MPK & Click2Dial</span></div>
                    </div>
                </div>
                <input name="disdialplan" type="text" id="disdialplan" style="display:none;">
            </div>
            
            <div webtip="DialPlan" class="iptalkmode">
                <div class="noreboot"><span id="a_dialplan">DialPlan</span> :</div>
                <input id="dialplan" name="dialplan" type="text" />
            </div>
            <div webtip="Early Dial" style="display:none">
                <div class="noreboot"><span id="a_earlyd">Early Dial</span> :</div>
                <input name="earlydial" type="checkbox" id="earlydial"><span id="a_earlydyes">Yes</span>
            </div>
            <div webtip="Refer-To Use Target Contact" class="iptalkmode">
                <div class="noreboot"><span id="a_referto">Refer-To Use Target Contact</span> :</div>
                <input name="targetcon" type="checkbox" id="targetcon"><span id="a_refertoyes">Yes</span>
            </div>
            <div webtip="Auto Answer" class="bjmode h323mode">
                <div class="noreboot"><span id="a_autoans">Auto Answer</span> :</div>
                <select name="autoanswer" id="autoanswer">
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                    <!--<option value="2">Enable Paging/Intercom</option>-->
                </select>
            </div>
            <div webtip="Enable Fast Start" style="display:none;">  <!-- class="h323mode"-->
                <div class="noreboot"><span id="a_faststart">Enable Fast Start</span> :</div>
                <input name="faststart" type="checkbox" id="faststart"><span id="a_faststartyes">Yes</span>
            </div>
            <div webtip="Tunneling" style="display:none;">  <!-- class="h323mode"-->
                <div class="noreboot"><span id="a_tunneling">Tunneling</span> :</div>
                <input name="tunneling" type="checkbox" id="tunneling"><span id="a_tunnelingyes">Yes</span>
            </div>
            <div webtip="Enable H225 Keep-alive" style="display:none;" class="h323mode">
                <div class="noreboot"><span id="a_h225alive">Enable H225 Keep-alive</span> :</div>
                <input name="h225alive" type="checkbox" id="h225alive"><span id="a_h225aliveyes">Yes</span>
            </div>
            <div webtip="Enable H245 Keep-alive" style="display:none;" class="h323mode">
                <div class="noreboot"><span id="a_h245alive">Enable H245 Keep-alive</span> :</div>
                <input name="h245alive" type="checkbox" id="h245alive"><span id="a_h245aliveyes">Yes</span>
            </div>
            <div webtip="Enable RTDR" style="display:none;" class="h323mode">
                <div class="noreboot"><span id="a_enablertdr">Enable RTDR</span> :</div>
                <input name="enablertdr" type="checkbox" id="enablertdr"><span id="a_enablertdryes">Yes</span>
            </div>
            <div webtip="Send Anonymous" class="iptalkmode">
                <div class="noreboot"><span id="a_sendanoy">Send Anonymous</span> :</div>
                <input name="sendanony" type="checkbox" id="sendanony"><span id="a_sendanoyyes">Yes</span>
            </div>
            <div webtip="Anonymous Call Rejection" class="iptalkmode">
                <div class="noreboot"><span id="a_anonycallrej">Anonymous Call Rejection</span> :</div>
                <input name="anonyrej" type="checkbox" id="anonyrej"><span id="a_anonycallrejyes">Yes</span>
            </div>
            <div webtip="Call Log" class="iptalkmode bjmodeshow">
                <div class="noreboot"><span id="a_calllog">Call Log</span> :</div>
                <select name="calllog" id="calllog" style="width:200px;">
                    <option value="0">Log All</option>
                    <option value="1">Log Incoming/Outgoing only(Missed Calls Not Recorded)</option>
                    <option value="2">Disable Call All</option>
                </select>
            </div>
            <div webtip="Special Feature" class="iptalkmode">
                <div class="rebootitem"><span id="a_spefea">Special Feature</span> :</div>
                <select name="spefea" id="spefea">
                    <option value="100">Standard</option>
                    <option value="102">Broadsoft</option>
                    <option value="108">CBCOM</option>
                    <option value="109">RNK</option>
                    <option value="113">China Mobile</option>
                    <option value="114">ZTE IMS</option>
                    <option value="115">Mobotix</option>
                    <option value="116">ZTE NGN</option>
                    <option value="117">Huawei IMS</option>
                </select>
            </div>
            <div webtip="Feature Key Synchronization" class="iptalkmode">
                <div class="rebootitem"><span id="a_feakey">Feature Key Synchronization</span> :</div>
                <select name="feakey" id="feakey">
                    <option value="0">Disabled</option>
                    <option value="1">Broadsoft</option>
                </select>
            </div>
            <div webtip="Enable Call Features" class="bjmode iptalkmode">
                <div class="noreboot"><span id="a_encallfea">Enable Call Features</span> :</div>
                <input name="enablefea" type="checkbox" id="enablefea"><span id="a_encallfeayes">Yes</span>
            </div>
            <div webtip="Ring Timeout" class="bjmode iptalkmode">
                <div class="noreboot"><span id="a_ringto">Ring Timeout</span> :</div>
                <input id="ringto" name="ringto" type="text" />
            </div>
            <div webtip="Transfer on 3 way conference Hangup" class="iptalkmode">
                <div class="noreboot"><span id="a_tranonhang">Transfer on 3 way conference Hangup</span> :</div>
                <input name="tranonhang" type="checkbox" id="tranonhang"><span id="a_tranonhangyes">Yes</span>
            </div>
            <div webtip="Use # as Dial Key" class="iptalkmode bjmodeshow">
                <div class="noreboot"><span id="a_usepound">Use # as Dial Key</span> :</div>
                <input name="dialkey" type="checkbox" id="dialkey"><span id="a_usepoundyes">Yes</span>
            </div>
            <div webtip="DND Call Feature On" style="display:none;">
                <div class="noreboot"><span id="a_dndfeaon">DND Call Feature On</span> :</div>
                 <input id="dndfeaon" name="dndfeaon" type="text" />
            </div> 
            <div webtip="DND Call Feature Off" style="display:none;">
                <div class="noreboot"><span id="a_dndfeaoff">DND Call Feature Off</span> :</div>
                 <input id="dndfeaoff" name="dndfeaoff" type="text" />
            </div> 
            <div webtip="Conference URI" class="iptalkmode">
                <div class="noreboot"><span id="a_confuri">Conference-URI</span> :</div>
                 <input id="confuri" name="confuri" type="text" />
            </div> 
            <div webtip="Broadsoft Call Center" style="display:none;">
                <div class="noreboot"><span id="a_bcallcenter">Broadsoft Call Center</span> :</div>
                <input name="bcallcenter" type="checkbox" id="bcallcenter"><span id="a_bcallcenteryes">Yes</span>
            </div>
            <div webtip="Hoteling Event" style="display:none;">
                <div class="noreboot"><span id="a_hotelevent">Hoteling Event</span> :</div>
                <input name="hotelevent" type="checkbox" id="hotelevent"><span id="a_hoteleventyes">Yes</span>
            </div>
            <div webtip="Call Center Status" style="display:none;">
                <div class="noreboot"><span id="a_centerstatus">Call Center Status</span> :</div>
                <input name="centerstatus" type="checkbox" id="centerstatus"><span id="a_centerstatusyes">Yes</span>
            </div>
            <div webtip="Upload Local MOH Audio File" class="iptalkmode bjmodeshow">
				<div class="noreboot"><span id="a_uploadaudio">Upload Local MOH Audio File</span> :</div>
				<button id="a_browse" type="button">Browse</button>
			</div>
			<div webtip="Enable Local MOH" class="iptalkmode bjmodeshow">
			    <div class="noreboot"><span id="a_enablemoh">Enable Local MOH</span> :</div>
				<input name="enablemoh" type="checkbox" id="enablemoh"><span id="a_enable">Yes</span>
			</div>
			<div webtip="Account Ring Tone" class="bjmode iptalkmode">
                <div class="noreboot"><span id="a_defaultringtone">Account Ring Tone</span> :</div>
                <select id="tonename">
                    <option value="content://settings/system/ringtone">System Default Ringtone</option>
                    <option value="ringtone_silence">Silent</option>
                </select>
            </div>
            <div class="titlediv bjmode">
                <div class="titleboot" webtip="Call Forward"><span id="a_callforward">Call Forward</span></div>
            </div>
            <div webtip="Call Forward Type" class="bjmode">
                <div class="noreboot"><span id="a_cftype">Call Forward Type</span> :</div>
                <select name="cftype" id="cftype">
                    <option value="None">None</option>
                    <option value="allTo">Call Forward Unconditional</option>
                    <option value="TimeRule">Call Forward Rule by time</option>
                    <option value="WorkRule">Call Forward Rule when work</option>
                </select>
            </div>
            <div webtip="All To" class="uccfdiv bjmode">
                <div class="noreboot"><span id="a_allto">All To</span> :</div>
                <input id="uccf" name="uccf" type="text" />
            </div>
            <div webtip="Time Period" class="timecfdiv bjmode">
                <div class="noreboot"><span id="a_timerd">Time Period</span> :</div>
                <input id="timecffrom" name="timecffrom" type="text" style="width:93px;"/><span>~</span>
                <input id="timecfto" name="timecfto" type="text"  style="width:93px;"/>
            </div>
            <div webtip="In Time Forward To" class="timecfdiv bjmode">
                <div class="noreboot"><span id="a_intimeto">In Time To</span> :</div>
                <input id="intimeto" name="intimeto" type="text" />
            </div>
            <div webtip="Out Time Forward To" class="timecfdiv bjmode">
                <div class="noreboot"><span id="a_outtimeto">Out Time To</span> :</div>
                <input id="outtimeto" name="outtimeto" type="text" />
            </div>
            <div webtip="Enable Busy Forward" class="workcfdiv bjmode">
                <div class="noreboot"><span id="a_enablebusyto">Enable Busy Forward</span> :</div>
                <input name="enablebusyto" type="checkbox" id="enablebusyto"><span id="a_enablebusytoyes">Yes</span>
            </div>
            <div webtip="Busy To" class="workcfdiv bjmode">
                <div class="noreboot"><span id="a_busyto">Busy To</span> :</div>
                <input id="bcf" name="bcf" type="text" />
            </div> 
            <div webtip="Enable No Answer Forward" class="workcfdiv bjmode">
                <div class="noreboot"><span id="a_enablenoanswerto">Enable No Answer Forward</span> :</div>
                <input name="enablenoanswerto" type="checkbox" id="enablenoanswerto"><span id="a_enablenoanswertoyes">Yes</span>
            </div>
            <div webtip="No Answer To" class="workcfdiv bjmode">
                <div class="noreboot"><span id="a_noanswerto">No Answer To</span> :</div>
                <input id="nacf" name="nacf" type="text" />
            </div>
            <div webtip="No Answer Timeout" class="workcfdiv bjmode">
                <div class="noreboot"><span id="a_forwardwt">Delayed Call Forward Wait Time (s)</span> :</div>
                <input id="forwardwt" name="forwardwt" type="text" value="20" />
            </div>
            <div webtip="Enable DND Forword" class="workcfdiv">
                <div class="noreboot"><span id="a_enabledndfwd">Enable DND Forword</span> :</div>
                <input name="enabledndfwd" type="checkbox" id="enabledndfwd"><span id="a_enabledndfwdyes">Yes</span>
            </div>
            <div webtip="DND To" class="workcfdiv">
                <div class="noreboot"><span id="a_dndto">DND To</span> :</div>
                <input id="dndto" name="dndto" type="text" />
            </div>
            <div class="titlediv bjmode iptalkmode">
                <div class="titleboot" webtip=""><span id="a_ringtone">Ring tones</span></div>
            </div>
        	<div class="noreboot bjmode iptalkmode" style="width:280px;margin:8px 35px 0 35px;margin-bottom:5px;" webtip="Match Incoming Caller ID">
                <span id="a_matchincad">Match Incoming Caller ID</span>
            </div>
            <div class="noreboot bjmode iptalkmode" style="width:180px;margin-bottom:5px;" webtip="Distinctive Ring Tone">
                <span id="a_cusrtone">Distinctive Ring Tone</span>
            </div>
            <div class="bjmode iptalkmode">
                <div style="margin-top:2px !important;" class="noreboot"><input id="callerid1" name="callerid1" type="text" /></div>
                <select name="tonename1" id="tonename1">
                	<option value="content://settings/system/ringtone">System Default Ringtone</option>
                	<option value="ringtone_silence">Silent</option>
                </select>
            </div>
            <div class="bjmode iptalkmode">
                <div style="margin-top:2px !important;" class="noreboot"><input id="callerid2" name="callerid2" type="text" /></div>
                <select name="tonename2" id="tonename2">
                	<option value="content://settings/system/ringtone">System Default Ringtone</option>
                	<option value="ringtone_silence">Silent</option>
                </select>
            </div>
            <div style="padding-bottom:10px;" class="bjmode iptalkmode">
                <div style="margin-top:2px !important;" class="noreboot"><input id="callerid3" name="callerid3" type="text" /></div>
                <select name="tonename3" id="tonename3">
                	<option value="content://settings/system/ringtone">System Default Ringtone</option>
                	<option value="ringtone_silence">Silent</option>
                </select>
            </div>
        </fieldset>
        <div class="savediv">
            <button id="a_save" type="button" class="savebtn">Save</button>
            <button id="a_cancel" type="button" class="cancelbtn">Cancel</button>
        </div>
    </form>
    </div>

</div>
<script type="text/javascript">
	var cookie_lang = $.cookie( "MyLanguage");
    var version = $.cookie("ver");
    if ( !cookie_lang ){
        cookie_lang = 'en';
	}
    if ( cookie_lang == 'zh' ){
        document.write("<script src='../js/jquery.validate.messages_cn.js'><\/script>");
	}
    if(!version)
        version = new Date().getTime();
    document.write("<script src='../js/public.js?ver=" + version + "'><\/script>");
    document.write("<script src='../lang/" + cookie_lang + ".js?ver=" + version + "'><\/script>");

</script>
<script type="text/javascript">
    var req_items = new Array;
    var req_tone_items = new Array;
    //use req_tone_items seperately to avoid get value too slow, as get tonename will spend some time
    var accountindex = 0;
    var mRemotevideo = 0;
    
$(function(){
    //$("#dialmode option:eq(2)").attr("selected", true);
    //cb_get_index(req_indexs);
    accountindex = $('#accountindex',parent.document.body).val();
    if( accountindex == '4' ){
        $("fieldset > div").hide();
        $("#a_faststart").text(a_19121);
        $("#a_tunneling").text(a_19123);
        $("#a_h225alive").text(a_19160);
        $("#a_h245alive").text(a_19161);
        $("#a_enablertdr").text(a_19192);
        $("#a_faststartyes, #a_tunnelingyes, #a_h225aliveyes, #a_h245aliveyes, #a_enablertdryes").text(a_5);
        $(".h323mode").show();
    }
    if( accountindex == '2' ){
        $("#a_autoans").text(a_19141);
        //$("#autoanswer option:eq(2)").remove();
    }else if( accountindex == '4' ){
        $("#a_autoans").text(a_1102);
        //$("#autoanswer option:eq(2)").remove();
    }else{
        $("#a_autoans").text(a_1102);
        //$("#autoanswer option:eq(2)").text(a_1136);
    }
    
    var colore = $('#existcolore',parent.document.body).val();
    if(colore == 54){
        $("#confuri").parent().hide();
        $("#a_browse").parent().hide();
        $("#enablemoh").parent().hide();
    }
    
    setInitState();
    cb_get_pvalue(accountindex);
    cb_get_tonelist();
	init_uploadaudio();
	$("input[type='file']").attr("title", "");
    pageEventActions();
});
function cb_get_pvalue(acctindex){
    accountindex = acctindex;
	switch(accountindex)
	{
	    case '1':
	        req_items.push(
			    new ReqItem("prefix", "66", ""),
                new ReqItem("disdialplan", "2382", ""),
			    new ReqItem("dialplan", "290", ""),
			    new ReqItem("autovideo", "2314", ""),
				new ReqItem("startfull", "2332", ""),
				new ReqItem("remotevideo", "2326", ""),
				new ReqItem("earlydial", "29", ""),
			    new ReqItem("targetcon", "135", ""),
			    new ReqItem("autoanswer", "90", ""),
			    new ReqItem("sendanony", "65", ""),
			    new ReqItem("anonyrej", "129", ""),
                new ReqItem("calllog", "182", ""),
                new ReqItem("spefea", "198", ""),
			    new ReqItem("feakey", "2325", ""),
			    new ReqItem("enablefea", "191", ""),
			    new ReqItem("uccf", "allTo_0", ""),
			    new ReqItem("cftype", "display_0", ""),
			    new ReqItem("timecffrom", "starttime_0", ""),
			    new ReqItem("timecfto", "finishtime_0", ""),
			    new ReqItem("intimeto", "inTimeForward_0", ""),
			    new ReqItem("outtimeto", "outTimeForward_0", ""),
			    new ReqItem("bcf", "busyForward_0", ""),
			    new ReqItem("nacf", "delayedForward_0", ""),
			    new ReqItem("enablebusyto", "busyForwardEnable_0", ""),
			    new ReqItem("enablenoanswerto", "delayedForwardEnable_0", ""),
			    new ReqItem("forwardwt", "139", ""),
                new ReqItem("enabledndfwd", "dndForwardEnable_0", ""),
                new ReqItem("dndto", "dndForward_0", ""),
			    new ReqItem("dialkey", "72", ""),
			    new ReqItem("confuri", "2318", ""),
			    new ReqItem("dndfeaon", "2344", ""),
			    new ReqItem("dndfeaoff", "2345", ""),
			    new ReqItem("bcallcenter", "2341", ""),
			    new ReqItem("hotelevent", "2342", ""),
			    new ReqItem("centerstatus", "2343", ""),
			    new ReqItem("tranonhang", "2304", ""),
			    new ReqItem("ringto", "1328", ""),
			    new ReqItem("callerid1", "1488", ""),
			    new ReqItem("callerid2", "1490", ""),
			    new ReqItem("callerid3", "1492", ""),
                new ReqItem("enablemoh", "2357", "")
				//new ReqItem("dialmode", "dial_mode", "")
			);
			req_tone_items.push(
		        new ReqItem("tonename", "104", ""),
			    new ReqItem("tonename1", "1489", ""),
			    new ReqItem("tonename2", "1491", ""),
			    new ReqItem("tonename3", "1493", "")
		    );
		    break;
			
		case '2':
			req_items.push(
				/*new ReqItem("prefix", "419", ""),
				new ReqItem("dialplan", "459", ""),
				new ReqItem("autovideo", "2414", ""),
				new ReqItem("startfull", "2432", ""),
				new ReqItem("remotevideo", "2426", ""),
				new ReqItem("earlydial", "422", ""),
				new ReqItem("targetcon", "469", ""),*/
				new ReqItem("autoanswer", "425", ""),
				/*new ReqItem("sendanony", "421", ""),
				new ReqItem("anonyrej", "446", ""),
                new ReqItem("calllog", "442", ""),
                new ReqItem("spefea", "424", ""),
				new ReqItem("feakey", "2425", ""),
				new ReqItem("enablefea", "420", ""),*/
			    new ReqItem("forwardwt", "470", ""),
                new ReqItem("enabledndfwd", "dndForwardEnable_1", ""),
                new ReqItem("dndto", "dndForward_1", ""),
				new ReqItem("uccf", "allTo_1", ""),
				new ReqItem("cftype", "display_1", ""),
				new ReqItem("timecffrom", "starttime_1", ""),
				new ReqItem("timecfto", "finishtime_1", ""),
				new ReqItem("intimeto", "inTimeForward_1", ""),
				new ReqItem("outtimeto", "outTimeForward_1", ""),
				new ReqItem("bcf", "busyForward_1", ""),
				new ReqItem("nacf", "delayedForward_1", ""),
				new ReqItem("enablebusyto", "busyForwardEnable_1", ""),
			    new ReqItem("enablenoanswerto", "delayedForwardEnable_1", "")
				/*new ReqItem("dialkey", "492", ""),
				new ReqItem("dndfeaon", "2444", ""),
			    new ReqItem("dndfeaoff", "2445", ""),
			    new ReqItem("confuri", "2418", ""),
			    new ReqItem("bcallcenter", "2441", ""),
			    new ReqItem("hotelevent", "2442", ""),
			    new ReqItem("centerstatus", "2443", ""),
			    new ReqItem("tranonhang", "2404", ""),
				new ReqItem("ringto", "476", ""),
				new ReqItem("callerid1", "1494", ""),
				new ReqItem("callerid2", "1496", ""),
				new ReqItem("callerid3", "1498", ""),
				new ReqItem("enablemoh", "2457", "")*/
		    );
			req_tone_items.push(
                new ReqItem("tonename", "423", ""),
				new ReqItem("tonename1", "1495", ""),
				new ReqItem("tonename2", "1497", ""),
				new ReqItem("tonename3", "1499", "")
			);
			break;

		case '3':
			req_items.push(
				new ReqItem("prefix", "519", ""),
				new ReqItem("dialplan", "559", ""),
				new ReqItem("autovideo", "2514", ""),
				new ReqItem("startfull", "2532", ""),
				new ReqItem("remotevideo", "2526", ""),
				new ReqItem("earlydial", "522", ""),
				new ReqItem("targetcon", "569", ""),
				new ReqItem("autoanswer", "525", ""),
				new ReqItem("sendanony", "521", ""),
				new ReqItem("anonyrej", "546", ""),
                new ReqItem("calllog", "542", ""),
                new ReqItem("spefea", "524", ""),
				new ReqItem("feakey", "2525", ""),
				new ReqItem("enablefea", "520", ""),
			    new ReqItem("forwardwt", "570", ""),
                new ReqItem("enabledndfwd", "dndForwardEnable_2", ""),
                new ReqItem("dndto", "dndForward_2", ""),
				new ReqItem("uccf", "allTo_2", ""),
				new ReqItem("cftype", "display_2", ""),
				new ReqItem("timecffrom", "starttime_2", ""),
				new ReqItem("timecfto", "finishtime_2", ""),
				new ReqItem("intimeto", "inTimeForward_2", ""),
				new ReqItem("outtimeto", "outTimeForward_2", ""),
				new ReqItem("bcf", "busyForward_2", ""),
				new ReqItem("nacf", "delayedForward_2", ""),
				new ReqItem("enablebusyto", "busyForwardEnable_2", ""),
			    new ReqItem("enablenoanswerto", "delayedForwardEnable_2", ""),
				new ReqItem("dialkey", "592", ""),
				new ReqItem("confuri", "2518", ""),
			    new ReqItem("dndfeaon", "2544", ""),
			    new ReqItem("dndfeaoff", "2545", ""),
			    new ReqItem("bcallcenter", "2541", ""),
			    new ReqItem("hotelevent", "2542", ""),
			    new ReqItem("centerstatus", "2543", ""),
			    new ReqItem("tranonhang", "2504", ""),
				new ReqItem("ringto", "576", ""),
				new ReqItem("callerid1", "1500", ""),
				new ReqItem("callerid2", "1502", ""),
				new ReqItem("callerid3", "1504", ""),
				new ReqItem("enablemoh", "2557", "")
			);
			req_tone_items.push(
                new ReqItem("tonename", "523", ""),
				new ReqItem("tonename1", "1501", ""),
				new ReqItem("tonename2", "1503", ""),
				new ReqItem("tonename3", "1505", "")
			);
			break;

		case '4':
			req_items.push(
			    new ReqItem("autoanswer", "25048", ""),
				new ReqItem("faststart", "25050", ""),
				new ReqItem("tunneling", "25053", ""),
				new ReqItem("h225alive", "25058", ""),
				new ReqItem("h245alive", "25057", ""),
				new ReqItem("enablertdr", "25060", "")
				/*new ReqItem("prefix", "619", ""),
				new ReqItem("dialplan", "659", ""),
				new ReqItem("autovideo", "2614", ""),
				new ReqItem("startfull", "2632", ""),
				new ReqItem("remotevideo", "2626", ""),
				new ReqItem("earlydial", "622", ""),
				new ReqItem("targetcon", "669", ""),
				new ReqItem("autoanswer", "625", ""),
				new ReqItem("faststart", "faststart", ""),
				new ReqItem("gkdiscovermode", "gkdiscovermode", ""),
				new ReqItem("tunneling", "tunneling", "")
				new ReqItem("sendanony", "621", ""),
				new ReqItem("anonyrej", "646", ""),
				new ReqItem("calllog", "642", ""),
		        new ReqItem("spefea", "624", ""),
				new ReqItem("feakey", "2625", ""),
				new ReqItem("enablefea", "620", ""),
			    new ReqItem("forwardwt", "670", ""),
                new ReqItem("enabledndfwd", "dndForwardEnable_3", ""),
                new ReqItem("dndto", "dndForward_3", ""),
				new ReqItem("uccf", "allTo_3", ""),
				new ReqItem("cftype", "display_3", ""),
				new ReqItem("timecffrom", "starttime_3", ""),
				new ReqItem("timecfto", "finishtime_3", ""),
				new ReqItem("intimeto", "inTimeForward_3", ""),
				new ReqItem("outtimeto", "outTimeForward_3", ""),
				new ReqItem("bcf", "busyForward_3", ""),
				new ReqItem("nacf", "delayedForward_3", ""),
				new ReqItem("enablebusyto", "busyForwardEnable_3", ""),
			    new ReqItem("enablenoanswerto", "delayedForwardEnable_3", ""),
				new ReqItem("dialkey", "692", ""),
				new ReqItem("confuri", "2618", ""),
			    new ReqItem("dndfeaon", "2644", ""),
			    new ReqItem("dndfeaoff", "2645", ""),
			    new ReqItem("bcallcenter", "2641", ""),
			    new ReqItem("hotelevent", "2642", ""),
			    new ReqItem("centerstatus", "2643", ""),
			    new ReqItem("tranonhang", "2604", ""),
				new ReqItem("ringto", "676", ""),
				new ReqItem("callerid1", "1506", ""),
				new ReqItem("callerid2", "1508", ""),
				new ReqItem("callerid3", "1510", ""),
				new ReqItem("enablemoh", "2657", "")*/
			);
			req_tone_items.push(
                new ReqItem("tonename", "623", ""),
				new ReqItem("tonename1", "1507", ""),
				new ReqItem("tonename2", "1509", ""),
				new ReqItem("tonename3", "1511", "")
			);
			break;
			
		case '5':
			req_items.push(
				new ReqItem("prefix", "1719", ""),
				new ReqItem("dialplan", "1759", ""),
				new ReqItem("autovideo", "2714", ""),
				new ReqItem("startfull", "2732", ""),
				new ReqItem("remotevideo", "2726", ""),
				new ReqItem("earlydial", "1722", ""),
				new ReqItem("targetcon", "1769", ""),
				new ReqItem("autoanswer", "1725", ""),
				new ReqItem("sendanony", "1721", ""),
				new ReqItem("anonyrej", "1746", ""),
				new ReqItem("calllog", "1742", ""),
		        new ReqItem("spefea", "1724", ""),
				new ReqItem("feakey", "2725", ""),
				new ReqItem("enablefea", "1720", ""),
			    new ReqItem("forwardwt", "1770", ""),
                new ReqItem("enabledndfwd", "dndForwardEnable_4", ""),
                new ReqItem("dndto", "dndForward_4", ""),
				new ReqItem("uccf", "allTo_4", ""),
				new ReqItem("cftype", "display_4", ""),
				new ReqItem("timecffrom", "starttime_4", ""),
				new ReqItem("timecfto", "finishtime_4", ""),
				new ReqItem("intimeto", "inTimeForward_4", ""),
				new ReqItem("outtimeto", "outTimeForward_4", ""),
				new ReqItem("bcf", "busyForward_4", ""),
				new ReqItem("nacf", "delayedForward_4", ""),
				new ReqItem("enablebusyto", "busyForwardEnable_4", ""),
			    new ReqItem("enablenoanswerto", "delayedForwardEnable_4", ""),
				new ReqItem("dialkey", "1792", ""),
				new ReqItem("confuri", "2718", ""),
			    new ReqItem("dndfeaon", "2744", ""),
			    new ReqItem("dndfeaoff", "2745", ""),
			    new ReqItem("bcallcenter", "2741", ""),
			    new ReqItem("hotelevent", "2742", ""),
			    new ReqItem("centerstatus", "2743", ""),
			    new ReqItem("tranonhang", "2704", ""),
				new ReqItem("ringto", "1776", ""),
				new ReqItem("callerid1", "1512", ""),
				new ReqItem("callerid2", "1514", ""),
				new ReqItem("callerid3", "1516", ""),
				new ReqItem("enablemoh", "2757", "")
			);
			req_tone_items.push(
                new ReqItem("tonename", "1723", ""),
				new ReqItem("tonename1", "1513", ""),
				new ReqItem("tonename2", "1515", ""),
				new ReqItem("tonename3", "1517", "")
			);
			break;

		case '6':
			req_items.push(
				new ReqItem("prefix", "1819", ""),
				new ReqItem("dialplan", "1859", ""),
				new ReqItem("autovideo", "2814", ""),
				new ReqItem("startfull", "2832", ""),
				new ReqItem("remotevideo", "2826", ""),
				new ReqItem("earlydial", "1822", ""),
				new ReqItem("targetcon", "1869", ""),
				new ReqItem("autoanswer", "1825", ""),
				new ReqItem("sendanony", "1821", ""),
				new ReqItem("anonyrej", "1846", ""),
				new ReqItem("calllog", "1842", ""),
		        new ReqItem("spefea", "1824", ""),
				new ReqItem("feakey", "2825", ""),
				new ReqItem("enablefea", "1820", ""),
			    new ReqItem("forwardwt", "1870", ""),
                new ReqItem("enabledndfwd", "dndForwardEnable_5", ""),
                new ReqItem("dndto", "dndForward_5", ""),
				new ReqItem("uccf", "allTo_5", ""),
				new ReqItem("cftype", "display_5", ""),
				new ReqItem("timecffrom", "starttime_5", ""),
				new ReqItem("timecfto", "finishtime_5", ""),
				new ReqItem("intimeto", "inTimeForward_5", ""),
				new ReqItem("outtimeto", "outTimeForward_5", ""),
				new ReqItem("bcf", "busyForward_5", ""),
				new ReqItem("nacf", "delayedForward_5", ""),
				new ReqItem("enablebusyto", "busyForwardEnable_5", ""),
			    new ReqItem("enablenoanswerto", "delayedForwardEnable_5", ""),
				new ReqItem("dialkey", "1892", ""),
				new ReqItem("confuri", "2818", ""),
			    new ReqItem("dndfeaon", "2844", ""),
			    new ReqItem("dndfeaoff", "2845", ""),
			    new ReqItem("bcallcenter", "2841", ""),
			    new ReqItem("hotelevent", "2842", ""),
			    new ReqItem("centerstatus", "2843", ""),
			    new ReqItem("tranonhang", "2804", ""),
				new ReqItem("ringto", "1876", ""),
				new ReqItem("callerid1", "1518", ""),
				new ReqItem("callerid2", "1520", ""),
				new ReqItem("callerid3", "1522", ""),
				new ReqItem("enablemoh", "2857", "")
			);
			req_tone_items.push(
                new ReqItem("tonename", "1823", ""),
				new ReqItem("tonename1", "1519", ""),
				new ReqItem("tonename2", "1521", ""),
				new ReqItem("tonename3", "1523", "")
			);
			break;

    }
	
    cb_get(req_items);
    //cb_get_tonename(req_tone_items);
    //cb_get_lock_acct(1);
}
function translate_call(){
    $("#a_call").text(a_16027);
    $("#a_dialplanpr").text(a_16149);
    $("#a_disdialplan").text(a_16291);
    $("#a_disdialpage").text(a_19369);
    $("#a_discontact").text(a_19370);
    $("#a_disincoming").text(a_19371);
    $("#a_disoutgoing").text(a_19372);
    $("#a_dismpkclick").text(a_19373);
    $("#a_dialplan").text(a_16150);
    $("#a_autovideo").text(a_16151);
    $("#a_startfull").text(a_16152);
    $("#a_remotevideo").text(a_16106);
    $("#remotevideo option:eq(0)").text(a_415);
    $("#remotevideo option:eq(1)").text(a_10000);
    $("#remotevideo option:eq(2)").text(a_16107);
    $("#a_earlyd").text(a_16153);
    $("#a_referto").text(a_16154);
    $("#a_sendanoy").text(a_16155);
    $("#a_anonycallrej").text(a_16156);
    $("#a_calllog").text(a_16157);
    $("#calllog option:eq(0)").text(a_16158);
    $("#calllog option:eq(1)").text(a_16159);
    $("#calllog option:eq(2)").text(a_16160);
    $("#a_spefea").text(a_16161);
    $("#spefea option:eq(0)").text(a_16109);
    $("#spefea option:eq(4)").text(a_16162);
    $("#spefea option:eq(8)").text(a_16163);
    $("#a_feakey").text(a_16164);
    $("#feakey option:eq(0)").text(a_39);
    $("#a_encallfea").text(a_16165);
    $("#a_callforward").text(a_16166);
    $("#a_cftype").text(a_4318);
    $("#cftype option:eq(0)").text(a_20);
    $("#cftype option:eq(1)").text(a_1106);
    $("#cftype option:eq(2)").text(a_1112);
    $("#cftype option:eq(3)").text(a_1108);
    $("#tonename option:eq(0), #tonename1 option:eq(0), #tonename2 option:eq(0), #tonename3 option:eq(0)").text(a_8421);
    $("#a_allto").text(a_1107);
    $("#a_busyto").text(a_1109);
    $("#a_timerd").text(a_16167);
    $("#a_intimeto").text(a_1115);
    $("#a_outtimeto").text(a_1116);
    $("#a_noanswerto").text(a_1110);
    $("#a_enablebusyto").text(a_19114);
    $("#a_enablenoanswerto").text(a_19115);
    $("#a_forwardwt").text(a_1111);
    $("#a_enabledndfwd").text(a_19244);
    $("#a_dndto").text(a_19245);
    $("#a_ringto").text(a_16169);
    $("#a_tranonhang").text(a_16170);
    $("#a_usepound").text(a_16171);
    $("#a_dndfeaon").text(a_16172);
    $("#a_dndfeaoff").text(a_16173);
    $("#a_confuri").text(a_16174);
    $("#a_bcallcenter").text(a_16175);
    $("#a_hotelevent").text(a_16176);
    $("#a_centerstatus").text(a_583);
    $("#a_defaultringtone").text(a_16177);
    $("#a_ringtone").text(a_4752);
    $("#a_matchincad").text(a_16178);
    $("#a_cusrtone").text(a_16179);
    $("#autoanswer option:eq(0)").text(a_6);
    $("#autoanswer option:eq(1), #a_earlydyes, #a_refertoyes, #a_autoansyes, #a_sendanoyyes, #a_anonycallrejyes, #a_encallfeayes, #a_usepoundyes, #a_trfohuyes, #a_tranonhangyes, #a_bcallcenteryes, #a_autovideoyes, #a_startfullyes, #a_hoteleventyes, #a_centerstatusyes, #a_enablebusytoyes, #a_enablenoanswertoyes, #a_enabledndfwdyes").text(a_5);
    $("#a_uploadaudio").text(a_16180);
	$("#a_browse").text(a_16486);
	$("#a_enablemoh").text(a_16181);
	$("#a_enable").text(a_5);
	$("#a_cancel").text(a_3);
    $("#a_save").text(a_17);
    /*$("#a_dialmode").text(a_16653);
    $("#dialmode option:eq(0)").text(a_415);
    $("#dialmode option:eq(1)").text(a_10017);
    $("#dialmode option:eq(2)").text(a_10016);*/
}

function init_uploadaudio()
{
	var button = $("#a_browse"), interval;
	var uploadkeytimer = 0;
	var fileext;
	new Ajax_upload(button, {
		name: 'file',
		action : '../upload?type=audiofile&acct=' + accountindex,
		onSubmit : function(file, ext) {
			cb_ping();
			fileext = ext;
			//action : '../upload?type=audiofile&ext=' + fileext + '&acct=' + accountindex;
			if (!(ext && (/^(wav)$/.test(ext) || /^(mp3)$/.test(ext)))) {
				//$.prompt(ext_wrong);
				view_message(a_16182,MSG_FAIL);
				return false;
			}

			window.parent.block_upload_func();
			button.text(a_16431);
			button.addClass("widebtn");

			//this.disable();
			$("#a_browse").attr("disabled", "true");

			interval = window.setInterval(function(){
				var text = button.text();
				uploadkeytimer ++;
				if (text.length < (a_16431.length +3)) {
					button.text(text + ".");
				} else {
					button.text(a_16431);
				} 
				if (uploadkeytimer > 900) {
					window.clearInterval(interval);
					uploadkeytimer = 0;
					$.prompt(a_16432);
					button.text(a_7404);
					button.removeClass("widebtn");
				}	
			}, 200);	
		},
		onComplete: function(file, response) {
			//var msgs = res_parse_rawtext(response);
			//var size = msgs.headers['Size'];
			var msgs = response.split("Size");
			msgs = msgs[1].split("<");
			var size = msgs[0].substring(1,msgs[0].length);
			var size_int = parseInt(size);
			if(size > 5000000)
				alert(a_16439);
			button.text(a_8104);
			window.clearInterval(interval);
			$("input[type='file']").attr("title", "");
			uploadkeytimer = 0;
			//alert("success");
			//button.text(a_browse);
			cb_audio_upload_success(fileext);
			//this.enable();
		}
	});
}

function cb_audio_upload_success(fileext)
{
	var urihead = "action=converaudio&region=account&ext=" + fileext + "&acct=" + accountindex;
	urihead += "&time=" + new Date().getTime();
	$.ajax ({
		type: 'get',
		url: '/manager',
		data: urihead,
		dataType: 'text',
		success:function(data) {
			//cb_audio_conver_success(data);
			var msg = res_parse_rawtext(data);
			var response = msg.headers['response'];

			if(response == "Success") 
				$.prompt(a_16476);
			else
				$.prompt(a_16477);
			$("#a_browse").removeClass("widebtn");
			$("#a_browse").text(a_16486);
			$("#a_browse").removeAttr("disabled");
			window.parent.unblock_func();
		},
		error:function(xmlHttpRequest, errorThrown) {
			/*view_message(a_uploadfail, MSG_FAIL);
			$("#a_browse").removeClass("widebtn");
			$("#a_browse").text(a_browse);*/
		}
	});
}

function cb_get_tonelist(){
	var urihead = "action=tonelist&region=account";
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_get_tonelist_done(data);
        },
        error:function(xmlHttpRequest, errorThrown) {
            cb_networkerror(xmlHttpRequest, errorThrown);
        }
    });
}
function cb_get_tonelist_done(data){
	if( data.substring(0, 1) == "{" )
    {
        var json = eval("(" + data + ")");
		var ringtone = json.Ringtone;
		var ringname, indexdot;
		for (var i = 0; ringtone[i] != undefined; i++) {
			indexdot = ringtone[i].lastIndexOf(".");
			ringname = ringtone[i].substring(0, indexdot);
			var $toneopt = $("<option value='/system/media/audio/ringtones/" + ringtone[i] + "'>" + htmlEncode(ringname) + "</option>");
			$('#tonename').append($toneopt);
			$toneopt.clone(true).appendTo($('#tonename1'));
			$toneopt.clone(true).appendTo($('#tonename2'));
			$toneopt.clone(true).appendTo($('#tonename3'));
		}
	}
	cb_get_tonelist1();
    //cb_get_pvalue($('#accountindex',parent.document.body).val());
}

function cb_get_tonelist1(){
	var urihead = "action=tonelist1&region=account";
	urihead += "&time=" + new Date().getTime();
	$.ajax ({
		type: 'get',
		url: '/manager',
		data:urihead,
		datatype:'text',
		success:function(data) {
			cb_get_tonelist_done1(data);
		},
		error:function(xmlHttpRequest, errorThrown) {
			cb_networkerror(xmlHttpRequest, errorThown);
		}
	});
}

function cb_get_tonelist_done1(data) {
	if( data.substring(0,1) == "{" )
	{
		var tObj = eval("(" + data + ")");
		var data, title;
		var items = tObj.Ringtone;

		for (var i = 0; items[i] != undefined; i++)
		{
			data = items[i].data;
			title = items[i].title;
			var $toneopt = $("<option value='" + data + "'>" + htmlEncode(title) + "</option>");
			$("#tonename").append($toneopt);
			$toneopt.clone(true).appendTo($('#tonename1'));
			$toneopt.clone(true).appendTo($('#tonename2'));
			$toneopt.clone(true).appendTo($('#tonename3'));
		}
	}
	if( accountindex == '1' )
	    cb_get_tonename(req_tone_items);
}
function cb_get_tonename(items){
	var uritail = "";
    for (var i = 0; i < items.length; i++) {
        uritail += build_get(i, items[i].pvalue);
    }
	var urihead = "action=get&" + uritail;
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            cb_get_tonename_suc(data, items);
        },
        error:function(xmlHttpRequest, errorThrown) {
            view_message("Get Error", MSG_ALERT);
        }
    });
}
function cb_get_tonename_suc(data, items) {
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    view_ringtone_write(msgs, items);
}
function view_ringtone_write(msgs, items) {
    $("#tonename,#tonename1").sSelect({ddMaxHeight:"280px"});
	$("#tonename2,#tonename3").sSelect({ddMaxHeight:"300px"});
    var temp;
    for (var i = 0; i < items.length; i++) {
		var tempid = '#' + items[i].id;
        var temp = $(tempid);
        temp.getSetSSValue(msgs.headers[items[i].pvalue.toLowerCase()]); 
        
        /*if (temp == null || temp == undefined || temp.length == 0){
			alert(tempid + ' is ' + temp);
            var tempname = 'input[name=' + items[i].id + ']';
			temp = $(tempname);
        }
        else {
			var tempsel = tempid + ' option';
			var temp = $(tempsel);
            for (var q = 0; q < temp.length; q++) {
                if (temp.eq(q).val() ==
                    msgs.headers[items[i].pvalue.toLowerCase()]) {
                    temp.eq(q).attr('selected', true);
                    break;
                }
            }
        }*/
    }
}
function cb_put_tonename(items) {
    var uritail = "";
    for (var i = 0, k = 0; i < items.length; i++, k++) {
		var tempid = '#' + items[i].id;
        var temp = $(tempid);
        if (temp == null || temp == undefined || temp.length == 0)
        {
            var tempname = 'input[name=' + items[i].id + ']';
			temp = $(tempname);
        }
        var val = temp.val();
		uritail +=
            build_put(k, items[i].pvalue, val);
	}
	var urihead = "action=put&" + uritail;
    urihead += "&time=" + new Date().getTime();
    $.ajax ({
        type: 'get',
        url:'/manager',
        data:urihead,
        dataType:'text',
        success:function(data) {
            //cb_put_suc(data);
        },
        error:function(xmlHttpRequest, errorThrown) {
            view_message("Put Error", MSG_ALERT);
        }
    });
}
function setInitState(){
    if( accountindex != '4' ){
        change_forword_type("TimeRule");
    }
    //$(".uccfdiv, .timecfdiv, .workcfdiv").hide();
    translate_call();
    $("#Formvalidate").validate({
		rules: {
                forwardwt: { digits:true, required:true, range:[1,120] },
                ringto: { digits:true, range:[0,300] }
        },

		errorElement: "em",
		success: function(label) {label.text(" ").addClass("success"); }
    });
    //$("#spefea").sSelect({ddMaxHeight:"100px"});
    $("#remotevideo, #calllog, #cftype, #spefea, #feakey, #autoanswer").sSelect();
    //$("#calllog").next(".newListSelected").children(".newList").addClass("widenewList");
}
function change_forword_type(type)
{
    if( type == "None" )
    {
        $(".uccfdiv").hide();
        $(".timecfdiv").hide();
        $(".workcfdiv").hide();
    }else if( type == "allTo" )
    {
        $(".uccfdiv").show();
        $(".timecfdiv").hide();
        $(".workcfdiv").hide();
    }else if( type == "TimeRule" )
    {
        $(".uccfdiv").hide();
        $(".timecfdiv").show();
        $(".workcfdiv").hide();
    }else if( type == "WorkRule" )
    {
        $(".uccfdiv").hide();
        $(".timecfdiv").hide();
        $(".workcfdiv").show();
    }
}      
function update_forward_type()
{
    var type = $("#cftype").val();
    change_forword_type(type);
}

function cb_put_suc(data, mode)
{
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    if( cb_if_is_fail(msgs) )
        view_message(a_16419, MSG_FAIL);
    else {
        view_message(a_7479, MSG_OK); 
    }
    checkIsApplyNeed();
}

function tobinary(n)
{
    var binstr = tobinChange(n);
    while( binstr.length % 5 != 0 ) {
        binstr = "0" + binstr;
    }
    return binstr;
}

function tobinChange(n)
{
    if(!isNaN(n) && n>0)
    {
        if(n%2==0)
        {
            return tobinChange(n/2)+"0";
        }
        else {
            if(n>2)
            {
                return tobinChange(parseInt(n/2))+(n%2);
            }
            else
            {
            return tobinChange(0)+n;
            }
        }
    }
    else
    {
        return "";
    }
}

function pageEventActions(){
    $("#cftype").change(function(){
        update_forward_type();
    });
    
    $("#bcallcenter").change(function(){
        update_callcenter_mode();
    });
    
    $("#a_save").click(function(){
        var tmptype = $("#cftype").val();
        if( tmptype == "TimeRule" ){
            $("#timecffrom").rules("add", { required: true });
            $("#timecfto").rules("add", { required: true });
        }else{
            $("#timecffrom").rules("remove");
            $("#timecfto").rules("remove");
        }
        if( !$("#Formvalidate").valid() ){
            view_message(a_16442,MSG_FAIL);
            return false;
        }
        if( accountindex == '1' || accountindex == '2' ){
            if( cb_check_forward_time( $("#timecffrom").val() ) == 0 || cb_check_forward_time( $("#timecfto").val() ) == 0 )
            {
                view_message(a_16478,MSG_FAIL);
                return false;
            }
            /*if( tmptype == "None" )
            {
                $("#uccf, #intimeto, #outtimeto, #bcf, #nacf").val("");
            }*/
            $("#uccf").val( $.trim($("#uccf").val()) );
            $("#intimeto").val( $.trim($("#intimeto").val()) );
            $("#outtimeto").val( $.trim($("#outtimeto").val()) );
            $("#bcf").val( $.trim($("#bcf").val()) );
            $("#nacf").val( $.trim($("#nacf").val()) );
        }
        
        if($("#dialplan").val() == ""){
            $("#dialplan").val("{ x+ | \\+x+ | *x+ | *xx*x+ | x+*x+*x+*x+ | x+*x+*x+*x+#x+ }");
        }
        
        var dialplan = $.trim($("#dialplan").val());
        $("#dialplan").val(dialplan);
        if(dialplan.charAt(0) != "{" || dialplan.charAt(dialplan.length - 1) != "}"){
            $.prompt(a_19251);
            return false;
        }
        
        var disdialpage = "0", discontact = "0", disincoming = "0", disoutgoing = "0", dismpkclick = "0";
        if( $("#disdialpage").attr("checked") ){
            disdialpage = "1";
        }
        if( $("#discontact").attr("checked") ){
            discontact = "1";
        }
        if( $("#disincoming").attr("checked") ){
            disincoming = "1";
        }
        if( $("#disoutgoing").attr("checked") ){
            disoutgoing = "1";
        }
        if( $("#dismpkclick").attr("checked") ){
            dismpkclick = "1";
        }
        var disdialplan = dismpkclick + disoutgoing + disincoming + discontact + disdialpage;
        $("#disdialplan").val( parseInt(disdialplan, 2) );
        
        cb_put(req_items, "");
        if( accountindex == '1' )
            cb_put_tonename(req_tone_items, "");
        //cb_put_tonename(req_tone_items);
        //appendApplyFunction("cb_set_autoanswer(" + accountindex + ")");
        //appendApplyFunction("cb_set_callforward(" + accountindex + ", '" + tmptype + "')");
		var applyfun = $.cookie("applyfunc");
        var perfixval = $("#prefix").val();
        perfixval = perfixval.replace("\\","\\\\");
        if( accountindex == '4' )
		    accountindex = '9';
		if (applyfun != undefined && applyfun != ""){
			applyfun += ";cb_set_autoanswer(" + accountindex + ");";
			if( accountindex == '1' || accountindex == '2' )
			    applyfun += "cb_set_callforward(" + accountindex + ", '" + tmptype + "');cb_set_remotevideo(" + $("#remotevideo").val() + ");";
			if( accountindex == '1' )
			    applyfun += "cb_set_prefix('"+perfixval+"')";
		}else{
			applyfun = "cb_set_autoanswer(" + accountindex + ");";
			if( accountindex == '1' || accountindex == '2' )
			    applyfun += "cb_set_callforward(" + accountindex + ", '" + tmptype + "');cb_set_remotevideo(" + $("#remotevideo").val() + ");";
			if( accountindex == '1' )
			    applyfun += "cb_set_prefix('"+perfixval+"')";
	    }
		$.cookie("applyfunc", applyfun, {path: '/', expires: 10});
        //cb_set_autoanswer(1);
        //cb_set_callforward(1, tmptype);
    });
    setTimeout("update_forward_type()", 500);

}
function update_callcenter_mode()
{
	if( $("#bcallcenter").prop("checked") )
	{
		$("#a_hotelevent, #a_centerstatus").css("color", "#555555");
		$("#hotelevent, #centerstatus").attr("disabled", false);
		$("#feakey").getSetSSValue("1");
	}else
	{
		$("#a_hotelevent, #a_centerstatus").css("color", "gray");
		$("#hotelevent, #centerstatus").attr("disabled", true);
		$("#feakey").getSetSSValue("0");
	}
}
function get_item_suc_callback() {
    if( $("#bcallcenter").prop("checked") )
	{
		$("#a_hotelevent, #a_centerstatus").css("color", "#555555");
		$("#hotelevent, #centerstatus").attr("disabled", false);
	}else
	{
		$("#a_hotelevent, #a_centerstatus").css("color", "gray");
		$("#hotelevent, #centerstatus").attr("disabled", true);
	}
	if( accountindex == 2 ){
        $(".iptalkmode").hide();
        //$("#a_dialplan").removeClass("netfontcolor").addClass("grayfont");
        //$("#dialplan").attr("disabled", true);
    }
    else if( accountindex == 3){
        $("#calllog option:eq(1)").remove();
        $("#calllog").resetSS();
        $(".iptalkmode, .bjmode").hide();
        $(".bjmodeshow").show();
    }
    else if(accountindex == 1){
        $("#tranonhang").parent().hide();
    }
    
    var disdialplan = tobinary(parseInt($("#disdialplan").val()));
	if( disdialplan.substring(0, 1) == "1" ){
	    $("#dismpkclick").attr("checked", true);
	}
	if( disdialplan.substring(1, 2) == "1" ){
	    $("#disoutgoing").attr("checked", true);
	}
	if( disdialplan.substring(2, 3) == "1" ){
	    $("#disincoming").attr("checked", true);
	}
	if( disdialplan.substring(3, 4) == "1" ){
	    $("#discontact").attr("checked", true);
	}
	if( disdialplan.substring(4, 5) == "1" ){
	    $("#disdialpage").attr("checked", true);
	}
}
function cb_if_put_suc(data){
    var msgs = res_parse_rawtext(data);
    cb_if_auth_fail(msgs);
    cb_if_is_fail(msgs);
    cb_put_suc(data,"");
    cb_get_twitter();    
}

</script>

</body>

</html>
